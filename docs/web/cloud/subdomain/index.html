<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="readloud">
    
    <link rel="shortcut icon" href="../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Subdomain Discovery - readloud.org</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Subdomain Discovery", url: "#_top", children: [
              {title: "Automation", url: "#automation" },
              {title: "Google Dorks", url: "#google-dorks" },
              {title: "Online Tools", url: "#online-tools" },
              {title: "Subdomain Takeover", url: "#subdomain-takeover" },
          ]},
          {title: "Subdomain Takeover", url: "#subdomain-takeover_1", children: [
              {title: "Automation", url: "#automation_1" },
              {title: "Can I Take Over XYZ?", url: "#can-i-take-over-xyz" },
              {title: "CNAME Subdomain Takeover", url: "#cname-subdomain-takeover" },
              {title: "NS Subdomain Takeover", url: "#ns-subdomain-takeover" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    

    <h1 id="subdomain-discovery">Subdomain Discovery</h1>
<p>Finding subdomains is a method of reconnaissance.</p>
<h2 id="automation">Automation</h2>
<p>Reference: <a href="https://medium.com/@DrakenKun/how-to-find-subdomain-takeover-using-httpx-dig-5c2351d380b4">https://medium.com/@DrakenKun/how-to-find-subdomain-takeover-using-httpx-dig-5c2351d380b4</a></p>
<h3 id="subfinder">Subfinder</h3>
<p>To set API keys, add them to <code>$HOME/.config/subfinder/provider-config.yaml</code>. See <a href="https://docs.projectdiscovery.io/tools/subfinder/install#post-install-configuration">https://docs.projectdiscovery.io/tools/subfinder/install#post-install-configuration</a> for details.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a># -all: Use all sources for enumeration
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a># -cs: Include all sources in the output
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>subfinder -d example.com -all -cs &gt; tmp. ; cat tmp. | cut -d &quot;,&quot; -f 1 &gt; domains. ; rm tmp.
</span></code></pre></div>
<h3 id="bbot">BBOT</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>bbot -t example.com -f subdomain-enum
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a># After enumerating, see the result file at ~/.bbot/scans/xxxx_xxxx/subdomains.
</span></code></pre></div>
<p><br /></p>
<h2 id="google-dorks">Google Dorks</h2>
<p>Use <code>site:</code> parameter on Google search.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>site:example.com
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>site:*.example.com
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>site:*.*.example.com
</span></code></pre></div>
<p><br /></p>
<h2 id="online-tools">Online Tools</h2>
<ul>
<li><strong><a href="https://www.nmmapper.com/">nmmapper</a></strong></li>
</ul>
<p><br /></p>
<h2 id="subdomain-takeover">Subdomain Takeover</h2>
<p>After enumerating, it’s worth to check the <a href="/exploit/reconnaissance/subdomain-takeover">Subdomain Takever</a>.</p>
<h1 id="subdomain-takeover_1">Subdomain Takeover</h1>
<p>Subdomain Takeover is a malicious activity that the victim’s subdomain allows attackers to control and impersonate.</p>
<div class="language-text highlight"><pre><span></span><code>- [10-Test_for_Subdomain_Takeover](https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/10-Test_for_Subdomain_Takeover)
- [how-to-find-subdomain-takeover](https://medium.com/@DrakenKun/how-to-find-subdomain-takeover-using-httpx-dig-5c2351d380b4)
</code></pre></div>
<h2 id="automation_1">Automation</h2>
<p>First we need to enumerate subdomains. See <a href="/exploit/reconnaissance/subdomain-discovery">Subdomain Discovery</a> for doing that.  Then we can httpx for checking HTTP response status for each subdomain.</p>
<h3 id="httpx">httpx</h3>
<p><a href="https://github.com/projectdiscovery/httpx">https://github.com/projectdiscovery/httpx</a></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a># -title: Display page title
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a># -wc: Display response body word count
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a># -sc: Display response status-code
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a># -cl: Display response content-length
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a># -ct: Display response content-type
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a># -location: Display response redirect location
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a># -web-server: Display server name
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a># -asn: Display host ASN information
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a># -o: Output
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>cat domains. | httpx -title -wc -sc -cl -ct -location -web-server -asn -o alive-subdomains.
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a># Resume Scan (-resume)
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a># You can resume the scan using `resume.cfg`.
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>cat domains. | httpx -title -wc -sc -cl -ct -location -web-server -asn -o alive-subdomains. -resume resume.cfg
</span></code></pre></div>
<p><br /></p>
<h2 id="can-i-take-over-xyz">Can I Take Over XYZ?</h2>
<p>See <a href="https://github.com/EdOverflow/can-i-take-over-xyz">https://github.com/EdOverflow/can-i-take-over-xyz</a> to check if the provider allows us to register subdomains.</p>
<p><br /></p>
<h2 id="cname-subdomain-takeover">CNAME Subdomain Takeover</h2>
<h3 id="1-identify-misconfigurations-for-subdomains">1. Identify Misconfigurations for Subdomains</h3>
<p>Check DNS records for identifying what’s on the destination of the subdomain.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>dig sub.example.com ANY
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>dig sub.example.com CNAME
</span></code></pre></div>
<p>If the HEADER status is <strong>NXDOMAIN</strong> error in the result, subdomain takeover might be possible.<br />
Also we can try to access them with web browser or command-line:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a># -L: Follow redirect
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a># -v: Verbose mode
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>curl -Lv app.example.com
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>curl -v cloud.example.com
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>curl -v mail.example.com
</span></code></pre></div>
<h3 id="2-spoof-with-the-subdomain">2. Spoof with the Subdomain</h3>
<p>If a certain subdomain can be accessible but the error page of the specific provider (e.g. GitHub, Google Cloud, Wix, etc.)  appeared, it means that the subdomain of the settings in the service provider was removed but the DNS record (e.g. A, CNAME) remains yet.   </p>
<p>In short, attackers can spoof as a legitimate site by claiming this subdomain in the provider.</p>
<p>Here’s an abstract example:</p>
<ol>
<li>Login the target provider.</li>
<li>Create a malicious website.</li>
<li>Add the target subdomain (e.g. app.example.com) as custom domain in the setting page.</li>
<li>If users visit app.example.com, they have now visited a malicious website created by an attacker.</li>
</ol>
<p><br /></p>
<h2 id="ns-subdomain-takeover">NS Subdomain Takeover</h2>
<p>It’s more dangerous If NS record is vulnerable because if the nameserver is taken over, an attacker can take full control of victim’s domains.</p>
<p>To gather NS records for the target domain, use <code>dig</code> command.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>dig example.com +short NS
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a># Result examples
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>ns-100.abcde.org
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>ns-120.abcde.co.uk
</span></code></pre></div>
<p>Next, check if the gathered domains can be purchased with domain name registrar like GoDaddy, NameCheap.</p>
<p>For example, search <code>[abcde.org](http://abcde.org)</code> in the domain search page of NameCheap. If this domain can be purchased, attackers can buy this domain then take control the name resolution of a victim by creating the custom nameserver which pointed to this domain.</p>

  <br>
    

    <br>
</div>

<footer class="col-md-12 wm-page-content">
      <p>
        <a href="https://github.com/readloud/readloud.github.io/releases/tag/themes/edit/master/docs/web/cloud/subdomain.md"><i class="fa fa-github"></i>
Edit on GitHub</a>
      </p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/noraj/mkdocs-windmill-dark">Windmill Dark</a> theme by Alexandre ZANNI (noraj).</p>
<p>        ⚠️ The quieter you become, the more you are able to hear 🥷</p>
</footer>

</body>
</html>